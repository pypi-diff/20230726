# Comparing `tmp/mariqt-0.5.7-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.8-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 214685 bytes, number of entries: 31
--rw-r--r--  2.0 unx     5876 b- defN 23-Jul-24 10:48 mariqt/converters.py
--rw-r--r--  2.0 unx    14710 b- defN 23-Jul-24 10:48 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-Jul-24 10:48 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jul-24 10:48 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 23-Jul-24 10:48 mariqt/files.py
--rw-r--r--  2.0 unx    28565 b- defN 23-Jul-24 10:48 mariqt/geo.py
--rw-r--r--  2.0 unx    23207 b- defN 23-Jul-24 10:48 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 23-Jul-24 10:48 mariqt/misc.py
--rw-r--r--  2.0 unx    40980 b- defN 23-Jul-24 10:48 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-Jul-24 10:48 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-Jul-24 10:48 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 23-Jul-24 10:48 mariqt/settings.py
--rw-r--r--  2.0 unx     8323 b- defN 23-Jul-24 10:48 mariqt/tests.py
--rw-r--r--  2.0 unx     9613 b- defN 23-Jul-24 10:48 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-Jul-24 10:48 mariqt/version.py
--rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-24 10:48 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-24 10:48 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
--rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-24 10:48 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 23-Jul-24 10:48 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4684 b- defN 23-Jul-24 10:48 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jul-24 10:48 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   117609 b- defN 23-Jul-24 10:48 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-Jul-24 10:48 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-Jul-24 10:48 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jul-24 10:48 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-24 10:50 mariqt-0.5.7.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-24 10:50 mariqt-0.5.7.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-Jul-24 10:50 mariqt-0.5.7.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Jul-24 10:50 mariqt-0.5.7.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-24 10:50 mariqt-0.5.7.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-24 10:50 mariqt-0.5.7.dist-info/RECORD
-31 files, 1080956 bytes uncompressed, 210659 bytes compressed:  80.5%
+Zip file size: 214833 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jul-25 14:34 mariqt/converters.py
+-rw-r--r--  2.0 unx    14710 b- defN 23-Jul-25 14:34 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jul-25 14:34 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-25 14:34 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jul-25 14:34 mariqt/files.py
+-rw-r--r--  2.0 unx    28565 b- defN 23-Jul-25 14:34 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jul-25 14:34 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jul-25 14:34 mariqt/misc.py
+-rw-r--r--  2.0 unx    40980 b- defN 23-Jul-25 14:34 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jul-25 14:34 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jul-25 14:34 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jul-25 14:34 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jul-25 14:34 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jul-25 14:34 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-25 14:34 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-25 14:34 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-25 14:34 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-25 14:34 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jul-25 14:34 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jul-25 14:34 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jul-25 14:34 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   118284 b- defN 23-Jul-25 14:34 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jul-25 14:34 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jul-25 14:34 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-25 14:34 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-25 14:39 mariqt-0.5.8.dist-info/RECORD
+31 files, 1081631 bytes uncompressed, 210807 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.5.7.dist-info/AUTHORS.md
+Filename: mariqt-0.5.8.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.5.7.dist-info/LICENSE
+Filename: mariqt-0.5.8.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.5.7.dist-info/METADATA
+Filename: mariqt-0.5.8.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.5.7.dist-info/WHEEL
+Filename: mariqt-0.5.8.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.5.7.dist-info/top_level.txt
+Filename: mariqt-0.5.8.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.5.7.dist-info/RECORD
+Filename: mariqt-0.5.8.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.5.7'
+__version__ = '0.5.8'
```

## mariqt/sources/ifdo.py

```diff
@@ -123,7229 +123,7271 @@
 000007a0: 2220 5072 6f76 6964 6573 2063 6f6e 7665  " Provides conve
 000007b0: 6e69 656e 7420 6675 6e63 7469 6f6e 7320  nient functions 
 000007c0: 666f 7220 7265 6164 696e 6720 6461 7461  for reading data
 000007d0: 2066 726f 6d20 6946 444f 2066 696c 6573   from iFDO files
 000007e0: 2022 0a20 2020 2020 2020 200a 2020 2020   ".        .    
 000007f0: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
 00000800: 6520 3d20 6946 444f 6669 6c65 0a20 2020  e = iFDOfile.   
-00000810: 2020 2020 206f 203d 206f 7065 6e28 7365       o = open(se
-00000820: 6c66 2e69 4644 4f66 696c 652c 2027 7227  lf.iFDOfile, 'r'
-00000830: 290a 2020 2020 2020 2020 7365 6c66 2e69  ).        self.i
-00000840: 6664 6f20 3d20 7961 6d6c 2e6c 6f61 6428  fdo = yaml.load(
-00000850: 6f2c 2020 4c6f 6164 6572 3d79 616d 6c2e  o,  Loader=yaml.
-00000860: 434c 6f61 6465 7229 0a20 2020 2020 2020  CLoader).       
-00000870: 206f 2e63 6c6f 7365 2829 0a0a 0a20 2020   o.close()...   
-00000880: 2064 6566 205f 5f67 6574 6974 656d 5f5f   def __getitem__
-00000890: 2873 656c 662c 206b 6579 7329 3a0a 2020  (self, keys):.  
-000008a0: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
-000008b0: 7320 636f 7079 206f 6620 6368 6563 6b65  s copy of checke
-000008c0: 6420 6966 646f 2073 6574 206f 7220 6974  d ifdo set or it
-000008d0: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
-000008e0: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
-000008f0: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
-00000900: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
-00000910: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
-00000920: 2061 7320 652e 672e 2027 3c69 7465 6d3e   as e.g. '<item>
-00000930: 3a3c 6b65 793e 3a2e 2e2e 272e 2043 616e  :<key>:...'. Can
-00000940: 2062 6520 7573 6564 2066 6f72 2068 6561   be used for hea
-00000950: 6465 7220 6669 656c 6473 2061 7320 7765  der fields as we
-00000960: 6c6c 2061 7320 6974 656d 2066 6965 6c64  ll as item field
-00000970: 732e 0a20 2020 2020 2020 2020 2020 2049  s..            I
-00000980: 7465 6d20 696e 6465 7820 6361 6e20 6265  tem index can be
-00000990: 206c 6567 6c65 6374 6564 2c20 696e 2063   leglected, in c
-000009a0: 6173 6520 6f66 2076 6964 656f 2061 2064  ase of video a d
-000009b0: 6963 7420 7b3c 696d 6167 652d 6461 7461  ict {<image-data
-000009c0: 7469 6d65 3e3a 3c76 616c 7565 3e2c 2e2e  time>:<value>,..
-000009d0: 2e7d 2069 7320 7265 7475 726e 6564 2e0a  .} is returned..
-000009e0: 2020 2020 2020 2020 2020 2020 5261 6973              Rais
-000009f0: 6573 2049 6664 6f45 7863 6570 7469 6f6e  es IfdoException
-00000a00: 2069 6620 6974 656d 2064 6f65 7320 6e6f   if item does no
-00000a10: 7420 6578 6973 742e 2022 2222 0a20 2020  t exist. """.   
-00000a20: 2020 2020 206b 6579 7320 3d20 6b65 7973       keys = keys
-00000a30: 2e73 706c 6974 2827 3a27 290a 2020 2020  .split(':').    
-00000a40: 2020 2020 7265 7475 726e 2069 4644 4f2e      return iFDO.
-00000a50: 5f69 4644 4f5f 5f67 6574 4669 656c 6456  _iFDO__getFieldV
-00000a60: 616c 7565 2873 656c 662e 6966 646f 2c6b  alue(self.ifdo,k
-00000a70: 6579 7329 0a0a 0a20 2020 2064 6566 2067  eys)...    def g
-00000a80: 6574 496d 6167 6573 506f 7369 7469 6f6e  etImagesPosition
-00000a90: 7328 7365 6c66 2c69 6d61 6765 5f74 7970  s(self,image_typ
-00000aa0: 6573 3d6d 6971 7476 2e69 6d61 6765 5f74  es=miqtv.image_t
-00000ab0: 7970 6573 293a 0a20 2020 2020 2020 2022  ypes):.        "
-00000ac0: 2222 2052 6574 7572 6e73 2069 6d61 6765  "" Returns image
-00000ad0: 7320 6669 7273 7420 706f 7369 7469 6f6e  s first position
-00000ae0: 2873 2920 0a20 2020 2020 2020 2020 2020  (s) .           
-00000af0: 2040 7265 7475 726e 3a20 7b27 696d 6167   @return: {'imag
-00000b00: 654e 616d 6527 3a20 5b7b 276c 6174 273a  eName': [{'lat':
-00000b10: 2076 616c 7565 2c20 276c 6f6e 273a 2076   value, 'lon': v
-00000b20: 616c 7565 2c20 2764 6174 6574 696d 6527  alue, 'datetime'
-00000b30: 3a20 7661 6c75 657d 5d7d 2c20 696d 6167  : value}]}, imag
-00000b40: 652d 636f 6f72 6469 6e61 7465 2d72 6566  e-coordinate-ref
-00000b50: 6572 656e 6365 2d73 7973 7465 6d20 2222  erence-system ""
-00000b60: 220a 2020 2020 2020 2020 0a20 2020 2020  ".        .     
-00000b70: 2020 2072 6574 4469 6374 203d 207b 7d0a     retDict = {}.
-00000b80: 2020 2020 2020 2020 7265 7452 6566 7379          retRefsy
-00000b90: 7320 3d20 7365 6c66 2e69 6664 6f5b 6d69  s = self.ifdo[mi
-00000ba0: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
-00000bb0: 6164 6572 5f6b 6579 5d5b 2769 6d61 6765  ader_key]['image
-00000bc0: 2d63 6f6f 7264 696e 6174 652d 7265 6665  -coordinate-refe
-00000bd0: 7265 6e63 652d 7379 7374 656d 275d 0a0a  rence-system']..
-00000be0: 2020 2020 2020 2020 6865 6164 6572 5661          headerVa
-00000bf0: 6c4c 6174 203d 204e 6f6e 650a 2020 2020  lLat = None.    
-00000c00: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00000c10: 2020 2020 2068 6561 6465 7256 616c 4c61       headerValLa
-00000c20: 7420 3d20 7365 6c66 2e69 6664 6f5b 6d69  t = self.ifdo[mi
-00000c30: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
-00000c40: 6164 6572 5f6b 6579 5d5b 2769 6d61 6765  ader_key]['image
-00000c50: 2d6c 6174 6974 7564 6527 5d0a 2020 2020  -latitude'].    
-00000c60: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-00000c70: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00000c80: 2070 6173 730a 0a20 2020 2020 2020 2068   pass..        h
-00000c90: 6561 6465 7256 616c 4c6f 6e20 3d20 4e6f  eaderValLon = No
-00000ca0: 6e65 0a20 2020 2020 2020 2074 7279 3a0a  ne.        try:.
-00000cb0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00000cc0: 6572 5661 6c4c 6f6e 203d 2073 656c 662e  erValLon = self.
-00000cd0: 6966 646f 5b6d 6971 7476 2e69 6d61 6765  ifdo[miqtv.image
-00000ce0: 5f73 6574 5f68 6561 6465 725f 6b65 795d  _set_header_key]
-00000cf0: 5b27 696d 6167 652d 6c6f 6e67 6974 7564  ['image-longitud
-00000d00: 6527 5d0a 2020 2020 2020 2020 6578 6365  e'].        exce
-00000d10: 7074 204b 6579 4572 726f 723a 0a20 2020  pt KeyError:.   
-00000d20: 2020 2020 2020 2020 2070 6173 730a 0a0a           pass...
-00000d30: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00000d40: 4e61 6d65 2069 6e20 7365 6c66 2e69 6664  Name in self.ifd
-00000d50: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00000d60: 745f 6974 656d 735f 6b65 795d 3a0a 2020  t_items_key]:.  
-00000d70: 2020 2020 2020 2020 2020 6966 2066 696c            if fil
-00000d80: 654e 616d 652e 7370 6c69 7428 272e 2729  eName.split('.')
-00000d90: 5b2d 315d 2e6c 6f77 6572 2829 2069 6e20  [-1].lower() in 
-00000da0: 696d 6167 655f 7479 7065 733a 0a20 2020  image_types:.   
-00000db0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00000dc0: 4469 6374 5b66 696c 654e 616d 655d 203d  Dict[fileName] =
-00000dd0: 2073 656c 662e 5f5f 6765 7449 7465 6d4c   self.__getItemL
-00000de0: 6174 4c6f 6e28 6669 6c65 4e61 6d65 2c68  atLon(fileName,h
-00000df0: 6561 6465 7256 616c 4c61 742c 6865 6164  eaderValLat,head
-00000e00: 6572 5661 6c4c 6f6e 290a 0a20 2020 2020  erValLon)..     
-00000e10: 2020 2072 6574 7572 6e20 7265 7444 6963     return retDic
-00000e20: 742c 2072 6574 5265 6673 7973 0a0a 0a20  t, retRefsys... 
-00000e30: 2020 2064 6566 2077 7269 7465 576f 726c     def writeWorl
-00000e40: 6446 696c 6573 466f 7250 686f 746f 7328  dFilesForPhotos(
-00000e50: 7365 6c66 2c64 6573 7444 6972 3a73 7472  self,destDir:str
-00000e60: 2c69 6d61 6765 536f 7572 6365 4469 723a  ,imageSourceDir:
-00000e70: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
-00000e80: 2220 5772 6974 6573 2077 6f72 6c64 2066  " Writes world f
-00000e90: 696c 6573 2066 6f72 2070 686f 746f 7320  iles for photos 
-00000ea0: 6966 2061 6c6c 2072 6571 7569 7265 6420  if all required 
-00000eb0: 6669 656c 6473 2061 7265 2074 6865 7265  fields are there
-00000ec0: 2075 6e64 6572 2074 6865 2061 7373 756d   under the assum
-00000ed0: 7074 696f 6e20 7468 6174 2074 6865 2063  ption that the c
-00000ee0: 616d 6572 6120 7761 7320 6c6f 6f6b 696e  amera was lookin
-00000ef0: 6720 7374 7261 6967 6874 2064 6f77 6e20  g straight down 
-00000f00: 2870 6974 6368 2061 6e64 2072 6f6c 6c20  (pitch and roll 
-00000f10: 6172 6520 6967 6e6f 7265 6421 292e 200a  are ignored!). .
-00000f20: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
-00000f30: 726e 7320 6120 6c69 7374 206f 6620 6974  rns a list of it
-00000f40: 656d 7320 666f 7220 7768 6963 6820 6372  ems for which cr
-00000f50: 6561 7469 6f6e 2066 6169 6c65 643a 205b  eation failed: [
-00000f60: 5b69 7465 6d2c 6d73 675d 2c2e 2e2e 5d22  [item,msg],...]"
-00000f70: 2222 0a0a 2020 2020 2020 2020 2320 544f  ""..        # TO
-00000f80: 444f 2067 6574 2069 6d61 6765 7320 6f6e  DO get images on
-00000f90: 6c69 6e65 2066 726f 6d20 6272 6f6b 6572  line from broker
-00000fa0: 0a0a 2020 2020 2020 2020 6946 444f 6578  ..        iFDOex
-00000fb0: 6365 7074 696f 6e73 203d 205b 5d0a 0a20  ceptions = [].. 
-00000fc0: 2020 2020 2020 2023 2067 6574 2069 6d61         # get ima
-00000fd0: 6765 7320 706f 7369 7469 6f6e 0a20 2020  ges position.   
-00000fe0: 2020 2020 2070 6f73 6974 696f 6e73 4c61       positionsLa
-00000ff0: 744c 6f6e 2c20 7265 6673 7973 203d 2073  tLon, refsys = s
-00001000: 656c 662e 6765 7449 6d61 6765 7350 6f73  elf.getImagesPos
-00001010: 6974 696f 6e73 2869 6d61 6765 5f74 7970  itions(image_typ
-00001020: 6573 3d6d 6971 7476 2e70 686f 746f 5f74  es=miqtv.photo_t
-00001030: 7970 6573 290a 2020 2020 2020 2020 6372  ypes).        cr
-00001040: 7346 6965 6c64 546d 7020 3d20 2727 2e6a  sFieldTmp = ''.j
-00001050: 6f69 6e28 6520 666f 7220 6520 696e 2072  oin(e for e in r
-00001060: 6566 7379 7320 6966 2065 2e69 7361 6c6e  efsys if e.isaln
-00001070: 756d 2829 292e 6c6f 7765 7228 290a 2020  um()).lower().  
-00001080: 2020 2020 2020 6966 2063 7273 4669 656c        if crsFiel
-00001090: 6454 6d70 203d 3d20 2777 6773 3834 2720  dTmp == 'wgs84' 
-000010a0: 6f72 2063 7273 4669 656c 6454 6d70 203d  or crsFieldTmp =
-000010b0: 3d20 2765 7073 6734 3332 3627 3a0a 2020  = 'epsg4326':.  
-000010c0: 2020 2020 2020 2020 2020 7265 6673 7973            refsys
-000010d0: 203d 2022 5747 5338 3422 0a20 2020 2020   = "WGS84".     
-000010e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000010f0: 2020 2020 2069 4644 4f65 7863 6570 7469       iFDOexcepti
-00001100: 6f6e 732e 6170 7065 6e64 285b 2222 2c22  ons.append(["","
-00001110: 436f 6f72 6469 6e61 7465 7320 7265 6665  Coordinates refe
-00001120: 7265 6e63 6520 7379 7374 656d 205c 2222  rence system \""
-00001130: 202b 2072 6566 7379 7320 2b20 225c 2220   + refsys + "\" 
-00001140: 6361 6e20 6e6f 7420 6265 2068 616e 646c  can not be handl
-00001150: 6564 2e20 5573 6520 7072 6566 6572 6162  ed. Use preferab
-00001160: 6c79 2045 5053 473a 3433 3236 206f 7220  ly EPSG:4326 or 
-00001170: 5747 5338 3422 5d29 0a20 2020 2020 2020  WGS84"]).       
-00001180: 2020 2020 2072 6574 7572 6e20 6946 444f       return iFDO
-00001190: 6578 6365 7074 696f 6e73 0a0a 0a20 2020  exceptions...   
-000011a0: 2020 2020 2066 6f72 2070 686f 746f 2069       for photo i
-000011b0: 6e20 706f 7369 7469 6f6e 734c 6174 4c6f  n positionsLatLo
-000011c0: 6e3a 0a20 2020 2020 2020 2020 2020 2074  n:.            t
-000011d0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000011e0: 2020 2020 7365 6c66 2e63 6865 636b 4974      self.checkIt
-000011f0: 656d 4861 7368 2870 686f 746f 2c69 6d61  emHash(photo,ima
-00001200: 6765 536f 7572 6365 4469 7229 2023 2054  geSourceDir) # T
-00001210: 4f44 4f20 636f 756c 6420 6265 2069 6e20  ODO could be in 
-00001220: 6469 6666 6572 656e 7420 7375 6266 6f6c  different subfol
-00001230: 6465 7220 6f72 2066 726f 6d20 6f6e 6c69  der or from onli
-00001240: 6e65 2062 726f 6b65 720a 0a20 2020 2020  ne broker..     
-00001250: 2020 2020 2020 2020 2020 2023 2063 6f6e             # con
-00001260: 7665 7274 2074 6f20 7574 6d20 746f 2061  vert to utm to a
-00001270: 766f 6964 2070 7265 6369 7369 6f6e 2069  void precision i
-00001280: 7373 7565 2077 6974 6820 6c61 742f 6c6f  ssue with lat/lo
-00001290: 6e20 7661 6c75 6573 2069 6e20 776f 726c  n values in worl
-000012a0: 6420 6669 6c65 730a 2020 2020 2020 2020  d files.        
-000012b0: 2020 2020 2020 2020 6c61 7420 3d20 706f          lat = po
+00000810: 2020 2020 2073 656c 662e 6966 646f 203d       self.ifdo =
+00000820: 2069 4644 4f2e 6f70 656e 5f69 6664 6f5f   iFDO.open_ifdo_
+00000830: 6669 6c65 2873 656c 662e 6946 444f 6669  file(self.iFDOfi
+00000840: 6c65 290a 0a0a 2020 2020 6465 6620 5f5f  le)...    def __
+00000850: 6765 7469 7465 6d5f 5f28 7365 6c66 2c20  getitem__(self, 
+00000860: 6b65 7973 293a 0a20 2020 2020 2020 2022  keys):.        "
+00000870: 2222 2052 6574 7572 6e73 2063 6f70 7920  "" Returns copy 
+00000880: 6f66 2063 6865 636b 6564 2069 6664 6f20  of checked ifdo 
+00000890: 7365 7420 6f72 2069 7465 6d20 6669 656c  set or item fiel
+000008a0: 6420 7661 6c75 652c 2061 6c73 6f20 636f  d value, also co
+000008b0: 6e73 6964 6572 6e67 2064 6566 6175 6c74  nsiderng default
+000008c0: 2076 616c 7565 7320 6672 6f6d 2068 6561   values from hea
+000008d0: 6465 722e 0a20 2020 2020 2020 2020 2020  der..           
+000008e0: 2055 7365 206b 6579 7320 6173 2065 2e67   Use keys as e.g
+000008f0: 2e20 273c 6974 656d 3e3a 3c6b 6579 3e3a  . '<item>:<key>:
+00000900: 2e2e 2e27 2e20 4361 6e20 6265 2075 7365  ...'. Can be use
+00000910: 6420 666f 7220 6865 6164 6572 2066 6965  d for header fie
+00000920: 6c64 7320 6173 2077 656c 6c20 6173 2069  lds as well as i
+00000930: 7465 6d20 6669 656c 6473 2e0a 2020 2020  tem fields..    
+00000940: 2020 2020 2020 2020 4974 656d 2069 6e64          Item ind
+00000950: 6578 2063 616e 2062 6520 6c65 676c 6563  ex can be leglec
+00000960: 7465 642c 2069 6e20 6361 7365 206f 6620  ted, in case of 
+00000970: 7669 6465 6f20 6120 6469 6374 207b 3c69  video a dict {<i
+00000980: 6d61 6765 2d64 6174 6174 696d 653e 3a3c  mage-datatime>:<
+00000990: 7661 6c75 653e 2c2e 2e2e 7d20 6973 2072  value>,...} is r
+000009a0: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
+000009b0: 2020 2020 2052 6169 7365 7320 4966 646f       Raises Ifdo
+000009c0: 4578 6365 7074 696f 6e20 6966 2069 7465  Exception if ite
+000009d0: 6d20 646f 6573 206e 6f74 2065 7869 7374  m does not exist
+000009e0: 2e20 2222 220a 2020 2020 2020 2020 6b65  . """.        ke
+000009f0: 7973 203d 206b 6579 732e 7370 6c69 7428  ys = keys.split(
+00000a00: 273a 2729 0a20 2020 2020 2020 2072 6574  ':').        ret
+00000a10: 7572 6e20 6946 444f 2e5f 6946 444f 5f5f  urn iFDO._iFDO__
+00000a20: 6765 7446 6965 6c64 5661 6c75 6528 7365  getFieldValue(se
+00000a30: 6c66 2e69 6664 6f2c 6b65 7973 290a 0a0a  lf.ifdo,keys)...
+00000a40: 2020 2020 6465 6620 6765 7449 6d61 6765      def getImage
+00000a50: 7350 6f73 6974 696f 6e73 2873 656c 662c  sPositions(self,
+00000a60: 696d 6167 655f 7479 7065 733d 6d69 7174  image_types=miqt
+00000a70: 762e 696d 6167 655f 7479 7065 7329 3a0a  v.image_types):.
+00000a80: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
+00000a90: 726e 7320 696d 6167 6573 2066 6972 7374  rns images first
+00000aa0: 2070 6f73 6974 696f 6e28 7329 200a 2020   position(s) .  
+00000ab0: 2020 2020 2020 2020 2020 4072 6574 7572            @retur
+00000ac0: 6e3a 207b 2769 6d61 6765 4e61 6d65 273a  n: {'imageName':
+00000ad0: 205b 7b27 6c61 7427 3a20 7661 6c75 652c   [{'lat': value,
+00000ae0: 2027 6c6f 6e27 3a20 7661 6c75 652c 2027   'lon': value, '
+00000af0: 6461 7465 7469 6d65 273a 2076 616c 7565  datetime': value
+00000b00: 7d5d 7d2c 2069 6d61 6765 2d63 6f6f 7264  }]}, image-coord
+00000b10: 696e 6174 652d 7265 6665 7265 6e63 652d  inate-reference-
+00000b20: 7379 7374 656d 2022 2222 0a20 2020 2020  system """.     
+00000b30: 2020 200a 2020 2020 2020 2020 7265 7444     .        retD
+00000b40: 6963 7420 3d20 7b7d 0a20 2020 2020 2020  ict = {}.       
+00000b50: 2072 6574 5265 6673 7973 203d 2073 656c   retRefsys = sel
+00000b60: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
+00000b70: 6765 5f73 6574 5f68 6561 6465 725f 6b65  ge_set_header_ke
+00000b80: 795d 5b27 696d 6167 652d 636f 6f72 6469  y]['image-coordi
+00000b90: 6e61 7465 2d72 6566 6572 656e 6365 2d73  nate-reference-s
+00000ba0: 7973 7465 6d27 5d0a 0a20 2020 2020 2020  ystem']..       
+00000bb0: 2068 6561 6465 7256 616c 4c61 7420 3d20   headerValLat = 
+00000bc0: 4e6f 6e65 0a20 2020 2020 2020 2074 7279  None.        try
+00000bd0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+00000be0: 6164 6572 5661 6c4c 6174 203d 2073 656c  aderValLat = sel
+00000bf0: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
+00000c00: 6765 5f73 6574 5f68 6561 6465 725f 6b65  ge_set_header_ke
+00000c10: 795d 5b27 696d 6167 652d 6c61 7469 7475  y]['image-latitu
+00000c20: 6465 275d 0a20 2020 2020 2020 2065 7863  de'].        exc
+00000c30: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
+00000c40: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+00000c50: 2020 2020 2020 2020 6865 6164 6572 5661          headerVa
+00000c60: 6c4c 6f6e 203d 204e 6f6e 650a 2020 2020  lLon = None.    
+00000c70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00000c80: 2020 2020 2068 6561 6465 7256 616c 4c6f       headerValLo
+00000c90: 6e20 3d20 7365 6c66 2e69 6664 6f5b 6d69  n = self.ifdo[mi
+00000ca0: 7174 762e 696d 6167 655f 7365 745f 6865  qtv.image_set_he
+00000cb0: 6164 6572 5f6b 6579 5d5b 2769 6d61 6765  ader_key]['image
+00000cc0: 2d6c 6f6e 6769 7475 6465 275d 0a20 2020  -longitude'].   
+00000cd0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00000ce0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00000cf0: 2020 7061 7373 0a0a 0a20 2020 2020 2020    pass...       
+00000d00: 2066 6f72 2066 696c 654e 616d 6520 696e   for fileName in
+00000d10: 2073 656c 662e 6966 646f 5b6d 6971 7476   self.ifdo[miqtv
+00000d20: 2e69 6d61 6765 5f73 6574 5f69 7465 6d73  .image_set_items
+00000d30: 5f6b 6579 5d3a 0a20 2020 2020 2020 2020  _key]:.         
+00000d40: 2020 2069 6620 6669 6c65 4e61 6d65 2e73     if fileName.s
+00000d50: 706c 6974 2827 2e27 295b 2d31 5d2e 6c6f  plit('.')[-1].lo
+00000d60: 7765 7228 2920 696e 2069 6d61 6765 5f74  wer() in image_t
+00000d70: 7970 6573 3a0a 2020 2020 2020 2020 2020  ypes:.          
+00000d80: 2020 2020 2020 7265 7444 6963 745b 6669        retDict[fi
+00000d90: 6c65 4e61 6d65 5d20 3d20 7365 6c66 2e5f  leName] = self._
+00000da0: 5f67 6574 4974 656d 4c61 744c 6f6e 2866  _getItemLatLon(f
+00000db0: 696c 654e 616d 652c 6865 6164 6572 5661  ileName,headerVa
+00000dc0: 6c4c 6174 2c68 6561 6465 7256 616c 4c6f  lLat,headerValLo
+00000dd0: 6e29 0a0a 2020 2020 2020 2020 7265 7475  n)..        retu
+00000de0: 726e 2072 6574 4469 6374 2c20 7265 7452  rn retDict, retR
+00000df0: 6566 7379 730a 0a0a 2020 2020 6465 6620  efsys...    def 
+00000e00: 7772 6974 6557 6f72 6c64 4669 6c65 7346  writeWorldFilesF
+00000e10: 6f72 5068 6f74 6f73 2873 656c 662c 6465  orPhotos(self,de
+00000e20: 7374 4469 723a 7374 722c 696d 6167 6553  stDir:str,imageS
+00000e30: 6f75 7263 6544 6972 3a73 7472 293a 0a20  ourceDir:str):. 
+00000e40: 2020 2020 2020 2022 2222 2057 7269 7465         """ Write
+00000e50: 7320 776f 726c 6420 6669 6c65 7320 666f  s world files fo
+00000e60: 7220 7068 6f74 6f73 2069 6620 616c 6c20  r photos if all 
+00000e70: 7265 7175 6972 6564 2066 6965 6c64 7320  required fields 
+00000e80: 6172 6520 7468 6572 6520 756e 6465 7220  are there under 
+00000e90: 7468 6520 6173 7375 6d70 7469 6f6e 2074  the assumption t
+00000ea0: 6861 7420 7468 6520 6361 6d65 7261 2077  hat the camera w
+00000eb0: 6173 206c 6f6f 6b69 6e67 2073 7472 6169  as looking strai
+00000ec0: 6768 7420 646f 776e 2028 7069 7463 6820  ght down (pitch 
+00000ed0: 616e 6420 726f 6c6c 2061 7265 2069 676e  and roll are ign
+00000ee0: 6f72 6564 2129 2e20 0a20 2020 2020 2020  ored!). .       
+00000ef0: 2020 2020 2052 6574 7572 6e73 2061 206c       Returns a l
+00000f00: 6973 7420 6f66 2069 7465 6d73 2066 6f72  ist of items for
+00000f10: 2077 6869 6368 2063 7265 6174 696f 6e20   which creation 
+00000f20: 6661 696c 6564 3a20 5b5b 6974 656d 2c6d  failed: [[item,m
+00000f30: 7367 5d2c 2e2e 2e5d 2222 220a 0a20 2020  sg],...]"""..   
+00000f40: 2020 2020 2023 2054 4f44 4f20 6765 7420       # TODO get 
+00000f50: 696d 6167 6573 206f 6e6c 696e 6520 6672  images online fr
+00000f60: 6f6d 2062 726f 6b65 720a 0a20 2020 2020  om broker..     
+00000f70: 2020 2069 4644 4f65 7863 6570 7469 6f6e     iFDOexception
+00000f80: 7320 3d20 5b5d 0a0a 2020 2020 2020 2020  s = []..        
+00000f90: 2320 6765 7420 696d 6167 6573 2070 6f73  # get images pos
+00000fa0: 6974 696f 6e0a 2020 2020 2020 2020 706f  ition.        po
+00000fb0: 7369 7469 6f6e 734c 6174 4c6f 6e2c 2072  sitionsLatLon, r
+00000fc0: 6566 7379 7320 3d20 7365 6c66 2e67 6574  efsys = self.get
+00000fd0: 496d 6167 6573 506f 7369 7469 6f6e 7328  ImagesPositions(
+00000fe0: 696d 6167 655f 7479 7065 733d 6d69 7174  image_types=miqt
+00000ff0: 762e 7068 6f74 6f5f 7479 7065 7329 0a20  v.photo_types). 
+00001000: 2020 2020 2020 2063 7273 4669 656c 6454         crsFieldT
+00001010: 6d70 203d 2027 272e 6a6f 696e 2865 2066  mp = ''.join(e f
+00001020: 6f72 2065 2069 6e20 7265 6673 7973 2069  or e in refsys i
+00001030: 6620 652e 6973 616c 6e75 6d28 2929 2e6c  f e.isalnum()).l
+00001040: 6f77 6572 2829 0a20 2020 2020 2020 2069  ower().        i
+00001050: 6620 6372 7346 6965 6c64 546d 7020 3d3d  f crsFieldTmp ==
+00001060: 2027 7767 7338 3427 206f 7220 6372 7346   'wgs84' or crsF
+00001070: 6965 6c64 546d 7020 3d3d 2027 6570 7367  ieldTmp == 'epsg
+00001080: 3433 3236 273a 0a20 2020 2020 2020 2020  4326':.         
+00001090: 2020 2072 6566 7379 7320 3d20 2257 4753     refsys = "WGS
+000010a0: 3834 220a 2020 2020 2020 2020 656c 7365  84".        else
+000010b0: 3a0a 2020 2020 2020 2020 2020 2020 6946  :.            iF
+000010c0: 444f 6578 6365 7074 696f 6e73 2e61 7070  DOexceptions.app
+000010d0: 656e 6428 5b22 222c 2243 6f6f 7264 696e  end(["","Coordin
+000010e0: 6174 6573 2072 6566 6572 656e 6365 2073  ates reference s
+000010f0: 7973 7465 6d20 5c22 2220 2b20 7265 6673  ystem \"" + refs
+00001100: 7973 202b 2022 5c22 2063 616e 206e 6f74  ys + "\" can not
+00001110: 2062 6520 6861 6e64 6c65 642e 2055 7365   be handled. Use
+00001120: 2070 7265 6665 7261 626c 7920 4550 5347   preferably EPSG
+00001130: 3a34 3332 3620 6f72 2057 4753 3834 225d  :4326 or WGS84"]
+00001140: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00001150: 7475 726e 2069 4644 4f65 7863 6570 7469  turn iFDOexcepti
+00001160: 6f6e 730a 0a0a 2020 2020 2020 2020 666f  ons...        fo
+00001170: 7220 7068 6f74 6f20 696e 2070 6f73 6974  r photo in posit
+00001180: 696f 6e73 4c61 744c 6f6e 3a0a 2020 2020  ionsLatLon:.    
+00001190: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+000011a0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000011b0: 662e 6368 6563 6b49 7465 6d48 6173 6828  f.checkItemHash(
+000011c0: 7068 6f74 6f2c 696d 6167 6553 6f75 7263  photo,imageSourc
+000011d0: 6544 6972 2920 2320 544f 444f 2063 6f75  eDir) # TODO cou
+000011e0: 6c64 2062 6520 696e 2064 6966 6665 7265  ld be in differe
+000011f0: 6e74 2073 7562 666f 6c64 6572 206f 7220  nt subfolder or 
+00001200: 6672 6f6d 206f 6e6c 696e 6520 6272 6f6b  from online brok
+00001210: 6572 0a0a 2020 2020 2020 2020 2020 2020  er..            
+00001220: 2020 2020 2320 636f 6e76 6572 7420 746f      # convert to
+00001230: 2075 746d 2074 6f20 6176 6f69 6420 7072   utm to avoid pr
+00001240: 6563 6973 696f 6e20 6973 7375 6520 7769  ecision issue wi
+00001250: 7468 206c 6174 2f6c 6f6e 2076 616c 7565  th lat/lon value
+00001260: 7320 696e 2077 6f72 6c64 2066 696c 6573  s in world files
+00001270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001280: 206c 6174 203d 2070 6f73 6974 696f 6e73   lat = positions
+00001290: 4c61 744c 6f6e 5b70 686f 746f 5d5b 305d  LatLon[photo][0]
+000012a0: 5b27 6c61 7427 5d0a 2020 2020 2020 2020  ['lat'].        
+000012b0: 2020 2020 2020 2020 6c6f 6e20 3d20 706f          lon = po
 000012c0: 7369 7469 6f6e 734c 6174 4c6f 6e5b 7068  sitionsLatLon[ph
-000012d0: 6f74 6f5d 5b30 5d5b 276c 6174 275d 0a20  oto][0]['lat']. 
-000012e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000012f0: 6f6e 203d 2070 6f73 6974 696f 6e73 4c61  on = positionsLa
-00001300: 744c 6f6e 5b70 686f 746f 5d5b 305d 5b27  tLon[photo][0]['
-00001310: 6c6f 6e27 5d0a 2020 2020 2020 2020 2020  lon'].          
-00001320: 2020 2020 2020 6561 7374 696e 672c 6e6f        easting,no
-00001330: 7274 6869 6e67 2c7a 6f6e 652c 6973 4e6f  rthing,zone,isNo
-00001340: 7274 6820 3d20 6d69 7174 672e 6c61 744c  rth = miqtg.latL
-00001350: 6f6e 3275 746d 286c 6174 2c6c 6f6e 2c72  on2utm(lat,lon,r
-00001360: 6566 7379 7329 0a20 2020 2020 2020 2020  efsys).         
-00001370: 2020 2020 2020 2065 7869 6620 3d20 7365         exif = se
-00001380: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
-00001390: 756c 7456 616c 7565 2870 686f 746f 2c27  ultValue(photo,'
-000013a0: 696d 6167 652d 6163 7175 6973 6974 696f  image-acquisitio
-000013b0: 6e2d 7365 7474 696e 6773 2729 2023 2054  n-settings') # T
-000013c0: 4f44 4f20 7768 6174 2069 6620 6e6f 7420  ODO what if not 
-000013d0: 7468 6572 653f 2072 6561 6420 6672 6f6d  there? read from
-000013e0: 2069 6d61 6765 2064 6972 6563 746c 793f   image directly?
-000013f0: 2053 686f 756c 6420 6265 2063 6865 636b   Should be check
-00001400: 6564 2069 6620 6861 7368 206d 6174 6368  ed if hash match
-00001410: 6573 3f20 496d 6167 6520 636f 756c 6420  es? Image could 
-00001420: 6861 7665 2062 6565 6e20 6372 6f70 7065  have been croppe
-00001430: 6420 6166 7465 7220 6946 444f 2063 7265  d after iFDO cre
-00001440: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00001450: 2020 2020 2020 696d 6167 6557 6964 7468        imageWidth
-00001460: 203d 2069 6e74 2873 7472 2865 7869 665b   = int(str(exif[
-00001470: 2749 6d61 6765 2057 6964 7468 275d 292e  'Image Width']).
-00001480: 7374 7269 7028 275c 2727 2929 0a20 2020  strip('\'')).   
-00001490: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-000014a0: 6765 4865 6967 6874 203d 2069 6e74 2873  geHeight = int(s
-000014b0: 7472 2865 7869 665b 2749 6d61 6765 2048  tr(exif['Image H
-000014c0: 6569 6768 7427 5d29 2e73 7472 6970 2827  eight']).strip('
-000014d0: 5c27 2729 290a 2020 2020 2020 2020 2020  \'')).          
-000014e0: 2020 2020 2020 6865 6164 696e 6720 3d20        heading = 
-000014f0: 7365 6c66 2e5f 5f67 6574 4974 656d 4465  self.__getItemDe
-00001500: 6661 756c 7456 616c 7565 2870 686f 746f  faultValue(photo
-00001510: 2c27 696d 6167 652d 6361 6d65 7261 2d79  ,'image-camera-y
-00001520: 6177 2d64 6567 7265 6573 2729 0a20 2020  aw-degrees').   
-00001530: 2020 2020 2020 2020 2020 2020 2061 6c74               alt
-00001540: 6974 7564 6520 3d20 7365 6c66 2e5f 5f67  itude = self.__g
-00001550: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
-00001560: 7565 2870 686f 746f 2c27 696d 6167 652d  ue(photo,'image-
-00001570: 6d65 7465 7273 2d61 626f 7665 2d67 726f  meters-above-gro
-00001580: 756e 6427 290a 0a20 2020 2020 2020 2020  und')..         
-00001590: 2020 2020 2020 2064 6f6d 6550 6f72 742c         domePort,
-000015a0: 6d73 6720 3d20 7365 6c66 2e5f 5f74 7279  msg = self.__try
-000015b0: 4765 7449 7344 6f6d 6550 6f72 7428 7068  GetIsDomePort(ph
-000015c0: 6f74 6f29 0a20 2020 2020 2020 2020 2020  oto).           
-000015d0: 2020 2020 2066 6f63 616c 4c65 6e67 6850       focalLenghP
-000015e0: 6978 656c 732c 206d 7367 203d 2073 656c  ixels, msg = sel
-000015f0: 662e 5f5f 7472 7947 6574 466f 6361 6c4c  f.__tryGetFocalL
-00001600: 656e 6774 6849 6e50 6978 656c 7328 7068  engthInPixels(ph
-00001610: 6f74 6f2c 2064 6f6d 6550 6f72 7429 0a20  oto, domePort). 
-00001620: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001630: 6620 666f 6361 6c4c 656e 6768 5069 7865  f focalLenghPixe
-00001640: 6c73 203d 3d20 5b2d 312c 2d31 5d20 6f72  ls == [-1,-1] or
-00001650: 2066 6f63 616c 4c65 6e67 6850 6978 656c   focalLenghPixel
-00001660: 7320 3d3d 202d 313a 0a20 2020 2020 2020  s == -1:.       
-00001670: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00001680: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-00001690: 6570 7469 6f6e 286d 7367 290a 2020 2020  eption(msg).    
-000016a0: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-000016b0: 672e 7772 6974 6553 696d 706c 6555 746d  g.writeSimpleUtm
-000016c0: 576f 726c 6446 696c 6528 6f73 2e70 6174  WorldFile(os.pat
-000016d0: 682e 6a6f 696e 2864 6573 7444 6972 2c6d  h.join(destDir,m
-000016e0: 6971 7467 2e63 6f6e 7665 7274 496d 6167  iqtg.convertImag
-000016f0: 654e 616d 6554 6f57 6f72 6c64 4669 6c65  eNameToWorldFile
-00001700: 4e61 6d65 2870 686f 746f 2929 2c65 6173  Name(photo)),eas
-00001710: 7469 6e67 2c6e 6f72 7468 696e 672c 7a6f  ting,northing,zo
-00001720: 6e65 2c69 734e 6f72 7468 2c69 6d61 6765  ne,isNorth,image
-00001730: 5769 6474 682c 696d 6167 6548 6569 6768  Width,imageHeigh
-00001740: 742c 6865 6164 696e 672c 616c 7469 7475  t,heading,altitu
-00001750: 6465 2c66 6f63 616c 4c65 6e67 6850 6978  de,focalLenghPix
-00001760: 656c 735b 305d 2c66 6f63 616c 4c65 6e67  els[0],focalLeng
-00001770: 6850 6978 656c 735b 315d 290a 2020 2020  hPixels[1]).    
-00001780: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-00001790: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-000017a0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-000017b0: 2020 2020 2020 2020 2069 4644 4f65 7863           iFDOexc
-000017c0: 6570 7469 6f6e 732e 6170 7065 6e64 285b  eptions.append([
-000017d0: 7068 6f74 6f2c 7374 7228 652e 6172 6773  photo,str(e.args
-000017e0: 295d 290a 0a20 2020 2020 2020 2072 6574  )])..        ret
-000017f0: 7572 6e20 6946 444f 6578 6365 7074 696f  urn iFDOexceptio
-00001800: 6e73 0a0a 0a20 2020 2064 6566 2063 6865  ns...    def che
-00001810: 636b 4974 656d 4861 7368 2873 656c 662c  ckItemHash(self,
-00001820: 6974 656d 3a73 7472 2c66 696c 6544 6972  item:str,fileDir
-00001830: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
-00001840: 2222 2063 6f6d 7061 7265 7320 6669 6c65  "" compares file
-00001850: 2773 2068 6173 6820 7769 7468 2068 6173  's hash with has
-00001860: 6820 696e 2069 4644 4f20 616e 6420 7468  h in iFDO and th
-00001870: 726f 7773 2065 7863 6570 7469 6f6e 2069  rows exception i
-00001880: 6620 7468 6579 2064 6f6e 2774 206d 6174  f they don't mat
-00001890: 6368 2022 2222 0a0a 2020 2020 2020 2020  ch """..        
-000018a0: 6669 6c65 203d 206f 732e 7061 7468 2e6a  file = os.path.j
-000018b0: 6f69 6e28 6669 6c65 4469 722c 6974 656d  oin(fileDir,item
-000018c0: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-000018d0: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-000018e0: 6669 6c65 293a 0a20 2020 2020 2020 2020  file):.         
-000018f0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-00001900: 6664 6f45 7863 6570 7469 6f6e 2822 4669  fdoException("Fi
-00001910: 6c65 205c 2222 202b 2069 7465 6d20 2b20  le \"" + item + 
-00001920: 225c 2220 6e6f 7420 666f 756e 6420 696e  "\" not found in
-00001930: 2064 6972 205c 2222 202b 2066 696c 6544   dir \"" + fileD
-00001940: 6972 202b 2022 5c22 2229 0a0a 2020 2020  ir + "\"")..    
-00001950: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00001960: 6528 7365 6c66 2e69 6664 6f5b 6d69 7174  e(self.ifdo[miqt
-00001970: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
-00001980: 735f 6b65 795d 5b69 7465 6d5d 2c6c 6973  s_key][item],lis
-00001990: 7429 3a20 2320 696e 2063 6173 6520 6f66  t): # in case of
-000019a0: 2076 6964 656f 2077 6974 6820 6974 656d   video with item
-000019b0: 2061 7320 6c69 7374 2074 6865 2066 6972   as list the fir
-000019c0: 7374 2065 6e74 7279 2068 6f6c 6473 2074  st entry holds t
-000019d0: 6865 2064 6566 6175 6c74 2061 6e64 2074  he default and t
-000019e0: 6865 2068 6173 6820 6361 6e6e 6f74 2076  he hash cannot v
-000019f0: 6172 7920 666f 7220 7468 6520 7361 6d65  ary for the same
-00001a00: 2069 6d61 6765 0a20 2020 2020 2020 2020   image.         
-00001a10: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
-00001a20: 656c 662e 6966 646f 5b6d 6971 7476 2e69  elf.ifdo[miqtv.i
-00001a30: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
-00001a40: 6579 5d5b 6974 656d 5d5b 305d 200a 2020  ey][item][0] .  
-00001a50: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00001a60: 2020 2020 2020 2020 6974 656d 456e 7472          itemEntr
-00001a70: 7920 3d20 7365 6c66 2e69 6664 6f5b 6d69  y = self.ifdo[mi
-00001a80: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
-00001a90: 656d 735f 6b65 795d 5b69 7465 6d5d 0a20  ems_key][item]. 
-00001aa0: 2020 2020 2020 2069 6620 6e6f 7420 6974         if not it
-00001ab0: 656d 456e 7472 795b 2769 6d61 6765 2d68  emEntry['image-h
-00001ac0: 6173 682d 7368 6132 3536 275d 203d 3d20  ash-sha256'] == 
-00001ad0: 6d69 7174 632e 7368 6132 3536 4861 7368  miqtc.sha256Hash
-00001ae0: 4669 6c65 2866 696c 6529 3a0a 2020 2020  File(file):.    
-00001af0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-00001b00: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-00001b10: 6e28 6974 656d 2c20 2269 4644 4f20 656e  n(item, "iFDO en
-00001b20: 7472 7920 6973 206e 6f74 2075 7020 746f  try is not up to
-00001b30: 2064 6174 652c 2069 6d61 6765 2068 6173   date, image has
-00001b40: 6820 646f 6573 206e 6f74 206d 6174 6368  h does not match
-00001b50: 2e22 290a 0a20 2020 2064 6566 2067 6574  .")..    def get
-00001b60: 496d 6167 6544 6972 6563 746f 7279 2873  ImageDirectory(s
-00001b70: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00001b80: 2220 5265 7475 726e 7320 7468 6520 6c6f  " Returns the lo
-00001b90: 7765 726d 6f73 7420 6c6f 6361 6c20 6469  wermost local di
-00001ba0: 7265 6374 6f72 7920 636f 6e74 6169 6e69  rectory containi
-00001bb0: 6e67 2074 6865 2069 6d61 6765 2066 696c  ng the image fil
-00001bc0: 6573 2069 6e66 6572 7265 6420 6672 6f6d  es inferred from
-00001bd0: 2027 696d 6167 652d 6c6f 6361 6c2d 7061   'image-local-pa
-00001be0: 7468 272e 2049 6620 2769 6d61 6765 2d6c  th'. If 'image-l
-00001bf0: 6f63 616c 2d70 6174 6827 206e 6f74 2070  ocal-path' not p
-00001c00: 726f 7669 6465 6420 666f 7220 616c 6c20  rovided for all 
-00001c10: 696d 6167 6520 6974 656d 7320 7468 6520  image items the 
-00001c20: 6946 444f 2773 2070 6172 656e 7420 6469  iFDO's parent di
-00001c30: 7265 6374 6f72 7920 6973 2072 6574 7572  rectory is retur
-00001c40: 6e65 642e 2022 2222 0a20 2020 2020 2020  ned. """.       
-00001c50: 206c 6f63 616c 5061 7468 7320 3d20 5b5d   localPaths = []
-00001c60: 0a20 2020 2020 2020 2069 4644 4f46 696c  .        iFDOFil
-00001c70: 6550 6172 656e 7444 6972 203d 206f 732e  eParentDir = os.
-00001c80: 7061 7468 2e64 6972 6e61 6d65 286f 732e  path.dirname(os.
-00001c90: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-00001ca0: 662e 6946 444f 6669 6c65 2929 0a20 2020  f.iFDOfile)).   
-00001cb0: 2020 2020 2066 6f72 2069 7465 6d20 696e       for item in
-00001cc0: 2073 656c 662e 6966 646f 5b6d 6971 7476   self.ifdo[miqtv
-00001cd0: 2e69 6d61 6765 5f73 6574 5f69 7465 6d73  .image_set_items
-00001ce0: 5f6b 6579 5d3a 0a20 2020 2020 2020 2020  _key]:.         
-00001cf0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00001d00: 2020 2020 2020 2020 6974 656d 4c6f 6361          itemLoca
-00001d10: 6c50 6174 6820 3d20 7365 6c66 2e5f 5f67  lPath = self.__g
-00001d20: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
-00001d30: 7565 2869 7465 6d2c 2769 6d61 6765 2d6c  ue(item,'image-l
-00001d40: 6f63 616c 2d70 6174 6827 290a 2020 2020  ocal-path').    
-00001d50: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-00001d60: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00001d70: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00001d80: 2020 2020 6974 656d 4c6f 6361 6c50 6174      itemLocalPat
-00001d90: 6820 3d20 6946 444f 4669 6c65 5061 7265  h = iFDOFilePare
-00001da0: 6e74 4469 720a 2020 2020 2020 2020 2020  ntDir.          
-00001db0: 2020 6966 2069 7465 6d4c 6f63 616c 5061    if itemLocalPa
-00001dc0: 7468 206e 6f74 2069 6e20 6c6f 6361 6c50  th not in localP
-00001dd0: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
-00001de0: 2020 2020 2020 6c6f 6361 6c50 6174 6873        localPaths
-00001df0: 2e61 7070 656e 6428 6974 656d 4c6f 6361  .append(itemLoca
-00001e00: 6c50 6174 6829 0a20 2020 2020 2020 2063  lPath).        c
-00001e10: 6f6d 6d6f 6e50 6174 6820 3d20 6f73 2e70  ommonPath = os.p
-00001e20: 6174 682e 636f 6d6d 6f6e 7061 7468 286c  ath.commonpath(l
-00001e30: 6f63 616c 5061 7468 7329 0a20 2020 2020  ocalPaths).     
-00001e40: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
-00001e50: 682e 6973 6162 7328 636f 6d6d 6f6e 5061  h.isabs(commonPa
-00001e60: 7468 293a 0a20 2020 2020 2020 2020 2020  th):.           
-00001e70: 2063 6f6d 6d6f 6e50 6174 6820 3d20 6f73   commonPath = os
-00001e80: 2e70 6174 682e 6e6f 726d 7061 7468 286f  .path.normpath(o
-00001e90: 732e 7061 7468 2e6a 6f69 6e28 6f73 2e70  s.path.join(os.p
-00001ea0: 6174 682e 6469 726e 616d 6528 7365 6c66  ath.dirname(self
-00001eb0: 2e69 4644 4f66 696c 6529 2c20 636f 6d6d  .iFDOfile), comm
-00001ec0: 6f6e 5061 7468 2929 0a20 2020 2020 2020  onPath)).       
-00001ed0: 2072 6574 7572 6e20 636f 6d6d 6f6e 5061   return commonPa
-00001ee0: 7468 0a0a 0a20 2020 2064 6566 205f 5f74  th...    def __t
-00001ef0: 7279 4765 7449 7344 6f6d 6550 6f72 7428  ryGetIsDomePort(
-00001f00: 7365 6c66 2c69 7465 6d29 3a0a 2020 2020  self,item):.    
-00001f10: 2020 2020 2222 2220 5472 6965 7320 746f      """ Tries to
-00001f20: 2072 6561 6420 706f 7274 2074 7970 6520   read port type 
-00001f30: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
-00001f40: 7261 2d68 6f75 7369 6e67 2d76 6965 7770  ra-housing-viewp
-00001f50: 6f72 7427 5b76 6965 7770 6f72 742d 7479  ort'[viewport-ty
-00001f60: 7065 5d20 6f72 2027 696d 6167 652d 666c  pe] or 'image-fl
-00001f70: 6174 706f 7274 2d70 6172 616d 6574 6572  atport-parameter
-00001f80: 7327 2f27 696d 6167 652d 646f 6d65 706f  s'/'image-domepo
-00001f90: 7274 2d70 6172 616d 6574 6572 7327 200a  rt-parameters' .
-00001fa0: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
-00001fb0: 726e 7320 5472 7565 2c6d 7367 2069 6620  rns True,msg if 
-00001fc0: 646f 6d65 2070 6f72 742c 2046 616c 7365  dome port, False
-00001fd0: 2c6d 7367 2069 6620 666c 6174 2070 6f72  ,msg if flat por
-00001fe0: 742c 204e 6f6e 652c 6d73 6720 6f74 6865  t, None,msg othe
-00001ff0: 7277 6973 6520 2222 220a 0a20 2020 2020  rwise """..     
-00002000: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00002010: 2020 2020 706f 7274 5479 7065 5374 7220      portTypeStr 
-00002020: 3d20 7365 6c66 2e5f 5f67 6574 4974 656d  = self.__getItem
-00002030: 4465 6661 756c 7456 616c 7565 2869 7465  DefaultValue(ite
-00002040: 6d2c 2769 6d61 6765 2d63 616d 6572 612d  m,'image-camera-
-00002050: 686f 7573 696e 672d 7669 6577 706f 7274  housing-viewport
-00002060: 2729 0a20 2020 2020 2020 2020 2020 2070  ').            p
-00002070: 6f72 7454 7970 6553 7472 203d 2070 6f72  ortTypeStr = por
-00002080: 7454 7970 6553 7472 5b27 7669 6577 706f  tTypeStr['viewpo
-00002090: 7274 2d74 7970 6527 5d0a 2020 2020 2020  rt-type'].      
-000020a0: 2020 2020 2020 6966 2027 646f 6d65 2720        if 'dome' 
-000020b0: 696e 2070 6f72 7454 7970 6553 7472 2e6c  in portTypeStr.l
-000020c0: 6f77 6572 2829 2061 6e64 206e 6f74 2027  ower() and not '
-000020d0: 666c 6174 2720 696e 2070 6f72 7454 7970  flat' in portTyp
-000020e0: 6553 7472 2e6c 6f77 6572 2829 3a0a 2020  eStr.lower():.  
-000020f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00002100: 7475 726e 2054 7275 652c 2250 6172 7365  turn True,"Parse
-00002110: 6420 6672 6f6d 2027 696d 6167 652d 6361  d from 'image-ca
-00002120: 6d65 7261 2d68 6f75 7369 6e67 2d76 6965  mera-housing-vie
-00002130: 7770 6f72 7427 5b27 7669 6577 706f 7274  wport'['viewport
-00002140: 2d74 7970 6527 5d22 0a20 2020 2020 2020  -type']".       
-00002150: 2020 2020 2065 6c69 6620 6e6f 7420 2764       elif not 'd
-00002160: 6f6d 6527 2069 6e20 706f 7274 5479 7065  ome' in portType
-00002170: 5374 722e 6c6f 7765 7228 2920 616e 6420  Str.lower() and 
-00002180: 2766 6c61 7427 2069 6e20 706f 7274 5479  'flat' in portTy
-00002190: 7065 5374 722e 6c6f 7765 7228 293a 0a20  peStr.lower():. 
-000021a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000021b0: 6574 7572 6e20 4661 6c73 652c 2250 6172  eturn False,"Par
-000021c0: 7365 6420 6672 6f6d 2027 696d 6167 652d  sed from 'image-
-000021d0: 6361 6d65 7261 2d68 6f75 7369 6e67 2d76  camera-housing-v
-000021e0: 6965 7770 6f72 7427 5b27 7669 6577 706f  iewport'['viewpo
-000021f0: 7274 2d74 7970 6527 5d22 0a20 2020 2020  rt-type']".     
-00002200: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00002210: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00002220: 7572 6e20 4e6f 6e65 2c22 436f 756c 6420  urn None,"Could 
-00002230: 6e6f 7420 7265 6164 2070 6f72 7420 7479  not read port ty
-00002240: 7065 2066 726f 6d20 2769 6d61 6765 2d63  pe from 'image-c
-00002250: 616d 6572 612d 686f 7573 696e 672d 7669  amera-housing-vi
-00002260: 6577 706f 7274 275b 2776 6965 7770 6f72  ewport'['viewpor
-00002270: 742d 7479 7065 275d 2069 6e20 6974 656d  t-type'] in item
-00002280: 3a20 2220 2b20 6974 656d 0a20 2020 2020  : " + item.     
-00002290: 2020 2065 7863 6570 7420 286d 6971 7463     except (miqtc
-000022a0: 2e49 6664 6f45 7863 6570 7469 6f6e 2c20  .IfdoException, 
-000022b0: 4b65 7945 7272 6f72 293a 0a20 2020 2020  KeyError):.     
-000022c0: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
-000022d0: 2020 2020 2066 6c61 7450 6f72 7450 6172       flatPortPar
-000022e0: 616d 7346 6f75 6e64 203d 2046 616c 7365  amsFound = False
-000022f0: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
-00002300: 2020 2020 2020 2020 2020 2066 6c61 7450             flatP
-00002310: 6f72 7450 6172 616d 7320 3d20 7365 6c66  ortParams = self
-00002320: 2e5f 5f67 6574 4974 656d 4465 6661 756c  .__getItemDefaul
-00002330: 7456 616c 7565 2869 7465 6d2c 2769 6d61  tValue(item,'ima
-00002340: 6765 2d66 6c61 7470 6f72 742d 7061 7261  ge-flatport-para
-00002350: 6d65 7465 7273 2729 0a20 2020 2020 2020  meters').       
-00002360: 2020 2020 2066 6c61 7450 6f72 7450 6172       flatPortPar
-00002370: 616d 7346 6f75 6e64 203d 2054 7275 650a  amsFound = True.
-00002380: 2020 2020 2020 2020 6578 6365 7074 206d          except m
-00002390: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-000023a0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-000023b0: 7061 7373 0a20 2020 2020 2020 2064 6f6d  pass.        dom
-000023c0: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
-000023d0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
-000023e0: 2074 7279 3a20 0a20 2020 2020 2020 2020   try: .         
-000023f0: 2020 2064 6f6d 6550 6f72 7450 6172 616d     domePortParam
-00002400: 7320 3d20 7365 6c66 2e5f 5f67 6574 4974  s = self.__getIt
-00002410: 656d 4465 6661 756c 7456 616c 7565 2869  emDefaultValue(i
-00002420: 7465 6d2c 2769 6d61 6765 2d64 6f6d 6570  tem,'image-domep
-00002430: 6f72 742d 7061 7261 6d65 7465 7273 2729  ort-parameters')
-00002440: 0a20 2020 2020 2020 2020 2020 2064 6f6d  .            dom
-00002450: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
-00002460: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-00002470: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
-00002480: 6f45 7863 6570 7469 6f6e 3a0a 2020 2020  oException:.    
-00002490: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-000024a0: 2020 2020 2020 6966 2066 6c61 7450 6f72        if flatPor
-000024b0: 7450 6172 616d 7346 6f75 6e64 2061 6e64  tParamsFound and
-000024c0: 2064 6f6d 6550 6f72 7450 6172 616d 7346   domePortParamsF
-000024d0: 6f75 6e64 3a0a 2020 2020 2020 2020 2020  ound:.          
-000024e0: 2020 7265 7475 726e 204e 6f6e 652c 2243    return None,"C
-000024f0: 6f75 6c64 206e 6f74 2072 6561 6420 706f  ould not read po
-00002500: 7274 2074 7970 6520 6672 6f6d 2069 7465  rt type from ite
-00002510: 6d20 6173 2069 7420 636f 6e74 6169 6e73  m as it contains
-00002520: 2069 6e66 6f20 6f6e 2062 6f74 6820 666c   info on both fl
-00002530: 6174 2061 6e64 2064 6f6d 6520 706f 7274  at and dome port
-00002540: 3a20 2220 2b20 6974 656d 0a20 2020 2020  : " + item.     
-00002550: 2020 2069 6620 666c 6174 506f 7274 5061     if flatPortPa
-00002560: 7261 6d73 466f 756e 643a 0a20 2020 2020  ramsFound:.     
-00002570: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00002580: 6c73 652c 2241 7373 756d 6564 2061 7320  lse,"Assumed as 
-00002590: 666c 6174 2070 6f72 7420 6173 2027 696d  flat port as 'im
-000025a0: 6167 652d 666c 6174 706f 7274 2d70 6172  age-flatport-par
-000025b0: 616d 6574 6572 7327 2066 6f75 6e64 2069  ameters' found i
-000025c0: 6e20 6974 656d 3a20 2220 2b20 6974 656d  n item: " + item
-000025d0: 0a20 2020 2020 2020 2069 6620 646f 6d65  .        if dome
-000025e0: 506f 7274 5061 7261 6d73 466f 756e 643a  PortParamsFound:
-000025f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00002600: 7572 6e20 5472 7565 2c22 4173 7375 6d65  urn True,"Assume
-00002610: 6420 6173 2064 6f6d 6520 706f 7274 2061  d as dome port a
-00002620: 7320 2769 6d61 6765 2d64 6f6d 6570 6f72  s 'image-domepor
-00002630: 742d 7061 7261 6d65 7465 7273 2720 666f  t-parameters' fo
-00002640: 756e 6420 696e 2069 7465 6d3a 2022 202b  und in item: " +
-00002650: 2069 7465 6d0a 2020 2020 2020 2020 7265   item.        re
-00002660: 7475 726e 204e 6f6e 652c 2243 6f75 6c64  turn None,"Could
-00002670: 206e 6f74 2072 6561 6420 706f 7274 2074   not read port t
-00002680: 7970 6520 6672 6f6d 2069 7465 6d3a 2022  ype from item: "
-00002690: 202b 2069 7465 6d0a 0a0a 2020 2020 6465   + item...    de
-000026a0: 6620 5f5f 7472 7947 6574 466f 6361 6c4c  f __tryGetFocalL
-000026b0: 656e 6774 6849 6e50 6978 656c 7328 7365  engthInPixels(se
-000026c0: 6c66 2c69 7465 6d3a 7374 722c 646f 6d65  lf,item:str,dome
-000026d0: 506f 7274 3d4e 6f6e 6529 3a0a 2020 2020  Port=None):.    
-000026e0: 2020 2020 2222 2220 0a20 2020 2020 2020      """ .       
-000026f0: 2054 7269 6573 2074 6f20 7265 6164 2f64   Tries to read/d
-00002700: 6574 6572 6d69 6e65 2066 6f63 616c 206c  etermine focal l
-00002710: 656e 6774 6820 696e 2070 6978 656c 7320  ength in pixels 
-00002720: 6569 7468 6572 2066 726f 6d20 2769 6d61  either from 'ima
-00002730: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
-00002740: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
-00002750: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
-00002760: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
-00002770: 5d20 6f72 2066 726f 6d20 6578 6966 2076  ] or from exif v
-00002780: 616c 7565 732e 0a20 2020 2020 2020 2069  alues..        i
-00002790: 6620 646f 6d65 506f 7274 203d 2046 616c  f domePort = Fal
-000027a0: 7365 2c20 666c 6174 2070 6f72 7420 6973  se, flat port is
-000027b0: 2061 7373 756d 6564 2061 6e64 2061 2063   assumed and a c
-000027c0: 6f72 7265 6374 696f 6e20 6661 6374 6f72  orrection factor
-000027d0: 206f 6620 312e 3333 2069 7320 6170 706c   of 1.33 is appl
-000027e0: 6965 6420 666f 7220 666f 6361 6c20 6c65  ied for focal le
-000027f0: 6e67 7468 2064 6574 6572 6d69 6e65 6420  ngth determined 
-00002800: 6672 6f6d 2065 7869 6620 7661 6c75 6573  from exif values
-00002810: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00002820: 2065 6974 6865 7220 666f 6361 6c4c 656e   either focalLen
-00002830: 6774 682c 206d 6573 7361 6765 206f 7220  gth, message or 
-00002840: 5b66 6f63 616c 4c65 6e67 7468 582c 666f  [focalLengthX,fo
-00002850: 6361 6c4c 656e 6774 6859 5d2c 206d 6573  calLengthY], mes
-00002860: 7361 6765 2e20 4966 2075 6e73 7563 6365  sage. If unsucce
-00002870: 7373 6675 6c20 666f 6361 6c4c 656e 6774  ssful focalLengt
-00002880: 6820 3d20 2d31 0a20 2020 2020 2020 2022  h = -1.        "
-00002890: 2222 0a0a 2020 2020 2020 2020 2320 7472  ""..        # tr
-000028a0: 7920 7265 6164 2066 726f 6d20 2769 6d61  y read from 'ima
-000028b0: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
-000028c0: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
-000028d0: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
-000028e0: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
-000028f0: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
-00002900: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
-00002910: 4c65 6e67 7468 5859 203d 2073 656c 662e  LengthXY = self.
-00002920: 5f5f 6765 7449 7465 6d44 6566 6175 6c74  __getItemDefault
-00002930: 5661 6c75 6528 6974 656d 2c27 696d 6167  Value(item,'imag
-00002940: 652d 6361 6d65 7261 2d63 616c 6962 7261  e-camera-calibra
-00002950: 7469 6f6e 2d6d 6f64 656c 2729 0a20 2020  tion-model').   
-00002960: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00002970: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00002980: 6361 6c4c 656e 6774 6858 5920 3d20 666f  calLengthXY = fo
-00002990: 6361 6c4c 656e 6774 6858 595b 2763 616c  calLengthXY['cal
-000029a0: 6962 7261 7469 6f6e 2d66 6f63 616c 2d6c  ibration-focal-l
-000029b0: 656e 6774 682d 7879 2d70 6978 656c 275d  ength-xy-pixel']
-000029c0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-000029d0: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
-000029e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000029f0: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-00002a00: 6365 7074 696f 6e28 6974 656d 2c22 646f  ception(item,"do
-00002a10: 6573 206e 6f74 2063 6f6e 7461 696e 2027  es not contain '
-00002a20: 696d 6167 652d 6361 6d65 7261 2d63 616c  image-camera-cal
-00002a30: 6962 7261 7469 6f6e 2d6d 6f64 656c 275b  ibration-model'[
-00002a40: 2763 616c 6962 7261 7469 6f6e 2d66 6f63  'calibration-foc
-00002a50: 616c 2d6c 656e 6774 682d 7879 2d70 6978  al-length-xy-pix
-00002a60: 656c 275d 2229 0a0a 2020 2020 2020 2020  el']")..        
-00002a70: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00002a80: 7461 6e63 6528 666f 6361 6c4c 656e 6774  tance(focalLengt
-00002a90: 6858 592c 6c69 7374 293a 2023 2078 2061  hXY,list): # x a
-00002aa0: 6e64 2079 2076 616c 7565 2061 7265 2069  nd y value are i
-00002ab0: 6465 6e74 6963 616c 0a20 2020 2020 2020  dentical.       
-00002ac0: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
-00002ad0: 6e67 7468 5859 203d 205b 666f 6361 6c4c  ngthXY = [focalL
-00002ae0: 656e 6774 6858 592c 666f 6361 6c4c 656e  engthXY,focalLen
-00002af0: 6774 6858 595d 0a20 2020 2020 2020 2020  gthXY].         
-00002b00: 2020 2069 6620 6c65 6e28 666f 6361 6c4c     if len(focalL
-00002b10: 656e 6774 6858 5929 2021 3d20 323a 0a20  engthXY) != 2:. 
-00002b20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002b30: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-00002b40: 7863 6570 7469 6f6e 2869 7465 6d2c 2249  xception(item,"I
-00002b50: 6e76 616c 6964 2065 6e74 7279 2066 6f72  nvalid entry for
-00002b60: 2027 696d 6167 652d 6361 6d65 7261 2d63   'image-camera-c
-00002b70: 616c 6962 7261 7469 6f6e 2d6d 6f64 656c  alibration-model
-00002b80: 275b 2763 616c 6962 7261 7469 6f6e 2d66  '['calibration-f
-00002b90: 6f63 616c 2d6c 656e 6774 682d 7879 2d70  ocal-length-xy-p
-00002ba0: 6978 656c 275d 203a 2022 202b 2073 7472  ixel'] : " + str
-00002bb0: 2866 6f63 616c 4c65 6e67 7468 5859 2920  (focalLengthXY) 
-00002bc0: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00002bd0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00002be0: 2866 6f63 616c 4c65 6e67 7468 5859 5b30  (focalLengthXY[0
-00002bf0: 5d2c 666c 6f61 7429 206f 7220 6e6f 7420  ],float) or not 
-00002c00: 6973 696e 7374 616e 6365 2866 6f63 616c  isinstance(focal
-00002c10: 4c65 6e67 7468 5859 5b30 5d2c 696e 7429  LengthXY[0],int)
-00002c20: 206f 7220 6e6f 7420 6973 696e 7374 616e   or not isinstan
-00002c30: 6365 2866 6f63 616c 4c65 6e67 7468 5859  ce(focalLengthXY
-00002c40: 5b31 5d2c 666c 6f61 7429 206f 7220 6e6f  [1],float) or no
-00002c50: 7420 6973 696e 7374 616e 6365 2866 6f63  t isinstance(foc
-00002c60: 616c 4c65 6e67 7468 5859 5b31 5d2c 696e  alLengthXY[1],in
-00002c70: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00002c80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00002c90: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
-00002ca0: 616c 4c65 6e67 7468 5859 203d 205b 666c  alLengthXY = [fl
-00002cb0: 6f61 7428 666f 6361 6c4c 656e 6774 6858  oat(focalLengthX
-00002cc0: 595b 305d 292c 666c 6f61 7428 666f 6361  Y[0]),float(foca
-00002cd0: 6c4c 656e 6774 6858 595b 315d 295d 0a20  lLengthXY[1])]. 
-00002ce0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00002cf0: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-00002d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002d10: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
-00002d20: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
-00002d30: 6974 656d 2c22 496e 7661 6c69 6420 656e  item,"Invalid en
-00002d40: 7472 7920 666f 7220 2769 6d61 6765 2d63  try for 'image-c
-00002d50: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
-00002d60: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
-00002d70: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
-00002d80: 7468 2d78 792d 7069 7865 6c27 5d20 3a20  th-xy-pixel'] : 
-00002d90: 2220 2b20 7374 7228 666f 6361 6c4c 656e  " + str(focalLen
-00002da0: 6774 6858 5929 2029 0a20 2020 2020 2020  gthXY) ).       
-00002db0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00002dc0: 2020 7265 7475 726e 2066 6f63 616c 4c65    return focalLe
-00002dd0: 6e67 7468 5859 2c20 2250 6172 7365 6420  ngthXY, "Parsed 
-00002de0: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
-00002df0: 7261 2d63 616c 6962 7261 7469 6f6e 2d6d  ra-calibration-m
-00002e00: 6f64 656c 275b 2763 616c 6962 7261 7469  odel'['calibrati
-00002e10: 6f6e 2d66 6f63 616c 2d6c 656e 6774 682d  on-focal-length-
-00002e20: 7879 2d70 6978 656c 275d 220a 2020 2020  xy-pixel']".    
-00002e30: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
-00002e40: 2e49 6664 6f45 7863 6570 7469 6f6e 3a0a  .IfdoException:.
-00002e50: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00002e60: 0a0a 2020 2020 2020 2020 756e 6465 7277  ..        underw
-00002e70: 6174 6572 496d 6167 6520 3d20 5472 7565  aterImage = True
-00002e80: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00002e90: 2020 2020 2020 2020 2020 616c 7430 203d            alt0 =
-00002ea0: 2073 656c 665b 6974 656d 2b27 303a 696d   self[item+'0:im
-00002eb0: 6167 652d 616c 7469 7475 6465 2d6d 6574  age-altitude-met
-00002ec0: 6572 7327 5d20 2373 656c 662e 5f5f 6765  ers'] #self.__ge
-00002ed0: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
-00002ee0: 6528 6974 656d 2c20 2769 6d61 6765 2d61  e(item, 'image-a
-00002ef0: 6c74 6974 7564 652d 6d65 7465 7273 2729  ltitude-meters')
-00002f00: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00002f10: 616c 7430 203e 2030 3a0a 2020 2020 2020  alt0 > 0:.      
-00002f20: 2020 2020 2020 2020 2020 756e 6465 7277            underw
-00002f30: 6174 6572 496d 6167 6520 3d20 4661 6c73  aterImage = Fals
-00002f40: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00002f50: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-00002f60: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00002f70: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
-00002f80: 2320 6164 6420 636f 7272 6563 7469 6f6e  # add correction
-00002f90: 2066 6163 746f 7220 666f 7220 666c 6174   factor for flat
-00002fa0: 2070 6f72 740a 2020 2020 2020 2020 6966   port.        if
-00002fb0: 2064 6f6d 6550 6f72 7420 6973 204e 6f6e   domePort is Non
-00002fc0: 6520 616e 6420 756e 6465 7277 6174 6572  e and underwater
-00002fd0: 496d 6167 653a 0a20 2020 2020 2020 2020  Image:.         
-00002fe0: 2020 2072 6574 7572 6e20 5b2d 312c 2d31     return [-1,-1
-00002ff0: 5d2c 2022 436f 756c 6420 6e6f 7420 6465  ], "Could not de
-00003000: 7465 726d 696e 6520 666f 6361 6c20 6c65  termine focal le
-00003010: 6e67 7468 2066 726f 6d20 2769 6d61 6765  ngth from 'image
-00003020: 2d63 616d 6572 612d 6361 6c69 6272 6174  -camera-calibrat
-00003030: 696f 6e2d 6d6f 6465 6c27 5b27 6361 6c69  ion-model'['cali
-00003040: 6272 6174 696f 6e2d 666f 6361 6c2d 6c65  bration-focal-le
-00003050: 6e67 7468 2d78 792d 7069 7865 6c27 5d20  ngth-xy-pixel'] 
-00003060: 616e 6420 706f 7274 2074 7970 652c 2077  and port type, w
-00003070: 6869 6368 2069 7320 7265 7175 6972 6564  hich is required
-00003080: 2066 6f72 2063 6f72 7265 6374 2065 7661   for correct eva
-00003090: 6c75 6174 696f 6e20 6f66 2065 7869 6620  luation of exif 
-000030a0: 7661 6c75 6573 2c20 6973 206e 6f74 2070  values, is not p
-000030b0: 726f 7669 6465 6421 220a 2020 2020 2020  rovided!".      
-000030c0: 2020 636f 7272 6563 7469 6f6e 466b 7420    correctionFkt 
-000030d0: 3d20 312e 300a 2020 2020 2020 2020 6966  = 1.0.        if
-000030e0: 2064 6f6d 6550 6f72 7420 3d3d 2046 616c   domePort == Fal
-000030f0: 7365 2061 6e64 2075 6e64 6572 7761 7465  se and underwate
-00003100: 7249 6d61 6765 3a0a 2020 2020 2020 2020  rImage:.        
-00003110: 2020 2020 636f 7272 6563 7469 6f6e 466b      correctionFk
-00003120: 7420 3d20 312e 3333 0a0a 2020 2020 2020  t = 1.33..      
-00003130: 2020 2320 6f74 6865 7277 6973 6520 7472    # otherwise tr
-00003140: 7920 6465 7269 7665 2066 726f 6d20 6578  y derive from ex
-00003150: 6966 2074 6167 730a 2020 2020 2020 2020  if tags.        
-00003160: 6578 6966 203d 2073 656c 662e 5f5f 6765  exif = self.__ge
-00003170: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
-00003180: 6528 6974 656d 2c27 696d 6167 652d 6163  e(item,'image-ac
-00003190: 7175 6973 6974 696f 6e2d 7365 7474 696e  quisition-settin
-000031a0: 6773 2729 0a20 2020 2020 2020 2023 2320  gs').        ## 
-000031b0: 6672 6f6d 2046 6f63 616c 204c 656e 6774  from Focal Lengt
-000031c0: 682c 2046 6f63 616c 2050 6c61 6e65 2058  h, Focal Plane X
-000031d0: 2052 6573 6f6c 7574 696f 6e2c 2046 6f63   Resolution, Foc
-000031e0: 616c 2050 6c61 6e65 2059 2052 6573 6f6c  al Plane Y Resol
-000031f0: 7574 696f 6e2c 2046 6f63 616c 2050 6c61  ution, Focal Pla
-00003200: 6e65 2052 6573 6f6c 7574 696f 6e20 556e  ne Resolution Un
-00003210: 6974 0a20 2020 2020 2020 2066 6f63 616c  it.        focal
-00003220: 4c65 6e67 7468 5859 2c20 6d73 6720 3d20  LengthXY, msg = 
-00003230: 7365 6c66 2e5f 5f74 7279 4465 7465 726d  self.__tryDeterm
-00003240: 696e 6546 6f63 616c 4c65 6e67 6874 496e  ineFocalLenghtIn
-00003250: 5069 7865 6c73 4672 6f6d 4578 6966 5f31  PixelsFromExif_1
-00003260: 2865 7869 6629 0a20 2020 2020 2020 2069  (exif).        i
-00003270: 6620 666f 6361 6c4c 656e 6774 6858 5920  f focalLengthXY 
-00003280: 213d 205b 2d31 2c2d 315d 3a0a 2020 2020  != [-1,-1]:.    
-00003290: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-000032a0: 652a 636f 7272 6563 7469 6f6e 466b 7420  e*correctionFkt 
-000032b0: 666f 7220 6520 696e 2066 6f63 616c 4c65  for e in focalLe
-000032c0: 6e67 7468 5859 5d2c 2027 4465 7269 7665  ngthXY], 'Derive
-000032d0: 6420 6672 6f6d 2065 7869 6620 7461 6773  d from exif tags
-000032e0: 2046 6f63 616c 204c 656e 6774 682c 2046   Focal Length, F
-000032f0: 6f63 616c 2050 6c61 6e65 2058 2052 6573  ocal Plane X Res
-00003300: 6f6c 7574 696f 6e2c 2046 6f63 616c 2050  olution, Focal P
-00003310: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
-00003320: 6e2c 2046 6f63 616c 2050 6c61 6e65 2052  n, Focal Plane R
-00003330: 6573 6f6c 7574 696f 6e20 556e 6974 270a  esolution Unit'.
-00003340: 2020 2020 2020 2020 2323 2066 726f 6d20          ## from 
-00003350: 6672 6f6d 2033 3520 6d6d 2065 7175 6976  from 35 mm equiv
-00003360: 616c 656e 7420 666f 6361 6c20 6c65 6e67  alent focal leng
-00003370: 7468 0a20 2020 2020 2020 2066 6f63 616c  th.        focal
-00003380: 4c65 6e67 7468 5859 2c20 6d73 6720 3d20  LengthXY, msg = 
-00003390: 7365 6c66 2e5f 5f74 7279 4465 7465 726d  self.__tryDeterm
-000033a0: 696e 6546 6f63 616c 4c65 6e67 6874 496e  ineFocalLenghtIn
-000033b0: 5069 7865 6c73 4672 6f6d 4578 6966 5f32  PixelsFromExif_2
-000033c0: 2865 7869 6629 0a20 2020 2020 2020 2069  (exif).        i
-000033d0: 6620 666f 6361 6c4c 656e 6774 6858 5920  f focalLengthXY 
-000033e0: 213d 205b 2d31 2c2d 315d 3a0a 2020 2020  != [-1,-1]:.    
-000033f0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00003400: 652a 636f 7272 6563 7469 6f6e 466b 7420  e*correctionFkt 
-00003410: 666f 7220 6520 696e 2066 6f63 616c 4c65  for e in focalLe
-00003420: 6e67 7468 5859 5d2c 2027 4465 7269 7665  ngthXY], 'Derive
-00003430: 6420 6672 6f6d 2065 7869 6620 7461 6720  d from exif tag 
-00003440: 466f 6361 6c20 4c65 6e67 7468 2077 6974  Focal Length wit
-00003450: 6820 3335 206d 6d20 6571 7569 7661 6c65  h 35 mm equivale
-00003460: 6e74 270a 200a 2020 2020 2020 2020 7265  nt'. .        re
-00003470: 7475 726e 205b 2d31 2c2d 315d 2c20 2243  turn [-1,-1], "C
-00003480: 6f75 6c64 206e 6f74 2064 6574 6572 6d69  ould not determi
-00003490: 6e65 2066 726f 6d20 666f 6361 6c20 6c65  ne from focal le
-000034a0: 6e67 7468 2069 6e20 7069 7865 6c73 2066  ngth in pixels f
-000034b0: 726f 6d20 6e65 6974 6865 7220 2769 6d61  rom neither 'ima
-000034c0: 6765 2d63 616d 6572 612d 6361 6c69 6272  ge-camera-calibr
-000034d0: 6174 696f 6e2d 6d6f 6465 6c27 5b27 6361  ation-model'['ca
-000034e0: 6c69 6272 6174 696f 6e2d 666f 6361 6c2d  libration-focal-
-000034f0: 6c65 6e67 7468 2d78 792d 7069 7865 6c27  length-xy-pixel'
-00003500: 5d20 6e6f 7220 6578 6966 2074 6167 7320  ] nor exif tags 
-00003510: 466f 6361 6c20 4c65 6e67 7468 2c20 466f  Focal Length, Fo
-00003520: 6361 6c20 506c 616e 6520 5820 5265 736f  cal Plane X Reso
-00003530: 6c75 7469 6f6e 2c20 466f 6361 6c20 506c  lution, Focal Pl
-00003540: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
-00003550: 2c20 466f 6361 6c20 506c 616e 6520 5265  , Focal Plane Re
-00003560: 736f 6c75 7469 6f6e 2055 6e69 7422 0a0a  solution Unit"..
-00003570: 0a20 2020 2064 6566 205f 5f74 7279 4465  .    def __tryDe
-00003580: 7465 726d 696e 6546 6f63 616c 4c65 6e67  termineFocalLeng
-00003590: 6874 496e 5069 7865 6c73 4672 6f6d 4578  htInPixelsFromEx
-000035a0: 6966 5f31 2873 656c 662c 6578 6966 4469  if_1(self,exifDi
-000035b0: 6374 3a64 6963 7429 3a0a 2020 2020 2020  ct:dict):.      
-000035c0: 2020 2222 2220 7472 7920 746f 2064 6574    """ try to det
-000035d0: 6572 6d69 6e65 2066 6f63 616c 206c 656e  ermine focal len
-000035e0: 6774 6820 696e 2070 6978 656c 7320 6672  gth in pixels fr
-000035f0: 6f6d 2065 7869 6620 7461 6773 2046 6f63  om exif tags Foc
-00003600: 616c 204c 656e 6774 682c 2046 6f63 616c  al Length, Focal
-00003610: 2050 6c61 6e65 2058 2052 6573 6f6c 7574   Plane X Resolut
-00003620: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
-00003630: 2059 2052 6573 6f6c 7574 696f 6e2c 2046   Y Resolution, F
-00003640: 6f63 616c 2050 6c61 6e65 2052 6573 6f6c  ocal Plane Resol
-00003650: 7574 696f 6e20 556e 6974 2e0a 2020 2020  ution Unit..    
-00003660: 2020 2020 2020 2020 5265 7472 756e 7320          Retruns 
-00003670: 5b66 6f63 616c 4c65 6e67 7468 5069 7865  [focalLengthPixe
-00003680: 6c73 5f78 2c66 6f63 616c 4c65 6e67 7468  ls_x,focalLength
-00003690: 5069 7865 6c73 5f79 5d2c 206d 6573 7361  Pixels_y], messa
-000036a0: 6765 0a20 2020 2020 2020 2020 2020 2052  ge.            R
-000036b0: 6574 7275 6e73 2066 6f63 616c 4c65 6e67  etruns focalLeng
-000036c0: 7468 5069 7865 6c73 203d 202d 3120 6966  thPixels = -1 if
-000036d0: 206e 6f74 2073 7563 6365 7373 6675 6c6c   not successfull
-000036e0: 2022 2222 0a0a 2020 2020 2020 2020 7472   """..        tr
-000036f0: 793a 0a20 2020 2020 2020 2020 2020 2066  y:.            f
-00003700: 6f63 616c 4c65 6e67 7468 203d 2073 7472  ocalLength = str
-00003710: 2865 7869 6644 6963 745b 2746 6f63 616c  (exifDict['Focal
-00003720: 204c 656e 6774 6827 5d29 0a20 2020 2020   Length']).     
-00003730: 2020 2020 2020 2066 6f63 616c 506c 616e         focalPlan
-00003740: 6552 6573 5f78 203d 2066 6c6f 6174 2873  eRes_x = float(s
-00003750: 7472 2865 7869 6644 6963 745b 2746 6f63  tr(exifDict['Foc
-00003760: 616c 2050 6c61 6e65 2058 2052 6573 6f6c  al Plane X Resol
-00003770: 7574 696f 6e27 5d29 2e73 7472 6970 2827  ution']).strip('
-00003780: 5c27 2729 290a 2020 2020 2020 2020 2020  \'')).          
-00003790: 2020 666f 6361 6c50 6c61 6e65 5265 735f    focalPlaneRes_
-000037a0: 7920 3d20 666c 6f61 7428 7374 7228 6578  y = float(str(ex
-000037b0: 6966 4469 6374 5b27 466f 6361 6c20 506c  ifDict['Focal Pl
-000037c0: 616e 6520 5920 5265 736f 6c75 7469 6f6e  ane Y Resolution
-000037d0: 275d 292e 7374 7269 7028 275c 2727 2929  ']).strip('\''))
-000037e0: 0a20 2020 2020 2020 2020 2020 2066 6f63  .            foc
-000037f0: 616c 506c 616e 6552 6573 5f75 6e69 7420  alPlaneRes_unit 
-00003800: 3d20 7374 7228 6578 6966 4469 6374 5b27  = str(exifDict['
-00003810: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
-00003820: 6c75 7469 6f6e 2055 6e69 7427 5d29 2e73  lution Unit']).s
-00003830: 7472 6970 2827 5c27 2729 0a20 2020 2020  trip('\'').     
-00003840: 2020 2065 7863 6570 7420 284b 6579 4572     except (KeyEr
-00003850: 726f 722c 2056 616c 7565 4572 726f 7229  ror, ValueError)
-00003860: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00003870: 7475 726e 205b 2d31 2c2d 315d 2c20 2243  turn [-1,-1], "C
-00003880: 6f75 6c64 206e 6f74 2066 696e 6420 616c  ould not find al
-00003890: 6c20 7265 7175 6972 6564 2066 6965 6c64  l required field
-000038a0: 7320 466f 6361 6c20 4c65 6e67 7468 2c20  s Focal Length, 
-000038b0: 466f 6361 6c20 506c 616e 6520 5820 5265  Focal Plane X Re
-000038c0: 736f 6c75 7469 6f6e 2c20 466f 6361 6c20  solution, Focal 
-000038d0: 506c 616e 6520 5920 5265 736f 6c75 7469  Plane Y Resoluti
-000038e0: 6f6e 2c20 466f 6361 6c20 506c 616e 6520  on, Focal Plane 
-000038f0: 5265 736f 6c75 7469 6f6e 2055 6e69 7422  Resolution Unit"
-00003900: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-00003910: 2020 2320 7061 7273 6520 666f 6361 6c20    # parse focal 
-00003920: 6c65 6e67 7468 2066 726f 6d20 6c65 6674  length from left
-00003930: 2028 6d61 7920 6265 2027 372e 3520 6d6d   (may be '7.5 mm
-00003940: 2028 2e2e 2e29 2729 0a20 2020 2020 2020   (...)').       
-00003950: 2066 6f63 616c 4c65 6e67 7468 5374 7269   focalLengthStri
-00003960: 7070 6564 203d 2066 6f63 616c 4c65 6e67  pped = focalLeng
-00003970: 7468 2e73 7472 6970 2829 0a20 2020 2020  th.strip().     
-00003980: 2020 2066 6f63 616c 4c65 6e67 7468 466c     focalLengthFl
-00003990: 6f61 7420 3d20 4e6f 6e65 0a20 2020 2020  oat = None.     
-000039a0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000039b0: 6528 6c65 6e28 666f 6361 6c4c 656e 6774  e(len(focalLengt
-000039c0: 6853 7472 6970 7065 6429 293a 0a20 2020  hStripped)):.   
-000039d0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-000039e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000039f0: 6361 6c4c 656e 6774 6846 6c6f 6174 203d  calLengthFloat =
-00003a00: 2066 6c6f 6174 2866 6f63 616c 4c65 6e67   float(focalLeng
-00003a10: 7468 5374 7269 7070 6564 5b30 3a69 2b31  thStripped[0:i+1
-00003a20: 5d29 0a20 2020 2020 2020 2020 2020 2065  ]).            e
-00003a30: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-00003a40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003a50: 2020 7061 7373 0a20 2020 2020 2020 2069    pass.        i
-00003a60: 6620 666f 6361 6c4c 656e 6774 6846 6c6f  f focalLengthFlo
-00003a70: 6174 2069 7320 4e6f 6e65 3a0a 2020 2020  at is None:.    
-00003a80: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00003a90: 2d31 2c2d 315d 2c20 2243 6f75 6c64 206e  -1,-1], "Could n
-00003aa0: 6f74 2070 6172 7365 2066 6f72 6361 6c20  ot parse forcal 
-00003ab0: 6c65 6e67 7468 2066 726f 6d20 2746 6f63  length from 'Foc
-00003ac0: 616c 204c 656e 6774 6827 3a20 2220 2b20  al Length': " + 
-00003ad0: 666f 6361 6c4c 656e 6774 680a 2020 2020  focalLength.    
-00003ae0: 2020 2020 7363 616c 6546 6b74 5f66 6f63      scaleFkt_foc
-00003af0: 616c 203d 2073 656c 662e 5f5f 756e 6974  al = self.__unit
-00003b00: 436f 6e76 6572 7369 6f6e 4661 6374 326d  ConversionFact2m
-00003b10: 6d28 666f 6361 6c4c 656e 6774 6829 0a20  m(focalLength). 
-00003b20: 2020 2020 2020 2069 6620 7363 616c 6546         if scaleF
-00003b30: 6b74 5f66 6f63 616c 203d 3d20 2d31 3a0a  kt_focal == -1:.
-00003b40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00003b50: 726e 205b 2d31 2c2d 315d 2c20 2243 6f75  rn [-1,-1], "Cou
-00003b60: 6c64 206e 6f74 2070 6172 7365 2066 6f72  ld not parse for
-00003b70: 6361 6c20 6c65 6e67 7468 2075 6e69 7420  cal length unit 
-00003b80: 6672 6f6d 2027 466f 6361 6c20 4c65 6e67  from 'Focal Leng
-00003b90: 7468 273a 2022 202b 2066 6f63 616c 4c65  th': " + focalLe
-00003ba0: 6e67 7468 0a20 2020 2020 2020 2066 6f63  ngth.        foc
-00003bb0: 616c 4c65 6e67 7468 5f6d 6d20 3d20 666f  alLength_mm = fo
-00003bc0: 6361 6c4c 656e 6774 6846 6c6f 6174 202a  calLengthFloat *
-00003bd0: 2073 6361 6c65 466b 745f 666f 6361 6c0a   scaleFkt_focal.
-00003be0: 0a20 2020 2020 2020 2073 6361 6c65 466b  .        scaleFk
-00003bf0: 745f 7265 7320 3d20 7365 6c66 2e5f 5f75  t_res = self.__u
-00003c00: 6e69 7443 6f6e 7665 7273 696f 6e46 6163  nitConversionFac
-00003c10: 7432 6d6d 2866 6f63 616c 506c 616e 6552  t2mm(focalPlaneR
-00003c20: 6573 5f75 6e69 7429 0a20 2020 2020 2020  es_unit).       
-00003c30: 2069 6620 7363 616c 6546 6b74 5f72 6573   if scaleFkt_res
-00003c40: 203d 3d20 2d31 3a0a 2020 2020 2020 2020   == -1:.        
-00003c50: 2020 2020 7265 7475 726e 205b 2d31 2c2d      return [-1,-
-00003c60: 315d 2c20 2243 6f75 6c64 206e 6f74 2070  1], "Could not p
-00003c70: 6172 7365 2046 6f63 616c 2050 6c61 6e65  arse Focal Plane
-00003c80: 2052 6573 6f6c 7574 696f 6e20 556e 6974   Resolution Unit
-00003c90: 2066 726f 6d20 2746 6f63 616c 2050 6c61   from 'Focal Pla
-00003ca0: 6e65 2052 6573 6f6c 7574 696f 6e20 556e  ne Resolution Un
-00003cb0: 6974 273a 2022 202b 2066 6f63 616c 506c  it': " + focalPl
-00003cc0: 616e 6552 6573 5f75 6e69 740a 0a20 2020  aneRes_unit..   
-00003cd0: 2020 2020 2066 6f63 616c 4c65 6e67 7468       focalLength
-00003ce0: 5069 7865 6c73 5f78 203d 2066 6f63 616c  Pixels_x = focal
-00003cf0: 4c65 6e67 7468 5f6d 6d20 2a20 666f 6361  Length_mm * foca
-00003d00: 6c50 6c61 6e65 5265 735f 7820 2f20 7363  lPlaneRes_x / sc
-00003d10: 616c 6546 6b74 5f72 6573 0a20 2020 2020  aleFkt_res.     
-00003d20: 2020 2066 6f63 616c 4c65 6e67 7468 5069     focalLengthPi
-00003d30: 7865 6c73 5f79 203d 2066 6f63 616c 4c65  xels_y = focalLe
-00003d40: 6e67 7468 5f6d 6d20 2a20 666f 6361 6c50  ngth_mm * focalP
-00003d50: 6c61 6e65 5265 735f 7920 2f20 7363 616c  laneRes_y / scal
-00003d60: 6546 6b74 5f72 6573 0a0a 2020 2020 2020  eFkt_res..      
-00003d70: 2020 7265 7475 726e 205b 666f 6361 6c4c    return [focalL
-00003d80: 656e 6774 6850 6978 656c 735f 782c 666f  engthPixels_x,fo
-00003d90: 6361 6c4c 656e 6774 6850 6978 656c 735f  calLengthPixels_
-00003da0: 795d 2c20 2222 0a0a 0a20 2020 2064 6566  y], ""...    def
-00003db0: 205f 5f74 7279 4465 7465 726d 696e 6546   __tryDetermineF
-00003dc0: 6f63 616c 4c65 6e67 6874 496e 5069 7865  ocalLenghtInPixe
-00003dd0: 6c73 4672 6f6d 4578 6966 5f32 2873 656c  lsFromExif_2(sel
-00003de0: 662c 6578 6966 4469 6374 3a64 6963 7429  f,exifDict:dict)
-00003df0: 3a0a 2020 2020 2020 2020 2222 2220 7472  :.        """ tr
-00003e00: 7920 746f 2064 6574 6572 6d69 6e65 2066  y to determine f
-00003e10: 6f63 616c 206c 656e 6774 6820 696e 2070  ocal length in p
-00003e20: 6978 656c 7320 6672 6f6d 2033 3520 6d6d  ixels from 35 mm
-00003e30: 2065 7175 6976 616c 656e 7420 666f 6361   equivalent foca
-00003e40: 6c20 6c65 6e67 7468 2069 6e20 6578 6966  l length in exif
-00003e50: 2074 6167 2046 6f63 616c 204c 656e 6774   tag Focal Lengt
-00003e60: 6827 7320 6164 6420 6f6e 2065 2e67 2e20  h's add on e.g. 
-00003e70: 2737 2e30 206d 6d20 2833 3520 6d6d 2065  '7.0 mm (35 mm e
-00003e80: 7175 6976 616c 656e 743a 2033 382e 3820  quivalent: 38.8 
-00003e90: 6d6d 2927 2e0a 2020 2020 2020 2020 2020  mm)'..          
-00003ea0: 2020 5265 7472 756e 7320 5b66 6f63 616c    Retruns [focal
-00003eb0: 4c65 6e67 7468 5069 7865 6c73 5f78 2c66  LengthPixels_x,f
-00003ec0: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
-00003ed0: 5f79 5d2c 206d 6573 7361 6765 0a20 2020  _y], message.   
-00003ee0: 2020 2020 2020 2020 2052 6574 7275 6e73           Retruns
-00003ef0: 2066 6f63 616c 4c65 6e67 7468 5069 7865   focalLengthPixe
-00003f00: 6c73 203d 202d 3120 6966 206e 6f74 2073  ls = -1 if not s
-00003f10: 7563 6365 7373 6675 6c6c 2022 2222 0a0a  uccessfull """..
-00003f20: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00003f30: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
-00003f40: 6e67 7468 203d 2073 7472 2865 7869 6644  ngth = str(exifD
-00003f50: 6963 745b 2746 6f63 616c 204c 656e 6774  ict['Focal Lengt
-00003f60: 6827 5d29 0a20 2020 2020 2020 2020 2020  h']).           
-00003f70: 2069 6d61 6765 5769 6474 6820 3d20 696e   imageWidth = in
-00003f80: 7428 7374 7228 6578 6966 4469 6374 5b27  t(str(exifDict['
-00003f90: 496d 6167 6520 5769 6474 6827 5d29 2e73  Image Width']).s
-00003fa0: 7472 6970 2827 5c27 2729 290a 2020 2020  trip('\'')).    
-00003fb0: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
-00003fc0: 7272 6f72 2c20 5661 6c75 6545 7272 6f72  rror, ValueError
-00003fd0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00003fe0: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
-00003ff0: 436f 756c 6420 6e6f 7420 6669 6e64 2061  Could not find a
-00004000: 6c6c 2072 6571 7569 7265 6420 6669 656c  ll required fiel
-00004010: 6473 2046 6f63 616c 204c 656e 6774 682c  ds Focal Length,
-00004020: 2049 6d61 6765 2057 6964 7468 220a 0a20   Image Width".. 
-00004030: 2020 2020 2020 2023 2074 7279 2070 6172         # try par
-00004040: 7365 2033 3520 6d6d 2065 7175 6976 616c  se 35 mm equival
-00004050: 656e 7420 6672 6f6d 2065 2e67 2e3a 2020  ent from e.g.:  
-00004060: 372e 3020 6d6d 2028 3335 206d 6d20 6571  7.0 mm (35 mm eq
-00004070: 7569 7661 6c65 6e74 3a20 3338 2e38 206d  uivalent: 38.8 m
-00004080: 6d29 0a20 2020 2020 2020 2063 6f6c 6f6e  m).        colon
-00004090: 496e 6465 7820 3d20 666f 6361 6c4c 656e  Index = focalLen
-000040a0: 6774 682e 6669 6e64 2827 3a27 290a 2020  gth.find(':').  
-000040b0: 2020 2020 2020 6966 2063 6f6c 6f6e 496e        if colonIn
-000040c0: 6465 7820 3d3d 202d 313a 0a20 2020 2020  dex == -1:.     
-000040d0: 2020 2020 2020 2072 6574 7572 6e20 5b2d         return [-
-000040e0: 312c 2d31 5d2c 2022 436f 756c 6420 6e6f  1,-1], "Could no
-000040f0: 7420 7061 7273 6520 3335 206d 6d20 6571  t parse 35 mm eq
-00004100: 7569 7661 6c65 6e74 2066 6f63 616c 206c  uivalent focal l
-00004110: 656e 6774 6820 6672 6f6d 2027 466f 6361  ength from 'Foca
-00004120: 6c20 4c65 6e67 7468 273a 2022 202b 2066  l Length': " + f
-00004130: 6f63 616c 4c65 6e67 7468 0a20 2020 2020  ocalLength.     
-00004140: 2020 2066 6f63 616c 4c65 6e67 7468 4571     focalLengthEq
-00004150: 3335 6d6d 466c 6f61 7420 3d20 4e6f 6e65  35mmFloat = None
-00004160: 0a20 2020 2020 2020 2065 7175 616c 3335  .        equal35
-00004170: 6d6d 5061 7274 203d 2066 6f63 616c 4c65  mmPart = focalLe
-00004180: 6e67 7468 5b63 6f6c 6f6e 496e 6465 782b  ngth[colonIndex+
-00004190: 313a 3a5d 2e73 7472 6970 2829 0a20 2020  1::].strip().   
-000041a0: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-000041b0: 6e67 6528 6c65 6e28 6571 7561 6c33 356d  nge(len(equal35m
-000041c0: 6d50 6172 7429 293a 0a20 2020 2020 2020  mPart)):.       
-000041d0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000041e0: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
-000041f0: 656e 6774 6845 7133 356d 6d46 6c6f 6174  engthEq35mmFloat
-00004200: 203d 2066 6c6f 6174 2865 7175 616c 3335   = float(equal35
-00004210: 6d6d 5061 7274 5b30 3a69 2b31 5d29 0a20  mmPart[0:i+1]). 
-00004220: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00004230: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
-00004240: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00004250: 7373 0a20 2020 2020 2020 2073 6361 6c65  ss.        scale
-00004260: 466b 7420 3d20 7365 6c66 2e5f 5f75 6e69  Fkt = self.__uni
-00004270: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
-00004280: 6d6d 2866 6f63 616c 4c65 6e67 7468 5b63  mm(focalLength[c
-00004290: 6f6c 6f6e 496e 6465 782b 313a 3a5d 290a  olonIndex+1::]).
-000042a0: 2020 2020 2020 2020 6966 2066 6f63 616c          if focal
-000042b0: 4c65 6e67 7468 4571 3335 6d6d 466c 6f61  LengthEq35mmFloa
-000042c0: 7420 6973 204e 6f6e 6520 6f72 2073 6361  t is None or sca
-000042d0: 6c65 466b 7420 3d3d 202d 313a 0a20 2020  leFkt == -1:.   
-000042e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000042f0: 5b2d 312c 2d31 5d2c 2022 436f 756c 6420  [-1,-1], "Could 
-00004300: 6e6f 7420 7061 7273 6520 3335 206d 6d20  not parse 35 mm 
-00004310: 6571 7569 7661 6c65 6e74 2066 6f63 616c  equivalent focal
-00004320: 206c 656e 6774 6820 6672 6f6d 2027 466f   length from 'Fo
-00004330: 6361 6c20 4c65 6e67 7468 273a 2022 202b  cal Length': " +
-00004340: 2066 6f63 616c 4c65 6e67 7468 0a20 2020   focalLength.   
-00004350: 2020 2020 200a 2020 2020 2020 2020 666f       .        fo
-00004360: 6361 6c4c 656e 6774 6850 6978 656c 7320  calLengthPixels 
-00004370: 3d20 666f 6361 6c4c 656e 6774 6845 7133  = focalLengthEq3
-00004380: 356d 6d46 6c6f 6174 202a 2073 6361 6c65  5mmFloat * scale
-00004390: 466b 7420 2a20 696d 6167 6557 6964 7468  Fkt * imageWidth
-000043a0: 202f 2033 362e 300a 2020 2020 2020 2020   / 36.0.        
-000043b0: 7265 7475 726e 205b 666f 6361 6c4c 656e  return [focalLen
-000043c0: 6774 6850 6978 656c 732c 666f 6361 6c4c  gthPixels,focalL
-000043d0: 656e 6774 6850 6978 656c 735d 2c20 2222  engthPixels], ""
-000043e0: 0a0a 0a20 2020 2064 6566 205f 5f75 6e69  ...    def __uni
-000043f0: 7443 6f6e 7665 7273 696f 6e46 6163 7432  tConversionFact2
-00004400: 6d6d 2873 656c 662c 756e 6974 3a73 7472  mm(self,unit:str
-00004410: 293a 0a20 2020 2020 2020 2022 2222 206c  ):.        """ l
-00004420: 6f6f 6b73 2066 6f72 206c 6574 7465 7220  ooks for letter 
-00004430: 7365 7175 656e 6365 2069 6e20 756e 6974  sequence in unit
-00004440: 2061 6e64 2063 6865 636b 7320 6966 2069   and checks if i
-00004450: 7427 7320 2769 6e63 6865 7327 2c27 6d27  t's 'inches','m'
-00004460: 2c27 636d 272c 276d 6d27 2c27 756d 2720  ,'cm','mm','um' 
-00004470: 6f72 2027 2720 616e 6420 7265 7475 726e  or '' and return
-00004480: 7320 7265 7370 6563 7469 7665 2063 6f6e  s respective con
-00004490: 7665 7273 696f 6e20 6661 6374 6f72 2074  version factor t
-000044a0: 6f20 6d6d 2028 6966 2074 6865 7265 2061  o mm (if there a
-000044b0: 7265 206e 6f20 6c65 7474 6572 7320 6974  re no letters it
-000044c0: 2072 6574 7572 6e73 2031 292e 204f 7468   returns 1). Oth
-000044d0: 6572 7769 7365 2072 6574 7572 6e20 2d31  erwise return -1
-000044e0: 2022 2222 0a0a 2020 2020 2020 2020 6669   """..        fi
-000044f0: 7273 744c 6574 7465 7253 6571 203d 2022  rstLetterSeq = "
-00004500: 220a 2020 2020 2020 2020 6669 7273 7446  ".        firstF
-00004510: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-00004520: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00004530: 6e67 6528 6c65 6e28 756e 6974 2929 3a0a  nge(len(unit)):.
-00004540: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-00004550: 6e69 745b 695d 2e69 7361 6c70 6861 2829  nit[i].isalpha()
-00004560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004570: 2020 6669 7273 7446 6f75 6e64 203d 2054    firstFound = T
-00004580: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00004590: 2020 2020 6669 7273 744c 6574 7465 7253      firstLetterS
-000045a0: 6571 202b 3d20 756e 6974 5b69 5d0a 2020  eq += unit[i].  
-000045b0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000045c0: 2075 6e69 745b 695d 2e69 7361 6c70 6861   unit[i].isalpha
-000045d0: 2829 2061 6e64 2066 6972 7374 466f 756e  () and firstFoun
-000045e0: 6420 3d3d 2054 7275 653a 0a20 2020 2020  d == True:.     
-000045f0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-00004600: 0a0a 2020 2020 2020 2020 6966 2066 6972  ..        if fir
-00004610: 7374 4c65 7474 6572 5365 712e 6c6f 7765  stLetterSeq.lowe
-00004620: 7228 2920 3d3d 2022 696e 6368 6573 223a  r() == "inches":
-00004630: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
-00004640: 6c65 466b 7420 3d20 3235 2e34 0a20 2020  leFkt = 25.4.   
-00004650: 2020 2020 2065 6c69 6620 6669 7273 744c       elif firstL
-00004660: 6574 7465 7253 6571 2e6c 6f77 6572 2829  etterSeq.lower()
-00004670: 203d 3d20 226d 223a 0a20 2020 2020 2020   == "m":.       
-00004680: 2020 2020 2073 6361 6c65 466b 7420 3d20       scaleFkt = 
-00004690: 3130 3030 2e30 3b0a 2020 2020 2020 2020  1000.0;.        
-000046a0: 656c 6966 2066 6972 7374 4c65 7474 6572  elif firstLetter
-000046b0: 5365 712e 6c6f 7765 7228 2920 3d3d 2022  Seq.lower() == "
-000046c0: 636d 223a 0a20 2020 2020 2020 2020 2020  cm":.           
-000046d0: 2073 6361 6c65 466b 7420 3d20 3130 2e30   scaleFkt = 10.0
-000046e0: 3b0a 2020 2020 2020 2020 656c 6966 2066  ;.        elif f
-000046f0: 6972 7374 4c65 7474 6572 5365 712e 6c6f  irstLetterSeq.lo
-00004700: 7765 7228 2920 3d3d 2022 6d6d 223a 0a20  wer() == "mm":. 
-00004710: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00004720: 466b 7420 3d20 312e 303b 0a20 2020 2020  Fkt = 1.0;.     
-00004730: 2020 2065 6c69 6620 6669 7273 744c 6574     elif firstLet
-00004740: 7465 7253 6571 2e6c 6f77 6572 2829 203d  terSeq.lower() =
-00004750: 3d20 2275 6d22 3a0a 2020 2020 2020 2020  = "um":.        
-00004760: 2020 2020 7363 616c 6546 6b74 203d 2031      scaleFkt = 1
-00004770: 2f31 3030 303b 0a20 2020 2020 2020 2065  /1000;.        e
-00004780: 6c69 6620 6669 7273 744c 6574 7465 7253  lif firstLetterS
-00004790: 6571 2e6c 6f77 6572 2829 203d 3d20 2222  eq.lower() == ""
-000047a0: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
-000047b0: 616c 6546 6b74 203d 2031 3b0a 2020 2020  aleFkt = 1;.    
-000047c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000047d0: 2020 2020 2020 7363 616c 6546 6b74 203d        scaleFkt =
-000047e0: 202d 310a 0a20 2020 2020 2020 2072 6574   -1..        ret
-000047f0: 7572 6e20 7363 616c 6546 6b74 0a0a 0a20  urn scaleFkt... 
-00004800: 2020 2064 6566 205f 5f67 6574 4974 656d     def __getItem
-00004810: 4465 6661 756c 7456 616c 7565 2873 656c  DefaultValue(sel
-00004820: 662c 6974 656d 3a73 7472 2c66 6965 6c64  f,item:str,field
-00004830: 4e61 6d65 3a73 7472 293a 0a20 2020 2020  Name:str):.     
-00004840: 2020 2022 2222 2072 6574 7572 6e73 2069     """ returns i
-00004850: 7465 6d20 7661 6c75 6573 2028 6669 7273  tem values (firs
-00004860: 7420 656e 7472 7920 696e 2063 6173 6520  t entry in case 
-00004870: 6f66 2076 6964 656f 7329 2e20 5468 726f  of videos). Thro
-00004880: 7773 206d 6172 6971 742e 636f 7265 2e49  ws mariqt.core.I
-00004890: 6664 6f45 7863 6570 7469 6f6e 2069 6620  fdoException if 
-000048a0: 6669 656c 6420 6e6f 7420 666f 756e 642e  field not found.
-000048b0: 2022 2222 0a0a 2020 2020 2020 2020 7265   """..        re
-000048c0: 7420 3d20 7365 6c66 5b22 3a22 2e6a 6f69  t = self[":".joi
-000048d0: 6e28 5b69 7465 6d2c 2730 272c 6669 656c  n([item,'0',fiel
-000048e0: 644e 616d 655d 295d 0a20 2020 2020 2020  dName])].       
-000048f0: 2069 6620 7265 7420 3d3d 2022 223a 0a20   if ret == "":. 
-00004900: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00004910: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00004920: 696f 6e28 2245 7272 6f72 3a20 4669 656c  ion("Error: Fiel
-00004930: 6420 7b30 7d20 6e65 6974 6865 7220 666f  d {0} neither fo
-00004940: 756e 6420 696e 2069 7465 6d20 7b31 7d20  und in item {1} 
-00004950: 6e6f 7220 6865 6164 6572 222e 666f 726d  nor header".form
-00004960: 6174 2866 6965 6c64 4e61 6d65 2c69 7465  at(fieldName,ite
-00004970: 6d29 290a 2020 2020 2020 2020 7265 7475  m)).        retu
-00004980: 726e 2072 6574 0a0a 0a20 2020 2064 6566  rn ret...    def
-00004990: 205f 5f67 6574 4974 656d 4c61 744c 6f6e   __getItemLatLon
-000049a0: 2873 656c 662c 6974 656d 3a73 7472 2c68  (self,item:str,h
-000049b0: 6561 6465 7256 616c 4c61 742c 6865 6164  eaderValLat,head
-000049c0: 6572 5661 6c4c 6f6e 293a 0a20 2020 2020  erValLon):.     
-000049d0: 2020 2022 2222 2072 6574 7572 6e73 207b     """ returns {
-000049e0: 276c 6174 273a 2076 616c 7565 2c20 276c  'lat': value, 'l
-000049f0: 6f6e 273a 2076 616c 7565 2c20 2764 6174  on': value, 'dat
-00004a00: 6574 696d 6527 3a20 7661 6c75 657d 206f  etime': value} o
-00004a10: 6620 6c69 7374 206f 6620 7468 6f73 6520  f list of those 
-00004a20: 2222 220a 0a20 2020 2020 2020 2069 7465  """..        ite
-00004a30: 6d56 616c 203d 2073 656c 662e 6966 646f  mVal = self.ifdo
-00004a40: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
-00004a50: 5f69 7465 6d73 5f6b 6579 5d5b 6974 656d  _items_key][item
-00004a60: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
-00004a70: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-00004a80: 5661 6c2c 6c69 7374 293a 0a20 2020 2020  Val,list):.     
-00004a90: 2020 2020 2020 2072 6574 203d 2073 656c         ret = sel
-00004aa0: 662e 5f5f 7061 7273 6532 4c61 744c 6f6e  f.__parse2LatLon
-00004ab0: 4469 6374 2869 7465 6d56 616c 2c68 6561  Dict(itemVal,hea
-00004ac0: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
-00004ad0: 5661 6c4c 6f6e 290a 2020 2020 2020 2020  ValLon).        
-00004ae0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00004af0: 2020 7265 7420 3d20 5b5d 0a20 2020 2020    ret = [].     
-00004b00: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00004b10: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00004b20: 4c61 7444 6566 6175 6c74 203d 2069 7465  LatDefault = ite
-00004b30: 6d56 616c 5b30 5d5b 2769 6d61 6765 2d6c  mVal[0]['image-l
-00004b40: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
-00004b50: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-00004b60: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00004b70: 2020 2020 2020 2069 7465 6d4c 6174 4465         itemLatDe
-00004b80: 6661 756c 7420 3d20 6865 6164 6572 5661  fault = headerVa
-00004b90: 6c4c 6174 0a20 2020 2020 2020 2020 2020  lLat.           
-00004ba0: 2020 2020 2023 6966 2069 7465 6d4c 6174       #if itemLat
-00004bb0: 4465 6661 756c 7420 6973 204e 6f6e 653a  Default is None:
-00004bc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004bd0: 2023 2020 2020 7261 6973 6520 4578 6365   #    raise Exce
-00004be0: 7074 696f 6e28 2245 7272 6f72 3a20 4669  ption("Error: Fi
-00004bf0: 656c 6420 7b30 7d20 6e65 6974 6865 7220  eld {0} neither 
-00004c00: 666f 756e 6420 696e 2069 7465 6d20 7b31  found in item {1
-00004c10: 7d20 6e6f 7220 6865 6164 6572 222e 666f  } nor header".fo
-00004c20: 726d 6174 2827 696d 6167 652d 6c61 7469  rmat('image-lati
-00004c30: 7475 6465 272c 6974 656d 2929 0a0a 2020  tude',item))..  
-00004c40: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00004c50: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00004c60: 7465 6d4c 6f6e 4465 6661 756c 7420 3d20  temLonDefault = 
-00004c70: 6974 656d 5661 6c5b 305d 5b27 696d 6167  itemVal[0]['imag
-00004c80: 652d 6c6f 6e67 6974 7564 6527 5d0a 2020  e-longitude'].  
-00004c90: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00004ca0: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-00004cb0: 2020 2020 2020 2020 2020 2069 7465 6d4c             itemL
-00004cc0: 6f6e 4465 6661 756c 7420 3d20 6865 6164  onDefault = head
-00004cd0: 6572 5661 6c4c 6f6e 0a20 2020 2020 2020  erValLon.       
-00004ce0: 2020 2020 2020 2020 2023 6966 2069 7465           #if ite
-00004cf0: 6d4c 6f6e 4465 6661 756c 7420 6973 204e  mLonDefault is N
-00004d00: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00004d10: 2020 2020 2023 2020 2020 7261 6973 6520       #    raise 
-00004d20: 4578 6365 7074 696f 6e28 2245 7272 6f72  Exception("Error
-00004d30: 3a20 4669 656c 6420 7b30 7d20 6e65 6974  : Field {0} neit
-00004d40: 6865 7220 666f 756e 6420 696e 2069 7465  her found in ite
-00004d50: 6d20 7b31 7d20 6e6f 7220 6865 6164 6572  m {1} nor header
-00004d60: 222e 666f 726d 6174 2827 696d 6167 652d  ".format('image-
-00004d70: 6c61 7469 7475 6465 272c 6974 656d 2929  latitude',item))
-00004d80: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00004d90: 7220 7375 6245 6e74 7279 2069 6e20 6974  r subEntry in it
-00004da0: 656d 5661 6c3a 0a20 2020 2020 2020 2020  emVal:.         
-00004db0: 2020 2020 2020 2072 6574 2e61 7070 656e         ret.appen
-00004dc0: 6428 7365 6c66 2e5f 5f70 6172 7365 324c  d(self.__parse2L
-00004dd0: 6174 4c6f 6e44 6963 7428 7375 6245 6e74  atLonDict(subEnt
-00004de0: 7279 2c69 7465 6d4c 6174 4465 6661 756c  ry,itemLatDefaul
-00004df0: 742c 6974 656d 4c6f 6e44 6566 6175 6c74  t,itemLonDefault
-00004e00: 2929 0a0a 2020 2020 2020 2020 7265 7475  ))..        retu
-00004e10: 726e 2072 6574 0a20 2020 2020 2020 2020  rn ret.         
-00004e20: 2020 200a 0a20 2020 2064 6566 205f 5f70     ..    def __p
-00004e30: 6172 7365 324c 6174 4c6f 6e44 6963 7428  arse2LatLonDict(
-00004e40: 7365 6c66 2c69 7465 6d56 616c 2c68 6561  self,itemVal,hea
-00004e50: 6465 7256 616c 4c61 742c 6865 6164 6572  derValLat,header
-00004e60: 5661 6c4c 6f6e 293a 0a20 2020 2020 2020  ValLon):.       
-00004e70: 2022 2222 2072 6574 7572 6e73 207b 276c   """ returns {'l
-00004e80: 6174 273a 6c61 742c 276c 6f6e 273a 6c6f  at':lat,'lon':lo
-00004e90: 6e2c 2764 6174 6574 696d 6527 3a64 6174  n,'datetime':dat
-00004ea0: 6574 696d 657d 2022 2222 0a20 2020 2020  etime} """.     
-00004eb0: 2020 2064 6174 6574 696d 6520 3d20 6974     datetime = it
-00004ec0: 656d 5661 6c5b 2769 6d61 6765 2d64 6174  emVal['image-dat
-00004ed0: 6574 696d 6527 5d0a 2020 2020 2020 2020  etime'].        
-00004ee0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00004ef0: 206c 6174 203d 2069 7465 6d56 616c 5b27   lat = itemVal['
-00004f00: 696d 6167 652d 6c61 7469 7475 6465 275d  image-latitude']
-00004f10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00004f20: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
-00004f30: 2020 2020 2020 6c61 7420 3d20 6865 6164        lat = head
-00004f40: 6572 5661 6c4c 6174 0a20 2020 2020 2020  erValLat.       
-00004f50: 2020 2020 2069 6620 6c61 7420 6973 204e       if lat is N
-00004f60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00004f70: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-00004f80: 7469 6f6e 2822 4572 726f 723a 2046 6965  tion("Error: Fie
-00004f90: 6c64 207b 307d 206e 6569 7468 6572 2066  ld {0} neither f
-00004fa0: 6f75 6e64 2069 6e20 6974 656d 207b 317d  ound in item {1}
-00004fb0: 206e 6f72 2068 6561 6465 7222 2e66 6f72   nor header".for
-00004fc0: 6d61 7428 2769 6d61 6765 2d6c 6174 6974  mat('image-latit
-00004fd0: 7564 6527 2c69 7465 6d56 616c 2929 0a20  ude',itemVal)). 
-00004fe0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00004ff0: 2020 2020 2020 2020 6c6f 6e20 3d20 6974          lon = it
-00005000: 656d 5661 6c5b 2769 6d61 6765 2d6c 6f6e  emVal['image-lon
-00005010: 6769 7475 6465 275d 0a20 2020 2020 2020  gitude'].       
-00005020: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-00005030: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00005040: 6e20 3d20 6865 6164 6572 5661 6c4c 6f6e  n = headerValLon
-00005050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00005060: 6c6f 6e20 6973 204e 6f6e 653a 0a20 2020  lon is None:.   
-00005070: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00005080: 7365 2045 7863 6570 7469 6f6e 2822 4572  se Exception("Er
-00005090: 726f 723a 2046 6965 6c64 207b 307d 206e  ror: Field {0} n
-000050a0: 6569 7468 6572 2066 6f75 6e64 2069 6e20  either found in 
-000050b0: 6974 656d 207b 317d 206e 6f72 2068 6561  item {1} nor hea
-000050c0: 6465 7222 2e66 6f72 6d61 7428 2769 6d61  der".format('ima
-000050d0: 6765 2d6c 6f6e 6769 7475 6465 272c 6974  ge-longitude',it
-000050e0: 656d 5661 6c29 290a 2020 2020 2020 2020  emVal)).        
-000050f0: 7265 7475 726e 207b 276c 6174 273a 6c61  return {'lat':la
-00005100: 742c 276c 6f6e 273a 6c6f 6e2c 2764 6174  t,'lon':lon,'dat
-00005110: 6574 696d 6527 3a64 6174 6574 696d 657d  etime':datetime}
-00005120: 0a0a 0a64 6566 2069 4644 4f46 726f 6d46  ...def iFDOFromF
-00005130: 696c 6528 6946 444f 6669 6c65 3a73 7472  ile(iFDOfile:str
-00005140: 2c68 616e 646c 655f 7072 6566 6978 3d27  ,handle_prefix='
-00005150: 3230 2e35 3030 2e31 3230 3835 272c 7072  20.500.12085',pr
-00005160: 6f76 656e 616e 6365 203d 204e 6f6e 652c  ovenance = None,
-00005170: 7665 7262 6f73 653d 5472 7565 2c69 676e  verbose=True,ign
-00005180: 6f72 655f 696d 6167 655f 6669 6c65 733d  ore_image_files=
-00005190: 4661 6c73 652c 7772 6974 6554 6d70 5072  False,writeTmpPr
-000051a0: 6f76 4669 6c65 3d54 7275 652c 696d 6167  ovFile=True,imag
-000051b0: 655f 6272 6f6b 6572 5f75 7569 643d 2265  e_broker_uuid="e
-000051c0: 6532 3737 3537 382d 6139 3131 2d34 3834  e277578-a911-484
-000051d0: 642d 6135 3135 2d39 6337 3831 6437 3961  d-a515-9c781d79a
-000051e0: 6139 3122 293a 0a20 2020 2022 2222 2043  a91"):.    """ C
-000051f0: 6f6e 7665 6e69 656e 6365 2066 756e 6374  onvenience funct
-00005200: 696f 6e20 746f 2063 7265 6174 6520 616e  ion to create an
-00005210: 2069 4644 4f20 6f62 6a65 6374 2064 6972   iFDO object dir
-00005220: 6563 746c 7920 666f 726d 2061 6e20 6578  ectly form an ex
-00005230: 6973 7469 6e67 2069 4644 4f20 6669 6c65  isting iFDO file
-00005240: 2e20 5472 6965 7320 746f 2069 6e66 6572  . Tries to infer
-00005250: 2069 6d61 6765 2066 696c 6573 206c 6f63   image files loc
-00005260: 6174 696f 6e20 6672 6f6d 2027 696d 6167  ation from 'imag
-00005270: 652d 6c6f 6361 6c2d 7061 7468 272e 2052  e-local-path'. R
-00005280: 6574 7572 6e73 2069 4644 4f20 6f62 6a65  eturns iFDO obje
-00005290: 6374 2e20 0a20 2020 2020 2020 202d 2069  ct. .        - i
-000052a0: 4644 4f66 696c 653a 2073 7472 696e 6720  FDOfile: string 
-000052b0: 7061 7468 2074 6f20 6c6f 6164 2061 6e20  path to load an 
-000052c0: 6578 706c 6963 6974 2069 4644 4f20 6669  explicit iFDO fi
-000052d0: 6c65 2e0a 2020 2020 2020 2020 2d20 6861  le..        - ha
-000052e0: 6e64 6c65 5f70 7265 6669 783a 2073 7472  ndle_prefix: str
-000052f0: 696e 6720 7072 6566 6978 206f 6620 7468  ing prefix of th
-00005300: 6520 6861 6e64 6c65 2073 6572 7665 722e  e handle server.
-00005310: 2044 6566 6175 6c74 3a20 7468 6520 6f6e   Default: the on
-00005320: 6520 666f 7220 4765 6f6d 6172 2e0a 2020  e for Geomar..  
-00005330: 2020 2020 2020 2d20 7072 6f76 656e 616e        - provenan
-00005340: 6365 3a20 6d61 7269 7174 2e70 726f 7665  ce: mariqt.prove
-00005350: 6e63 616e 6365 2e50 726f 7665 6e61 6e63  ncance.Provenanc
-00005360: 6520 6f62 6a65 6374 2074 6f20 7472 6163  e object to trac
-00005370: 6b20 6461 7461 2070 726f 7665 6e61 6e63  k data provenanc
-00005380: 652e 2044 6566 6175 6c74 3a20 6120 6e65  e. Default: a ne
-00005390: 7720 7072 6f76 656e 616e 6365 206f 626a  w provenance obj
-000053a0: 6563 7420 6973 2063 7265 6174 6564 2069  ect is created i
-000053b0: 6e20 7468 6520 2770 726f 746f 636f 6c27  n the 'protocol'
-000053c0: 2073 7562 666f 6c64 6572 2e0a 2020 2020   subfolder..    
-000053d0: 2020 2020 2d20 7665 7262 6f73 653a 2062      - verbose: b
-000053e0: 6f6f 6c20 7768 6574 6865 7220 746f 2070  ool whether to p
-000053f0: 7269 6e74 206f 7574 2069 6e66 6f72 6d61  rint out informa
-00005400: 7469 6f6e 2e20 5072 6f63 6573 7369 6e67  tion. Processing
-00005410: 2069 7320 6661 7374 6572 2069 6620 7665   is faster if ve
-00005420: 7262 6f73 6520 6973 2046 616c 7365 2e20  rbose is False. 
-00005430: 4465 6661 756c 743a 2054 7275 652e 0a20  Default: True.. 
-00005440: 2020 2020 2020 202d 2069 676e 6f72 655f         - ignore_
-00005450: 696d 6167 655f 6669 6c65 733a 2062 6f6f  image_files: boo
-00005460: 6c20 7768 6574 6865 7220 6974 2773 2061  l whether it's a
-00005470: 6363 6570 7465 6420 7468 6174 2074 6865  ccepted that the
-00005480: 7265 2061 7265 206e 6f74 2069 6d61 6765  re are not image
-00005490: 7320 7965 7420 696e 2027 6469 7227 2e20  s yet in 'dir'. 
-000054a0: 4465 6661 756c 743a 2046 616c 7365 2e0a  Default: False..
-000054b0: 2020 2020 2020 2020 2d20 7772 6974 6554          - writeT
-000054c0: 6d70 5072 6f76 4669 6c65 3a20 626f 6f6c  mpProvFile: bool
-000054d0: 2077 6865 7468 6572 2074 6f20 7772 6974   whether to writ
-000054e0: 6520 6120 7465 6d70 6f72 6172 7920 7072  e a temporary pr
-000054f0: 6f76 656e 616e 6365 2066 696c 6520 6475  ovenance file du
-00005500: 7269 6e67 2074 6865 2069 4644 4f20 6372  ring the iFDO cr
-00005510: 6561 7469 6f6e 2070 726f 6365 7373 2077  eation process w
-00005520: 6869 6368 2077 696c 6c20 6265 2072 6570  hich will be rep
-00005530: 6c61 6365 6420 6279 2061 2066 696e 616c  laced by a final
-00005540: 206f 6e65 2069 6e20 7468 6520 656e 642e   one in the end.
-00005550: 2044 6566 6175 6c74 3a20 5472 7565 0a20   Default: True. 
-00005560: 2020 2020 2020 202d 2069 6d61 6765 5f62         - image_b
-00005570: 726f 6b65 725f 7575 6964 3a20 7575 6964  roker_uuid: uuid
-00005580: 206f 6620 696d 6167 6520 6272 6f6b 6572   of image broker
-00005590: 2074 6f20 6372 6561 7465 2069 6d61 6765   to create image
-000055a0: 2068 616e 646c 6573 2061 7320 6874 7470   handles as http
-000055b0: 733a 2f2f 6864 6c2e 6861 6e64 6c65 2e6e  s://hdl.handle.n
-000055c0: 6574 2f3c 6861 6e64 6c65 5f70 7265 6669  et/<handle_prefi
-000055d0: 783e 2f3c 696d 6167 655f 6272 6f6b 6572  x>/<image_broker
-000055e0: 5f75 7569 643e 403c 696d 6167 652d 7575  _uuid>@<image-uu
-000055f0: 6964 3e20 2222 220a 2020 2020 7265 6164  id> """.    read
-00005600: 6572 203d 2069 4644 4f5f 5265 6164 6572  er = iFDO_Reader
-00005610: 2869 4644 4f66 696c 6529 0a20 2020 2069  (iFDOfile).    i
-00005620: 6d61 6765 7344 6972 203d 206d 6971 7463  magesDir = miqtc
-00005630: 2e74 6f55 6e69 7850 6174 6828 6f73 2e70  .toUnixPath(os.p
-00005640: 6174 682e 6e6f 726d 7061 7468 286d 6971  ath.normpath(miq
-00005650: 7463 2e74 6f55 6e69 7850 6174 6828 7265  tc.toUnixPath(re
-00005660: 6164 6572 2e67 6574 496d 6167 6544 6972  ader.getImageDir
-00005670: 6563 746f 7279 2829 2929 290a 2020 2020  ectory()))).    
-00005680: 6261 7365 4469 7220 3d20 6d69 7174 632e  baseDir = miqtc.
-00005690: 746f 556e 6978 5061 7468 286f 732e 7061  toUnixPath(os.pa
-000056a0: 7468 2e63 6f6d 6d6f 6e70 6174 6828 5b69  th.commonpath([i
-000056b0: 4644 4f66 696c 652c 696d 6167 6573 4469  FDOfile,imagesDi
-000056c0: 725d 2929 0a20 2020 2069 6d61 6765 4461  r])).    imageDa
-000056d0: 7461 5479 7065 466f 6c64 6572 203d 205b  taTypeFolder = [
-000056e0: 6520 666f 7220 6520 696e 2069 6d61 6765  e for e in image
-000056f0: 7344 6972 2e72 6570 6c61 6365 2862 6173  sDir.replace(bas
-00005700: 6544 6972 2c22 2229 2e73 706c 6974 2822  eDir,"").split("
-00005710: 2f22 2920 6966 2065 2021 3d20 2222 5d5b  /") if e != ""][
-00005720: 305d 0a20 2020 2069 6620 696d 6167 6544  0].    if imageD
-00005730: 6174 6154 7970 6546 6f6c 6465 7220 6e6f  ataTypeFolder no
-00005740: 7420 696e 206d 6971 7464 2e44 6972 2e64  t in miqtd.Dir.d
-00005750: 742e 5f5f 6d65 6d62 6572 735f 5f3a 0a20  t.__members__:. 
-00005760: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00005770: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00005780: 2822 496d 6167 6573 2061 7265 206e 6f74  ("Images are not
-00005790: 206c 6f63 6174 6564 2069 6e20 6120 7661   located in a va
-000057a0: 6c69 6420 6461 7461 2074 7970 6520 6469  lid data type di
-000057b0: 7265 6374 6f72 7920 2872 6177 2c20 696e  rectory (raw, in
-000057c0: 7465 726d 6564 6961 7465 2c20 7072 6f63  termediate, proc
-000057d0: 6573 7365 642c 202e 2e2e 2920 696e 2074  essed, ...) in t
-000057e0: 6865 2073 616d 6520 7072 6f6a 6563 7420  he same project 
-000057f0: 6173 2069 4644 4f20 6669 6c65 2e22 290a  as iFDO file.").
-00005800: 2020 2020 696d 6167 6573 4461 7461 5479      imagesDataTy
-00005810: 7065 4469 7220 3d20 6f73 2e70 6174 682e  peDir = os.path.
-00005820: 6a6f 696e 2862 6173 6544 6972 2c69 6d61  join(baseDir,ima
-00005830: 6765 4461 7461 5479 7065 466f 6c64 6572  geDataTypeFolder
-00005840: 290a 2020 2020 6469 724f 626a 203d 206d  ).    dirObj = m
-00005850: 6971 7464 2e44 6972 2822 222c 696d 6167  iqtd.Dir("",imag
-00005860: 6573 4461 7461 5479 7065 4469 722c 2063  esDataTypeDir, c
-00005870: 7265 6174 653d 4661 6c73 652c 2077 6974  reate=False, wit
-00005880: 685f 6765 6172 3d46 616c 7365 290a 2020  h_gear=False).  
-00005890: 2020 7265 7475 726e 2069 4644 4f28 6469    return iFDO(di
-000058a0: 723d 6469 724f 626a 2c68 616e 646c 655f  r=dirObj,handle_
-000058b0: 7072 6566 6978 3d68 616e 646c 655f 7072  prefix=handle_pr
-000058c0: 6566 6978 2c70 726f 7665 6e61 6e63 653d  efix,provenance=
-000058d0: 7072 6f76 656e 616e 6365 2c76 6572 626f  provenance,verbo
-000058e0: 7365 3d76 6572 626f 7365 2c69 676e 6f72  se=verbose,ignor
-000058f0: 655f 696d 6167 655f 6669 6c65 733d 6967  e_image_files=ig
-00005900: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
-00005910: 2c77 7269 7465 546d 7050 726f 7646 696c  ,writeTmpProvFil
-00005920: 653d 7772 6974 6554 6d70 5072 6f76 4669  e=writeTmpProvFi
-00005930: 6c65 2c69 4644 4f66 696c 653d 6946 444f  le,iFDOfile=iFDO
-00005940: 6669 6c65 2c69 6d61 6765 5f62 726f 6b65  file,image_broke
-00005950: 725f 7575 6964 3d69 6d61 6765 5f62 726f  r_uuid=image_bro
-00005960: 6b65 725f 7575 6964 290a 0a0a 636c 6173  ker_uuid)...clas
-00005970: 7320 6946 444f 3a0a 2020 2020 2220 436c  s iFDO:.    " Cl
-00005980: 6173 7320 666f 7220 6372 6561 7469 6e67  ass for creating
-00005990: 2061 6e64 2065 6469 7469 6e67 2069 4644   and editing iFD
-000059a0: 4f2e 7961 6d6c 2066 696c 6573 2022 0a0a  O.yaml files "..
-000059b0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000059c0: 2873 656c 662c 2064 6972 3a6d 6971 7464  (self, dir:miqtd
-000059d0: 2e44 6972 2c20 6861 6e64 6c65 5f70 7265  .Dir, handle_pre
-000059e0: 6669 783d 2732 302e 3530 302e 3132 3038  fix='20.500.1208
-000059f0: 3527 2c70 726f 7665 6e61 6e63 6520 3d20  5',provenance = 
-00005a00: 4e6f 6e65 2c76 6572 626f 7365 3d54 7275  None,verbose=Tru
-00005a10: 652c 6967 6e6f 7265 5f69 6d61 6765 5f66  e,ignore_image_f
-00005a20: 696c 6573 3d46 616c 7365 2c77 7269 7465  iles=False,write
-00005a30: 546d 7050 726f 7646 696c 653d 5472 7565  TmpProvFile=True
-00005a40: 2c69 4644 4f66 696c 653d 4e6f 6e65 2c69  ,iFDOfile=None,i
-00005a50: 6d61 6765 5f62 726f 6b65 725f 7575 6964  mage_broker_uuid
-00005a60: 3d22 6565 3237 3735 3738 2d61 3931 312d  ="ee277578-a911-
-00005a70: 3438 3464 2d61 3531 352d 3963 3738 3164  484d-a515-9c781d
-00005a80: 3739 6161 3931 2229 3a0a 2020 2020 2020  79aa91"):.      
-00005a90: 2020 2222 2220 4372 6561 7465 7320 616e    """ Creates an
-00005aa0: 2069 464f 4420 6f62 6a65 6374 2e20 5265   iFOD object. Re
-00005ab0: 7175 6972 6573 2061 2076 616c 6964 2064  quires a valid d
-00005ac0: 6972 6563 746f 7279 2063 6f6e 7461 696e  irectory contain
-00005ad0: 696e 6720 696d 6167 6520 6461 7461 206f  ing image data o
-00005ae0: 722f 616e 6420 616e 6420 6946 444f 2066  r/and and iFDO f
-00005af0: 696c 6520 616e 6420 6120 6861 6e64 6c65  ile and a handle
-00005b00: 2070 7265 6669 7820 6966 2069 7427 7320   prefix if it's 
-00005b10: 6e6f 7420 7468 6520 4765 6f6d 6172 206f  not the Geomar o
-00005b20: 6e65 2e20 4c6f 6164 7320 6469 7265 6374  ne. Loads direct
-00005b30: 6f72 7927 7320 6946 444f 2066 696c 6520  ory's iFDO file 
-00005b40: 6966 2069 7420 6578 6973 7473 2061 6c72  if it exists alr
-00005b50: 6561 6479 2e0a 2020 2020 2020 2020 2020  eady..          
-00005b60: 2020 2d20 6469 723a 206d 6172 6971 742e    - dir: mariqt.
-00005b70: 6469 7265 6374 6f72 6965 732e 4469 7220  directories.Dir 
-00005b80: 6f62 6a65 6374 2070 6f69 6e74 696e 6720  object pointing 
-00005b90: 746f 2061 2076 616c 6964 2064 6174 6120  to a valid data 
-00005ba0: 7479 7065 2064 6972 6563 746f 7279 2028  type directory (
-00005bb0: 7261 772c 2069 6e74 6572 6d65 6469 6174  raw, intermediat
-00005bc0: 652c 2070 726f 6365 7373 6564 2c20 2e2e  e, processed, ..
-00005bd0: 2e29 2063 6f6e 7461 696e 696e 6720 7468  .) containing th
-00005be0: 6520 696d 6167 6520 6461 7461 2e0a 2020  e image data..  
-00005bf0: 2020 2020 2020 2020 2020 2d20 6861 6e64            - hand
-00005c00: 6c65 5f70 7265 6669 783a 2073 7472 696e  le_prefix: strin
-00005c10: 6720 7072 6566 6978 206f 6620 7468 6520  g prefix of the 
-00005c20: 6861 6e64 6c65 2073 6572 7665 722e 2044  handle server. D
-00005c30: 6566 6175 6c74 3a20 7468 6520 6f6e 6520  efault: the one 
-00005c40: 666f 7220 4765 6f6d 6172 2e0a 2020 2020  for Geomar..    
-00005c50: 2020 2020 2020 2020 2d20 7072 6f76 656e          - proven
-00005c60: 616e 6365 3a20 6d61 7269 7174 2e70 726f  ance: mariqt.pro
-00005c70: 7665 6e63 616e 6365 2e50 726f 7665 6e61  vencance.Provena
-00005c80: 6e63 6520 6f62 6a65 6374 2074 6f20 7472  nce object to tr
-00005c90: 6163 6b20 6461 7461 2070 726f 7665 6e61  ack data provena
-00005ca0: 6e63 652e 2044 6566 6175 6c74 3a20 6120  nce. Default: a 
-00005cb0: 6e65 7720 7072 6f76 656e 616e 6365 206f  new provenance o
-00005cc0: 626a 6563 7420 6973 2063 7265 6174 6564  bject is created
-00005cd0: 2069 6e20 7468 6520 2770 726f 746f 636f   in the 'protoco
-00005ce0: 6c27 2073 7562 666f 6c64 6572 2e0a 2020  l' subfolder..  
-00005cf0: 2020 2020 2020 2020 2020 2d20 7665 7262            - verb
-00005d00: 6f73 653a 2062 6f6f 6c20 7768 6574 6865  ose: bool whethe
-00005d10: 7220 746f 2070 7269 6e74 206f 7574 2069  r to print out i
-00005d20: 6e66 6f72 6d61 7469 6f6e 2e20 4465 6661  nformation. Defa
-00005d30: 756c 743a 2054 7275 652e 0a20 2020 2020  ult: True..     
-00005d40: 2020 2020 2020 202d 2069 676e 6f72 655f         - ignore_
-00005d50: 696d 6167 655f 6669 6c65 733a 2069 6d61  image_files: ima
-00005d60: 6765 7320 6669 6c65 7320 6172 6520 6967  ges files are ig
-00005d70: 6e6f 7265 642e 2054 6865 7920 6172 6520  nored. They are 
-00005d80: 6e6f 7420 7365 6172 6368 6564 2066 6f72  not searched for
-00005d90: 2069 6e20 2772 6177 2720 616e 6420 6974   in 'raw' and it
-00005da0: 656d 7320 7661 6c75 6573 2061 7265 206e  ems values are n
-00005db0: 6f74 2075 7064 6174 6564 206e 6f72 2063  ot updated nor c
-00005dc0: 6865 636b 6564 2e20 4465 6661 756c 7420  hecked. Default 
-00005dd0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00005de0: 2020 2020 2d20 7772 6974 6554 6d70 5072      - writeTmpPr
-00005df0: 6f76 4669 6c65 3a20 626f 6f6c 2077 6865  ovFile: bool whe
-00005e00: 7468 6572 2074 6f20 7772 6974 6520 6120  ther to write a 
-00005e10: 7465 6d70 6f72 6172 7920 7072 6f76 656e  temporary proven
-00005e20: 616e 6365 2066 696c 6520 6475 7269 6e67  ance file during
-00005e30: 2074 6865 2069 4644 4f20 6372 6561 7469   the iFDO creati
-00005e40: 6f6e 2070 726f 6365 7373 2077 6869 6368  on process which
-00005e50: 2077 696c 6c20 6265 2072 6570 6c61 6365   will be replace
-00005e60: 6420 6279 2061 2066 696e 616c 206f 6e65  d by a final one
-00005e70: 2069 6e20 7468 6520 656e 642e 2044 6566   in the end. Def
-00005e80: 6175 6c74 3a20 5472 7565 0a20 2020 2020  ault: True.     
-00005e90: 2020 2020 2020 202d 2069 4644 4f66 696c         - iFDOfil
-00005ea0: 653a 2073 7472 696e 6720 7061 7468 2074  e: string path t
-00005eb0: 6f20 6c6f 6164 2061 6e20 6578 706c 6963  o load an explic
-00005ec0: 6974 2069 4644 4f20 6669 6c65 2e20 4966  it iFDO file. If
-00005ed0: 206e 6f74 2070 726f 7669 6465 6420 6120   not provided a 
-00005ee0: 6d61 7463 6869 6e67 2069 4644 4f20 6669  matching iFDO fi
-00005ef0: 6c65 2028 6966 2069 7420 616c 7265 6164  le (if it alread
-00005f00: 7920 6578 6973 7473 2920 7769 6c6c 2062  y exists) will b
-00005f10: 6520 6c6f 6164 6564 2066 726f 6d20 7468  e loaded from th
-00005f20: 6520 2770 726f 6475 6374 7327 2073 7562  e 'products' sub
-00005f30: 6469 7265 6374 6f72 792e 2044 6566 6175  directory. Defau
-00005f40: 6c74 3a20 4e6f 6e65 200a 2020 2020 2020  lt: None .      
-00005f50: 2020 2020 2020 2d20 696d 6167 655f 6272        - image_br
-00005f60: 6f6b 6572 5f75 7569 643a 2075 7569 6420  oker_uuid: uuid 
-00005f70: 6f66 2069 6d61 6765 2062 726f 6b65 7220  of image broker 
-00005f80: 746f 2063 7265 6174 6520 696d 6167 6520  to create image 
-00005f90: 6861 6e64 6c65 7320 6173 2068 7474 7073  handles as https
-00005fa0: 3a2f 2f68 646c 2e68 616e 646c 652e 6e65  ://hdl.handle.ne
-00005fb0: 742f 3c68 616e 646c 655f 7072 6566 6978  t/<handle_prefix
-00005fc0: 3e2f 3c69 6d61 6765 5f62 726f 6b65 725f  >/<image_broker_
-00005fd0: 7575 6964 3e40 3c69 6d61 6765 2d75 7569  uuid>@<image-uui
-00005fe0: 643e 2022 2222 0a0a 2020 2020 2020 2020  d> """..        
-00005ff0: 2320 6368 6563 6b20 7468 6174 2061 7420  # check that at 
-00006000: 6469 7220 6f72 2069 4644 4f66 696c 6520  dir or iFDOfile 
-00006010: 7072 6f76 6964 6564 0a20 2020 2020 2020  provided.       
-00006020: 2069 6620 6469 7220 6973 204e 6f6e 6520   if dir is None 
-00006030: 616e 6420 6946 444f 6669 6c65 2069 7320  and iFDOfile is 
-00006040: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00006050: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-00006060: 646f 4578 6365 7074 696f 6e28 224e 6569  doException("Nei
-00006070: 7468 6572 2064 6972 206e 6f72 2069 4644  ther dir nor iFD
-00006080: 4f66 696c 6520 7072 6f76 6964 6564 2066  Ofile provided f
-00006090: 6f72 2069 4644 4f2e 2229 0a0a 2020 2020  or iFDO.")..    
-000060a0: 2020 2020 7365 6c66 2e64 6972 203d 2064      self.dir = d
-000060b0: 6972 0a20 2020 2020 2020 2073 656c 662e  ir.        self.
-000060c0: 696d 6167 6573 4469 7220 3d20 6469 722e  imagesDir = dir.
-000060d0: 746f 7479 7065 2829 0a20 2020 2020 2020  totype().       
-000060e0: 2073 656c 662e 6469 722e 6372 6561 7465   self.dir.create
-000060f0: 5479 7065 466f 6c64 6572 2829 0a20 2020  TypeFolder().   
-00006100: 2020 2020 2073 656c 662e 6861 6e64 6c65       self.handle
-00006110: 5f70 7265 6669 7820 3d20 2268 7474 7073  _prefix = "https
-00006120: 3a2f 2f68 646c 2e68 616e 646c 652e 6e65  ://hdl.handle.ne
-00006130: 742f 2220 2b20 6861 6e64 6c65 5f70 7265  t/" + handle_pre
-00006140: 6669 780a 2020 2020 2020 2020 7365 6c66  fix.        self
-00006150: 2e69 6d61 6765 5f68 616e 646c 655f 7072  .image_handle_pr
-00006160: 6566 6978 203d 2073 656c 662e 6861 6e64  efix = self.hand
-00006170: 6c65 5f70 7265 6669 7820 2b20 222f 2220  le_prefix + "/" 
-00006180: 2b20 696d 6167 655f 6272 6f6b 6572 5f75  + image_broker_u
-00006190: 7569 640a 2020 2020 2020 2020 7365 6c66  uid.        self
-000061a0: 2e69 676e 6f72 655f 696d 6167 655f 6669  .ignore_image_fi
-000061b0: 6c65 7320 3d20 6967 6e6f 7265 5f69 6d61  les = ignore_ima
-000061c0: 6765 5f66 696c 6573 0a0a 2020 2020 2020  ge_files..      
-000061d0: 2020 7365 6c66 2e69 6d61 6765 5365 7448    self.imageSetH
-000061e0: 6561 6465 724b 6579 203d 206d 6971 7476  eaderKey = miqtv
-000061f0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-00006200: 725f 6b65 790a 2020 2020 2020 2020 7365  r_key.        se
-00006210: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00006220: 4b65 7920 3d20 6d69 7174 762e 696d 6167  Key = miqtv.imag
-00006230: 655f 7365 745f 6974 656d 735f 6b65 790a  e_set_items_key.
-00006240: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-00006250: 6f5f 746d 7020 3d20 7b73 656c 662e 696d  o_tmp = {self.im
-00006260: 6167 6553 6574 4865 6164 6572 4b65 793a  ageSetHeaderKey:
-00006270: 207b 7d2c 0a20 2020 2020 2020 2020 2020   {},.           
-00006280: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00006290: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-000062a0: 4b65 793a 207b 7d7d 0a20 2020 2020 2020  Key: {}}.       
-000062b0: 2073 656c 662e 6966 646f 5f70 6172 7365   self.ifdo_parse
-000062c0: 6420 3d20 4e6f 6e65 0a20 2020 2020 2020  d = None.       
-000062d0: 2073 656c 662e 6966 646f 5f63 6865 636b   self.ifdo_check
-000062e0: 6564 203d 2063 6f70 792e 6465 6570 636f  ed = copy.deepco
-000062f0: 7079 2873 656c 662e 6966 646f 5f74 6d70  py(self.ifdo_tmp
-00006300: 2920 2023 2074 6f20 6265 2073 6574 2062  )  # to be set b
-00006310: 7920 6372 6561 7465 6946 444f 2829 206f  y createiFDO() o
-00006320: 6e6c 7921 0a20 2020 2020 2020 2073 656c  nly!.        sel
-00006330: 662e 5f5f 616c 6c55 5549 4473 4368 6563  f.__allUUIDsChec
-00006340: 6b65 6420 3d20 4661 6c73 650a 2020 2020  ked = False.    
-00006350: 2020 2020 7365 6c66 2e70 726f 7620 3d20      self.prov = 
-00006360: 7072 6f76 656e 616e 6365 0a20 2020 2020  provenance.     
-00006370: 2020 2069 6620 7072 6f76 656e 616e 6365     if provenance
-00006380: 203d 3d20 4e6f 6e65 3a0a 2020 2020 2020   == None:.      
-00006390: 2020 2020 2020 746d 7046 696c 6550 6174        tmpFilePat
-000063a0: 6820 3d20 2222 0a20 2020 2020 2020 2020  h = "".         
-000063b0: 2020 2069 6620 7772 6974 6554 6d70 5072     if writeTmpPr
-000063c0: 6f76 4669 6c65 3a0a 2020 2020 2020 2020  ovFile:.        
-000063d0: 2020 2020 2020 2020 746d 7046 696c 6550          tmpFileP
-000063e0: 6174 6820 3d20 7365 6c66 2e64 6972 2e74  ath = self.dir.t
-000063f0: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
-00006400: 6f74 6f63 6f6c 290a 2020 2020 2020 2020  otocol).        
-00006410: 2020 2020 7365 6c66 2e70 726f 7620 3d20      self.prov = 
-00006420: 6d69 7174 702e 5072 6f76 656e 616e 6365  miqtp.Provenance
-00006430: 2822 6946 444f 222c 7665 7262 6f73 653d  ("iFDO",verbose=
-00006440: 7665 7262 6f73 652c 746d 7046 696c 6550  verbose,tmpFileP
-00006450: 6174 683d 746d 7046 696c 6550 6174 6829  ath=tmpFilePath)
-00006460: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-00006470: 676c 6f62 616c 2076 6572 626f 7369 7479  global verbosity
-00006480: 0a20 2020 2020 2020 206d 6971 7476 2e73  .        miqtv.s
-00006490: 6574 476c 6f62 616c 5665 7262 6f73 6528  etGlobalVerbose(
-000064a0: 7665 7262 6f73 6529 0a0a 2020 2020 2020  verbose)..      
-000064b0: 2020 6966 206e 6f74 2064 6972 2e65 7869    if not dir.exi
-000064c0: 7374 7328 293a 0a20 2020 2020 2020 2020  sts():.         
-000064d0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-000064e0: 6f6e 2822 6469 7265 6374 726f 7922 2c20  on("directroy", 
-000064f0: 6469 722e 7374 7228 292c 2022 646f 6573  dir.str(), "does
-00006500: 206e 6f74 2065 7869 7374 2e22 290a 0a20   not exist.").. 
-00006510: 2020 2020 2020 2069 6620 6e6f 7420 6469         if not di
-00006520: 722e 7661 6c69 6444 6174 6144 6972 2829  r.validDataDir()
-00006530: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00006540: 6973 6520 4578 6365 7074 696f 6e28 2264  ise Exception("d
-00006550: 6972 6563 7472 6f79 222c 2064 6972 2e73  irectroy", dir.s
-00006560: 7472 2829 2c20 226e 6f74 2076 616c 6964  tr(), "not valid
-00006570: 2e20 446f 6573 206e 6f74 2063 6f6d 706c  . Does not compl
-00006580: 7920 7769 7468 2073 7472 7563 7475 7265  y with structure
-00006590: 202f 6261 7365 2f70 726f 6a65 6374 2f5b   /base/project/[
-000065a0: 4765 6172 2f5d 6576 656e 742f 7365 6e73  Gear/]event/sens
-000065b0: 6f72 2f64 6174 615f 7479 7065 2f22 290a  or/data_type/").
-000065c0: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
-000065d0: 2069 4644 4f20 6669 6c65 0a20 2020 2020   iFDO file.     
-000065e0: 2020 2073 656c 662e 6946 444f 6669 6c65     self.iFDOfile
-000065f0: 5f20 3d20 2222 2023 2069 7320 7365 7420  _ = "" # is set 
-00006600: 6279 2073 6574 6946 444f 4669 6c65 4e61  by setiFDOFileNa
-00006610: 6d65 2829 0a20 2020 2020 2020 206c 6f61  me().        loa
-00006620: 6465 6469 4644 4f20 3d20 4661 6c73 650a  dediFDO = False.
-00006630: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00006640: 4644 4f66 696c 6520 6973 204e 6f6e 653a  FDOfile is None:
-00006650: 0a20 2020 2020 2020 2020 2020 2069 4644  .            iFD
-00006660: 4f66 696c 655f 203d 2069 4644 4f66 696c  Ofile_ = iFDOfil
-00006670: 650a 2020 2020 2020 2020 2020 2020 7365  e.            se
-00006680: 6c66 2e73 6574 6946 444f 4669 6c65 4e61  lf.setiFDOFileNa
-00006690: 6d65 2869 4644 4f66 696c 655f 290a 2020  me(iFDOfile_).  
-000066a0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000066b0: 206f 732e 7061 7468 2e69 7366 696c 6528   os.path.isfile(
-000066c0: 6946 444f 6669 6c65 5f29 3a0a 2020 2020  iFDOfile_):.    
-000066d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000066e0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-000066f0: 7074 696f 6e28 2269 4644 4f20 6669 6c65  ption("iFDO file
-00006700: 206e 6f74 2066 6f75 6e64 3a20 2220 2b20   not found: " + 
-00006710: 6946 444f 6669 6c65 5f29 0a20 2020 2020  iFDOfile_).     
-00006720: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00006730: 2020 2020 2069 4644 4f66 696c 655f 203d       iFDOfile_ =
-00006740: 2073 656c 662e 6469 722e 746f 2873 656c   self.dir.to(sel
-00006750: 662e 6469 722e 6474 2e70 726f 6475 6374  f.dir.dt.product
-00006760: 7329 2b73 656c 662e 636f 6e73 7472 7563  s)+self.construc
-00006770: 7469 4644 4f66 696c 654e 616d 6528 7365  tiFDOfileName(se
-00006780: 6c66 2e64 6972 2e70 726f 6a65 6374 2829  lf.dir.project()
-00006790: 2c73 656c 662e 6469 722e 6576 656e 7428  ,self.dir.event(
-000067a0: 292c 7365 6c66 2e64 6972 2e73 656e 736f  ),self.dir.senso
-000067b0: 7228 2929 0a0a 2020 2020 2020 2020 0a20  r())..        . 
-000067c0: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
-000067d0: 6765 7349 6e49 6d61 6765 7344 6972 203d  gesInImagesDir =
-000067e0: 205b 5d0a 2020 2020 2020 2020 6966 2073   [].        if s
-000067f0: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
-00006800: 5f66 696c 6573 3a0a 2020 2020 2020 2020  _files:.        
-00006810: 2020 2020 7072 696e 7428 2243 6175 7469      print("Cauti
-00006820: 6f6e 2120 7275 6e6e 696e 6720 696e 2069  on! running in i
-00006830: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
-00006840: 7320 6d6f 6465 2e22 290a 2020 2020 2020  s mode.").      
-00006850: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00006860: 2020 2020 7365 6c66 2e5f 696d 6167 6573      self._images
-00006870: 496e 496d 6167 6573 4469 7220 3d20 6d69  InImagesDir = mi
-00006880: 7174 692e 6272 6f77 7365 466f 7249 6d61  qti.browseForIma
-00006890: 6765 4669 6c65 7328 7365 6c66 2e69 6d61  geFiles(self.ima
-000068a0: 6765 7344 6972 290a 2020 2020 2020 2020  gesDir).        
-000068b0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-000068c0: 6167 6573 4469 7253 6f72 7465 644c 6973  agesDirSortedLis
-000068d0: 7420 3d20 5b66 696c 6520 666f 7220 6669  t = [file for fi
-000068e0: 6c65 2069 6e20 7365 6c66 2e5f 696d 6167  le in self._imag
-000068f0: 6573 496e 496d 6167 6573 4469 725d 0a20  esInImagesDir]. 
-00006900: 2020 2020 2020 2073 656c 662e 5f69 6d61         self._ima
-00006910: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
-00006920: 7274 6564 4c69 7374 2e73 6f72 7428 290a  rtedList.sort().
-00006930: 2020 2020 2020 2020 7365 6c66 2e5f 696d          self._im
-00006940: 6167 654e 616d 6573 496d 6167 6573 4469  ageNamesImagesDi
-00006950: 7220 3d20 5b6f 732e 7061 7468 2e62 6173  r = [os.path.bas
-00006960: 656e 616d 6528 6669 6c65 2920 666f 7220  ename(file) for 
-00006970: 6669 6c65 2069 6e20 7365 6c66 2e5f 696d  file in self._im
-00006980: 6167 6573 496e 496d 6167 6573 4469 725d  agesInImagesDir]
-00006990: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-000069a0: 2873 656c 662e 5f69 6d61 6765 7349 6e49  (self._imagesInI
-000069b0: 6d61 6765 7344 6972 2920 3d3d 2030 2061  magesDir) == 0 a
-000069c0: 6e64 206e 6f74 2069 676e 6f72 655f 696d  nd not ignore_im
-000069d0: 6167 655f 6669 6c65 733a 0a20 2020 2020  age_files:.     
-000069e0: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-000069f0: 6570 7469 6f6e 2822 4e6f 2069 6d61 6765  eption("No image
-00006a00: 7320 6669 6c65 7320 666f 756e 6420 696e  s files found in
-00006a10: 2022 202b 2073 656c 662e 696d 6167 6573   " + self.images
-00006a20: 4469 7220 2b20 2220 616e 6420 6974 7320  Dir + " and its 
-00006a30: 7375 6264 6972 6563 746f 7269 6573 2229  subdirectories")
-00006a40: 0a0a 2020 2020 2020 2020 756e 6971 7565  ..        unique
-00006a50: 2c20 6475 7020 3d20 6d69 7174 742e 6669  , dup = miqtt.fi
-00006a60: 6c65 7348 6176 6555 6e69 7175 654e 616d  lesHaveUniqueNam
-00006a70: 6528 7365 6c66 2e5f 696d 6167 6573 496e  e(self._imagesIn
-00006a80: 496d 6167 6573 4469 7229 0a20 2020 2020  ImagesDir).     
-00006a90: 2020 2069 6620 6e6f 7420 756e 6971 7565     if not unique
-00006aa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00006ab0: 6973 6520 4578 6365 7074 696f 6e28 0a20  ise Exception(. 
-00006ac0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00006ad0: 4e6f 7420 616c 6c20 6669 6c65 7320 6861  Not all files ha
-00006ae0: 7665 2075 6e69 7175 6520 6e61 6d65 732e  ve unique names.
-00006af0: 2044 7570 6c69 6361 7465 733a 2022 202b   Duplicates: " +
-00006b00: 2073 7472 2864 7570 2929 0a0a 2020 2020   str(dup))..    
-00006b10: 2020 2020 616c 6c76 616c 6964 2c20 6d73      allvalid, ms
-00006b20: 6720 3d20 6d69 7174 742e 616c 6c49 6d61  g = miqtt.allIma
-00006b30: 6765 4e61 6d65 7356 616c 6964 2873 656c  geNamesValid(sel
-00006b40: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
-00006b50: 7344 6972 2920 0a20 2020 2020 2020 2069  sDir) .        i
-00006b60: 6620 6e6f 7420 616c 6c76 616c 6964 3a0a  f not allvalid:.
-00006b70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006b80: 6520 4578 6365 7074 696f 6e28 6d73 6729  e Exception(msg)
-00006b90: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00006ba0: 726f 762e 6c6f 6728 7374 7228 6c65 6e28  rov.log(str(len(
-00006bb0: 7365 6c66 2e5f 696d 6167 6573 496e 496d  self._imagesInIm
-00006bc0: 6167 6573 4469 7229 2920 2b20 2220 696d  agesDir)) + " im
-00006bd0: 6167 6520 6669 6c65 7320 666f 756e 642e  age files found.
-00006be0: 2229 0a20 2020 2020 2020 2073 656c 662e  ").        self.
-00006bf0: 7072 6f76 2e6c 6f67 2822 2229 0a20 2020  prov.log("").   
-00006c00: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00006c10: 6f67 2822 466f 6c6c 6f77 696e 6720 696e  og("Following in
-00006c20: 666f 726d 6174 696f 6e20 7761 7320 7061  formation was pa
-00006c30: 7273 6564 2066 726f 6d20 6469 7265 6374  rsed from direct
-00006c40: 6f72 792c 2070 6c65 6173 6520 6368 6563  ory, please chec
-00006c50: 6b20 666f 7220 636f 7272 6563 746e 6573  k for correctnes
-00006c60: 733a 2229 0a20 2020 2020 2020 2073 656c  s:").        sel
-00006c70: 662e 7072 6f76 2e6c 6f67 2822 5072 6f6a  f.prov.log("Proj
-00006c80: 6563 743a 5c74 222b 7365 6c66 2e64 6972  ect:\t"+self.dir
-00006c90: 2e70 726f 6a65 6374 2829 290a 2020 2020  .project()).    
-00006ca0: 2020 2020 6966 2073 656c 662e 6469 722e      if self.dir.
-00006cb0: 7769 7468 5f67 6561 723a 0a20 2020 2020  with_gear:.     
-00006cc0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00006cd0: 2e6c 6f67 2822 4765 6172 3a5c 745c 7422  .log("Gear:\t\t"
-00006ce0: 2b73 656c 662e 6469 722e 6765 6172 2829  +self.dir.gear()
-00006cf0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-00006d00: 726f 762e 6c6f 6728 2245 7665 6e74 3a5c  rov.log("Event:\
-00006d10: 745c 7422 2b73 656c 662e 6469 722e 6576  t\t"+self.dir.ev
-00006d20: 656e 7428 2929 0a20 2020 2020 2020 2073  ent()).        s
-00006d30: 656c 662e 7072 6f76 2e6c 6f67 2822 5365  elf.prov.log("Se
-00006d40: 6e73 6f72 3a5c 745c 7422 2b73 656c 662e  nsor:\t\t"+self.
-00006d50: 6469 722e 7365 6e73 6f72 2829 290a 2020  dir.sensor()).  
-00006d60: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00006d70: 6c6f 6728 2222 290a 0a20 2020 2020 2020  log("")..       
-00006d80: 2023 2069 6e74 6572 6d65 6469 6174 6520   # intermediate 
-00006d90: 6669 6c65 730a 2020 2020 2020 2020 7365  files.        se
-00006da0: 6c66 2e5f 5f69 6e69 7449 6e74 6572 6d65  lf.__initInterme
-00006db0: 6469 6174 6546 696c 6573 2829 2020 2020  diateFiles()    
-00006dc0: 0a0a 2020 2020 2020 2020 2320 7472 7920  ..        # try 
-00006dd0: 6c6f 6164 2065 7869 7374 696e 6720 6946  load existing iF
-00006de0: 444f 2066 696c 650a 2020 2020 2020 2020  DO file.        
-00006df0: 6966 2873 656c 662e 7265 6164 6946 444f  if(self.readiFDO
-00006e00: 6669 6c65 2869 4644 4f66 696c 655f 2929  file(iFDOfile_))
-00006e10: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-00006e20: 6164 6564 6946 444f 203d 2054 7275 650a  adediFDO = True.
-00006e30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00006e40: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00006e50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00006e60: 6174 6820 3d20 7365 6c66 2e64 6972 2e74  ath = self.dir.t
-00006e70: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
-00006e80: 6f64 7563 7473 290a 2020 2020 2020 2020  oducts).        
-00006e90: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00006ea0: 5f20 696e 206f 732e 6c69 7374 6469 7228  _ in os.listdir(
-00006eb0: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
-00006ec0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00006ed0: 6c65 5f5b 2d31 303a 2d34 5d20 3d3d 2022  le_[-10:-4] == "
-00006ee0: 5f69 4644 4f2e 2220 616e 6420 7365 6c66  _iFDO." and self
-00006ef0: 2e72 6561 6469 4644 4f66 696c 6528 7061  .readiFDOfile(pa
-00006f00: 7468 2b66 696c 655f 293a 0a20 2020 2020  th+file_):.     
-00006f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f20: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
-00006f30: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00006f40: 2020 2020 2020 2020 2020 2020 2069 4644               iFD
-00006f50: 4f66 696c 655f 203d 2070 6174 682b 6669  Ofile_ = path+fi
-00006f60: 6c65 5f0a 2020 2020 2020 2020 2020 2020  le_.            
-00006f70: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00006f80: 6b0a 2020 2020 2020 2020 2020 2020 6578  k.            ex
-00006f90: 6365 7074 2046 696c 654e 6f74 466f 756e  cept FileNotFoun
-00006fa0: 6445 7272 6f72 3a0a 2020 2020 2020 2020  dError:.        
-00006fb0: 2020 2020 2020 2020 7061 7373 2020 2020          pass    
-00006fc0: 2020 2020 0a0a 2020 2020 2020 2020 7365      ..        se
-00006fd0: 6c66 2e74 7279 4175 746f 5365 7448 6561  lf.tryAutoSetHea
-00006fe0: 6465 7246 6965 6c64 7328 290a 2020 2020  derFields().    
-00006ff0: 2020 2020 7365 6c66 2e73 6574 4865 6164      self.setHead
-00007000: 6572 496d 6167 654c 6f63 616c 5061 7468  erImageLocalPath
-00007010: 4669 656c 6428 290a 2020 2020 2020 2020  Field().        
-00007020: 6966 206c 6f61 6465 6469 4644 4f3a 0a20  if loadediFDO:. 
-00007030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007040: 7365 7469 4644 4f46 696c 654e 616d 6528  setiFDOFileName(
-00007050: 6946 444f 6669 6c65 5f29 0a0a 0a20 2020  iFDOfile_)...   
-00007060: 2064 6566 2072 6561 6469 4644 4f66 696c   def readiFDOfil
-00007070: 6528 7365 6c66 2c66 696c 653a 7374 7229  e(self,file:str)
-00007080: 3a0a 2020 2020 2020 2020 2222 2220 7265  :.        """ re
-00007090: 6164 7320 6946 444f 2066 696c 6520 2222  ads iFDO file ""
-000070a0: 220a 2020 2020 2020 2020 7472 795f 7961  ".        try_ya
-000070b0: 6d6c 203d 2046 616c 7365 0a0a 2020 2020  ml = False..    
-000070c0: 2020 2020 2320 6966 2066 696c 6520 6973      # if file is
-000070d0: 2079 616d 6c20 6669 6c65 206c 6f61 6420   yaml file load 
-000070e0: 6974 2061 7320 7375 6368 0a20 2020 2020  it as such.     
-000070f0: 2020 2069 6620 6669 6c65 2e73 706c 6974     if file.split
-00007100: 2827 2e27 295b 2d31 5d20 3d3d 2027 7961  ('.')[-1] == 'ya
-00007110: 6d6c 273a 0a20 2020 2020 2020 2020 2020  ml':.           
-00007120: 2074 7279 5f79 616d 6c20 3d20 5472 7565   try_yaml = True
-00007130: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00007140: 655f 7961 6d6c 203d 2066 696c 650a 0a20  e_yaml = file.. 
-00007150: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00007160: 2e70 6174 682e 6973 6669 6c65 2866 696c  .path.isfile(fil
-00007170: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-00007180: 2320 6966 2066 696c 6520 646f 6573 206e  # if file does n
-00007190: 6f74 2065 7869 7374 2063 6865 636b 2069  ot exist check i
-000071a0: 6620 7961 6d6c 2076 6572 7369 6f6e 2065  f yaml version e
-000071b0: 7873 6973 7420 616e 6420 7472 7920 746f  xsist and try to
-000071c0: 206c 6f61 6420 7468 6174 206f 6e65 0a20   load that one. 
-000071d0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000071e0: 7961 6d6c 203d 2066 696c 652e 7265 706c  yaml = file.repl
-000071f0: 6163 6528 272e 6a73 6f6e 272c 272e 7961  ace('.json','.ya
-00007200: 6d6c 2729 0a20 2020 2020 2020 2020 2020  ml').           
-00007210: 2069 6620 6f73 2e70 6174 682e 6973 6669   if os.path.isfi
-00007220: 6c65 2866 696c 655f 7961 6d6c 293a 0a20  le(file_yaml):. 
-00007230: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00007240: 7279 5f79 616d 6c20 3d20 5472 7565 0a20  ry_yaml = True. 
-00007250: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00007260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007270: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-00007280: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
-00007290: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
-000072a0: 2822 4c6f 6164 696e 6720 6946 444f 2066  ("Loading iFDO f
-000072b0: 696c 6522 290a 2020 2020 2020 2020 7472  ile").        tr
-000072c0: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
-000072d0: 2074 7279 206c 6f61 6420 6a73 6f6e 2c20   try load json, 
-000072e0: 6f74 6865 7277 6973 6520 7472 7920 7961  otherwise try ya
-000072f0: 6d6c 0a20 2020 2020 2020 2020 2020 2069  ml.            i
-00007300: 6620 7472 795f 7961 6d6c 3a0a 2020 2020  f try_yaml:.    
-00007310: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
-00007320: 6f70 656e 2866 696c 655f 7961 6d6c 2c20  open(file_yaml, 
-00007330: 2772 2729 0a20 2020 2020 2020 2020 2020  'r').           
-00007340: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-00007350: 6d70 203d 2079 616d 6c2e 6c6f 6164 286f  mp = yaml.load(o
-00007360: 2c20 204c 6f61 6465 723d 7961 6d6c 2e43  ,  Loader=yaml.C
-00007370: 4c6f 6164 6572 290a 2020 2020 2020 2020  Loader).        
-00007380: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00007390: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-000073a0: 656e 2866 696c 652c 2027 7227 290a 2020  en(file, 'r').  
-000073b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000073c0: 6c66 2e69 6664 6f5f 746d 7020 3d20 6a73  lf.ifdo_tmp = js
-000073d0: 6f6e 2e6c 6f61 6428 6f29 0a0a 2020 2020  on.load(o)..    
-000073e0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-000073f0: 6f5f 7061 7273 6564 203d 2063 6f70 792e  o_parsed = copy.
-00007400: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
-00007410: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
-00007420: 2020 2020 6f2e 636c 6f73 6528 290a 2020      o.close().  
-00007430: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
-00007440: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00007450: 656c 662e 7072 6f76 2e61 6464 5072 6576  elf.prov.addPrev
-00007460: 696f 7573 5072 6f76 656e 616e 6365 2873  iousProvenance(s
-00007470: 656c 662e 7072 6f76 2e67 6574 4c61 7374  elf.prov.getLast
-00007480: 5072 6f76 656e 616e 6365 4669 6c65 2873  ProvenanceFile(s
-00007490: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
-000074a0: 6469 722e 6474 2e70 726f 746f 636f 6c29  dir.dt.protocol)
-000074b0: 2c73 656c 662e 7072 6f76 2e65 7865 6375  ,self.prov.execu
-000074c0: 7461 626c 6529 290a 2020 2020 2020 2020  table)).        
-000074d0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-000074e0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000074f0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00007500: 2873 7472 2865 2e61 7267 7329 290a 2020  (str(e.args)).  
-00007510: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00007520: 2046 616c 7365 0a20 2020 2020 2020 2073   False.        s
-00007530: 2e73 746f 7028 290a 0a20 2020 2020 2020  .stop()..       
-00007540: 2023 2074 7279 2074 6f20 7061 7273 6520   # try to parse 
-00007550: 652e 672e 2073 7472 696e 6773 2074 6861  e.g. strings tha
-00007560: 7420 7265 7072 6573 656e 7420 6469 6374  t represent dict
-00007570: 730a 2020 2020 2020 2020 6d69 7174 632e  s.        miqtc.
-00007580: 7265 6375 7273 6976 6545 7661 6c28 7365  recursiveEval(se
-00007590: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
-000075a0: 2020 2020 2020 6966 2073 656c 662e 696d        if self.im
-000075b0: 6167 6553 6574 4865 6164 6572 4b65 7920  ageSetHeaderKey 
-000075c0: 6e6f 7420 696e 2073 656c 662e 6966 646f  not in self.ifdo
-000075d0: 5f74 6d70 3a0a 2020 2020 2020 2020 2020  _tmp:.          
-000075e0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-000075f0: 6e28 2245 7272 6f72 206c 6f61 6469 6e67  n("Error loading
-00007600: 2069 4644 4f20 6669 6c65 222c 6669 6c65   iFDO file",file
-00007610: 2c22 646f 6573 206e 6f74 2063 6f6e 7461  ,"does not conta
-00007620: 696e 222c 7365 6c66 2e69 6d61 6765 5365  in",self.imageSe
-00007630: 7448 6561 6465 724b 6579 290a 2020 2020  tHeaderKey).    
-00007640: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-00007650: 6553 6574 4974 656d 734b 6579 206e 6f74  eSetItemsKey not
-00007660: 2069 6e20 7365 6c66 2e69 6664 6f5f 746d   in self.ifdo_tm
-00007670: 703a 0a20 2020 2020 2020 2020 2020 2072  p:.            r
-00007680: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
-00007690: 4572 726f 7220 6c6f 6164 696e 6720 6946  Error loading iF
-000076a0: 444f 2066 696c 6522 2c66 696c 652c 2264  DO file",file,"d
-000076b0: 6f65 7320 6e6f 7420 636f 6e74 6169 6e22  oes not contain"
-000076c0: 2c73 656c 662e 696d 6167 6553 6574 4974  ,self.imageSetIt
-000076d0: 656d 734b 6579 290a 0a20 2020 2020 2020  emsKey)..       
-000076e0: 2069 6620 2073 656c 662e 6966 646f 5f74   if  self.ifdo_t
-000076f0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00007700: 4865 6164 6572 4b65 795d 203d 3d20 4e6f  HeaderKey] == No
-00007710: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007720: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00007730: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-00007740: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
-00007750: 2020 2069 6620 7365 6c66 2e69 6664 6f5f     if self.ifdo_
-00007760: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-00007770: 7449 7465 6d73 4b65 795d 203d 3d20 4e6f  tItemsKey] == No
-00007780: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00007790: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-000077a0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-000077b0: 4b65 795d 203d 207b 7d0a 0a20 2020 2020  Key] = {}..     
-000077c0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-000077d0: 2822 6946 444f 2066 696c 6520 6c6f 6164  ("iFDO file load
-000077e0: 6564 3a5c 7422 2b6f 732e 7061 7468 2e62  ed:\t"+os.path.b
-000077f0: 6173 656e 616d 6528 6669 6c65 2929 0a0a  asename(file))..
-00007800: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-00007810: 6946 444f 2076 6572 7369 6f6e 0a20 2020  iFDO version.   
-00007820: 2020 2020 2072 6561 6456 6572 7369 6f6e       readVersion
-00007830: 203d 2022 762e 312e 302e 3022 2023 2064   = "v.1.0.0" # d
-00007840: 6964 206e 6f74 2068 6176 6520 7468 6520  id not have the 
-00007850: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
-00007860: 7665 7273 696f 6e27 2066 6965 6c64 2079  version' field y
-00007870: 6574 0a20 2020 2020 2020 2074 7279 3a20  et.        try: 
-00007880: 0a20 2020 2020 2020 2020 2020 2072 6561  .            rea
-00007890: 6456 6572 7369 6f6e 203d 2073 656c 662e  dVersion = self.
-000078a0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-000078b0: 6167 652d 7365 742d 6966 646f 2d76 6572  age-set-ifdo-ver
-000078c0: 7369 6f6e 2729 0a20 2020 2020 2020 2065  sion').        e
-000078d0: 7863 6570 7420 4b65 7945 7272 6f72 3a0a  xcept KeyError:.
-000078e0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000078f0: 0a20 2020 2020 2020 2069 6e74 5265 6164  .        intRead
-00007900: 5665 7273 696f 6e20 3d20 5665 7273 696f  Version = Versio
-00007910: 6e28 7265 6164 5665 7273 696f 6e29 0a20  n(readVersion). 
-00007920: 2020 2020 2020 2069 6e74 5468 6973 5665         intThisVe
-00007930: 7273 696f 6e20 3d20 5665 7273 696f 6e28  rsion = Version(
-00007940: 6d69 7174 762e 6946 444f 5f76 6572 7369  miqtv.iFDO_versi
-00007950: 6f6e 290a 2020 2020 2020 2020 6966 2069  on).        if i
-00007960: 6e74 5265 6164 5665 7273 696f 6e20 3c20  ntReadVersion < 
-00007970: 696e 7454 6869 7356 6572 7369 6f6e 3a0a  intThisVersion:.
-00007980: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007990: 2e70 726f 762e 6c6f 6728 224c 6f61 6465  .prov.log("Loade
-000079a0: 6420 6946 444f 2068 6173 2076 6572 7369  d iFDO has versi
-000079b0: 6f6e 2022 202b 2072 6561 6456 6572 7369  on " + readVersi
-000079c0: 6f6e 202b 2022 2061 6e64 2077 696c 6c20  on + " and will 
-000079d0: 6265 2075 7064 6174 6564 2074 6f20 7665  be updated to ve
-000079e0: 7273 696f 6e20 2220 2b20 6d69 7174 762e  rsion " + miqtv.
-000079f0: 6946 444f 5f76 6572 7369 6f6e 290a 2020  iFDO_version).  
-00007a00: 2020 2020 2020 6966 2069 6e74 5265 6164        if intRead
-00007a10: 5665 7273 696f 6e20 3e20 696e 7454 6869  Version > intThi
-00007a20: 7356 6572 7369 6f6e 3a0a 2020 2020 2020  sVersion:.      
-00007a30: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00007a40: 6c6f 6728 2243 6175 7469 6f6e 2120 4c6f  log("Caution! Lo
-00007a50: 6164 6564 2069 4644 4f20 6861 7320 7665  aded iFDO has ve
-00007a60: 7273 696f 6e20 2220 2b20 7265 6164 5665  rsion " + readVe
-00007a70: 7273 696f 6e20 2b20 2220 6973 2061 6865  rsion + " is ahe
-00007a80: 6164 206f 6620 7665 7273 696f 6e20 7573  ad of version us
-00007a90: 6564 2068 6572 653a 2022 202b 206d 6971  ed here: " + miq
-00007aa0: 7476 2e69 4644 4f5f 7665 7273 696f 6e29  tv.iFDO_version)
-00007ab0: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
-00007ac0: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
-00007ad0: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
-00007ae0: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
-00007af0: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
-00007b00: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00007b10: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00007b20: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
-00007b30: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
-00007b40: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-00007b50: 2829 0a20 2020 2020 2020 2074 7279 3a0a  ().        try:.
-00007b60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007b70: 2e63 6f6e 7665 7274 546f 4465 6661 756c  .convertToDefaul
-00007b80: 7444 6174 6554 696d 6546 6f72 6d61 7428  tDateTimeFormat(
-00007b90: 7365 6c66 2e69 6664 6f5f 746d 7029 0a20  self.ifdo_tmp). 
-00007ba0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00007bb0: 6365 7074 696f 6e20 6173 2065 783a 0a20  ception as ex:. 
-00007bc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00007bd0: 7072 6f76 2e6c 6f67 2822 4368 6563 6b69  prov.log("Checki
-00007be0: 6e67 2064 6174 6574 696d 6520 666f 726d  ng datetime form
-00007bf0: 6174 3a20 2220 2b20 7374 7228 6578 2929  at: " + str(ex))
-00007c00: 0a0a 2020 2020 2020 2020 2320 666f 7220  ..        # for 
-00007c10: 736f 6f6f 6f6f 6d65 2072 6561 736f 6e20  sooooome reason 
-00007c20: 7468 6973 2066 6978 6573 2061 2068 6963  this fixes a hic
-00007c30: 6b75 7020 6f66 2074 6865 2070 726f 6720  kup of the prog 
-00007c40: 696e 2063 7265 6174 6569 4644 4f28 290a  in createiFDO().
-00007c50: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00007c60: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00007c70: 726f 6772 6573 734d 7367 2822 666f 6f22  rogressMsg("foo"
-00007c80: 2c20 312c 6d6f 6475 6c6f 3d31 290a 2020  , 1,modulo=1).  
-00007c90: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-00007ca0: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00007cb0: 2e5f 7472 795f 7570 6772 6164 655f 746f  ._try_upgrade_to
-00007cc0: 5f69 6664 6f5f 7665 7273 696f 6e5f 3278  _ifdo_version_2x
-00007cd0: 2829 0a0a 2020 2020 2020 2020 2320 6368  ()..        # ch
-00007ce0: 6563 6b20 7265 6164 2069 4644 4f20 6669  eck read iFDO fi
-00007cf0: 6c65 0a20 2020 2020 2020 2074 7279 3a0a  le.        try:.
-00007d00: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00007d10: 6f74 2073 656c 662e 6967 6e6f 7265 5f69  ot self.ignore_i
-00007d20: 6d61 6765 5f66 696c 6573 3a0a 2020 2020  mage_files:.    
-00007d30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00007d40: 2e63 7265 6174 6569 4644 4f28 7365 6c66  .createiFDO(self
-00007d50: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00007d60: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-00007d70: 5d2c 206d 6971 7469 2e63 7265 6174 6549  ], miqti.createI
-00007d80: 6d61 6765 4974 656d 734c 6973 7446 726f  mageItemsListFro
-00007d90: 6d49 6d61 6765 4974 656d 7344 6963 7428  mImageItemsDict(
-00007da0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00007db0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00007dc0: 4b65 795d 2929 0a20 2020 2020 2020 2020  Key])).         
-00007dd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007de0: 2020 2020 2020 2020 2073 656c 662e 7570           self.up
-00007df0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
-00007e00: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00007e10: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
-00007e20: 6d69 7174 692e 6372 6561 7465 496d 6167  miqti.createImag
-00007e30: 6549 7465 6d73 4c69 7374 4672 6f6d 496d  eItemsListFromIm
-00007e40: 6167 6549 7465 6d73 4469 6374 2873 656c  ageItemsDict(sel
-00007e50: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-00007e60: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-00007e70: 5d29 2c68 6561 6465 725f 6f6e 6c79 3d73  ]),header_only=s
-00007e80: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
-00007e90: 5f66 696c 6573 290a 2020 2020 2020 2020  _files).        
-00007ea0: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
-00007eb0: 6f45 7863 6570 7469 6f6e 2061 7320 6578  oException as ex
-00007ec0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00007ed0: 6c66 2e70 726f 762e 6c6f 6728 224c 6f61  lf.prov.log("Loa
-00007ee0: 6465 6420 6946 444f 2066 696c 6520 6e6f  ded iFDO file no
-00007ef0: 7420 7661 6c69 6420 7965 743a 2022 202b  t valid yet: " +
-00007f00: 2073 7472 2865 7829 290a 0a20 2020 2020   str(ex))..     
-00007f10: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
-00007f20: 0a20 2020 2064 6566 2077 7269 7465 5f69  .    def write_i
-00007f30: 6664 6f5f 6669 6c65 2873 656c 662c 616c  fdo_file(self,al
-00007f40: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
-00007f50: 6972 6564 3d46 616c 7365 293a 0a20 2020  ired=False):.   
-00007f60: 2020 2020 2022 2222 2057 7269 7465 7320       """ Writes 
-00007f70: 616e 2069 4644 4f20 6669 6c65 2074 6f20  an iFDO file to 
-00007f80: 6469 736b 2e20 4f76 6572 7772 6974 6573  disk. Overwrites
-00007f90: 2070 6f74 656e 7469 616c 6c79 2065 7869   potentially exi
-00007fa0: 7374 696e 6720 6669 6c65 2e22 2222 0a0a  sting file."""..
-00007fb0: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
-00007fc0: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
-00007fd0: 6728 2257 7269 7469 6e67 2069 4644 4f20  g("Writing iFDO 
-00007fe0: 6669 6c65 2229 0a0a 2020 2020 2020 2020  file")..        
-00007ff0: 2320 6368 6563 6b20 6669 656c 6473 2061  # check fields a
-00008000: 6761 696e 2069 6620 6368 616e 6765 6420  gain if changed 
-00008010: 7369 6e63 6520 6c61 7374 2063 6865 636b  since last check
-00008020: 2028 6372 6561 7465 6946 444f 290a 2020   (createiFDO).  
-00008030: 2020 2020 2020 6966 2073 656c 662e 6966        if self.if
-00008040: 646f 5f74 6d70 2021 3d20 7365 6c66 2e69  do_tmp != self.i
-00008050: 6664 6f5f 6368 6563 6b65 643a 0a20 2020  fdo_checked:.   
-00008060: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
-00008070: 6561 7465 6946 444f 2873 656c 662e 6966  eateiFDO(self.if
-00008080: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-00008090: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
-000080a0: 6d69 7174 692e 6372 6561 7465 496d 6167  miqti.createImag
-000080b0: 6549 7465 6d73 4c69 7374 4672 6f6d 496d  eItemsListFromIm
-000080c0: 6167 6549 7465 6d73 4469 6374 2873 656c  ageItemsDict(sel
-000080d0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-000080e0: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-000080f0: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
-00008100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008110: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
-00008120: 7175 6972 6564 3d61 6c6c 6f77 5f6d 6973  quired=allow_mis
-00008130: 7369 6e67 5f72 6571 7569 7265 6429 0a20  sing_required). 
-00008140: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00008150: 2320 6164 6420 2224 7363 6865 6d61 220a  # add "$schema".
-00008160: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-00008170: 6f5f 6368 6563 6b65 645b 2224 7363 6865  o_checked["$sche
-00008180: 6d61 225d 203d 206d 6971 7476 2e69 6664  ma"] = miqtv.ifd
-00008190: 6f5f 7363 6865 6d61 5b27 2469 6427 5d0a  o_schema['$id'].
-000081a0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
-000081b0: 2069 4644 4f5f 7061 7468 203d 2073 656c   iFDO_path = sel
-000081c0: 662e 6765 7469 4644 4f46 696c 654e 616d  f.getiFDOFileNam
-000081d0: 6528 6f76 6572 7772 6974 653d 5472 7565  e(overwrite=True
-000081e0: 290a 0a20 2020 2020 2020 2023 2070 7574  )..        # put
-000081f0: 7320 6576 6572 7974 6869 6e67 2069 6e20  s everything in 
-00008200: 6f6e 6520 6c69 6e65 0a20 2020 2020 2020  one line.       
-00008210: 2023 7769 7468 206f 7065 6e28 6946 444f   #with open(iFDO
-00008220: 5f70 6174 682e 7265 706c 6163 6528 2279  _path.replace("y
-00008230: 616d 6c22 2c22 6a73 6f6e 2229 2c20 2777  aml","json"), 'w
-00008240: 2729 2061 7320 6670 3a0a 2020 2020 2020  ') as fp:.      
-00008250: 2020 2320 2020 206a 736f 6e2e 6475 6d70    #    json.dump
-00008260: 2873 656c 662e 6966 646f 5f63 6865 636b  (self.ifdo_check
-00008270: 6564 2c20 6670 290a 0a20 2020 2020 2020  ed, fp)..       
-00008280: 2023 2063 6f6e 7665 7274 2064 6963 7469   # convert dicti
-00008290: 6f6e 6172 7920 746f 204a 534f 4e20 7374  onary to JSON st
-000082a0: 7269 6e67 0a20 2020 2020 2020 206a 736f  ring.        jso
-000082b0: 6e5f 6461 7461 203d 206a 736f 6e2e 6475  n_data = json.du
-000082c0: 6d70 7328 7365 6c66 2e69 6664 6f5f 6368  mps(self.ifdo_ch
-000082d0: 6563 6b65 642c 2069 6e64 656e 7420 3d20  ecked, indent = 
-000082e0: 342c 2073 6f72 745f 6b65 7973 3d54 7275  4, sort_keys=Tru
-000082f0: 6529 0a0a 2020 2020 2020 2020 2320 7772  e)..        # wr
-00008300: 6974 6520 7468 6520 4a53 4f4e 2073 7472  ite the JSON str
-00008310: 696e 6720 746f 2061 2066 696c 650a 2020  ing to a file.  
-00008320: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
-00008330: 6946 444f 5f70 6174 682c 2027 7727 2920  iFDO_path, 'w') 
-00008340: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
-00008350: 2020 662e 7772 6974 6528 6a73 6f6e 5f64    f.write(json_d
-00008360: 6174 6129 0a20 2020 2020 2020 200a 2020  ata).        .  
-00008370: 2020 2020 2020 2320 6c6f 6720 6368 616e        # log chan
-00008380: 6765 730a 2020 2020 2020 2020 6966 206e  ges.        if n
-00008390: 6f74 2073 656c 662e 6966 646f 5f70 6172  ot self.ifdo_par
-000083a0: 7365 6420 6973 204e 6f6e 653a 0a20 2020  sed is None:.   
-000083b0: 2020 2020 2020 2020 2069 6664 6f5f 7570           ifdo_up
-000083c0: 6461 7465 203d 2044 6565 7044 6966 6628  date = DeepDiff(
-000083d0: 7365 6c66 2e69 6664 6f5f 7061 7273 6564  self.ifdo_parsed
-000083e0: 2c73 656c 662e 6966 646f 5f63 6865 636b  ,self.ifdo_check
-000083f0: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
-00008400: 2370 7072 696e 7428 6966 646f 5f75 7064  #pprint(ifdo_upd
-00008410: 6174 6529 0a20 2020 2020 2020 2020 2020  ate).           
-00008420: 2069 6620 6966 646f 5f75 7064 6174 6520   if ifdo_update 
-00008430: 213d 207b 7d3a 0a20 2020 2020 2020 2020  != {}:.         
-00008440: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00008450: 2e6c 6f67 2822 6946 444f 2075 7064 6174  .log("iFDO updat
-00008460: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
-00008470: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00008480: 6f67 2873 7472 2869 6664 6f5f 7570 6461  og(str(ifdo_upda
-00008490: 7465 292c 646f 6e74 5368 6f77 3d54 7275  te),dontShow=Tru
-000084a0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
-000084b0: 7072 6f76 2e6c 6f67 2822 5772 6f74 6520  prov.log("Wrote 
-000084c0: 6946 444f 2074 6f20 6669 6c65 2022 202b  iFDO to file " +
-000084d0: 2069 4644 4f5f 7061 7468 290a 2020 2020   iFDO_path).    
-000084e0: 2020 2020 7365 6c66 2e70 726f 762e 7772      self.prov.wr
-000084f0: 6974 6528 7365 6c66 2e64 6972 2e74 6f28  ite(self.dir.to(
-00008500: 7365 6c66 2e64 6972 2e64 742e 7072 6f74  self.dir.dt.prot
-00008510: 6f63 6f6c 2929 0a20 2020 2020 2020 2073  ocol)).        s
-00008520: 2e73 746f 7028 290a 0a20 2020 2064 6566  .stop()..    def
-00008530: 2077 7269 7465 6946 444f 6669 6c65 2873   writeiFDOfile(s
-00008540: 656c 662c 616c 6c6f 775f 6d69 7373 696e  elf,allow_missin
-00008550: 675f 7265 7175 6972 6564 3d46 616c 7365  g_required=False
-00008560: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-00008570: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
-00008580: 7772 6974 655f 6966 646f 5f66 696c 6520  write_ifdo_file 
-00008590: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
-000085a0: 2e77 7269 7465 5f69 6664 6f5f 6669 6c65  .write_ifdo_file
-000085b0: 2861 6c6c 6f77 5f6d 6973 7369 6e67 5f72  (allow_missing_r
-000085c0: 6571 7569 7265 6429 0a0a 0a20 2020 2064  equired)...    d
-000085d0: 6566 2073 6574 6946 444f 4669 6c65 4e61  ef setiFDOFileNa
-000085e0: 6d65 2873 656c 662c 6946 444f 6669 6c65  me(self,iFDOfile
-000085f0: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
-00008600: 2222 2053 6574 2074 6865 2063 7572 7265  "" Set the curre
-00008610: 6e74 2069 4644 4f20 6669 6c65 206e 616d  nt iFDO file nam
-00008620: 6520 7769 7468 2070 6174 682e 2053 6574  e with path. Set
-00008630: 2074 6f20 2222 2069 6e20 6f72 6465 7220   to "" in order 
-00008640: 746f 2067 6574 2064 6566 6175 6c74 206e  to get default n
-00008650: 616d 6520 616e 6420 6c6f 6361 7469 6f6e  ame and location
-00008660: 2e20 2222 220a 2020 2020 2020 2020 7365  . """.        se
-00008670: 6c66 2e69 4644 4f66 696c 655f 203d 2069  lf.iFDOfile_ = i
-00008680: 4644 4f66 696c 650a 2020 2020 2020 2020  FDOfile.        
-00008690: 7365 6c66 2e69 4644 4f66 696c 655f 203d  self.iFDOfile_ =
-000086a0: 2073 656c 662e 6765 7469 4644 4f46 696c   self.getiFDOFil
-000086b0: 654e 616d 6528 2920 2320 636f 6e73 7472  eName() # constr
-000086c0: 7563 7420 6465 6661 756c 7420 6e61 6d65  uct default name
-000086d0: 2069 6620 656d 7074 790a 2020 2020 2020   if empty.      
-000086e0: 2020 6966 206d 6971 7463 2e61 7373 6572    if miqtc.asser
-000086f0: 7453 6c61 7368 286f 732e 7061 7468 2e64  tSlash(os.path.d
-00008700: 6972 6e61 6d65 2873 656c 662e 6946 444f  irname(self.iFDO
-00008710: 6669 6c65 5f29 2920 213d 206d 6971 7463  file_)) != miqtc
-00008720: 2e61 7373 6572 7453 6c61 7368 2873 656c  .assertSlash(sel
-00008730: 662e 6469 722e 746f 2873 656c 662e 6469  f.dir.to(self.di
-00008740: 722e 6474 2e70 726f 6475 6374 7329 293a  r.dt.products)):
-00008750: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00008760: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
-00008770: 696f 6e21 2069 4644 4f20 6669 6c65 2070  ion! iFDO file p
-00008780: 6174 6820 6973 206e 6f74 2069 6e20 2770  ath is not in 'p
-00008790: 726f 6475 6374 7327 2073 7562 2066 6f6c  roducts' sub fol
-000087a0: 6465 7220 6173 2072 6563 6f6d 6d65 6e64  der as recommend
-000087b0: 6564 2e20 436f 6e73 6964 6572 2072 6573  ed. Consider res
-000087c0: 6574 7469 6e67 2077 6974 6820 7365 7469  etting with seti
-000087d0: 4644 4f46 696c 654e 616d 6528 292e 2022  FDOFileName(). "
-000087e0: 202b 2069 4644 4f66 696c 6529 0a20 2020   + iFDOfile).   
-000087f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00008800: 2020 2020 2020 6576 656e 7420 3d20 7365        event = se
-00008810: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-00008820: 2769 6d61 6765 2d65 7665 6e74 2729 5b27  'image-event')['
-00008830: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
-00008840: 2020 2073 656e 736f 7220 3d20 7365 6c66     sensor = self
-00008850: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
-00008860: 6d61 6765 2d73 656e 736f 7227 295b 276e  mage-sensor')['n
-00008870: 616d 6527 5d0a 2020 2020 2020 2020 6578  ame'].        ex
-00008880: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
-00008890: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-000088a0: 2020 2020 2020 6576 656e 7420 3d20 7365        event = se
-000088b0: 6c66 2e64 6972 2e65 7665 6e74 2829 0a20  lf.dir.event(). 
-000088c0: 2020 2020 2020 2020 2020 2073 656e 736f             senso
-000088d0: 7220 3d20 7365 6c66 2e64 6972 2e73 656e  r = self.dir.sen
-000088e0: 736f 7228 290a 0a20 2020 2020 2020 2069  sor()..        i
-000088f0: 4644 4f66 696c 654e 616d 6520 3d20 6f73  FDOfileName = os
-00008900: 2e70 6174 682e 6261 7365 6e61 6d65 2873  .path.basename(s
-00008910: 656c 662e 6946 444f 6669 6c65 5f29 0a20  elf.iFDOfile_). 
-00008920: 2020 2020 2020 2069 6620 6e6f 7420 6576         if not ev
-00008930: 656e 7420 696e 2069 4644 4f66 696c 654e  ent in iFDOfileN
-00008940: 616d 6520 6f72 206e 6f74 2069 4644 4f2e  ame or not iFDO.
-00008950: 6765 7453 686f 7274 4571 7569 706d 656e  getShortEquipmen
-00008960: 7449 4428 7365 6e73 6f72 2920 696e 2069  tID(sensor) in i
-00008970: 4644 4f66 696c 654e 616d 653a 0a20 2020  FDOfileName:.   
-00008980: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00008990: 6f76 2e6c 6f67 2822 4361 7574 696f 6e21  ov.log("Caution!
-000089a0: 2069 4644 4f20 6669 6c65 206e 616d 6520   iFDO file name 
-000089b0: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
-000089c0: 2070 726f 6a65 6374 2c20 6576 656e 7420   project, event 
-000089d0: 616e 6420 7365 6e73 6f72 206e 616d 6520  and sensor name 
-000089e0: 6173 2072 6563 6f6d 6d65 6e64 6564 2e20  as recommended. 
-000089f0: 436f 6e73 6964 6572 2072 6573 6574 7469  Consider resetti
-00008a00: 6e67 2077 6974 6820 7365 7469 4644 4f46  ng with setiFDOF
-00008a10: 696c 654e 616d 6528 292e 2022 202b 2069  ileName(). " + i
-00008a20: 4644 4f66 696c 6529 0a0a 0a20 2020 2064  FDOfile)...    d
-00008a30: 6566 2067 6574 6946 444f 4669 6c65 4e61  ef getiFDOFileNa
-00008a40: 6d65 2873 656c 662c 6f76 6572 7772 6974  me(self,overwrit
-00008a50: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
-00008a60: 2020 2222 2220 5265 7475 726e 7320 7468    """ Returns th
-00008a70: 6520 6375 7272 656e 7420 6946 444f 2066  e current iFDO f
-00008a80: 696c 6527 7320 6e61 6d65 2077 6974 6820  ile's name with 
-00008a90: 7061 7468 2e20 4966 206e 6f74 2073 6574  path. If not set
-00008aa0: 2079 6574 206f 7220 6f76 6572 7772 6974   yet or overwrit
-00008ab0: 653d 3d54 7275 6520 6974 2072 6574 7572  e==True it retur
-00008ac0: 6e73 2074 6865 206f 6e65 206d 6174 6368  ns the one match
-00008ad0: 696e 6720 696d 6167 652d 7365 742d 6e61  ing image-set-na
-00008ae0: 6d65 2e20 2222 220a 2020 2020 2020 2020  me. """.        
-00008af0: 6966 2073 656c 662e 6946 444f 6669 6c65  if self.iFDOfile
-00008b00: 5f20 3d3d 2022 2220 6f72 206f 7665 7277  _ == "" or overw
-00008b10: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
-00008b20: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
-00008b30: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-00008b40: 2769 6d61 6765 2d73 6574 2d6e 616d 6527  'image-set-name'
-00008b50: 2920 2b20 275f 6946 444f 2e6a 736f 6e27  ) + '_iFDO.json'
-00008b60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008b70: 7365 6c66 2e69 4644 4f66 696c 655f 2021  self.iFDOfile_ !
-00008b80: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-00008b90: 2020 2020 2020 2320 7265 6e61 6d65 2066        # rename f
-00008ba0: 696c 6520 6275 7420 6b65 6570 206c 6f63  ile but keep loc
-00008bb0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00008bc0: 2020 2020 2020 6966 2066 696c 655f 6e61        if file_na
-00008bd0: 6d65 2021 3d20 6f73 2e70 6174 682e 6261  me != os.path.ba
-00008be0: 7365 6e61 6d65 2873 656c 662e 6946 444f  sename(self.iFDO
-00008bf0: 6669 6c65 5f29 2061 6e64 206f 732e 7061  file_) and os.pa
-00008c00: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
-00008c10: 4644 4f66 696c 655f 293a 0a20 2020 2020  FDOfile_):.     
-00008c20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008c30: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-00008c40: 7574 696f 6e21 2069 6664 6f20 6669 6c65  ution! ifdo file
-00008c50: 2072 656e 616d 6564 2074 6f20 2220 2b20   renamed to " + 
-00008c60: 6669 6c65 5f6e 616d 6529 0a20 2020 2020  file_name).     
-00008c70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008c80: 6946 444f 6669 6c65 5f20 3d20 6f73 2e70  iFDOfile_ = os.p
-00008c90: 6174 682e 6a6f 696e 286f 732e 7061 7468  ath.join(os.path
-00008ca0: 2e64 6972 6e61 6d65 2873 656c 662e 6946  .dirname(self.iF
-00008cb0: 444f 6669 6c65 5f29 2c66 696c 655f 6e61  DOfile_),file_na
-00008cc0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
-00008cd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00008ce0: 2020 2020 2020 7365 6c66 2e69 4644 4f66        self.iFDOf
-00008cf0: 696c 655f 203d 206f 732e 7061 7468 2e6a  ile_ = os.path.j
-00008d00: 6f69 6e28 7365 6c66 2e64 6972 2e74 6f28  oin(self.dir.to(
-00008d10: 7365 6c66 2e64 6972 2e64 742e 7072 6f64  self.dir.dt.prod
-00008d20: 7563 7473 292c 2066 696c 655f 6e61 6d65  ucts), file_name
-00008d30: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00008d40: 2073 656c 662e 6946 444f 6669 6c65 5f0a   self.iFDOfile_.
-00008d50: 0a0a 2020 2020 6465 6620 7365 745f 696d  ..    def set_im
-00008d60: 6167 655f 7365 745f 6e61 6d65 5f66 6965  age_set_name_fie
-00008d70: 6c64 5f66 726f 6d5f 7072 6f6a 6563 745f  ld_from_project_
-00008d80: 6576 656e 745f 7365 6e73 6f72 2873 656c  event_sensor(sel
-00008d90: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-00008da0: 5365 7473 2066 6965 6c64 2069 6d61 6765  Sets field image
-00008db0: 2d73 6574 2d6e 616d 6520 6672 6f6d 2063  -set-name from c
-00008dc0: 7572 7265 6e74 2074 6d70 2066 6965 6c64  urrent tmp field
-00008dd0: 7320 666f 7220 7072 6f6a 6563 742c 2065  s for project, e
-00008de0: 7665 6e74 2061 6e64 2073 656e 736f 722e  vent and sensor.
-00008df0: 200a 2020 2020 2020 2020 5265 7475 726e   .        Return
-00008e00: 7320 696d 6167 652d 7365 742d 6e61 6d65  s image-set-name
-00008e10: 2076 616c 7565 2e20 2222 220a 2020 2020   value. """.    
-00008e20: 2020 2020 6e65 775f 696d 6167 655f 7365      new_image_se
-00008e30: 745f 6e61 6d65 203d 2073 656c 662e 636f  t_name = self.co
-00008e40: 6e73 7472 7563 7449 6d61 6765 5365 744e  nstructImageSetN
-00008e50: 616d 6528 7365 6c66 2e69 6664 6f5f 746d  ame(self.ifdo_tm
-00008e60: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-00008e70: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
-00008e80: 2d70 726f 6a65 6374 275d 5b27 6e61 6d65  -project']['name
-00008e90: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ec0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-00008ed0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00008ee0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-00008ef0: 6d61 6765 2d65 7665 6e74 275d 5b27 6e61  mage-event']['na
-00008f00: 6d65 275d 2c0a 2020 2020 2020 2020 2020  me'],.          
-00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
-00008f40: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00008f50: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-00008f60: 2769 6d61 6765 2d73 656e 736f 7227 5d5b  'image-sensor'][
-00008f70: 276e 616d 6527 5d29 0a20 2020 2020 2020  'name']).       
-00008f80: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-00008f90: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-00008fa0: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
-00008fb0: 742d 6e61 6d65 275d 203d 206e 6577 5f69  t-name'] = new_i
-00008fc0: 6d61 6765 5f73 6574 5f6e 616d 650a 2020  mage_set_name.  
-00008fd0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
-00008fe0: 5f69 6d61 6765 5f73 6574 5f6e 616d 650a  _image_set_name.
-00008ff0: 2020 2020 2020 2020 0a0a 2020 2020 4073          ..    @s
-00009000: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00009010: 6465 6620 636f 6e73 7472 7563 7449 6d61  def constructIma
-00009020: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
-00009030: 743a 7374 722c 6576 656e 743a 7374 722c  t:str,event:str,
-00009040: 7365 6e73 6f72 3a73 7472 293a 0a20 2020  sensor:str):.   
-00009050: 2020 2020 2022 2222 2072 6574 7572 6e73       """ returns
-00009060: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
-00009070: 743e 5f3c 7365 6e73 6f72 3e2c 2077 6974  t>_<sensor>, wit
-00009080: 6820 7368 6f72 7420 7665 7273 696f 6e20  h short version 
-00009090: 6f66 203c 7365 6e73 6f72 3e20 286f 6e6c  of <sensor> (onl
-000090a0: 7920 6964 292c 2070 7265 7665 6e74 696e  y id), preventin
-000090b0: 6720 706f 7465 6e74 6961 6c20 646f 7562  g potential doub
-000090c0: 6c69 6e67 206f 6620 3c70 726f 6a65 6374  ling of <project
-000090d0: 3e20 2022 2222 0a20 2020 2020 2020 2073  >  """.        s
-000090e0: 656e 736f 725f 7368 6f72 7420 3d20 6946  ensor_short = iF
-000090f0: 444f 2e67 6574 5368 6f72 7445 7175 6970  DO.getShortEquip
-00009100: 6d65 6e74 4944 2873 656e 736f 7229 0a20  mentID(sensor). 
-00009110: 2020 2020 2020 2069 6620 6c65 6e28 6576         if len(ev
-00009120: 656e 7429 203e 206c 656e 2870 726f 6a65  ent) > len(proje
-00009130: 6374 2920 616e 6420 6576 656e 745b 303a  ct) and event[0:
-00009140: 6c65 6e28 7072 6f6a 6563 7429 5d20 3d3d  len(project)] ==
-00009150: 2070 726f 6a65 6374 3a0a 2020 2020 2020   project:.      
-00009160: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
-00009170: 6e61 6d65 5f20 3d20 6576 656e 7420 2b20  name_ = event + 
-00009180: 225f 2220 2b20 7365 6e73 6f72 5f73 686f  "_" + sensor_sho
-00009190: 7274 0a20 2020 2020 2020 2065 6c73 653a  rt.        else:
-000091a0: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-000091b0: 6765 5f73 6574 5f6e 616d 655f 203d 2070  ge_set_name_ = p
-000091c0: 726f 6a65 6374 202b 2022 5f22 202b 2065  roject + "_" + e
-000091d0: 7665 6e74 202b 2022 5f22 202b 2073 656e  vent + "_" + sen
-000091e0: 736f 725f 7368 6f72 740a 2020 2020 2020  sor_short.      
-000091f0: 2020 7265 7475 726e 2069 6d61 6765 5f73    return image_s
-00009200: 6574 5f6e 616d 655f 2023 2054 4f44 4f20  et_name_ # TODO 
-00009210: 696e 636c 7564 6520 6461 7461 5479 7065  include dataType
-00009220: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
-00009230: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
-00009240: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
-00009250: 4428 6571 7569 706d 656e 7449 443a 7374  D(equipmentID:st
-00009260: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00009270: 7265 7475 726e 7320 6571 7569 706d 656e  returns equipmen
-00009280: 7420 6964 2077 6974 686f 7574 2070 6f74  t id without pot
-00009290: 656e 7469 616c 6c20 6c6f 6e67 203c 6e61  entiall long <na
-000092a0: 6d65 3e20 7061 7274 2c20 692e 652e 3a20  me> part, i.e.: 
-000092b0: 3c6f 776e 6572 3e5f 3c74 7970 653e 2d3c  <owner>_<type>-<
-000092c0: 7479 7065 2069 6e64 6578 5b5f 3c73 7562  type index[_<sub
-000092d0: 7479 7065 3e5d 2022 2222 0a20 2020 2020  type>] """.     
-000092e0: 2020 2072 6574 7572 6e20 275f 272e 6a6f     return '_'.jo
-000092f0: 696e 2865 7175 6970 6d65 6e74 4944 2e73  in(equipmentID.s
-00009300: 706c 6974 2827 5f27 295b 303a 335d 290a  plit('_')[0:3]).
-00009310: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
-00009320: 6f64 0a20 2020 2064 6566 2063 6f6e 7374  od.    def const
-00009330: 7275 6374 6946 444f 6669 6c65 4e61 6d65  ructiFDOfileName
-00009340: 2870 726f 6a65 6374 3a73 7472 2c65 7665  (project:str,eve
-00009350: 6e74 3a73 7472 2c73 656e 736f 723a 7374  nt:str,sensor:st
-00009360: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
-00009370: 7265 7475 726e 7320 3c63 6f6e 7374 7275  returns <constru
-00009380: 6374 496d 6167 6553 6574 4e61 6d65 2829  ctImageSetName()
-00009390: 3e5f 6946 444f 2e6a 736f 6e20 2222 220a  >_iFDO.json """.
-000093a0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-000093b0: 4644 4f2e 636f 6e73 7472 7563 7449 6d61  FDO.constructIma
-000093c0: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
-000093d0: 742c 6576 656e 742c 7365 6e73 6f72 2920  t,event,sensor) 
-000093e0: 2b20 275f 6946 444f 2e6a 736f 6e27 200a  + '_iFDO.json' .
-000093f0: 0a20 2020 200a 2020 2020 4073 7461 7469  .    .    @stati
-00009400: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-00009410: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
-00009420: 6966 646f 3a64 6963 742c 6b65 7973 3a6c  ifdo:dict,keys:l
-00009430: 6973 742c 6465 6661 756c 745f 6f6e 6c79  ist,default_only
-00009440: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
-00009450: 2020 2022 2222 2072 6574 7572 6e73 2063     """ returns c
-00009460: 6f70 7920 6f66 2073 6574 206f 7220 6974  opy of set or it
-00009470: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
-00009480: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
-00009490: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
-000094a0: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
-000094b0: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
-000094c0: 2061 7320 652e 672e 205b 3c69 7465 6d3e   as e.g. [<item>
-000094d0: 2c3c 6b65 793e 2c2e 2e5d 2e20 4361 6e20  ,<key>,..]. Can 
-000094e0: 6265 2075 7365 6420 666f 7220 6865 6164  be used for head
-000094f0: 6572 2066 6965 6c64 7320 6173 2077 656c  er fields as wel
-00009500: 6c20 6173 2069 7465 6d20 6669 656c 6473  l as item fields
-00009510: 2e0a 2020 2020 2020 2020 2020 2020 4974  ..            It
-00009520: 656d 2069 6e64 6578 2063 616e 2062 6520  em index can be 
-00009530: 6e65 676c 6563 7465 642c 2069 6e20 6361  neglected, in ca
-00009540: 7365 206f 6620 7669 6465 6f20 6120 6469  se of video a di
-00009550: 6374 207b 3c69 6d61 6765 2d64 6174 6174  ct {<image-datat
-00009560: 696d 653e 3a3c 7661 6c75 653e 2c2e 2e2e  ime>:<value>,...
-00009570: 7d20 6973 2072 6574 7572 6e65 640a 2020  } is returned.  
-00009580: 2020 2020 2020 2020 2020 756e 6c65 7373            unless
-00009590: 2064 6566 6175 6c74 5f6f 6e6c 7920 3d20   default_only = 
-000095a0: 4661 6c73 652c 2074 6865 6e20 6465 6661  False, then defa
-000095b0: 756c 7420 7661 6c75 6573 2061 7420 696e  ult values at in
-000095c0: 6465 7820 3020 6973 2072 6574 7572 6e65  dex 0 is returne
-000095d0: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
-000095e0: 6169 7365 7320 4966 646f 4578 6365 7074  aises IfdoExcept
-000095f0: 696f 6e20 6966 206b 6579 7320 646f 206e  ion if keys do n
-00009600: 6f74 2065 7869 7374 2e20 2222 220a 0a20  ot exist. """.. 
-00009610: 2020 2020 2020 2069 6620 6e6f 7420 6d69         if not mi
-00009620: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
-00009630: 656d 735f 6b65 7920 696e 2069 6664 6f20  ems_key in ifdo 
-00009640: 6f72 206e 6f74 206d 6971 7476 2e69 6d61  or not miqtv.ima
-00009650: 6765 5f73 6574 5f68 6561 6465 725f 6b65  ge_set_header_ke
-00009660: 7920 696e 2069 6664 6f3a 0a20 2020 2020  y in ifdo:.     
-00009670: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00009680: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00009690: 2822 496e 7661 6c69 6420 6966 646f 2064  ("Invalid ifdo d
-000096a0: 6963 742c 206d 6973 7369 6e67 2069 7465  ict, missing ite
-000096b0: 6d73 206f 7220 6865 6164 6572 206b 6579  ms or header key
-000096c0: 3a20 2220 2b20 7374 7228 6966 646f 2929  : " + str(ifdo))
-000096d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-000096e0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-000096f0: 6e63 6528 6b65 7973 2c6c 6973 7429 3a0a  nce(keys,list):.
-00009700: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
-00009710: 203d 205b 6b65 7973 5d0a 0a20 2020 2020   = [keys]..     
-00009720: 2020 2023 2072 656d 6f76 6520 6865 6164     # remove head
-00009730: 6572 206f 7220 6974 656d 2070 7265 6669  er or item prefi
-00009740: 7865 7320 6966 2074 6865 7265 0a20 2020  xes if there.   
-00009750: 2020 2020 2069 6620 6b65 7973 5b30 5d20       if keys[0] 
-00009760: 3d3d 206d 6971 7476 2e69 6d61 6765 5f73  == miqtv.image_s
-00009770: 6574 5f69 7465 6d73 5f6b 6579 206f 7220  et_items_key or 
-00009780: 6b65 7973 5b30 5d20 3d3d 206d 6971 7476  keys[0] == miqtv
-00009790: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-000097a0: 725f 6b65 793a 0a20 2020 2020 2020 2020  r_key:.         
-000097b0: 2020 206b 6579 7320 3d20 6b65 7973 5b31     keys = keys[1
-000097c0: 3a3a 5d0a 0a20 2020 2020 2020 2068 6561  ::]..        hea
-000097d0: 6465 7220 3d20 6966 646f 5b6d 6971 7476  der = ifdo[miqtv
-000097e0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
-000097f0: 725f 6b65 795d 0a20 2020 2020 2020 2069  r_key].        i
-00009800: 7465 6d73 203d 2069 6664 6f5b 6d69 7174  tems = ifdo[miqt
-00009810: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
-00009820: 735f 6b65 795d 0a20 2020 2020 2020 2023  s_key].        #
-00009830: 206c 6f6f 6b20 666f 7220 6465 6661 756c   look for defaul
-00009840: 7420 7661 6c75 650a 2020 2020 2020 2020  t value.        
-00009850: 666f 7220 736b 6970 7065 6449 6e48 6561  for skippedInHea
-00009860: 6465 7220 696e 2072 616e 6765 286c 656e  der in range(len
-00009870: 286b 6579 7329 293a 0a20 2020 2020 2020  (keys)):.       
-00009880: 2020 2020 2064 6566 6175 6c74 5661 6c20       defaultVal 
-00009890: 3d20 6669 6e64 4669 656c 6428 6865 6164  = findField(head
-000098a0: 6572 2c6b 6579 735b 736b 6970 7065 6449  er,keys[skippedI
-000098b0: 6e48 6561 6465 723a 3a5d 290a 2020 2020  nHeader::]).    
-000098c0: 2020 2020 2020 2020 6966 2064 6566 6175          if defau
-000098d0: 6c74 5661 6c20 213d 2022 223a 0a20 2020  ltVal != "":.   
-000098e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-000098f0: 616b 0a0a 2020 2020 2020 2020 2323 206c  ak..        ## l
-00009900: 6f6f 6b20 666f 7220 6974 656d 2076 616c  ook for item val
-00009910: 7565 0a20 2020 2020 2020 2023 2068 6561  ue.        # hea
-00009920: 6465 7220 6f6e 6c79 2076 616c 7565 2c20  der only value, 
-00009930: 646f 6e27 7420 6368 6563 6b20 696e 2069  don't check in i
-00009940: 7465 6d73 0a20 2020 2020 2020 2069 6620  tems.        if 
-00009950: 6669 6e64 4669 656c 6428 6974 656d 732c  findField(items,
-00009960: 6b65 7973 5b30 3a31 5d29 203d 3d20 2222  keys[0:1]) == ""
-00009970: 2061 6e64 2073 6b69 7070 6564 496e 4865   and skippedInHe
-00009980: 6164 6572 203d 3d20 303a 0a20 2020 2020  ader == 0:.     
-00009990: 2020 2020 2020 2072 6574 203d 2064 6566         ret = def
-000099a0: 6175 6c74 5661 6c0a 2020 2020 2020 2020  aultVal.        
-000099b0: 2020 2020 6966 2072 6574 203d 3d20 2222      if ret == ""
-000099c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000099d0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-000099e0: 646f 4578 6365 7074 696f 6e28 226b 6579  doException("key
-000099f0: 2064 6f65 7320 6e6f 7420 6578 6973 743a   does not exist:
-00009a00: 2220 2b20 7374 7228 6b65 7973 2929 0a20  " + str(keys)). 
-00009a10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009a20: 2020 2020 2020 2020 2023 2069 6620 6669           # if fi
-00009a30: 7273 7420 6b65 7920 6e6f 7420 666f 756e  rst key not foun
-00009a40: 6420 696e 2069 7465 6d73 2c20 692e 652e  d in items, i.e.
-00009a50: 2069 7320 6e6f 7420 6120 696d 6167 6520   is not a image 
-00009a60: 6e61 6d65 2c20 616e 6420 6669 7273 7420  name, and first 
-00009a70: 6b65 7920 6973 206e 6f74 2061 2068 6561  key is not a hea
-00009a80: 6465 7220 6b65 793a 0a20 2020 2020 2020  der key:.       
-00009a90: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
-00009aa0: 6428 6974 656d 732c 6b65 7973 5b30 3a31  d(items,keys[0:1
-00009ab0: 5d29 203d 3d20 2222 2061 6e64 2073 6b69  ]) == "" and ski
-00009ac0: 7070 6564 496e 4865 6164 6572 2021 3d20  ppedInHeader != 
-00009ad0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00009ae0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-00009af0: 6664 6f45 7863 6570 7469 6f6e 2822 6974  fdoException("it
-00009b00: 656d 2064 6f65 7320 6e6f 7420 6578 6973  em does not exis
-00009b10: 743a 2220 2b20 7374 7228 6b65 7973 5b30  t:" + str(keys[0
-00009b20: 3a31 5d29 290a 0a20 2020 2020 2020 2020  :1]))..         
-00009b30: 2020 2023 2063 6865 636b 2069 6620 696e     # check if in
-00009b40: 6465 7820 7072 6f76 6964 6564 0a20 2020  dex provided.   
-00009b50: 2020 2020 2020 2020 2069 6e64 6578 5072           indexPr
-00009b60: 6f76 6964 6564 203d 2054 7275 650a 2020  ovided = True.  
-00009b70: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00009b80: 286b 6579 7329 203e 2031 3a0a 2020 2020  (keys) > 1:.    
-00009b90: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00009ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009bb0: 2020 2020 2069 6e64 6578 203d 2069 6e74       index = int
-00009bc0: 286b 6579 735b 315d 290a 2020 2020 2020  (keys[1]).      
-00009bd0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00009be0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 696e 6465 7850 726f 7669 6465 6420 3d20  indexProvided = 
-00009c10: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00009c20: 2020 656c 6966 206c 656e 286b 6579 7329    elif len(keys)
-00009c30: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-00009c40: 2020 2020 2020 2069 6e64 6578 5072 6f76         indexProv
-00009c50: 6964 6564 203d 2046 616c 7365 0a20 2020  ided = False.   
-00009c60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00009c70: 2020 2020 2020 2020 2020 696d 6167 6549            imageI
-00009c80: 7465 6d54 696d 6550 6f69 6e74 7320 3d20  temTimePoints = 
-00009c90: 6974 656d 735b 6b65 7973 5b30 5d5d 0a0a  items[keys[0]]..
-00009ca0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00009cb0: 6e64 6578 5072 6f76 6964 6564 3a0a 2020  ndexProvided:.  
-00009cc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009cd0: 6966 206b 6579 2069 7320 7768 6f6c 6520  if key is whole 
-00009ce0: 696d 6167 6520 6164 6420 616c 6c20 7661  image add all va
-00009cf0: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
-00009d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009d10: 2069 6620 6c65 6e28 6b65 7973 2920 3d3d   if len(keys) ==
-00009d20: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-00009d30: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
-00009d40: 616c 203d 2068 6561 6465 720a 2020 2020  al = header.    
-00009d50: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
-00009d60: 6420 6465 6661 756c 7420 6672 6f6d 2069  d default from i
-00009d70: 6e64 6578 2030 0a20 2020 2020 2020 2020  ndex 0.         
-00009d80: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
-00009d90: 7973 2920 3e20 3120 616e 6420 696e 6465  ys) > 1 and inde
-00009da0: 7820 213d 2030 3a0a 2020 2020 2020 2020  x != 0:.        
-00009db0: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
-00009dc0: 5f30 203d 2063 6f70 792e 6465 6570 636f  _0 = copy.deepco
-00009dd0: 7079 286b 6579 7329 0a20 2020 2020 2020  py(keys).       
-00009de0: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00009df0: 735f 305b 315d 203d 2030 0a20 2020 2020  s_0[1] = 0.     
-00009e00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009e10: 6574 5f30 203d 2069 4644 4f2e 5f5f 6765  et_0 = iFDO.__ge
-00009e20: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
-00009e30: 2c6b 6579 735f 302c 736b 6970 7065 6449  ,keys_0,skippedI
-00009e40: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
-00009e50: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-00009e60: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00009e70: 7461 6e63 6528 7265 745f 302c 6469 6374  tance(ret_0,dict
-00009e80: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00009e90: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009ea0: 6c74 5661 6c20 3d20 7b2a 2a64 6566 6175  ltVal = {**defau
-00009eb0: 6c74 5661 6c2c 2a2a 7265 745f 307d 0a20  ltVal,**ret_0}. 
-00009ec0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009ed0: 6574 203d 2069 4644 4f2e 5f5f 6765 7449  et = iFDO.__getI
-00009ee0: 7465 6d56 616c 7565 2869 7465 6d73 2c6b  temValue(items,k
-00009ef0: 6579 732c 736b 6970 7065 6449 6e48 6561  eys,skippedInHea
-00009f00: 6465 722c 6465 6661 756c 7456 616c 290a  der,defaultVal).
-00009f10: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-00009f20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00009f30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009f40: 2069 6620 6b65 7920 6973 2077 686f 6c65   if key is whole
-00009f50: 2069 6d61 6765 2061 6464 2061 6c6c 2076   image add all v
-00009f60: 616c 7565 7320 6672 6f6d 2068 6561 6465  alues from heade
-00009f70: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00009f80: 2020 6966 206c 656e 286b 6579 7329 203d    if len(keys) =
-00009f90: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
-00009fa0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00009fb0: 5661 6c20 3d20 6865 6164 6572 0a0a 2020  Val = header..  
-00009fc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00009fd0: 7069 6374 7572 6520 2d3e 206a 7573 7420  picture -> just 
-00009fe0: 6f6e 6520 656e 7472 792c 2069 6e73 6572  one entry, inser
-00009ff0: 7420 696e 6465 7820 300a 2020 2020 2020  t index 0.      
-0000a000: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0000a010: 2869 6d61 6765 4974 656d 5469 6d65 506f  (imageItemTimePo
-0000a020: 696e 7473 2920 3d3d 2031 3a0a 2020 2020  ints) == 1:.    
-0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a040: 6b65 7973 203d 206b 6579 735b 303a 315d  keys = keys[0:1]
-0000a050: 202b 205b 305d 202b 206b 6579 735b 313a   + [0] + keys[1:
-0000a060: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-0000a070: 2020 2020 2020 2072 6574 203d 2069 4644         ret = iFD
-0000a080: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
-0000a090: 2869 7465 6d73 2c6b 6579 732c 736b 6970  (items,keys,skip
-0000a0a0: 7065 6449 6e48 6561 6465 722c 6465 6661  pedInHeader,defa
-0000a0b0: 756c 7456 616c 290a 2020 2020 2020 2020  ultVal).        
-0000a0c0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
-0000a0d0: 2020 2020 2020 2020 2020 2020 2023 2076               # v
-0000a0e0: 6964 656f 202d 3e20 7265 7475 726e 2076  ideo -> return v
-0000a0f0: 616c 7565 7320 666f 7220 6561 6368 2074  alues for each t
-0000a100: 696d 6520 7374 616d 700a 2020 2020 2020  ime stamp.      
-0000a110: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a130: 2020 2020 7265 7420 3d20 7b7d 0a20 2020      ret = {}.   
-0000a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a150: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0000a160: 6c65 6e28 696d 6167 6549 7465 6d54 696d  len(imageItemTim
-0000a170: 6550 6f69 6e74 7329 293a 0a20 2020 2020  ePoints)):.     
-0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a190: 2020 2074 696d 6550 6f69 6e74 4461 7461     timePointData
-0000a1a0: 203d 2069 6d61 6765 4974 656d 5469 6d65   = imageItemTime
-0000a1b0: 506f 696e 7473 5b69 5d0a 2020 2020 2020  Points[i].      
-0000a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1d0: 2020 6b65 7973 5f69 203d 206b 6579 735b    keys_i = keys[
-0000a1e0: 303a 315d 202b 205b 695d 202b 206b 6579  0:1] + [i] + key
-0000a1f0: 735b 313a 3a5d 0a20 2020 2020 2020 2020  s[1::].         
-0000a200: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-0000a210: 616c 5f69 203d 2069 4644 4f2e 5f5f 6765  al_i = iFDO.__ge
-0000a220: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
-0000a230: 2c6b 6579 735f 692c 736b 6970 7065 6449  ,keys_i,skippedI
-0000a240: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
-0000a250: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
-0000a260: 2020 2020 2020 2020 2020 2020 2320 6465              # de
-0000a270: 6661 756c 7420 6f6e 6c79 0a20 2020 2020  fault only.     
-0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a290: 2020 2069 6620 6465 6661 756c 745f 6f6e     if default_on
-0000a2a0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 7265 7420 3d20 7661 6c5f 690a 2020 2020  ret = val_i.    
+000012d0: 6f74 6f5d 5b30 5d5b 276c 6f6e 275d 0a20  oto][0]['lon']. 
+000012e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000012f0: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
+00001300: 7a6f 6e65 2c69 734e 6f72 7468 203d 206d  zone,isNorth = m
+00001310: 6971 7467 2e6c 6174 4c6f 6e32 7574 6d28  iqtg.latLon2utm(
+00001320: 6c61 742c 6c6f 6e2c 7265 6673 7973 290a  lat,lon,refsys).
+00001330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001340: 6578 6966 203d 2073 656c 662e 5f5f 6765  exif = self.__ge
+00001350: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
+00001360: 6528 7068 6f74 6f2c 2769 6d61 6765 2d61  e(photo,'image-a
+00001370: 6371 7569 7369 7469 6f6e 2d73 6574 7469  cquisition-setti
+00001380: 6e67 7327 2920 2320 544f 444f 2077 6861  ngs') # TODO wha
+00001390: 7420 6966 206e 6f74 2074 6865 7265 3f20  t if not there? 
+000013a0: 7265 6164 2066 726f 6d20 696d 6167 6520  read from image 
+000013b0: 6469 7265 6374 6c79 3f20 5368 6f75 6c64  directly? Should
+000013c0: 2062 6520 6368 6563 6b65 6420 6966 2068   be checked if h
+000013d0: 6173 6820 6d61 7463 6865 733f 2049 6d61  ash matches? Ima
+000013e0: 6765 2063 6f75 6c64 2068 6176 6520 6265  ge could have be
+000013f0: 656e 2063 726f 7070 6564 2061 6674 6572  en cropped after
+00001400: 2069 4644 4f20 6372 6561 7469 6f6e 0a20   iFDO creation. 
+00001410: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00001420: 6d61 6765 5769 6474 6820 3d20 696e 7428  mageWidth = int(
+00001430: 7374 7228 6578 6966 5b27 496d 6167 6520  str(exif['Image 
+00001440: 5769 6474 6827 5d29 2e73 7472 6970 2827  Width']).strip('
+00001450: 5c27 2729 290a 2020 2020 2020 2020 2020  \'')).          
+00001460: 2020 2020 2020 696d 6167 6548 6569 6768        imageHeigh
+00001470: 7420 3d20 696e 7428 7374 7228 6578 6966  t = int(str(exif
+00001480: 5b27 496d 6167 6520 4865 6967 6874 275d  ['Image Height']
+00001490: 292e 7374 7269 7028 275c 2727 2929 0a20  ).strip('\'')). 
+000014a0: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+000014b0: 6561 6469 6e67 203d 2073 656c 662e 5f5f  eading = self.__
+000014c0: 6765 7449 7465 6d44 6566 6175 6c74 5661  getItemDefaultVa
+000014d0: 6c75 6528 7068 6f74 6f2c 2769 6d61 6765  lue(photo,'image
+000014e0: 2d63 616d 6572 612d 7961 772d 6465 6772  -camera-yaw-degr
+000014f0: 6565 7327 290a 2020 2020 2020 2020 2020  ees').          
+00001500: 2020 2020 2020 616c 7469 7475 6465 203d        altitude =
+00001510: 2073 656c 662e 5f5f 6765 7449 7465 6d44   self.__getItemD
+00001520: 6566 6175 6c74 5661 6c75 6528 7068 6f74  efaultValue(phot
+00001530: 6f2c 2769 6d61 6765 2d6d 6574 6572 732d  o,'image-meters-
+00001540: 6162 6f76 652d 6772 6f75 6e64 2729 0a0a  above-ground')..
+00001550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001560: 646f 6d65 506f 7274 2c6d 7367 203d 2073  domePort,msg = s
+00001570: 656c 662e 5f5f 7472 7947 6574 4973 446f  elf.__tryGetIsDo
+00001580: 6d65 506f 7274 2870 686f 746f 290a 2020  mePort(photo).  
+00001590: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000015a0: 6361 6c4c 656e 6768 5069 7865 6c73 2c20  calLenghPixels, 
+000015b0: 6d73 6720 3d20 7365 6c66 2e5f 5f74 7279  msg = self.__try
+000015c0: 4765 7446 6f63 616c 4c65 6e67 7468 496e  GetFocalLengthIn
+000015d0: 5069 7865 6c73 2870 686f 746f 2c20 646f  Pixels(photo, do
+000015e0: 6d65 506f 7274 290a 2020 2020 2020 2020  mePort).        
+000015f0: 2020 2020 2020 2020 6966 2066 6f63 616c          if focal
+00001600: 4c65 6e67 6850 6978 656c 7320 3d3d 205b  LenghPixels == [
+00001610: 2d31 2c2d 315d 206f 7220 666f 6361 6c4c  -1,-1] or focalL
+00001620: 656e 6768 5069 7865 6c73 203d 3d20 2d31  enghPixels == -1
+00001630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001640: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+00001650: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+00001660: 6d73 6729 0a20 2020 2020 2020 2020 2020  msg).           
+00001670: 2020 2020 206d 6971 7467 2e77 7269 7465       miqtg.write
+00001680: 5369 6d70 6c65 5574 6d57 6f72 6c64 4669  SimpleUtmWorldFi
+00001690: 6c65 286f 732e 7061 7468 2e6a 6f69 6e28  le(os.path.join(
+000016a0: 6465 7374 4469 722c 6d69 7174 672e 636f  destDir,miqtg.co
+000016b0: 6e76 6572 7449 6d61 6765 4e61 6d65 546f  nvertImageNameTo
+000016c0: 576f 726c 6446 696c 654e 616d 6528 7068  WorldFileName(ph
+000016d0: 6f74 6f29 292c 6561 7374 696e 672c 6e6f  oto)),easting,no
+000016e0: 7274 6869 6e67 2c7a 6f6e 652c 6973 4e6f  rthing,zone,isNo
+000016f0: 7274 682c 696d 6167 6557 6964 7468 2c69  rth,imageWidth,i
+00001700: 6d61 6765 4865 6967 6874 2c68 6561 6469  mageHeight,headi
+00001710: 6e67 2c61 6c74 6974 7564 652c 666f 6361  ng,altitude,foca
+00001720: 6c4c 656e 6768 5069 7865 6c73 5b30 5d2c  lLenghPixels[0],
+00001730: 666f 6361 6c4c 656e 6768 5069 7865 6c73  focalLenghPixels
+00001740: 5b31 5d29 0a20 2020 2020 2020 2020 2020  [1]).           
+00001750: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+00001760: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
+00001770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001780: 2020 6946 444f 6578 6365 7074 696f 6e73    iFDOexceptions
+00001790: 2e61 7070 656e 6428 5b70 686f 746f 2c73  .append([photo,s
+000017a0: 7472 2865 2e61 7267 7329 5d29 0a0a 2020  tr(e.args)])..  
+000017b0: 2020 2020 2020 7265 7475 726e 2069 4644        return iFD
+000017c0: 4f65 7863 6570 7469 6f6e 730a 0a0a 2020  Oexceptions...  
+000017d0: 2020 6465 6620 6368 6563 6b49 7465 6d48    def checkItemH
+000017e0: 6173 6828 7365 6c66 2c69 7465 6d3a 7374  ash(self,item:st
+000017f0: 722c 6669 6c65 4469 723a 7374 7229 3a0a  r,fileDir:str):.
+00001800: 2020 2020 2020 2020 2222 2220 636f 6d70          """ comp
+00001810: 6172 6573 2066 696c 6527 7320 6861 7368  ares file's hash
+00001820: 2077 6974 6820 6861 7368 2069 6e20 6946   with hash in iF
+00001830: 444f 2061 6e64 2074 6872 6f77 7320 6578  DO and throws ex
+00001840: 6365 7074 696f 6e20 6966 2074 6865 7920  ception if they 
+00001850: 646f 6e27 7420 6d61 7463 6820 2222 220a  don't match """.
+00001860: 0a20 2020 2020 2020 2066 696c 6520 3d20  .        file = 
+00001870: 6f73 2e70 6174 682e 6a6f 696e 2866 696c  os.path.join(fil
+00001880: 6544 6972 2c69 7465 6d29 0a20 2020 2020  eDir,item).     
+00001890: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+000018a0: 682e 6973 6669 6c65 2866 696c 6529 3a0a  h.isfile(file):.
+000018b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000018c0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+000018d0: 7074 696f 6e28 2246 696c 6520 5c22 2220  ption("File \"" 
+000018e0: 2b20 6974 656d 202b 2022 5c22 206e 6f74  + item + "\" not
+000018f0: 2066 6f75 6e64 2069 6e20 6469 7220 5c22   found in dir \"
+00001900: 2220 2b20 6669 6c65 4469 7220 2b20 225c  " + fileDir + "\
+00001910: 2222 290a 0a20 2020 2020 2020 2069 6620  "")..        if 
+00001920: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+00001930: 6966 646f 5b6d 6971 7476 2e69 6d61 6765  ifdo[miqtv.image
+00001940: 5f73 6574 5f69 7465 6d73 5f6b 6579 5d5b  _set_items_key][
+00001950: 6974 656d 5d2c 6c69 7374 293a 2023 2069  item],list): # i
+00001960: 6e20 6361 7365 206f 6620 7669 6465 6f20  n case of video 
+00001970: 7769 7468 2069 7465 6d20 6173 206c 6973  with item as lis
+00001980: 7420 7468 6520 6669 7273 7420 656e 7472  t the first entr
+00001990: 7920 686f 6c64 7320 7468 6520 6465 6661  y holds the defa
+000019a0: 756c 7420 616e 6420 7468 6520 6861 7368  ult and the hash
+000019b0: 2063 616e 6e6f 7420 7661 7279 2066 6f72   cannot vary for
+000019c0: 2074 6865 2073 616d 6520 696d 6167 650a   the same image.
+000019d0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+000019e0: 456e 7472 7920 3d20 7365 6c66 2e69 6664  Entry = self.ifd
+000019f0: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
+00001a00: 745f 6974 656d 735f 6b65 795d 5b69 7465  t_items_key][ite
+00001a10: 6d5d 5b30 5d20 0a20 2020 2020 2020 2065  m][0] .        e
+00001a20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00001a30: 2069 7465 6d45 6e74 7279 203d 2073 656c   itemEntry = sel
+00001a40: 662e 6966 646f 5b6d 6971 7476 2e69 6d61  f.ifdo[miqtv.ima
+00001a50: 6765 5f73 6574 5f69 7465 6d73 5f6b 6579  ge_set_items_key
+00001a60: 5d5b 6974 656d 5d0a 2020 2020 2020 2020  ][item].        
+00001a70: 6966 206e 6f74 2069 7465 6d45 6e74 7279  if not itemEntry
+00001a80: 5b27 696d 6167 652d 6861 7368 2d73 6861  ['image-hash-sha
+00001a90: 3235 3627 5d20 3d3d 206d 6971 7463 2e73  256'] == miqtc.s
+00001aa0: 6861 3235 3648 6173 6846 696c 6528 6669  ha256HashFile(fi
+00001ab0: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+00001ac0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00001ad0: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
+00001ae0: 2022 6946 444f 2065 6e74 7279 2069 7320   "iFDO entry is 
+00001af0: 6e6f 7420 7570 2074 6f20 6461 7465 2c20  not up to date, 
+00001b00: 696d 6167 6520 6861 7368 2064 6f65 7320  image hash does 
+00001b10: 6e6f 7420 6d61 7463 682e 2229 0a0a 2020  not match.")..  
+00001b20: 2020 6465 6620 6765 7449 6d61 6765 4469    def getImageDi
+00001b30: 7265 6374 6f72 7928 7365 6c66 293a 0a20  rectory(self):. 
+00001b40: 2020 2020 2020 2022 2222 2052 6574 7572         """ Retur
+00001b50: 6e73 2074 6865 206c 6f77 6572 6d6f 7374  ns the lowermost
+00001b60: 206c 6f63 616c 2064 6972 6563 746f 7279   local directory
+00001b70: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+00001b80: 696d 6167 6520 6669 6c65 7320 696e 6665  image files infe
+00001b90: 7272 6564 2066 726f 6d20 2769 6d61 6765  rred from 'image
+00001ba0: 2d73 6574 2d6c 6f63 616c 2d70 6174 6827  -set-local-path'
+00001bb0: 2e20 4966 2027 696d 6167 652d 7365 742d  . If 'image-set-
+00001bc0: 6c6f 6361 6c2d 7061 7468 2720 6e6f 7420  local-path' not 
+00001bd0: 7072 6f76 6964 6564 2066 6f72 2061 6c6c  provided for all
+00001be0: 2069 6d61 6765 2069 7465 6d73 2074 6865   image items the
+00001bf0: 2069 4644 4f27 7320 7061 7265 6e74 2064   iFDO's parent d
+00001c00: 6972 6563 746f 7279 2069 7320 7265 7475  irectory is retu
+00001c10: 726e 6564 2e20 2222 220a 2020 2020 2020  rned. """.      
+00001c20: 2020 6c6f 6361 6c50 6174 6873 203d 205b    localPaths = [
+00001c30: 5d0a 2020 2020 2020 2020 6946 444f 4669  ].        iFDOFi
+00001c40: 6c65 5061 7265 6e74 4469 7220 3d20 6f73  leParentDir = os
+00001c50: 2e70 6174 682e 6469 726e 616d 6528 6f73  .path.dirname(os
+00001c60: 2e70 6174 682e 6469 726e 616d 6528 7365  .path.dirname(se
+00001c70: 6c66 2e69 4644 4f66 696c 6529 290a 2020  lf.iFDOfile)).  
+00001c80: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+00001c90: 6e20 7365 6c66 2e69 6664 6f5b 6d69 7174  n self.ifdo[miqt
+00001ca0: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00001cb0: 735f 6b65 795d 3a0a 2020 2020 2020 2020  s_key]:.        
+00001cc0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00001cd0: 2020 2020 2020 2020 2069 7465 6d4c 6f63           itemLoc
+00001ce0: 616c 5061 7468 203d 2073 656c 662e 5f5f  alPath = self.__
+00001cf0: 6765 7449 7465 6d44 6566 6175 6c74 5661  getItemDefaultVa
+00001d00: 6c75 6528 6974 656d 2c27 696d 6167 652d  lue(item,'image-
+00001d10: 7365 742d 6c6f 6361 6c2d 7061 7468 2729  set-local-path')
+00001d20: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00001d30: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
+00001d40: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00001d50: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00001d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001d70: 2020 6974 656d 4c6f 6361 6c50 6174 6820    itemLocalPath 
+00001d80: 3d20 7365 6c66 2e5f 5f67 6574 4974 656d  = self.__getItem
+00001d90: 4465 6661 756c 7456 616c 7565 2869 7465  DefaultValue(ite
+00001da0: 6d2c 2769 6d61 6765 2d6c 6f63 616c 2d70  m,'image-local-p
+00001db0: 6174 6827 2920 2320 6261 636b 7761 7264  ath') # backward
+00001dc0: 7320 636f 6d70 6174 6962 696c 6974 790a  s compatibility.
+00001dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001de0: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+00001df0: 6f45 7863 6570 7469 6f6e 3a0a 2020 2020  oException:.    
+00001e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001e10: 6974 656d 4c6f 6361 6c50 6174 6820 3d20  itemLocalPath = 
+00001e20: 6946 444f 4669 6c65 5061 7265 6e74 4469  iFDOFileParentDi
+00001e30: 720a 2020 2020 2020 2020 2020 2020 6966  r.            if
+00001e40: 2069 7465 6d4c 6f63 616c 5061 7468 206e   itemLocalPath n
+00001e50: 6f74 2069 6e20 6c6f 6361 6c50 6174 6873  ot in localPaths
+00001e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001e70: 2020 6c6f 6361 6c50 6174 6873 2e61 7070    localPaths.app
+00001e80: 656e 6428 6974 656d 4c6f 6361 6c50 6174  end(itemLocalPat
+00001e90: 6829 0a20 2020 2020 2020 2063 6f6d 6d6f  h).        commo
+00001ea0: 6e50 6174 6820 3d20 6f73 2e70 6174 682e  nPath = os.path.
+00001eb0: 636f 6d6d 6f6e 7061 7468 286c 6f63 616c  commonpath(local
+00001ec0: 5061 7468 7329 0a20 2020 2020 2020 2069  Paths).        i
+00001ed0: 6620 6e6f 7420 6f73 2e70 6174 682e 6973  f not os.path.is
+00001ee0: 6162 7328 636f 6d6d 6f6e 5061 7468 293a  abs(commonPath):
+00001ef0: 0a20 2020 2020 2020 2020 2020 2063 6f6d  .            com
+00001f00: 6d6f 6e50 6174 6820 3d20 6f73 2e70 6174  monPath = os.pat
+00001f10: 682e 6e6f 726d 7061 7468 286f 732e 7061  h.normpath(os.pa
+00001f20: 7468 2e6a 6f69 6e28 6f73 2e70 6174 682e  th.join(os.path.
+00001f30: 6469 726e 616d 6528 7365 6c66 2e69 4644  dirname(self.iFD
+00001f40: 4f66 696c 6529 2c20 636f 6d6d 6f6e 5061  Ofile), commonPa
+00001f50: 7468 2929 0a20 2020 2020 2020 2072 6574  th)).        ret
+00001f60: 7572 6e20 636f 6d6d 6f6e 5061 7468 0a0a  urn commonPath..
+00001f70: 0a20 2020 2064 6566 205f 5f74 7279 4765  .    def __tryGe
+00001f80: 7449 7344 6f6d 6550 6f72 7428 7365 6c66  tIsDomePort(self
+00001f90: 2c69 7465 6d29 3a0a 2020 2020 2020 2020  ,item):.        
+00001fa0: 2222 2220 5472 6965 7320 746f 2072 6561  """ Tries to rea
+00001fb0: 6420 706f 7274 2074 7970 6520 6672 6f6d  d port type from
+00001fc0: 2027 696d 6167 652d 6361 6d65 7261 2d68   'image-camera-h
+00001fd0: 6f75 7369 6e67 2d76 6965 7770 6f72 7427  ousing-viewport'
+00001fe0: 5b76 6965 7770 6f72 742d 7479 7065 5d20  [viewport-type] 
+00001ff0: 6f72 2027 696d 6167 652d 666c 6174 706f  or 'image-flatpo
+00002000: 7274 2d70 6172 616d 6574 6572 7327 2f27  rt-parameters'/'
+00002010: 696d 6167 652d 646f 6d65 706f 7274 2d70  image-domeport-p
+00002020: 6172 616d 6574 6572 7327 200a 2020 2020  arameters' .    
+00002030: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+00002040: 5472 7565 2c6d 7367 2069 6620 646f 6d65  True,msg if dome
+00002050: 2070 6f72 742c 2046 616c 7365 2c6d 7367   port, False,msg
+00002060: 2069 6620 666c 6174 2070 6f72 742c 204e   if flat port, N
+00002070: 6f6e 652c 6d73 6720 6f74 6865 7277 6973  one,msg otherwis
+00002080: 6520 2222 220a 0a20 2020 2020 2020 2074  e """..        t
+00002090: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000020a0: 706f 7274 5479 7065 5374 7220 3d20 7365  portTypeStr = se
+000020b0: 6c66 2e5f 5f67 6574 4974 656d 4465 6661  lf.__getItemDefa
+000020c0: 756c 7456 616c 7565 2869 7465 6d2c 2769  ultValue(item,'i
+000020d0: 6d61 6765 2d63 616d 6572 612d 686f 7573  mage-camera-hous
+000020e0: 696e 672d 7669 6577 706f 7274 2729 0a20  ing-viewport'). 
+000020f0: 2020 2020 2020 2020 2020 2070 6f72 7454             portT
+00002100: 7970 6553 7472 203d 2070 6f72 7454 7970  ypeStr = portTyp
+00002110: 6553 7472 5b27 7669 6577 706f 7274 2d74  eStr['viewport-t
+00002120: 7970 6527 5d0a 2020 2020 2020 2020 2020  ype'].          
+00002130: 2020 6966 2027 646f 6d65 2720 696e 2070    if 'dome' in p
+00002140: 6f72 7454 7970 6553 7472 2e6c 6f77 6572  ortTypeStr.lower
+00002150: 2829 2061 6e64 206e 6f74 2027 666c 6174  () and not 'flat
+00002160: 2720 696e 2070 6f72 7454 7970 6553 7472  ' in portTypeStr
+00002170: 2e6c 6f77 6572 2829 3a0a 2020 2020 2020  .lower():.      
+00002180: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00002190: 2054 7275 652c 2250 6172 7365 6420 6672   True,"Parsed fr
+000021a0: 6f6d 2027 696d 6167 652d 6361 6d65 7261  om 'image-camera
+000021b0: 2d68 6f75 7369 6e67 2d76 6965 7770 6f72  -housing-viewpor
+000021c0: 7427 5b27 7669 6577 706f 7274 2d74 7970  t'['viewport-typ
+000021d0: 6527 5d22 0a20 2020 2020 2020 2020 2020  e']".           
+000021e0: 2065 6c69 6620 6e6f 7420 2764 6f6d 6527   elif not 'dome'
+000021f0: 2069 6e20 706f 7274 5479 7065 5374 722e   in portTypeStr.
+00002200: 6c6f 7765 7228 2920 616e 6420 2766 6c61  lower() and 'fla
+00002210: 7427 2069 6e20 706f 7274 5479 7065 5374  t' in portTypeSt
+00002220: 722e 6c6f 7765 7228 293a 0a20 2020 2020  r.lower():.     
+00002230: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00002240: 6e20 4661 6c73 652c 2250 6172 7365 6420  n False,"Parsed 
+00002250: 6672 6f6d 2027 696d 6167 652d 6361 6d65  from 'image-came
+00002260: 7261 2d68 6f75 7369 6e67 2d76 6965 7770  ra-housing-viewp
+00002270: 6f72 7427 5b27 7669 6577 706f 7274 2d74  ort'['viewport-t
+00002280: 7970 6527 5d22 0a20 2020 2020 2020 2020  ype']".         
+00002290: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000022a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000022b0: 4e6f 6e65 2c22 436f 756c 6420 6e6f 7420  None,"Could not 
+000022c0: 7265 6164 2070 6f72 7420 7479 7065 2066  read port type f
+000022d0: 726f 6d20 2769 6d61 6765 2d63 616d 6572  rom 'image-camer
+000022e0: 612d 686f 7573 696e 672d 7669 6577 706f  a-housing-viewpo
+000022f0: 7274 275b 2776 6965 7770 6f72 742d 7479  rt'['viewport-ty
+00002300: 7065 275d 2069 6e20 6974 656d 3a20 2220  pe'] in item: " 
+00002310: 2b20 6974 656d 0a20 2020 2020 2020 2065  + item.        e
+00002320: 7863 6570 7420 286d 6971 7463 2e49 6664  xcept (miqtc.Ifd
+00002330: 6f45 7863 6570 7469 6f6e 2c20 4b65 7945  oException, KeyE
+00002340: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00002350: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
+00002360: 2066 6c61 7450 6f72 7450 6172 616d 7346   flatPortParamsF
+00002370: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+00002380: 2020 2020 2074 7279 3a20 0a20 2020 2020       try: .     
+00002390: 2020 2020 2020 2066 6c61 7450 6f72 7450         flatPortP
+000023a0: 6172 616d 7320 3d20 7365 6c66 2e5f 5f67  arams = self.__g
+000023b0: 6574 4974 656d 4465 6661 756c 7456 616c  etItemDefaultVal
+000023c0: 7565 2869 7465 6d2c 2769 6d61 6765 2d66  ue(item,'image-f
+000023d0: 6c61 7470 6f72 742d 7061 7261 6d65 7465  latport-paramete
+000023e0: 7273 2729 0a20 2020 2020 2020 2020 2020  rs').           
+000023f0: 2066 6c61 7450 6f72 7450 6172 616d 7346   flatPortParamsF
+00002400: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
+00002410: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
+00002420: 2e49 6664 6f45 7863 6570 7469 6f6e 3a0a  .IfdoException:.
+00002430: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00002440: 0a20 2020 2020 2020 2064 6f6d 6550 6f72  .        domePor
+00002450: 7450 6172 616d 7346 6f75 6e64 203d 2046  tParamsFound = F
+00002460: 616c 7365 0a20 2020 2020 2020 2074 7279  alse.        try
+00002470: 3a20 0a20 2020 2020 2020 2020 2020 2064  : .            d
+00002480: 6f6d 6550 6f72 7450 6172 616d 7320 3d20  omePortParams = 
+00002490: 7365 6c66 2e5f 5f67 6574 4974 656d 4465  self.__getItemDe
+000024a0: 6661 756c 7456 616c 7565 2869 7465 6d2c  faultValue(item,
+000024b0: 2769 6d61 6765 2d64 6f6d 6570 6f72 742d  'image-domeport-
+000024c0: 7061 7261 6d65 7465 7273 2729 0a20 2020  parameters').   
+000024d0: 2020 2020 2020 2020 2064 6f6d 6550 6f72           domePor
+000024e0: 7450 6172 616d 7346 6f75 6e64 203d 2054  tParamsFound = T
+000024f0: 7275 650a 2020 2020 2020 2020 6578 6365  rue.        exce
+00002500: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
+00002510: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00002520: 2020 2020 7061 7373 0a0a 2020 2020 2020      pass..      
+00002530: 2020 6966 2066 6c61 7450 6f72 7450 6172    if flatPortPar
+00002540: 616d 7346 6f75 6e64 2061 6e64 2064 6f6d  amsFound and dom
+00002550: 6550 6f72 7450 6172 616d 7346 6f75 6e64  ePortParamsFound
+00002560: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00002570: 7475 726e 204e 6f6e 652c 2243 6f75 6c64  turn None,"Could
+00002580: 206e 6f74 2072 6561 6420 706f 7274 2074   not read port t
+00002590: 7970 6520 6672 6f6d 2069 7465 6d20 6173  ype from item as
+000025a0: 2069 7420 636f 6e74 6169 6e73 2069 6e66   it contains inf
+000025b0: 6f20 6f6e 2062 6f74 6820 666c 6174 2061  o on both flat a
+000025c0: 6e64 2064 6f6d 6520 706f 7274 3a20 2220  nd dome port: " 
+000025d0: 2b20 6974 656d 0a20 2020 2020 2020 2069  + item.        i
+000025e0: 6620 666c 6174 506f 7274 5061 7261 6d73  f flatPortParams
+000025f0: 466f 756e 643a 0a20 2020 2020 2020 2020  Found:.         
+00002600: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00002610: 2241 7373 756d 6564 2061 7320 666c 6174  "Assumed as flat
+00002620: 2070 6f72 7420 6173 2027 696d 6167 652d   port as 'image-
+00002630: 666c 6174 706f 7274 2d70 6172 616d 6574  flatport-paramet
+00002640: 6572 7327 2066 6f75 6e64 2069 6e20 6974  ers' found in it
+00002650: 656d 3a20 2220 2b20 6974 656d 0a20 2020  em: " + item.   
+00002660: 2020 2020 2069 6620 646f 6d65 506f 7274       if domePort
+00002670: 5061 7261 6d73 466f 756e 643a 0a20 2020  ParamsFound:.   
+00002680: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00002690: 5472 7565 2c22 4173 7375 6d65 6420 6173  True,"Assumed as
+000026a0: 2064 6f6d 6520 706f 7274 2061 7320 2769   dome port as 'i
+000026b0: 6d61 6765 2d64 6f6d 6570 6f72 742d 7061  mage-domeport-pa
+000026c0: 7261 6d65 7465 7273 2720 666f 756e 6420  rameters' found 
+000026d0: 696e 2069 7465 6d3a 2022 202b 2069 7465  in item: " + ite
+000026e0: 6d0a 2020 2020 2020 2020 7265 7475 726e  m.        return
+000026f0: 204e 6f6e 652c 2243 6f75 6c64 206e 6f74   None,"Could not
+00002700: 2072 6561 6420 706f 7274 2074 7970 6520   read port type 
+00002710: 6672 6f6d 2069 7465 6d3a 2022 202b 2069  from item: " + i
+00002720: 7465 6d0a 0a0a 2020 2020 6465 6620 5f5f  tem...    def __
+00002730: 7472 7947 6574 466f 6361 6c4c 656e 6774  tryGetFocalLengt
+00002740: 6849 6e50 6978 656c 7328 7365 6c66 2c69  hInPixels(self,i
+00002750: 7465 6d3a 7374 722c 646f 6d65 506f 7274  tem:str,domePort
+00002760: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00002770: 2222 2220 0a20 2020 2020 2020 2054 7269  """ .        Tri
+00002780: 6573 2074 6f20 7265 6164 2f64 6574 6572  es to read/deter
+00002790: 6d69 6e65 2066 6f63 616c 206c 656e 6774  mine focal lengt
+000027a0: 6820 696e 2070 6978 656c 7320 6569 7468  h in pixels eith
+000027b0: 6572 2066 726f 6d20 2769 6d61 6765 2d63  er from 'image-c
+000027c0: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
+000027d0: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
+000027e0: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
+000027f0: 7468 2d78 792d 7069 7865 6c27 5d20 6f72  th-xy-pixel'] or
+00002800: 2066 726f 6d20 6578 6966 2076 616c 7565   from exif value
+00002810: 732e 0a20 2020 2020 2020 2069 6620 646f  s..        if do
+00002820: 6d65 506f 7274 203d 2046 616c 7365 2c20  mePort = False, 
+00002830: 666c 6174 2070 6f72 7420 6973 2061 7373  flat port is ass
+00002840: 756d 6564 2061 6e64 2061 2063 6f72 7265  umed and a corre
+00002850: 6374 696f 6e20 6661 6374 6f72 206f 6620  ction factor of 
+00002860: 312e 3333 2069 7320 6170 706c 6965 6420  1.33 is applied 
+00002870: 666f 7220 666f 6361 6c20 6c65 6e67 7468  for focal length
+00002880: 2064 6574 6572 6d69 6e65 6420 6672 6f6d   determined from
+00002890: 2065 7869 6620 7661 6c75 6573 0a20 2020   exif values.   
+000028a0: 2020 2020 2052 6574 7572 6e73 2065 6974       Returns eit
+000028b0: 6865 7220 666f 6361 6c4c 656e 6774 682c  her focalLength,
+000028c0: 206d 6573 7361 6765 206f 7220 5b66 6f63   message or [foc
+000028d0: 616c 4c65 6e67 7468 582c 666f 6361 6c4c  alLengthX,focalL
+000028e0: 656e 6774 6859 5d2c 206d 6573 7361 6765  engthY], message
+000028f0: 2e20 4966 2075 6e73 7563 6365 7373 6675  . If unsuccessfu
+00002900: 6c20 666f 6361 6c4c 656e 6774 6820 3d20  l focalLength = 
+00002910: 2d31 0a20 2020 2020 2020 2022 2222 0a0a  -1.        """..
+00002920: 2020 2020 2020 2020 2320 7472 7920 7265          # try re
+00002930: 6164 2066 726f 6d20 2769 6d61 6765 2d63  ad from 'image-c
+00002940: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
+00002950: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
+00002960: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
+00002970: 7468 2d78 792d 7069 7865 6c27 5d0a 2020  th-xy-pixel'].  
+00002980: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00002990: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
+000029a0: 7468 5859 203d 2073 656c 662e 5f5f 6765  thXY = self.__ge
+000029b0: 7449 7465 6d44 6566 6175 6c74 5661 6c75  tItemDefaultValu
+000029c0: 6528 6974 656d 2c27 696d 6167 652d 6361  e(item,'image-ca
+000029d0: 6d65 7261 2d63 616c 6962 7261 7469 6f6e  mera-calibration
+000029e0: 2d6d 6f64 656c 2729 0a20 2020 2020 2020  -model').       
+000029f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00002a00: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
+00002a10: 656e 6774 6858 5920 3d20 666f 6361 6c4c  engthXY = focalL
+00002a20: 656e 6774 6858 595b 2763 616c 6962 7261  engthXY['calibra
+00002a30: 7469 6f6e 2d66 6f63 616c 2d6c 656e 6774  tion-focal-lengt
+00002a40: 682d 7879 2d70 6978 656c 275d 0a20 2020  h-xy-pixel'].   
+00002a50: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00002a60: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
+00002a70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002a80: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00002a90: 696f 6e28 6974 656d 2c22 646f 6573 206e  ion(item,"does n
+00002aa0: 6f74 2063 6f6e 7461 696e 2027 696d 6167  ot contain 'imag
+00002ab0: 652d 6361 6d65 7261 2d63 616c 6962 7261  e-camera-calibra
+00002ac0: 7469 6f6e 2d6d 6f64 656c 275b 2763 616c  tion-model'['cal
+00002ad0: 6962 7261 7469 6f6e 2d66 6f63 616c 2d6c  ibration-focal-l
+00002ae0: 656e 6774 682d 7879 2d70 6978 656c 275d  ength-xy-pixel']
+00002af0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00002b00: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00002b10: 6528 666f 6361 6c4c 656e 6774 6858 592c  e(focalLengthXY,
+00002b20: 6c69 7374 293a 2023 2078 2061 6e64 2079  list): # x and y
+00002b30: 2076 616c 7565 2061 7265 2069 6465 6e74   value are ident
+00002b40: 6963 616c 0a20 2020 2020 2020 2020 2020  ical.           
+00002b50: 2020 2020 2066 6f63 616c 4c65 6e67 7468       focalLength
+00002b60: 5859 203d 205b 666f 6361 6c4c 656e 6774  XY = [focalLengt
+00002b70: 6858 592c 666f 6361 6c4c 656e 6774 6858  hXY,focalLengthX
+00002b80: 595d 0a20 2020 2020 2020 2020 2020 2069  Y].            i
+00002b90: 6620 6c65 6e28 666f 6361 6c4c 656e 6774  f len(focalLengt
+00002ba0: 6858 5929 2021 3d20 323a 0a20 2020 2020  hXY) != 2:.     
+00002bb0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00002bc0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+00002bd0: 7469 6f6e 2869 7465 6d2c 2249 6e76 616c  tion(item,"Inval
+00002be0: 6964 2065 6e74 7279 2066 6f72 2027 696d  id entry for 'im
+00002bf0: 6167 652d 6361 6d65 7261 2d63 616c 6962  age-camera-calib
+00002c00: 7261 7469 6f6e 2d6d 6f64 656c 275b 2763  ration-model'['c
+00002c10: 616c 6962 7261 7469 6f6e 2d66 6f63 616c  alibration-focal
+00002c20: 2d6c 656e 6774 682d 7879 2d70 6978 656c  -length-xy-pixel
+00002c30: 275d 203a 2022 202b 2073 7472 2866 6f63  '] : " + str(foc
+00002c40: 616c 4c65 6e67 7468 5859 2920 290a 0a20  alLengthXY) ).. 
+00002c50: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00002c60: 7420 6973 696e 7374 616e 6365 2866 6f63  t isinstance(foc
+00002c70: 616c 4c65 6e67 7468 5859 5b30 5d2c 666c  alLengthXY[0],fl
+00002c80: 6f61 7429 206f 7220 6e6f 7420 6973 696e  oat) or not isin
+00002c90: 7374 616e 6365 2866 6f63 616c 4c65 6e67  stance(focalLeng
+00002ca0: 7468 5859 5b30 5d2c 696e 7429 206f 7220  thXY[0],int) or 
+00002cb0: 6e6f 7420 6973 696e 7374 616e 6365 2866  not isinstance(f
+00002cc0: 6f63 616c 4c65 6e67 7468 5859 5b31 5d2c  ocalLengthXY[1],
+00002cd0: 666c 6f61 7429 206f 7220 6e6f 7420 6973  float) or not is
+00002ce0: 696e 7374 616e 6365 2866 6f63 616c 4c65  instance(focalLe
+00002cf0: 6e67 7468 5859 5b31 5d2c 696e 7429 3a0a  ngthXY[1],int):.
+00002d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d10: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00002d20: 2020 2020 2020 2020 2066 6f63 616c 4c65           focalLe
+00002d30: 6e67 7468 5859 203d 205b 666c 6f61 7428  ngthXY = [float(
+00002d40: 666f 6361 6c4c 656e 6774 6858 595b 305d  focalLengthXY[0]
+00002d50: 292c 666c 6f61 7428 666f 6361 6c4c 656e  ),float(focalLen
+00002d60: 6774 6858 595b 315d 295d 0a20 2020 2020  gthXY[1])].     
+00002d70: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00002d80: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
+00002d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002da0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00002db0: 646f 4578 6365 7074 696f 6e28 6974 656d  doException(item
+00002dc0: 2c22 496e 7661 6c69 6420 656e 7472 7920  ,"Invalid entry 
+00002dd0: 666f 7220 2769 6d61 6765 2d63 616d 6572  for 'image-camer
+00002de0: 612d 6361 6c69 6272 6174 696f 6e2d 6d6f  a-calibration-mo
+00002df0: 6465 6c27 5b27 6361 6c69 6272 6174 696f  del'['calibratio
+00002e00: 6e2d 666f 6361 6c2d 6c65 6e67 7468 2d78  n-focal-length-x
+00002e10: 792d 7069 7865 6c27 5d20 3a20 2220 2b20  y-pixel'] : " + 
+00002e20: 7374 7228 666f 6361 6c4c 656e 6774 6858  str(focalLengthX
+00002e30: 5929 2029 0a20 2020 2020 2020 2020 2020  Y) ).           
+00002e40: 200a 2020 2020 2020 2020 2020 2020 7265   .            re
+00002e50: 7475 726e 2066 6f63 616c 4c65 6e67 7468  turn focalLength
+00002e60: 5859 2c20 2250 6172 7365 6420 6672 6f6d  XY, "Parsed from
+00002e70: 2027 696d 6167 652d 6361 6d65 7261 2d63   'image-camera-c
+00002e80: 616c 6962 7261 7469 6f6e 2d6d 6f64 656c  alibration-model
+00002e90: 275b 2763 616c 6962 7261 7469 6f6e 2d66  '['calibration-f
+00002ea0: 6f63 616c 2d6c 656e 6774 682d 7879 2d70  ocal-length-xy-p
+00002eb0: 6978 656c 275d 220a 2020 2020 2020 2020  ixel']".        
+00002ec0: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+00002ed0: 6f45 7863 6570 7469 6f6e 3a0a 2020 2020  oException:.    
+00002ee0: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+00002ef0: 2020 2020 2020 756e 6465 7277 6174 6572        underwater
+00002f00: 496d 6167 6520 3d20 5472 7565 0a20 2020  Image = True.   
+00002f10: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00002f20: 2020 2020 2020 616c 7430 203d 2073 656c        alt0 = sel
+00002f30: 665b 6974 656d 2b27 303a 696d 6167 652d  f[item+'0:image-
+00002f40: 616c 7469 7475 6465 2d6d 6574 6572 7327  altitude-meters'
+00002f50: 5d20 2373 656c 662e 5f5f 6765 7449 7465  ] #self.__getIte
+00002f60: 6d44 6566 6175 6c74 5661 6c75 6528 6974  mDefaultValue(it
+00002f70: 656d 2c20 2769 6d61 6765 2d61 6c74 6974  em, 'image-altit
+00002f80: 7564 652d 6d65 7465 7273 2729 0a20 2020  ude-meters').   
+00002f90: 2020 2020 2020 2020 2069 6620 616c 7430           if alt0
+00002fa0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00002fb0: 2020 2020 2020 756e 6465 7277 6174 6572        underwater
+00002fc0: 496d 6167 6520 3d20 4661 6c73 650a 2020  Image = False.  
+00002fd0: 2020 2020 2020 6578 6365 7074 206d 6971        except miq
+00002fe0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00002ff0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00003000: 7373 0a0a 2020 2020 2020 2020 2320 6164  ss..        # ad
+00003010: 6420 636f 7272 6563 7469 6f6e 2066 6163  d correction fac
+00003020: 746f 7220 666f 7220 666c 6174 2070 6f72  tor for flat por
+00003030: 740a 2020 2020 2020 2020 6966 2064 6f6d  t.        if dom
+00003040: 6550 6f72 7420 6973 204e 6f6e 6520 616e  ePort is None an
+00003050: 6420 756e 6465 7277 6174 6572 496d 6167  d underwaterImag
+00003060: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00003070: 6574 7572 6e20 5b2d 312c 2d31 5d2c 2022  eturn [-1,-1], "
+00003080: 436f 756c 6420 6e6f 7420 6465 7465 726d  Could not determ
+00003090: 696e 6520 666f 6361 6c20 6c65 6e67 7468  ine focal length
+000030a0: 2066 726f 6d20 2769 6d61 6765 2d63 616d   from 'image-cam
+000030b0: 6572 612d 6361 6c69 6272 6174 696f 6e2d  era-calibration-
+000030c0: 6d6f 6465 6c27 5b27 6361 6c69 6272 6174  model'['calibrat
+000030d0: 696f 6e2d 666f 6361 6c2d 6c65 6e67 7468  ion-focal-length
+000030e0: 2d78 792d 7069 7865 6c27 5d20 616e 6420  -xy-pixel'] and 
+000030f0: 706f 7274 2074 7970 652c 2077 6869 6368  port type, which
+00003100: 2069 7320 7265 7175 6972 6564 2066 6f72   is required for
+00003110: 2063 6f72 7265 6374 2065 7661 6c75 6174   correct evaluat
+00003120: 696f 6e20 6f66 2065 7869 6620 7661 6c75  ion of exif valu
+00003130: 6573 2c20 6973 206e 6f74 2070 726f 7669  es, is not provi
+00003140: 6465 6421 220a 2020 2020 2020 2020 636f  ded!".        co
+00003150: 7272 6563 7469 6f6e 466b 7420 3d20 312e  rrectionFkt = 1.
+00003160: 300a 2020 2020 2020 2020 6966 2064 6f6d  0.        if dom
+00003170: 6550 6f72 7420 3d3d 2046 616c 7365 2061  ePort == False a
+00003180: 6e64 2075 6e64 6572 7761 7465 7249 6d61  nd underwaterIma
+00003190: 6765 3a0a 2020 2020 2020 2020 2020 2020  ge:.            
+000031a0: 636f 7272 6563 7469 6f6e 466b 7420 3d20  correctionFkt = 
+000031b0: 312e 3333 0a0a 2020 2020 2020 2020 2320  1.33..        # 
+000031c0: 6f74 6865 7277 6973 6520 7472 7920 6465  otherwise try de
+000031d0: 7269 7665 2066 726f 6d20 6578 6966 2074  rive from exif t
+000031e0: 6167 730a 2020 2020 2020 2020 6578 6966  ags.        exif
+000031f0: 203d 2073 656c 662e 5f5f 6765 7449 7465   = self.__getIte
+00003200: 6d44 6566 6175 6c74 5661 6c75 6528 6974  mDefaultValue(it
+00003210: 656d 2c27 696d 6167 652d 6163 7175 6973  em,'image-acquis
+00003220: 6974 696f 6e2d 7365 7474 696e 6773 2729  ition-settings')
+00003230: 0a20 2020 2020 2020 2023 2320 6672 6f6d  .        ## from
+00003240: 2046 6f63 616c 204c 656e 6774 682c 2046   Focal Length, F
+00003250: 6f63 616c 2050 6c61 6e65 2058 2052 6573  ocal Plane X Res
+00003260: 6f6c 7574 696f 6e2c 2046 6f63 616c 2050  olution, Focal P
+00003270: 6c61 6e65 2059 2052 6573 6f6c 7574 696f  lane Y Resolutio
+00003280: 6e2c 2046 6f63 616c 2050 6c61 6e65 2052  n, Focal Plane R
+00003290: 6573 6f6c 7574 696f 6e20 556e 6974 0a20  esolution Unit. 
+000032a0: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
+000032b0: 7468 5859 2c20 6d73 6720 3d20 7365 6c66  thXY, msg = self
+000032c0: 2e5f 5f74 7279 4465 7465 726d 696e 6546  .__tryDetermineF
+000032d0: 6f63 616c 4c65 6e67 6874 496e 5069 7865  ocalLenghtInPixe
+000032e0: 6c73 4672 6f6d 4578 6966 5f31 2865 7869  lsFromExif_1(exi
+000032f0: 6629 0a20 2020 2020 2020 2069 6620 666f  f).        if fo
+00003300: 6361 6c4c 656e 6774 6858 5920 213d 205b  calLengthXY != [
+00003310: 2d31 2c2d 315d 3a0a 2020 2020 2020 2020  -1,-1]:.        
+00003320: 2020 2020 7265 7475 726e 205b 652a 636f      return [e*co
+00003330: 7272 6563 7469 6f6e 466b 7420 666f 7220  rrectionFkt for 
+00003340: 6520 696e 2066 6f63 616c 4c65 6e67 7468  e in focalLength
+00003350: 5859 5d2c 2027 4465 7269 7665 6420 6672  XY], 'Derived fr
+00003360: 6f6d 2065 7869 6620 7461 6773 2046 6f63  om exif tags Foc
+00003370: 616c 204c 656e 6774 682c 2046 6f63 616c  al Length, Focal
+00003380: 2050 6c61 6e65 2058 2052 6573 6f6c 7574   Plane X Resolut
+00003390: 696f 6e2c 2046 6f63 616c 2050 6c61 6e65  ion, Focal Plane
+000033a0: 2059 2052 6573 6f6c 7574 696f 6e2c 2046   Y Resolution, F
+000033b0: 6f63 616c 2050 6c61 6e65 2052 6573 6f6c  ocal Plane Resol
+000033c0: 7574 696f 6e20 556e 6974 270a 2020 2020  ution Unit'.    
+000033d0: 2020 2020 2323 2066 726f 6d20 6672 6f6d      ## from from
+000033e0: 2033 3520 6d6d 2065 7175 6976 616c 656e   35 mm equivalen
+000033f0: 7420 666f 6361 6c20 6c65 6e67 7468 0a20  t focal length. 
+00003400: 2020 2020 2020 2066 6f63 616c 4c65 6e67         focalLeng
+00003410: 7468 5859 2c20 6d73 6720 3d20 7365 6c66  thXY, msg = self
+00003420: 2e5f 5f74 7279 4465 7465 726d 696e 6546  .__tryDetermineF
+00003430: 6f63 616c 4c65 6e67 6874 496e 5069 7865  ocalLenghtInPixe
+00003440: 6c73 4672 6f6d 4578 6966 5f32 2865 7869  lsFromExif_2(exi
+00003450: 6629 0a20 2020 2020 2020 2069 6620 666f  f).        if fo
+00003460: 6361 6c4c 656e 6774 6858 5920 213d 205b  calLengthXY != [
+00003470: 2d31 2c2d 315d 3a0a 2020 2020 2020 2020  -1,-1]:.        
+00003480: 2020 2020 7265 7475 726e 205b 652a 636f      return [e*co
+00003490: 7272 6563 7469 6f6e 466b 7420 666f 7220  rrectionFkt for 
+000034a0: 6520 696e 2066 6f63 616c 4c65 6e67 7468  e in focalLength
+000034b0: 5859 5d2c 2027 4465 7269 7665 6420 6672  XY], 'Derived fr
+000034c0: 6f6d 2065 7869 6620 7461 6720 466f 6361  om exif tag Foca
+000034d0: 6c20 4c65 6e67 7468 2077 6974 6820 3335  l Length with 35
+000034e0: 206d 6d20 6571 7569 7661 6c65 6e74 270a   mm equivalent'.
+000034f0: 200a 2020 2020 2020 2020 7265 7475 726e   .        return
+00003500: 205b 2d31 2c2d 315d 2c20 2243 6f75 6c64   [-1,-1], "Could
+00003510: 206e 6f74 2064 6574 6572 6d69 6e65 2066   not determine f
+00003520: 726f 6d20 666f 6361 6c20 6c65 6e67 7468  rom focal length
+00003530: 2069 6e20 7069 7865 6c73 2066 726f 6d20   in pixels from 
+00003540: 6e65 6974 6865 7220 2769 6d61 6765 2d63  neither 'image-c
+00003550: 616d 6572 612d 6361 6c69 6272 6174 696f  amera-calibratio
+00003560: 6e2d 6d6f 6465 6c27 5b27 6361 6c69 6272  n-model'['calibr
+00003570: 6174 696f 6e2d 666f 6361 6c2d 6c65 6e67  ation-focal-leng
+00003580: 7468 2d78 792d 7069 7865 6c27 5d20 6e6f  th-xy-pixel'] no
+00003590: 7220 6578 6966 2074 6167 7320 466f 6361  r exif tags Foca
+000035a0: 6c20 4c65 6e67 7468 2c20 466f 6361 6c20  l Length, Focal 
+000035b0: 506c 616e 6520 5820 5265 736f 6c75 7469  Plane X Resoluti
+000035c0: 6f6e 2c20 466f 6361 6c20 506c 616e 6520  on, Focal Plane 
+000035d0: 5920 5265 736f 6c75 7469 6f6e 2c20 466f  Y Resolution, Fo
+000035e0: 6361 6c20 506c 616e 6520 5265 736f 6c75  cal Plane Resolu
+000035f0: 7469 6f6e 2055 6e69 7422 0a0a 0a20 2020  tion Unit"...   
+00003600: 2064 6566 205f 5f74 7279 4465 7465 726d   def __tryDeterm
+00003610: 696e 6546 6f63 616c 4c65 6e67 6874 496e  ineFocalLenghtIn
+00003620: 5069 7865 6c73 4672 6f6d 4578 6966 5f31  PixelsFromExif_1
+00003630: 2873 656c 662c 6578 6966 4469 6374 3a64  (self,exifDict:d
+00003640: 6963 7429 3a0a 2020 2020 2020 2020 2222  ict):.        ""
+00003650: 2220 7472 7920 746f 2064 6574 6572 6d69  " try to determi
+00003660: 6e65 2066 6f63 616c 206c 656e 6774 6820  ne focal length 
+00003670: 696e 2070 6978 656c 7320 6672 6f6d 2065  in pixels from e
+00003680: 7869 6620 7461 6773 2046 6f63 616c 204c  xif tags Focal L
+00003690: 656e 6774 682c 2046 6f63 616c 2050 6c61  ength, Focal Pla
+000036a0: 6e65 2058 2052 6573 6f6c 7574 696f 6e2c  ne X Resolution,
+000036b0: 2046 6f63 616c 2050 6c61 6e65 2059 2052   Focal Plane Y R
+000036c0: 6573 6f6c 7574 696f 6e2c 2046 6f63 616c  esolution, Focal
+000036d0: 2050 6c61 6e65 2052 6573 6f6c 7574 696f   Plane Resolutio
+000036e0: 6e20 556e 6974 2e0a 2020 2020 2020 2020  n Unit..        
+000036f0: 2020 2020 5265 7472 756e 7320 5b66 6f63      Retruns [foc
+00003700: 616c 4c65 6e67 7468 5069 7865 6c73 5f78  alLengthPixels_x
+00003710: 2c66 6f63 616c 4c65 6e67 7468 5069 7865  ,focalLengthPixe
+00003720: 6c73 5f79 5d2c 206d 6573 7361 6765 0a20  ls_y], message. 
+00003730: 2020 2020 2020 2020 2020 2052 6574 7275             Retru
+00003740: 6e73 2066 6f63 616c 4c65 6e67 7468 5069  ns focalLengthPi
+00003750: 7865 6c73 203d 202d 3120 6966 206e 6f74  xels = -1 if not
+00003760: 2073 7563 6365 7373 6675 6c6c 2022 2222   successfull """
+00003770: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+00003780: 2020 2020 2020 2020 2020 2066 6f63 616c             focal
+00003790: 4c65 6e67 7468 203d 2073 7472 2865 7869  Length = str(exi
+000037a0: 6644 6963 745b 2746 6f63 616c 204c 656e  fDict['Focal Len
+000037b0: 6774 6827 5d29 0a20 2020 2020 2020 2020  gth']).         
+000037c0: 2020 2066 6f63 616c 506c 616e 6552 6573     focalPlaneRes
+000037d0: 5f78 203d 2066 6c6f 6174 2873 7472 2865  _x = float(str(e
+000037e0: 7869 6644 6963 745b 2746 6f63 616c 2050  xifDict['Focal P
+000037f0: 6c61 6e65 2058 2052 6573 6f6c 7574 696f  lane X Resolutio
+00003800: 6e27 5d29 2e73 7472 6970 2827 5c27 2729  n']).strip('\'')
+00003810: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+00003820: 6361 6c50 6c61 6e65 5265 735f 7920 3d20  calPlaneRes_y = 
+00003830: 666c 6f61 7428 7374 7228 6578 6966 4469  float(str(exifDi
+00003840: 6374 5b27 466f 6361 6c20 506c 616e 6520  ct['Focal Plane 
+00003850: 5920 5265 736f 6c75 7469 6f6e 275d 292e  Y Resolution']).
+00003860: 7374 7269 7028 275c 2727 2929 0a20 2020  strip('\'')).   
+00003870: 2020 2020 2020 2020 2066 6f63 616c 506c           focalPl
+00003880: 616e 6552 6573 5f75 6e69 7420 3d20 7374  aneRes_unit = st
+00003890: 7228 6578 6966 4469 6374 5b27 466f 6361  r(exifDict['Foca
+000038a0: 6c20 506c 616e 6520 5265 736f 6c75 7469  l Plane Resoluti
+000038b0: 6f6e 2055 6e69 7427 5d29 2e73 7472 6970  on Unit']).strip
+000038c0: 2827 5c27 2729 0a20 2020 2020 2020 2065  ('\'').        e
+000038d0: 7863 6570 7420 284b 6579 4572 726f 722c  xcept (KeyError,
+000038e0: 2056 616c 7565 4572 726f 7229 3a0a 2020   ValueError):.  
+000038f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00003900: 205b 2d31 2c2d 315d 2c20 2243 6f75 6c64   [-1,-1], "Could
+00003910: 206e 6f74 2066 696e 6420 616c 6c20 7265   not find all re
+00003920: 7175 6972 6564 2066 6965 6c64 7320 466f  quired fields Fo
+00003930: 6361 6c20 4c65 6e67 7468 2c20 466f 6361  cal Length, Foca
+00003940: 6c20 506c 616e 6520 5820 5265 736f 6c75  l Plane X Resolu
+00003950: 7469 6f6e 2c20 466f 6361 6c20 506c 616e  tion, Focal Plan
+00003960: 6520 5920 5265 736f 6c75 7469 6f6e 2c20  e Y Resolution, 
+00003970: 466f 6361 6c20 506c 616e 6520 5265 736f  Focal Plane Reso
+00003980: 6c75 7469 6f6e 2055 6e69 7422 0a20 2020  lution Unit".   
+00003990: 2020 2020 200a 2020 2020 2020 2020 2320       .        # 
+000039a0: 7061 7273 6520 666f 6361 6c20 6c65 6e67  parse focal leng
+000039b0: 7468 2066 726f 6d20 6c65 6674 2028 6d61  th from left (ma
+000039c0: 7920 6265 2027 372e 3520 6d6d 2028 2e2e  y be '7.5 mm (..
+000039d0: 2e29 2729 0a20 2020 2020 2020 2066 6f63  .)').        foc
+000039e0: 616c 4c65 6e67 7468 5374 7269 7070 6564  alLengthStripped
+000039f0: 203d 2066 6f63 616c 4c65 6e67 7468 2e73   = focalLength.s
+00003a00: 7472 6970 2829 0a20 2020 2020 2020 2066  trip().        f
+00003a10: 6f63 616c 4c65 6e67 7468 466c 6f61 7420  ocalLengthFloat 
+00003a20: 3d20 4e6f 6e65 0a20 2020 2020 2020 2066  = None.        f
+00003a30: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+00003a40: 6e28 666f 6361 6c4c 656e 6774 6853 7472  n(focalLengthStr
+00003a50: 6970 7065 6429 293a 0a20 2020 2020 2020  ipped)):.       
+00003a60: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00003a70: 2020 2020 2020 2020 2020 666f 6361 6c4c            focalL
+00003a80: 656e 6774 6846 6c6f 6174 203d 2066 6c6f  engthFloat = flo
+00003a90: 6174 2866 6f63 616c 4c65 6e67 7468 5374  at(focalLengthSt
+00003aa0: 7269 7070 6564 5b30 3a69 2b31 5d29 0a20  ripped[0:i+1]). 
+00003ab0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00003ac0: 7420 5661 6c75 6545 7272 6f72 3a0a 2020  t ValueError:.  
+00003ad0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00003ae0: 7373 0a20 2020 2020 2020 2069 6620 666f  ss.        if fo
+00003af0: 6361 6c4c 656e 6774 6846 6c6f 6174 2069  calLengthFloat i
+00003b00: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003b10: 2020 2020 7265 7475 726e 205b 2d31 2c2d      return [-1,-
+00003b20: 315d 2c20 2243 6f75 6c64 206e 6f74 2070  1], "Could not p
+00003b30: 6172 7365 2066 6f72 6361 6c20 6c65 6e67  arse forcal leng
+00003b40: 7468 2066 726f 6d20 2746 6f63 616c 204c  th from 'Focal L
+00003b50: 656e 6774 6827 3a20 2220 2b20 666f 6361  ength': " + foca
+00003b60: 6c4c 656e 6774 680a 2020 2020 2020 2020  lLength.        
+00003b70: 7363 616c 6546 6b74 5f66 6f63 616c 203d  scaleFkt_focal =
+00003b80: 2073 656c 662e 5f5f 756e 6974 436f 6e76   self.__unitConv
+00003b90: 6572 7369 6f6e 4661 6374 326d 6d28 666f  ersionFact2mm(fo
+00003ba0: 6361 6c4c 656e 6774 6829 0a20 2020 2020  calLength).     
+00003bb0: 2020 2069 6620 7363 616c 6546 6b74 5f66     if scaleFkt_f
+00003bc0: 6f63 616c 203d 3d20 2d31 3a0a 2020 2020  ocal == -1:.    
+00003bd0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00003be0: 2d31 2c2d 315d 2c20 2243 6f75 6c64 206e  -1,-1], "Could n
+00003bf0: 6f74 2070 6172 7365 2066 6f72 6361 6c20  ot parse forcal 
+00003c00: 6c65 6e67 7468 2075 6e69 7420 6672 6f6d  length unit from
+00003c10: 2027 466f 6361 6c20 4c65 6e67 7468 273a   'Focal Length':
+00003c20: 2022 202b 2066 6f63 616c 4c65 6e67 7468   " + focalLength
+00003c30: 0a20 2020 2020 2020 2066 6f63 616c 4c65  .        focalLe
+00003c40: 6e67 7468 5f6d 6d20 3d20 666f 6361 6c4c  ngth_mm = focalL
+00003c50: 656e 6774 6846 6c6f 6174 202a 2073 6361  engthFloat * sca
+00003c60: 6c65 466b 745f 666f 6361 6c0a 0a20 2020  leFkt_focal..   
+00003c70: 2020 2020 2073 6361 6c65 466b 745f 7265       scaleFkt_re
+00003c80: 7320 3d20 7365 6c66 2e5f 5f75 6e69 7443  s = self.__unitC
+00003c90: 6f6e 7665 7273 696f 6e46 6163 7432 6d6d  onversionFact2mm
+00003ca0: 2866 6f63 616c 506c 616e 6552 6573 5f75  (focalPlaneRes_u
+00003cb0: 6e69 7429 0a20 2020 2020 2020 2069 6620  nit).        if 
+00003cc0: 7363 616c 6546 6b74 5f72 6573 203d 3d20  scaleFkt_res == 
+00003cd0: 2d31 3a0a 2020 2020 2020 2020 2020 2020  -1:.            
+00003ce0: 7265 7475 726e 205b 2d31 2c2d 315d 2c20  return [-1,-1], 
+00003cf0: 2243 6f75 6c64 206e 6f74 2070 6172 7365  "Could not parse
+00003d00: 2046 6f63 616c 2050 6c61 6e65 2052 6573   Focal Plane Res
+00003d10: 6f6c 7574 696f 6e20 556e 6974 2066 726f  olution Unit fro
+00003d20: 6d20 2746 6f63 616c 2050 6c61 6e65 2052  m 'Focal Plane R
+00003d30: 6573 6f6c 7574 696f 6e20 556e 6974 273a  esolution Unit':
+00003d40: 2022 202b 2066 6f63 616c 506c 616e 6552   " + focalPlaneR
+00003d50: 6573 5f75 6e69 740a 0a20 2020 2020 2020  es_unit..       
+00003d60: 2066 6f63 616c 4c65 6e67 7468 5069 7865   focalLengthPixe
+00003d70: 6c73 5f78 203d 2066 6f63 616c 4c65 6e67  ls_x = focalLeng
+00003d80: 7468 5f6d 6d20 2a20 666f 6361 6c50 6c61  th_mm * focalPla
+00003d90: 6e65 5265 735f 7820 2f20 7363 616c 6546  neRes_x / scaleF
+00003da0: 6b74 5f72 6573 0a20 2020 2020 2020 2066  kt_res.        f
+00003db0: 6f63 616c 4c65 6e67 7468 5069 7865 6c73  ocalLengthPixels
+00003dc0: 5f79 203d 2066 6f63 616c 4c65 6e67 7468  _y = focalLength
+00003dd0: 5f6d 6d20 2a20 666f 6361 6c50 6c61 6e65  _mm * focalPlane
+00003de0: 5265 735f 7920 2f20 7363 616c 6546 6b74  Res_y / scaleFkt
+00003df0: 5f72 6573 0a0a 2020 2020 2020 2020 7265  _res..        re
+00003e00: 7475 726e 205b 666f 6361 6c4c 656e 6774  turn [focalLengt
+00003e10: 6850 6978 656c 735f 782c 666f 6361 6c4c  hPixels_x,focalL
+00003e20: 656e 6774 6850 6978 656c 735f 795d 2c20  engthPixels_y], 
+00003e30: 2222 0a0a 0a20 2020 2064 6566 205f 5f74  ""...    def __t
+00003e40: 7279 4465 7465 726d 696e 6546 6f63 616c  ryDetermineFocal
+00003e50: 4c65 6e67 6874 496e 5069 7865 6c73 4672  LenghtInPixelsFr
+00003e60: 6f6d 4578 6966 5f32 2873 656c 662c 6578  omExif_2(self,ex
+00003e70: 6966 4469 6374 3a64 6963 7429 3a0a 2020  ifDict:dict):.  
+00003e80: 2020 2020 2020 2222 2220 7472 7920 746f        """ try to
+00003e90: 2064 6574 6572 6d69 6e65 2066 6f63 616c   determine focal
+00003ea0: 206c 656e 6774 6820 696e 2070 6978 656c   length in pixel
+00003eb0: 7320 6672 6f6d 2033 3520 6d6d 2065 7175  s from 35 mm equ
+00003ec0: 6976 616c 656e 7420 666f 6361 6c20 6c65  ivalent focal le
+00003ed0: 6e67 7468 2069 6e20 6578 6966 2074 6167  ngth in exif tag
+00003ee0: 2046 6f63 616c 204c 656e 6774 6827 7320   Focal Length's 
+00003ef0: 6164 6420 6f6e 2065 2e67 2e20 2737 2e30  add on e.g. '7.0
+00003f00: 206d 6d20 2833 3520 6d6d 2065 7175 6976   mm (35 mm equiv
+00003f10: 616c 656e 743a 2033 382e 3820 6d6d 2927  alent: 38.8 mm)'
+00003f20: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
+00003f30: 7472 756e 7320 5b66 6f63 616c 4c65 6e67  truns [focalLeng
+00003f40: 7468 5069 7865 6c73 5f78 2c66 6f63 616c  thPixels_x,focal
+00003f50: 4c65 6e67 7468 5069 7865 6c73 5f79 5d2c  LengthPixels_y],
+00003f60: 206d 6573 7361 6765 0a20 2020 2020 2020   message.       
+00003f70: 2020 2020 2052 6574 7275 6e73 2066 6f63       Retruns foc
+00003f80: 616c 4c65 6e67 7468 5069 7865 6c73 203d  alLengthPixels =
+00003f90: 202d 3120 6966 206e 6f74 2073 7563 6365   -1 if not succe
+00003fa0: 7373 6675 6c6c 2022 2222 0a0a 2020 2020  ssfull """..    
+00003fb0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00003fc0: 2020 2020 2066 6f63 616c 4c65 6e67 7468       focalLength
+00003fd0: 203d 2073 7472 2865 7869 6644 6963 745b   = str(exifDict[
+00003fe0: 2746 6f63 616c 204c 656e 6774 6827 5d29  'Focal Length'])
+00003ff0: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+00004000: 6765 5769 6474 6820 3d20 696e 7428 7374  geWidth = int(st
+00004010: 7228 6578 6966 4469 6374 5b27 496d 6167  r(exifDict['Imag
+00004020: 6520 5769 6474 6827 5d29 2e73 7472 6970  e Width']).strip
+00004030: 2827 5c27 2729 290a 2020 2020 2020 2020  ('\'')).        
+00004040: 6578 6365 7074 2028 4b65 7945 7272 6f72  except (KeyError
+00004050: 2c20 5661 6c75 6545 7272 6f72 293a 0a20  , ValueError):. 
+00004060: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004070: 6e20 5b2d 312c 2d31 5d2c 2022 436f 756c  n [-1,-1], "Coul
+00004080: 6420 6e6f 7420 6669 6e64 2061 6c6c 2072  d not find all r
+00004090: 6571 7569 7265 6420 6669 656c 6473 2046  equired fields F
+000040a0: 6f63 616c 204c 656e 6774 682c 2049 6d61  ocal Length, Ima
+000040b0: 6765 2057 6964 7468 220a 0a20 2020 2020  ge Width"..     
+000040c0: 2020 2023 2074 7279 2070 6172 7365 2033     # try parse 3
+000040d0: 3520 6d6d 2065 7175 6976 616c 656e 7420  5 mm equivalent 
+000040e0: 6672 6f6d 2065 2e67 2e3a 2020 372e 3020  from e.g.:  7.0 
+000040f0: 6d6d 2028 3335 206d 6d20 6571 7569 7661  mm (35 mm equiva
+00004100: 6c65 6e74 3a20 3338 2e38 206d 6d29 0a20  lent: 38.8 mm). 
+00004110: 2020 2020 2020 2063 6f6c 6f6e 496e 6465         colonInde
+00004120: 7820 3d20 666f 6361 6c4c 656e 6774 682e  x = focalLength.
+00004130: 6669 6e64 2827 3a27 290a 2020 2020 2020  find(':').      
+00004140: 2020 6966 2063 6f6c 6f6e 496e 6465 7820    if colonIndex 
+00004150: 3d3d 202d 313a 0a20 2020 2020 2020 2020  == -1:.         
+00004160: 2020 2072 6574 7572 6e20 5b2d 312c 2d31     return [-1,-1
+00004170: 5d2c 2022 436f 756c 6420 6e6f 7420 7061  ], "Could not pa
+00004180: 7273 6520 3335 206d 6d20 6571 7569 7661  rse 35 mm equiva
+00004190: 6c65 6e74 2066 6f63 616c 206c 656e 6774  lent focal lengt
+000041a0: 6820 6672 6f6d 2027 466f 6361 6c20 4c65  h from 'Focal Le
+000041b0: 6e67 7468 273a 2022 202b 2066 6f63 616c  ngth': " + focal
+000041c0: 4c65 6e67 7468 0a20 2020 2020 2020 2066  Length.        f
+000041d0: 6f63 616c 4c65 6e67 7468 4571 3335 6d6d  ocalLengthEq35mm
+000041e0: 466c 6f61 7420 3d20 4e6f 6e65 0a20 2020  Float = None.   
+000041f0: 2020 2020 2065 7175 616c 3335 6d6d 5061       equal35mmPa
+00004200: 7274 203d 2066 6f63 616c 4c65 6e67 7468  rt = focalLength
+00004210: 5b63 6f6c 6f6e 496e 6465 782b 313a 3a5d  [colonIndex+1::]
+00004220: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+00004230: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00004240: 6c65 6e28 6571 7561 6c33 356d 6d50 6172  len(equal35mmPar
+00004250: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
+00004260: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00004270: 2020 2020 2020 666f 6361 6c4c 656e 6774        focalLengt
+00004280: 6845 7133 356d 6d46 6c6f 6174 203d 2066  hEq35mmFloat = f
+00004290: 6c6f 6174 2865 7175 616c 3335 6d6d 5061  loat(equal35mmPa
+000042a0: 7274 5b30 3a69 2b31 5d29 0a20 2020 2020  rt[0:i+1]).     
+000042b0: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
+000042c0: 6c75 6545 7272 6f72 3a0a 2020 2020 2020  lueError:.      
+000042d0: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+000042e0: 2020 2020 2020 2073 6361 6c65 466b 7420         scaleFkt 
+000042f0: 3d20 7365 6c66 2e5f 5f75 6e69 7443 6f6e  = self.__unitCon
+00004300: 7665 7273 696f 6e46 6163 7432 6d6d 2866  versionFact2mm(f
+00004310: 6f63 616c 4c65 6e67 7468 5b63 6f6c 6f6e  ocalLength[colon
+00004320: 496e 6465 782b 313a 3a5d 290a 2020 2020  Index+1::]).    
+00004330: 2020 2020 6966 2066 6f63 616c 4c65 6e67      if focalLeng
+00004340: 7468 4571 3335 6d6d 466c 6f61 7420 6973  thEq35mmFloat is
+00004350: 204e 6f6e 6520 6f72 2073 6361 6c65 466b   None or scaleFk
+00004360: 7420 3d3d 202d 313a 0a20 2020 2020 2020  t == -1:.       
+00004370: 2020 2020 2072 6574 7572 6e20 5b2d 312c       return [-1,
+00004380: 2d31 5d2c 2022 436f 756c 6420 6e6f 7420  -1], "Could not 
+00004390: 7061 7273 6520 3335 206d 6d20 6571 7569  parse 35 mm equi
+000043a0: 7661 6c65 6e74 2066 6f63 616c 206c 656e  valent focal len
+000043b0: 6774 6820 6672 6f6d 2027 466f 6361 6c20  gth from 'Focal 
+000043c0: 4c65 6e67 7468 273a 2022 202b 2066 6f63  Length': " + foc
+000043d0: 616c 4c65 6e67 7468 0a20 2020 2020 2020  alLength.       
+000043e0: 200a 2020 2020 2020 2020 666f 6361 6c4c   .        focalL
+000043f0: 656e 6774 6850 6978 656c 7320 3d20 666f  engthPixels = fo
+00004400: 6361 6c4c 656e 6774 6845 7133 356d 6d46  calLengthEq35mmF
+00004410: 6c6f 6174 202a 2073 6361 6c65 466b 7420  loat * scaleFkt 
+00004420: 2a20 696d 6167 6557 6964 7468 202f 2033  * imageWidth / 3
+00004430: 362e 300a 2020 2020 2020 2020 7265 7475  6.0.        retu
+00004440: 726e 205b 666f 6361 6c4c 656e 6774 6850  rn [focalLengthP
+00004450: 6978 656c 732c 666f 6361 6c4c 656e 6774  ixels,focalLengt
+00004460: 6850 6978 656c 735d 2c20 2222 0a0a 0a20  hPixels], ""... 
+00004470: 2020 2064 6566 205f 5f75 6e69 7443 6f6e     def __unitCon
+00004480: 7665 7273 696f 6e46 6163 7432 6d6d 2873  versionFact2mm(s
+00004490: 656c 662c 756e 6974 3a73 7472 293a 0a20  elf,unit:str):. 
+000044a0: 2020 2020 2020 2022 2222 206c 6f6f 6b73         """ looks
+000044b0: 2066 6f72 206c 6574 7465 7220 7365 7175   for letter sequ
+000044c0: 656e 6365 2069 6e20 756e 6974 2061 6e64  ence in unit and
+000044d0: 2063 6865 636b 7320 6966 2069 7427 7320   checks if it's 
+000044e0: 2769 6e63 6865 7327 2c27 6d27 2c27 636d  'inches','m','cm
+000044f0: 272c 276d 6d27 2c27 756d 2720 6f72 2027  ','mm','um' or '
+00004500: 2720 616e 6420 7265 7475 726e 7320 7265  ' and returns re
+00004510: 7370 6563 7469 7665 2063 6f6e 7665 7273  spective convers
+00004520: 696f 6e20 6661 6374 6f72 2074 6f20 6d6d  ion factor to mm
+00004530: 2028 6966 2074 6865 7265 2061 7265 206e   (if there are n
+00004540: 6f20 6c65 7474 6572 7320 6974 2072 6574  o letters it ret
+00004550: 7572 6e73 2031 292e 204f 7468 6572 7769  urns 1). Otherwi
+00004560: 7365 2072 6574 7572 6e20 2d31 2022 2222  se return -1 """
+00004570: 0a0a 2020 2020 2020 2020 6669 7273 744c  ..        firstL
+00004580: 6574 7465 7253 6571 203d 2022 220a 2020  etterSeq = "".  
+00004590: 2020 2020 2020 6669 7273 7446 6f75 6e64        firstFound
+000045a0: 203d 2046 616c 7365 0a20 2020 2020 2020   = False.       
+000045b0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+000045c0: 6c65 6e28 756e 6974 2929 3a0a 2020 2020  len(unit)):.    
+000045d0: 2020 2020 2020 2020 6966 2075 6e69 745b          if unit[
+000045e0: 695d 2e69 7361 6c70 6861 2829 3a0a 2020  i].isalpha():.  
+000045f0: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00004600: 7273 7446 6f75 6e64 203d 2054 7275 650a  rstFound = True.
+00004610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004620: 6669 7273 744c 6574 7465 7253 6571 202b  firstLetterSeq +
+00004630: 3d20 756e 6974 5b69 5d0a 2020 2020 2020  = unit[i].      
+00004640: 2020 2020 2020 6966 206e 6f74 2075 6e69        if not uni
+00004650: 745b 695d 2e69 7361 6c70 6861 2829 2061  t[i].isalpha() a
+00004660: 6e64 2066 6972 7374 466f 756e 6420 3d3d  nd firstFound ==
+00004670: 2054 7275 653a 0a20 2020 2020 2020 2020   True:.         
+00004680: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+00004690: 2020 2020 2020 6966 2066 6972 7374 4c65        if firstLe
+000046a0: 7474 6572 5365 712e 6c6f 7765 7228 2920  tterSeq.lower() 
+000046b0: 3d3d 2022 696e 6368 6573 223a 0a20 2020  == "inches":.   
+000046c0: 2020 2020 2020 2020 2073 6361 6c65 466b           scaleFk
+000046d0: 7420 3d20 3235 2e34 0a20 2020 2020 2020  t = 25.4.       
+000046e0: 2065 6c69 6620 6669 7273 744c 6574 7465   elif firstLette
+000046f0: 7253 6571 2e6c 6f77 6572 2829 203d 3d20  rSeq.lower() == 
+00004700: 226d 223a 0a20 2020 2020 2020 2020 2020  "m":.           
+00004710: 2073 6361 6c65 466b 7420 3d20 3130 3030   scaleFkt = 1000
+00004720: 2e30 3b0a 2020 2020 2020 2020 656c 6966  .0;.        elif
+00004730: 2066 6972 7374 4c65 7474 6572 5365 712e   firstLetterSeq.
+00004740: 6c6f 7765 7228 2920 3d3d 2022 636d 223a  lower() == "cm":
+00004750: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
+00004760: 6c65 466b 7420 3d20 3130 2e30 3b0a 2020  leFkt = 10.0;.  
+00004770: 2020 2020 2020 656c 6966 2066 6972 7374        elif first
+00004780: 4c65 7474 6572 5365 712e 6c6f 7765 7228  LetterSeq.lower(
+00004790: 2920 3d3d 2022 6d6d 223a 0a20 2020 2020  ) == "mm":.     
+000047a0: 2020 2020 2020 2073 6361 6c65 466b 7420         scaleFkt 
+000047b0: 3d20 312e 303b 0a20 2020 2020 2020 2065  = 1.0;.        e
+000047c0: 6c69 6620 6669 7273 744c 6574 7465 7253  lif firstLetterS
+000047d0: 6571 2e6c 6f77 6572 2829 203d 3d20 2275  eq.lower() == "u
+000047e0: 6d22 3a0a 2020 2020 2020 2020 2020 2020  m":.            
+000047f0: 7363 616c 6546 6b74 203d 2031 2f31 3030  scaleFkt = 1/100
+00004800: 303b 0a20 2020 2020 2020 2065 6c69 6620  0;.        elif 
+00004810: 6669 7273 744c 6574 7465 7253 6571 2e6c  firstLetterSeq.l
+00004820: 6f77 6572 2829 203d 3d20 2222 3a0a 2020  ower() == "":.  
+00004830: 2020 2020 2020 2020 2020 7363 616c 6546            scaleF
+00004840: 6b74 203d 2031 3b0a 2020 2020 2020 2020  kt = 1;.        
+00004850: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00004860: 2020 7363 616c 6546 6b74 203d 202d 310a    scaleFkt = -1.
+00004870: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00004880: 7363 616c 6546 6b74 0a0a 0a20 2020 2064  scaleFkt...    d
+00004890: 6566 205f 5f67 6574 4974 656d 4465 6661  ef __getItemDefa
+000048a0: 756c 7456 616c 7565 2873 656c 662c 6974  ultValue(self,it
+000048b0: 656d 3a73 7472 2c66 6965 6c64 4e61 6d65  em:str,fieldName
+000048c0: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+000048d0: 2222 2072 6574 7572 6e73 2069 7465 6d20  "" returns item 
+000048e0: 7661 6c75 6573 2028 6669 7273 7420 656e  values (first en
+000048f0: 7472 7920 696e 2063 6173 6520 6f66 2076  try in case of v
+00004900: 6964 656f 7329 2e20 5468 726f 7773 206d  ideos). Throws m
+00004910: 6172 6971 742e 636f 7265 2e49 6664 6f45  ariqt.core.IfdoE
+00004920: 7863 6570 7469 6f6e 2069 6620 6669 656c  xception if fiel
+00004930: 6420 6e6f 7420 666f 756e 642e 2022 2222  d not found. """
+00004940: 0a0a 2020 2020 2020 2020 7265 7420 3d20  ..        ret = 
+00004950: 7365 6c66 5b22 3a22 2e6a 6f69 6e28 5b69  self[":".join([i
+00004960: 7465 6d2c 2730 272c 6669 656c 644e 616d  tem,'0',fieldNam
+00004970: 655d 295d 0a20 2020 2020 2020 2069 6620  e])].        if 
+00004980: 7265 7420 3d3d 2022 223a 0a20 2020 2020  ret == "":.     
+00004990: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+000049a0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+000049b0: 2245 7272 6f72 3a20 4669 656c 6420 7b30  "Error: Field {0
+000049c0: 7d20 6e65 6974 6865 7220 666f 756e 6420  } neither found 
+000049d0: 696e 2069 7465 6d20 7b31 7d20 6e6f 7220  in item {1} nor 
+000049e0: 6865 6164 6572 222e 666f 726d 6174 2866  header".format(f
+000049f0: 6965 6c64 4e61 6d65 2c69 7465 6d29 290a  ieldName,item)).
+00004a00: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00004a10: 6574 0a0a 0a20 2020 2064 6566 205f 5f67  et...    def __g
+00004a20: 6574 4974 656d 4c61 744c 6f6e 2873 656c  etItemLatLon(sel
+00004a30: 662c 6974 656d 3a73 7472 2c68 6561 6465  f,item:str,heade
+00004a40: 7256 616c 4c61 742c 6865 6164 6572 5661  rValLat,headerVa
+00004a50: 6c4c 6f6e 293a 0a20 2020 2020 2020 2022  lLon):.        "
+00004a60: 2222 2072 6574 7572 6e73 207b 276c 6174  "" returns {'lat
+00004a70: 273a 2076 616c 7565 2c20 276c 6f6e 273a  ': value, 'lon':
+00004a80: 2076 616c 7565 2c20 2764 6174 6574 696d   value, 'datetim
+00004a90: 6527 3a20 7661 6c75 657d 206f 6620 6c69  e': value} of li
+00004aa0: 7374 206f 6620 7468 6f73 6520 2222 220a  st of those """.
+00004ab0: 0a20 2020 2020 2020 2069 7465 6d56 616c  .        itemVal
+00004ac0: 203d 2073 656c 662e 6966 646f 5b6d 6971   = self.ifdo[miq
+00004ad0: 7476 2e69 6d61 6765 5f73 6574 5f69 7465  tv.image_set_ite
+00004ae0: 6d73 5f6b 6579 5d5b 6974 656d 5d0a 2020  ms_key][item].  
+00004af0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+00004b00: 6e73 7461 6e63 6528 6974 656d 5661 6c2c  nstance(itemVal,
+00004b10: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00004b20: 2020 2072 6574 203d 2073 656c 662e 5f5f     ret = self.__
+00004b30: 7061 7273 6532 4c61 744c 6f6e 4469 6374  parse2LatLonDict
+00004b40: 2869 7465 6d56 616c 2c68 6561 6465 7256  (itemVal,headerV
+00004b50: 616c 4c61 742c 6865 6164 6572 5661 6c4c  alLat,headerValL
+00004b60: 6f6e 290a 2020 2020 2020 2020 656c 7365  on).        else
+00004b70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00004b80: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
+00004b90: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00004ba0: 2020 2020 2020 2020 6974 656d 4c61 7444          itemLatD
+00004bb0: 6566 6175 6c74 203d 2069 7465 6d56 616c  efault = itemVal
+00004bc0: 5b30 5d5b 2769 6d61 6765 2d6c 6174 6974  [0]['image-latit
+00004bd0: 7564 6527 5d0a 2020 2020 2020 2020 2020  ude'].          
+00004be0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00004bf0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00004c00: 2020 2069 7465 6d4c 6174 4465 6661 756c     itemLatDefaul
+00004c10: 7420 3d20 6865 6164 6572 5661 6c4c 6174  t = headerValLat
+00004c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004c30: 2023 6966 2069 7465 6d4c 6174 4465 6661   #if itemLatDefa
+00004c40: 756c 7420 6973 204e 6f6e 653a 0a20 2020  ult is None:.   
+00004c50: 2020 2020 2020 2020 2020 2020 2023 2020               #  
+00004c60: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+00004c70: 6e28 2245 7272 6f72 3a20 4669 656c 6420  n("Error: Field 
+00004c80: 7b30 7d20 6e65 6974 6865 7220 666f 756e  {0} neither foun
+00004c90: 6420 696e 2069 7465 6d20 7b31 7d20 6e6f  d in item {1} no
+00004ca0: 7220 6865 6164 6572 222e 666f 726d 6174  r header".format
+00004cb0: 2827 696d 6167 652d 6c61 7469 7475 6465  ('image-latitude
+00004cc0: 272c 6974 656d 2929 0a0a 2020 2020 2020  ',item))..      
+00004cd0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00004ce0: 2020 2020 2020 2020 2020 2069 7465 6d4c             itemL
+00004cf0: 6f6e 4465 6661 756c 7420 3d20 6974 656d  onDefault = item
+00004d00: 5661 6c5b 305d 5b27 696d 6167 652d 6c6f  Val[0]['image-lo
+00004d10: 6e67 6974 7564 6527 5d0a 2020 2020 2020  ngitude'].      
+00004d20: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00004d30: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
+00004d40: 2020 2020 2020 2069 7465 6d4c 6f6e 4465         itemLonDe
+00004d50: 6661 756c 7420 3d20 6865 6164 6572 5661  fault = headerVa
+00004d60: 6c4c 6f6e 0a20 2020 2020 2020 2020 2020  lLon.           
+00004d70: 2020 2020 2023 6966 2069 7465 6d4c 6f6e       #if itemLon
+00004d80: 4465 6661 756c 7420 6973 204e 6f6e 653a  Default is None:
+00004d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004da0: 2023 2020 2020 7261 6973 6520 4578 6365   #    raise Exce
+00004db0: 7074 696f 6e28 2245 7272 6f72 3a20 4669  ption("Error: Fi
+00004dc0: 656c 6420 7b30 7d20 6e65 6974 6865 7220  eld {0} neither 
+00004dd0: 666f 756e 6420 696e 2069 7465 6d20 7b31  found in item {1
+00004de0: 7d20 6e6f 7220 6865 6164 6572 222e 666f  } nor header".fo
+00004df0: 726d 6174 2827 696d 6167 652d 6c61 7469  rmat('image-lati
+00004e00: 7475 6465 272c 6974 656d 2929 0a0a 2020  tude',item))..  
+00004e10: 2020 2020 2020 2020 2020 666f 7220 7375            for su
+00004e20: 6245 6e74 7279 2069 6e20 6974 656d 5661  bEntry in itemVa
+00004e30: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
+00004e40: 2020 2072 6574 2e61 7070 656e 6428 7365     ret.append(se
+00004e50: 6c66 2e5f 5f70 6172 7365 324c 6174 4c6f  lf.__parse2LatLo
+00004e60: 6e44 6963 7428 7375 6245 6e74 7279 2c69  nDict(subEntry,i
+00004e70: 7465 6d4c 6174 4465 6661 756c 742c 6974  temLatDefault,it
+00004e80: 656d 4c6f 6e44 6566 6175 6c74 2929 0a0a  emLonDefault))..
+00004e90: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00004ea0: 6574 0a20 2020 2020 2020 2020 2020 200a  et.            .
+00004eb0: 0a20 2020 2064 6566 205f 5f70 6172 7365  .    def __parse
+00004ec0: 324c 6174 4c6f 6e44 6963 7428 7365 6c66  2LatLonDict(self
+00004ed0: 2c69 7465 6d56 616c 2c68 6561 6465 7256  ,itemVal,headerV
+00004ee0: 616c 4c61 742c 6865 6164 6572 5661 6c4c  alLat,headerValL
+00004ef0: 6f6e 293a 0a20 2020 2020 2020 2022 2222  on):.        """
+00004f00: 2072 6574 7572 6e73 207b 276c 6174 273a   returns {'lat':
+00004f10: 6c61 742c 276c 6f6e 273a 6c6f 6e2c 2764  lat,'lon':lon,'d
+00004f20: 6174 6574 696d 6527 3a64 6174 6574 696d  atetime':datetim
+00004f30: 657d 2022 2222 0a20 2020 2020 2020 2064  e} """.        d
+00004f40: 6174 6574 696d 6520 3d20 6974 656d 5661  atetime = itemVa
+00004f50: 6c5b 2769 6d61 6765 2d64 6174 6574 696d  l['image-datetim
+00004f60: 6527 5d0a 2020 2020 2020 2020 7472 793a  e'].        try:
+00004f70: 0a20 2020 2020 2020 2020 2020 206c 6174  .            lat
+00004f80: 203d 2069 7465 6d56 616c 5b27 696d 6167   = itemVal['imag
+00004f90: 652d 6c61 7469 7475 6465 275d 0a20 2020  e-latitude'].   
+00004fa0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00004fb0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00004fc0: 2020 6c61 7420 3d20 6865 6164 6572 5661    lat = headerVa
+00004fd0: 6c4c 6174 0a20 2020 2020 2020 2020 2020  lLat.           
+00004fe0: 2069 6620 6c61 7420 6973 204e 6f6e 653a   if lat is None:
+00004ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005000: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00005010: 2822 4572 726f 723a 2046 6965 6c64 207b  ("Error: Field {
+00005020: 307d 206e 6569 7468 6572 2066 6f75 6e64  0} neither found
+00005030: 2069 6e20 6974 656d 207b 317d 206e 6f72   in item {1} nor
+00005040: 2068 6561 6465 7222 2e66 6f72 6d61 7428   header".format(
+00005050: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
+00005060: 2c69 7465 6d56 616c 2929 0a20 2020 2020  ,itemVal)).     
+00005070: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+00005080: 2020 2020 6c6f 6e20 3d20 6974 656d 5661      lon = itemVa
+00005090: 6c5b 2769 6d61 6765 2d6c 6f6e 6769 7475  l['image-longitu
+000050a0: 6465 275d 0a20 2020 2020 2020 2065 7863  de'].        exc
+000050b0: 6570 7420 4b65 7945 7272 6f72 3a0a 2020  ept KeyError:.  
+000050c0: 2020 2020 2020 2020 2020 6c6f 6e20 3d20            lon = 
+000050d0: 6865 6164 6572 5661 6c4c 6f6e 0a20 2020  headerValLon.   
+000050e0: 2020 2020 2020 2020 2069 6620 6c6f 6e20           if lon 
+000050f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00005100: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
+00005110: 7863 6570 7469 6f6e 2822 4572 726f 723a  xception("Error:
+00005120: 2046 6965 6c64 207b 307d 206e 6569 7468   Field {0} neith
+00005130: 6572 2066 6f75 6e64 2069 6e20 6974 656d  er found in item
+00005140: 207b 317d 206e 6f72 2068 6561 6465 7222   {1} nor header"
+00005150: 2e66 6f72 6d61 7428 2769 6d61 6765 2d6c  .format('image-l
+00005160: 6f6e 6769 7475 6465 272c 6974 656d 5661  ongitude',itemVa
+00005170: 6c29 290a 2020 2020 2020 2020 7265 7475  l)).        retu
+00005180: 726e 207b 276c 6174 273a 6c61 742c 276c  rn {'lat':lat,'l
+00005190: 6f6e 273a 6c6f 6e2c 2764 6174 6574 696d  on':lon,'datetim
+000051a0: 6527 3a64 6174 6574 696d 657d 0a0a 0a64  e':datetime}...d
+000051b0: 6566 2069 4644 4f46 726f 6d46 696c 6528  ef iFDOFromFile(
+000051c0: 6946 444f 6669 6c65 3a73 7472 2c68 616e  iFDOfile:str,han
+000051d0: 646c 655f 7072 6566 6978 3d27 3230 2e35  dle_prefix='20.5
+000051e0: 3030 2e31 3230 3835 272c 7072 6f76 656e  00.12085',proven
+000051f0: 616e 6365 203d 204e 6f6e 652c 7665 7262  ance = None,verb
+00005200: 6f73 653d 5472 7565 2c69 676e 6f72 655f  ose=True,ignore_
+00005210: 696d 6167 655f 6669 6c65 733d 4661 6c73  image_files=Fals
+00005220: 652c 7772 6974 6554 6d70 5072 6f76 4669  e,writeTmpProvFi
+00005230: 6c65 3d54 7275 652c 696d 6167 655f 6272  le=True,image_br
+00005240: 6f6b 6572 5f75 7569 643d 2265 6532 3737  oker_uuid="ee277
+00005250: 3537 382d 6139 3131 2d34 3834 642d 6135  578-a911-484d-a5
+00005260: 3135 2d39 6337 3831 6437 3961 6139 3122  15-9c781d79aa91"
+00005270: 293a 0a20 2020 2022 2222 2043 6f6e 7665  ):.    """ Conve
+00005280: 6e69 656e 6365 2066 756e 6374 696f 6e20  nience function 
+00005290: 746f 2063 7265 6174 6520 616e 2069 4644  to create an iFD
+000052a0: 4f20 6f62 6a65 6374 2064 6972 6563 746c  O object directl
+000052b0: 7920 666f 726d 2061 6e20 6578 6973 7469  y form an existi
+000052c0: 6e67 2069 4644 4f20 6669 6c65 2e20 5472  ng iFDO file. Tr
+000052d0: 6965 7320 746f 2069 6e66 6572 2069 6d61  ies to infer ima
+000052e0: 6765 2066 696c 6573 206c 6f63 6174 696f  ge files locatio
+000052f0: 6e20 6672 6f6d 2027 696d 6167 652d 7365  n from 'image-se
+00005300: 742d 6c6f 6361 6c2d 7061 7468 272e 2052  t-local-path'. R
+00005310: 6574 7572 6e73 2069 4644 4f20 6f62 6a65  eturns iFDO obje
+00005320: 6374 2e20 0a20 2020 2020 2020 202d 2069  ct. .        - i
+00005330: 4644 4f66 696c 653a 2073 7472 696e 6720  FDOfile: string 
+00005340: 7061 7468 2074 6f20 6c6f 6164 2061 6e20  path to load an 
+00005350: 6578 706c 6963 6974 2069 4644 4f20 6669  explicit iFDO fi
+00005360: 6c65 2e0a 2020 2020 2020 2020 2d20 6861  le..        - ha
+00005370: 6e64 6c65 5f70 7265 6669 783a 2073 7472  ndle_prefix: str
+00005380: 696e 6720 7072 6566 6978 206f 6620 7468  ing prefix of th
+00005390: 6520 6861 6e64 6c65 2073 6572 7665 722e  e handle server.
+000053a0: 2044 6566 6175 6c74 3a20 7468 6520 6f6e   Default: the on
+000053b0: 6520 666f 7220 4765 6f6d 6172 2e0a 2020  e for Geomar..  
+000053c0: 2020 2020 2020 2d20 7072 6f76 656e 616e        - provenan
+000053d0: 6365 3a20 6d61 7269 7174 2e70 726f 7665  ce: mariqt.prove
+000053e0: 6e63 616e 6365 2e50 726f 7665 6e61 6e63  ncance.Provenanc
+000053f0: 6520 6f62 6a65 6374 2074 6f20 7472 6163  e object to trac
+00005400: 6b20 6461 7461 2070 726f 7665 6e61 6e63  k data provenanc
+00005410: 652e 2044 6566 6175 6c74 3a20 6120 6e65  e. Default: a ne
+00005420: 7720 7072 6f76 656e 616e 6365 206f 626a  w provenance obj
+00005430: 6563 7420 6973 2063 7265 6174 6564 2069  ect is created i
+00005440: 6e20 7468 6520 2770 726f 746f 636f 6c27  n the 'protocol'
+00005450: 2073 7562 666f 6c64 6572 2e0a 2020 2020   subfolder..    
+00005460: 2020 2020 2d20 7665 7262 6f73 653a 2062      - verbose: b
+00005470: 6f6f 6c20 7768 6574 6865 7220 746f 2070  ool whether to p
+00005480: 7269 6e74 206f 7574 2069 6e66 6f72 6d61  rint out informa
+00005490: 7469 6f6e 2e20 5072 6f63 6573 7369 6e67  tion. Processing
+000054a0: 2069 7320 6661 7374 6572 2069 6620 7665   is faster if ve
+000054b0: 7262 6f73 6520 6973 2046 616c 7365 2e20  rbose is False. 
+000054c0: 4465 6661 756c 743a 2054 7275 652e 0a20  Default: True.. 
+000054d0: 2020 2020 2020 202d 2069 676e 6f72 655f         - ignore_
+000054e0: 696d 6167 655f 6669 6c65 733a 2062 6f6f  image_files: boo
+000054f0: 6c20 7768 6574 6865 7220 6974 2773 2061  l whether it's a
+00005500: 6363 6570 7465 6420 7468 6174 2074 6865  ccepted that the
+00005510: 7265 2061 7265 206e 6f74 2069 6d61 6765  re are not image
+00005520: 7320 7965 7420 696e 2027 6469 7227 2e20  s yet in 'dir'. 
+00005530: 4465 6661 756c 743a 2046 616c 7365 2e0a  Default: False..
+00005540: 2020 2020 2020 2020 2d20 7772 6974 6554          - writeT
+00005550: 6d70 5072 6f76 4669 6c65 3a20 626f 6f6c  mpProvFile: bool
+00005560: 2077 6865 7468 6572 2074 6f20 7772 6974   whether to writ
+00005570: 6520 6120 7465 6d70 6f72 6172 7920 7072  e a temporary pr
+00005580: 6f76 656e 616e 6365 2066 696c 6520 6475  ovenance file du
+00005590: 7269 6e67 2074 6865 2069 4644 4f20 6372  ring the iFDO cr
+000055a0: 6561 7469 6f6e 2070 726f 6365 7373 2077  eation process w
+000055b0: 6869 6368 2077 696c 6c20 6265 2072 6570  hich will be rep
+000055c0: 6c61 6365 6420 6279 2061 2066 696e 616c  laced by a final
+000055d0: 206f 6e65 2069 6e20 7468 6520 656e 642e   one in the end.
+000055e0: 2044 6566 6175 6c74 3a20 5472 7565 0a20   Default: True. 
+000055f0: 2020 2020 2020 202d 2069 6d61 6765 5f62         - image_b
+00005600: 726f 6b65 725f 7575 6964 3a20 7575 6964  roker_uuid: uuid
+00005610: 206f 6620 696d 6167 6520 6272 6f6b 6572   of image broker
+00005620: 2074 6f20 6372 6561 7465 2069 6d61 6765   to create image
+00005630: 2068 616e 646c 6573 2061 7320 6874 7470   handles as http
+00005640: 733a 2f2f 6864 6c2e 6861 6e64 6c65 2e6e  s://hdl.handle.n
+00005650: 6574 2f3c 6861 6e64 6c65 5f70 7265 6669  et/<handle_prefi
+00005660: 783e 2f3c 696d 6167 655f 6272 6f6b 6572  x>/<image_broker
+00005670: 5f75 7569 643e 403c 696d 6167 652d 7575  _uuid>@<image-uu
+00005680: 6964 3e20 2222 220a 2020 2020 0a20 2020  id> """.    .   
+00005690: 2072 6561 6465 7220 3d20 6946 444f 5f52   reader = iFDO_R
+000056a0: 6561 6465 7228 6946 444f 6669 6c65 290a  eader(iFDOfile).
+000056b0: 2020 2020 696d 6167 6573 4469 7220 3d20      imagesDir = 
+000056c0: 6d69 7174 632e 746f 556e 6978 5061 7468  miqtc.toUnixPath
+000056d0: 286f 732e 7061 7468 2e6e 6f72 6d70 6174  (os.path.normpat
+000056e0: 6828 6d69 7174 632e 746f 556e 6978 5061  h(miqtc.toUnixPa
+000056f0: 7468 2872 6561 6465 722e 6765 7449 6d61  th(reader.getIma
+00005700: 6765 4469 7265 6374 6f72 7928 2929 2929  geDirectory())))
+00005710: 0a20 2020 2062 6173 6544 6972 203d 206d  .    baseDir = m
+00005720: 6971 7463 2e74 6f55 6e69 7850 6174 6828  iqtc.toUnixPath(
+00005730: 6f73 2e70 6174 682e 636f 6d6d 6f6e 7061  os.path.commonpa
+00005740: 7468 285b 6946 444f 6669 6c65 2c69 6d61  th([iFDOfile,ima
+00005750: 6765 7344 6972 5d29 290a 2020 2020 696d  gesDir])).    im
+00005760: 6167 6544 6174 6154 7970 6546 6f6c 6465  ageDataTypeFolde
+00005770: 7220 3d20 5b65 2066 6f72 2065 2069 6e20  r = [e for e in 
+00005780: 696d 6167 6573 4469 722e 7265 706c 6163  imagesDir.replac
+00005790: 6528 6261 7365 4469 722c 2222 292e 7370  e(baseDir,"").sp
+000057a0: 6c69 7428 222f 2229 2069 6620 6520 213d  lit("/") if e !=
+000057b0: 2022 225d 5b30 5d0a 2020 2020 6966 2069   ""][0].    if i
+000057c0: 6d61 6765 4461 7461 5479 7065 466f 6c64  mageDataTypeFold
+000057d0: 6572 206e 6f74 2069 6e20 6d69 7174 642e  er not in miqtd.
+000057e0: 4469 722e 6474 2e5f 5f6d 656d 6265 7273  Dir.dt.__members
+000057f0: 5f5f 3a0a 2020 2020 2020 2020 7261 6973  __:.        rais
+00005800: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
+00005810: 7074 696f 6e28 2249 6d61 6765 7320 6172  ption("Images ar
+00005820: 6520 6e6f 7420 6c6f 6361 7465 6420 696e  e not located in
+00005830: 2061 2076 616c 6964 2064 6174 6120 7479   a valid data ty
+00005840: 7065 2064 6972 6563 746f 7279 2028 7261  pe directory (ra
+00005850: 772c 2069 6e74 6572 6d65 6469 6174 652c  w, intermediate,
+00005860: 2070 726f 6365 7373 6564 2c20 2e2e 2e29   processed, ...)
+00005870: 2069 6e20 7468 6520 7361 6d65 2070 726f   in the same pro
+00005880: 6a65 6374 2061 7320 6946 444f 2066 696c  ject as iFDO fil
+00005890: 652e 2229 0a20 2020 2069 6d61 6765 7344  e.").    imagesD
+000058a0: 6174 6154 7970 6544 6972 203d 206f 732e  ataTypeDir = os.
+000058b0: 7061 7468 2e6a 6f69 6e28 6261 7365 4469  path.join(baseDi
+000058c0: 722c 696d 6167 6544 6174 6154 7970 6546  r,imageDataTypeF
+000058d0: 6f6c 6465 7229 0a20 2020 2064 6972 4f62  older).    dirOb
+000058e0: 6a20 3d20 6d69 7174 642e 4469 7228 2222  j = miqtd.Dir(""
+000058f0: 2c69 6d61 6765 7344 6174 6154 7970 6544  ,imagesDataTypeD
+00005900: 6972 2c20 6372 6561 7465 3d46 616c 7365  ir, create=False
+00005910: 2c20 7769 7468 5f67 6561 723d 4661 6c73  , with_gear=Fals
+00005920: 6529 0a20 2020 2072 6574 7572 6e20 6946  e).    return iF
+00005930: 444f 2864 6972 3d64 6972 4f62 6a2c 6861  DO(dir=dirObj,ha
+00005940: 6e64 6c65 5f70 7265 6669 783d 6861 6e64  ndle_prefix=hand
+00005950: 6c65 5f70 7265 6669 782c 7072 6f76 656e  le_prefix,proven
+00005960: 616e 6365 3d70 726f 7665 6e61 6e63 652c  ance=provenance,
+00005970: 7665 7262 6f73 653d 7665 7262 6f73 652c  verbose=verbose,
+00005980: 6967 6e6f 7265 5f69 6d61 6765 5f66 696c  ignore_image_fil
+00005990: 6573 3d69 676e 6f72 655f 696d 6167 655f  es=ignore_image_
+000059a0: 6669 6c65 732c 7772 6974 6554 6d70 5072  files,writeTmpPr
+000059b0: 6f76 4669 6c65 3d77 7269 7465 546d 7050  ovFile=writeTmpP
+000059c0: 726f 7646 696c 652c 6946 444f 6669 6c65  rovFile,iFDOfile
+000059d0: 3d69 4644 4f66 696c 652c 696d 6167 655f  =iFDOfile,image_
+000059e0: 6272 6f6b 6572 5f75 7569 643d 696d 6167  broker_uuid=imag
+000059f0: 655f 6272 6f6b 6572 5f75 7569 6429 0a0a  e_broker_uuid)..
+00005a00: 0a63 6c61 7373 2069 4644 4f3a 0a20 2020  .class iFDO:.   
+00005a10: 2022 2043 6c61 7373 2066 6f72 2063 7265   " Class for cre
+00005a20: 6174 696e 6720 616e 6420 6564 6974 696e  ating and editin
+00005a30: 6720 6946 444f 2e79 616d 6c20 6669 6c65  g iFDO.yaml file
+00005a40: 7320 220a 0a20 2020 2064 6566 205f 5f69  s "..    def __i
+00005a50: 6e69 745f 5f28 7365 6c66 2c20 6469 723a  nit__(self, dir:
+00005a60: 6d69 7174 642e 4469 722c 2068 616e 646c  miqtd.Dir, handl
+00005a70: 655f 7072 6566 6978 3d27 3230 2e35 3030  e_prefix='20.500
+00005a80: 2e31 3230 3835 272c 7072 6f76 656e 616e  .12085',provenan
+00005a90: 6365 203d 204e 6f6e 652c 7665 7262 6f73  ce = None,verbos
+00005aa0: 653d 5472 7565 2c69 676e 6f72 655f 696d  e=True,ignore_im
+00005ab0: 6167 655f 6669 6c65 733d 4661 6c73 652c  age_files=False,
+00005ac0: 7772 6974 6554 6d70 5072 6f76 4669 6c65  writeTmpProvFile
+00005ad0: 3d54 7275 652c 6946 444f 6669 6c65 3d4e  =True,iFDOfile=N
+00005ae0: 6f6e 652c 696d 6167 655f 6272 6f6b 6572  one,image_broker
+00005af0: 5f75 7569 643d 2265 6532 3737 3537 382d  _uuid="ee277578-
+00005b00: 6139 3131 2d34 3834 642d 6135 3135 2d39  a911-484d-a515-9
+00005b10: 6337 3831 6437 3961 6139 3122 293a 0a20  c781d79aa91"):. 
+00005b20: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+00005b30: 6573 2061 6e20 6946 4f44 206f 626a 6563  es an iFOD objec
+00005b40: 742e 2052 6571 7569 7265 7320 6120 7661  t. Requires a va
+00005b50: 6c69 6420 6469 7265 6374 6f72 7920 636f  lid directory co
+00005b60: 6e74 6169 6e69 6e67 2069 6d61 6765 2064  ntaining image d
+00005b70: 6174 6120 6f72 2f61 6e64 2061 6e64 2069  ata or/and and i
+00005b80: 4644 4f20 6669 6c65 2061 6e64 2061 2068  FDO file and a h
+00005b90: 616e 646c 6520 7072 6566 6978 2069 6620  andle prefix if 
+00005ba0: 6974 2773 206e 6f74 2074 6865 2047 656f  it's not the Geo
+00005bb0: 6d61 7220 6f6e 652e 204c 6f61 6473 2064  mar one. Loads d
+00005bc0: 6972 6563 746f 7279 2773 2069 4644 4f20  irectory's iFDO 
+00005bd0: 6669 6c65 2069 6620 6974 2065 7869 7374  file if it exist
+00005be0: 7320 616c 7265 6164 792e 0a20 2020 2020  s already..     
+00005bf0: 2020 2020 2020 202d 2064 6972 3a20 6d61         - dir: ma
+00005c00: 7269 7174 2e64 6972 6563 746f 7269 6573  riqt.directories
+00005c10: 2e44 6972 206f 626a 6563 7420 706f 696e  .Dir object poin
+00005c20: 7469 6e67 2074 6f20 6120 7661 6c69 6420  ting to a valid 
+00005c30: 6461 7461 2074 7970 6520 6469 7265 6374  data type direct
+00005c40: 6f72 7920 2872 6177 2c20 696e 7465 726d  ory (raw, interm
+00005c50: 6564 6961 7465 2c20 7072 6f63 6573 7365  ediate, processe
+00005c60: 642c 202e 2e2e 2920 636f 6e74 6169 6e69  d, ...) containi
+00005c70: 6e67 2074 6865 2069 6d61 6765 2064 6174  ng the image dat
+00005c80: 612e 0a20 2020 2020 2020 2020 2020 202d  a..            -
+00005c90: 2068 616e 646c 655f 7072 6566 6978 3a20   handle_prefix: 
+00005ca0: 7374 7269 6e67 2070 7265 6669 7820 6f66  string prefix of
+00005cb0: 2074 6865 2068 616e 646c 6520 7365 7276   the handle serv
+00005cc0: 6572 2e20 4465 6661 756c 743a 2074 6865  er. Default: the
+00005cd0: 206f 6e65 2066 6f72 2047 656f 6d61 722e   one for Geomar.
+00005ce0: 0a20 2020 2020 2020 2020 2020 202d 2070  .            - p
+00005cf0: 726f 7665 6e61 6e63 653a 206d 6172 6971  rovenance: mariq
+00005d00: 742e 7072 6f76 656e 6361 6e63 652e 5072  t.provencance.Pr
+00005d10: 6f76 656e 616e 6365 206f 626a 6563 7420  ovenance object 
+00005d20: 746f 2074 7261 636b 2064 6174 6120 7072  to track data pr
+00005d30: 6f76 656e 616e 6365 2e20 4465 6661 756c  ovenance. Defaul
+00005d40: 743a 2061 206e 6577 2070 726f 7665 6e61  t: a new provena
+00005d50: 6e63 6520 6f62 6a65 6374 2069 7320 6372  nce object is cr
+00005d60: 6561 7465 6420 696e 2074 6865 2027 7072  eated in the 'pr
+00005d70: 6f74 6f63 6f6c 2720 7375 6266 6f6c 6465  otocol' subfolde
+00005d80: 722e 0a20 2020 2020 2020 2020 2020 202d  r..            -
+00005d90: 2076 6572 626f 7365 3a20 626f 6f6c 2077   verbose: bool w
+00005da0: 6865 7468 6572 2074 6f20 7072 696e 7420  hether to print 
+00005db0: 6f75 7420 696e 666f 726d 6174 696f 6e2e  out information.
+00005dc0: 2044 6566 6175 6c74 3a20 5472 7565 2e0a   Default: True..
+00005dd0: 2020 2020 2020 2020 2020 2020 2d20 6967              - ig
+00005de0: 6e6f 7265 5f69 6d61 6765 5f66 696c 6573  nore_image_files
+00005df0: 3a20 696d 6167 6573 2066 696c 6573 2061  : images files a
+00005e00: 7265 2069 676e 6f72 6564 2e20 5468 6579  re ignored. They
+00005e10: 2061 7265 206e 6f74 2073 6561 7263 6865   are not searche
+00005e20: 6420 666f 7220 696e 2027 7261 7727 2061  d for in 'raw' a
+00005e30: 6e64 2069 7465 6d73 2076 616c 7565 7320  nd items values 
+00005e40: 6172 6520 6e6f 7420 7570 6461 7465 6420  are not updated 
+00005e50: 6e6f 7220 6368 6563 6b65 642e 2044 6566  nor checked. Def
+00005e60: 6175 6c74 203d 2046 616c 7365 0a20 2020  ault = False.   
+00005e70: 2020 2020 2020 2020 202d 2077 7269 7465           - write
+00005e80: 546d 7050 726f 7646 696c 653a 2062 6f6f  TmpProvFile: boo
+00005e90: 6c20 7768 6574 6865 7220 746f 2077 7269  l whether to wri
+00005ea0: 7465 2061 2074 656d 706f 7261 7279 2070  te a temporary p
+00005eb0: 726f 7665 6e61 6e63 6520 6669 6c65 2064  rovenance file d
+00005ec0: 7572 696e 6720 7468 6520 6946 444f 2063  uring the iFDO c
+00005ed0: 7265 6174 696f 6e20 7072 6f63 6573 7320  reation process 
+00005ee0: 7768 6963 6820 7769 6c6c 2062 6520 7265  which will be re
+00005ef0: 706c 6163 6564 2062 7920 6120 6669 6e61  placed by a fina
+00005f00: 6c20 6f6e 6520 696e 2074 6865 2065 6e64  l one in the end
+00005f10: 2e20 4465 6661 756c 743a 2054 7275 650a  . Default: True.
+00005f20: 2020 2020 2020 2020 2020 2020 2d20 6946              - iF
+00005f30: 444f 6669 6c65 3a20 7374 7269 6e67 2070  DOfile: string p
+00005f40: 6174 6820 746f 206c 6f61 6420 616e 2065  ath to load an e
+00005f50: 7870 6c69 6369 7420 6946 444f 2066 696c  xplicit iFDO fil
+00005f60: 652e 2049 6620 6e6f 7420 7072 6f76 6964  e. If not provid
+00005f70: 6564 2061 206d 6174 6368 696e 6720 6946  ed a matching iF
+00005f80: 444f 2066 696c 6520 2869 6620 6974 2061  DO file (if it a
+00005f90: 6c72 6561 6479 2065 7869 7374 7329 2077  lready exists) w
+00005fa0: 696c 6c20 6265 206c 6f61 6465 6420 6672  ill be loaded fr
+00005fb0: 6f6d 2074 6865 2027 7072 6f64 7563 7473  om the 'products
+00005fc0: 2720 7375 6264 6972 6563 746f 7279 2e20  ' subdirectory. 
+00005fd0: 4465 6661 756c 743a 204e 6f6e 6520 0a20  Default: None . 
+00005fe0: 2020 2020 2020 2020 2020 202d 2069 6d61             - ima
+00005ff0: 6765 5f62 726f 6b65 725f 7575 6964 3a20  ge_broker_uuid: 
+00006000: 7575 6964 206f 6620 696d 6167 6520 6272  uuid of image br
+00006010: 6f6b 6572 2074 6f20 6372 6561 7465 2069  oker to create i
+00006020: 6d61 6765 2068 616e 646c 6573 2061 7320  mage handles as 
+00006030: 6874 7470 733a 2f2f 6864 6c2e 6861 6e64  https://hdl.hand
+00006040: 6c65 2e6e 6574 2f3c 6861 6e64 6c65 5f70  le.net/<handle_p
+00006050: 7265 6669 783e 2f3c 696d 6167 655f 6272  refix>/<image_br
+00006060: 6f6b 6572 5f75 7569 643e 403c 696d 6167  oker_uuid>@<imag
+00006070: 652d 7575 6964 3e20 2222 220a 0a20 2020  e-uuid> """..   
+00006080: 2020 2020 2023 2063 6865 636b 2074 6861       # check tha
+00006090: 7420 6174 2064 6972 206f 7220 6946 444f  t at dir or iFDO
+000060a0: 6669 6c65 2070 726f 7669 6465 640a 2020  file provided.  
+000060b0: 2020 2020 2020 6966 2064 6972 2069 7320        if dir is 
+000060c0: 4e6f 6e65 2061 6e64 2069 4644 4f66 696c  None and iFDOfil
+000060d0: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
+000060e0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+000060f0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00006100: 2822 4e65 6974 6865 7220 6469 7220 6e6f  ("Neither dir no
+00006110: 7220 6946 444f 6669 6c65 2070 726f 7669  r iFDOfile provi
+00006120: 6465 6420 666f 7220 6946 444f 2e22 290a  ded for iFDO.").
+00006130: 0a20 2020 2020 2020 2073 656c 662e 6469  .        self.di
+00006140: 7220 3d20 6469 720a 2020 2020 2020 2020  r = dir.        
+00006150: 7365 6c66 2e69 6d61 6765 7344 6972 203d  self.imagesDir =
+00006160: 2064 6972 2e74 6f74 7970 6528 290a 2020   dir.totype().  
+00006170: 2020 2020 2020 7365 6c66 2e64 6972 2e63        self.dir.c
+00006180: 7265 6174 6554 7970 6546 6f6c 6465 7228  reateTypeFolder(
+00006190: 290a 2020 2020 2020 2020 7365 6c66 2e68  ).        self.h
+000061a0: 616e 646c 655f 7072 6566 6978 203d 2022  andle_prefix = "
+000061b0: 6874 7470 733a 2f2f 6864 6c2e 6861 6e64  https://hdl.hand
+000061c0: 6c65 2e6e 6574 2f22 202b 2068 616e 646c  le.net/" + handl
+000061d0: 655f 7072 6566 6978 0a20 2020 2020 2020  e_prefix.       
+000061e0: 2073 656c 662e 696d 6167 655f 6861 6e64   self.image_hand
+000061f0: 6c65 5f70 7265 6669 7820 3d20 7365 6c66  le_prefix = self
+00006200: 2e68 616e 646c 655f 7072 6566 6978 202b  .handle_prefix +
+00006210: 2022 2f22 202b 2069 6d61 6765 5f62 726f   "/" + image_bro
+00006220: 6b65 725f 7575 6964 0a20 2020 2020 2020  ker_uuid.       
+00006230: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
+00006240: 6765 5f66 696c 6573 203d 2069 676e 6f72  ge_files = ignor
+00006250: 655f 696d 6167 655f 6669 6c65 730a 0a20  e_image_files.. 
+00006260: 2020 2020 2020 2073 656c 662e 696d 6167         self.imag
+00006270: 6553 6574 4865 6164 6572 4b65 7920 3d20  eSetHeaderKey = 
+00006280: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+00006290: 6865 6164 6572 5f6b 6579 0a20 2020 2020  header_key.     
+000062a0: 2020 2073 656c 662e 696d 6167 6553 6574     self.imageSet
+000062b0: 4974 656d 734b 6579 203d 206d 6971 7476  ItemsKey = miqtv
+000062c0: 2e69 6d61 6765 5f73 6574 5f69 7465 6d73  .image_set_items
+000062d0: 5f6b 6579 0a20 2020 2020 2020 2073 656c  _key.        sel
+000062e0: 662e 6966 646f 5f74 6d70 203d 207b 7365  f.ifdo_tmp = {se
+000062f0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+00006300: 724b 6579 3a20 7b7d 2c0a 2020 2020 2020  rKey: {},.      
+00006310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006320: 2020 2073 656c 662e 696d 6167 6553 6574     self.imageSet
+00006330: 4974 656d 734b 6579 3a20 7b7d 7d0a 2020  ItemsKey: {}}.  
+00006340: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+00006350: 7061 7273 6564 203d 204e 6f6e 650a 2020  parsed = None.  
+00006360: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+00006370: 6368 6563 6b65 6420 3d20 636f 7079 2e64  checked = copy.d
+00006380: 6565 7063 6f70 7928 7365 6c66 2e69 6664  eepcopy(self.ifd
+00006390: 6f5f 746d 7029 2020 2320 746f 2062 6520  o_tmp)  # to be 
+000063a0: 7365 7420 6279 2063 7265 6174 6569 4644  set by createiFD
+000063b0: 4f28 2920 6f6e 6c79 210a 2020 2020 2020  O() only!.      
+000063c0: 2020 7365 6c66 2e5f 5f61 6c6c 5555 4944    self.__allUUID
+000063d0: 7343 6865 636b 6564 203d 2046 616c 7365  sChecked = False
+000063e0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+000063f0: 6f76 203d 2070 726f 7665 6e61 6e63 650a  ov = provenance.
+00006400: 2020 2020 2020 2020 6966 2070 726f 7665          if prove
+00006410: 6e61 6e63 6520 3d3d 204e 6f6e 653a 0a20  nance == None:. 
+00006420: 2020 2020 2020 2020 2020 2074 6d70 4669             tmpFi
+00006430: 6c65 5061 7468 203d 2022 220a 2020 2020  lePath = "".    
+00006440: 2020 2020 2020 2020 6966 2077 7269 7465          if write
+00006450: 546d 7050 726f 7646 696c 653a 0a20 2020  TmpProvFile:.   
+00006460: 2020 2020 2020 2020 2020 2020 2074 6d70               tmp
+00006470: 4669 6c65 5061 7468 203d 2073 656c 662e  FilePath = self.
+00006480: 6469 722e 746f 2873 656c 662e 6469 722e  dir.to(self.dir.
+00006490: 6474 2e70 726f 746f 636f 6c29 0a20 2020  dt.protocol).   
+000064a0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+000064b0: 6f76 203d 206d 6971 7470 2e50 726f 7665  ov = miqtp.Prove
+000064c0: 6e61 6e63 6528 2269 4644 4f22 2c76 6572  nance("iFDO",ver
+000064d0: 626f 7365 3d76 6572 626f 7365 2c74 6d70  bose=verbose,tmp
+000064e0: 4669 6c65 5061 7468 3d74 6d70 4669 6c65  FilePath=tmpFile
+000064f0: 5061 7468 290a 0a20 2020 2020 2020 2023  Path)..        #
+00006500: 2073 6574 2067 6c6f 6261 6c20 7665 7262   set global verb
+00006510: 6f73 6974 790a 2020 2020 2020 2020 6d69  osity.        mi
+00006520: 7174 762e 7365 7447 6c6f 6261 6c56 6572  qtv.setGlobalVer
+00006530: 626f 7365 2876 6572 626f 7365 290a 0a20  bose(verbose).. 
+00006540: 2020 2020 2020 2069 6620 6e6f 7420 6469         if not di
+00006550: 722e 6578 6973 7473 2829 3a0a 2020 2020  r.exists():.    
+00006560: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00006570: 6365 7074 696f 6e28 2264 6972 6563 7472  ception("directr
+00006580: 6f79 222c 2064 6972 2e73 7472 2829 2c20  oy", dir.str(), 
+00006590: 2264 6f65 7320 6e6f 7420 6578 6973 742e  "does not exist.
+000065a0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
+000065b0: 6f74 2064 6972 2e76 616c 6964 4461 7461  ot dir.validData
+000065c0: 4469 7228 293a 0a20 2020 2020 2020 2020  Dir():.         
+000065d0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+000065e0: 6f6e 2822 6469 7265 6374 726f 7922 2c20  on("directroy", 
+000065f0: 6469 722e 7374 7228 292c 2022 6e6f 7420  dir.str(), "not 
+00006600: 7661 6c69 642e 2044 6f65 7320 6e6f 7420  valid. Does not 
+00006610: 636f 6d70 6c79 2077 6974 6820 7374 7275  comply with stru
+00006620: 6374 7572 6520 2f62 6173 652f 7072 6f6a  cture /base/proj
+00006630: 6563 742f 5b47 6561 722f 5d65 7665 6e74  ect/[Gear/]event
+00006640: 2f73 656e 736f 722f 6461 7461 5f74 7970  /sensor/data_typ
+00006650: 652f 2229 0a0a 2020 2020 2020 2020 2320  e/")..        # 
+00006660: 6368 6563 6b20 6946 444f 2066 696c 650a  check iFDO file.
+00006670: 2020 2020 2020 2020 7365 6c66 2e69 4644          self.iFD
+00006680: 4f66 696c 655f 203d 2022 2220 2320 6973  Ofile_ = "" # is
+00006690: 2073 6574 2062 7920 7365 7469 4644 4f46   set by setiFDOF
+000066a0: 696c 654e 616d 6528 290a 2020 2020 2020  ileName().      
+000066b0: 2020 6c6f 6164 6564 6946 444f 203d 2046    loadediFDO = F
+000066c0: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
+000066d0: 6e6f 7420 6946 444f 6669 6c65 2069 7320  not iFDOfile is 
+000066e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000066f0: 2020 6946 444f 6669 6c65 5f20 3d20 6946    iFDOfile_ = iF
+00006700: 444f 6669 6c65 0a20 2020 2020 2020 2020  DOfile.         
+00006710: 2020 2073 656c 662e 7365 7469 4644 4f46     self.setiFDOF
+00006720: 696c 654e 616d 6528 6946 444f 6669 6c65  ileName(iFDOfile
+00006730: 5f29 0a20 2020 2020 2020 2020 2020 2069  _).            i
+00006740: 6620 6e6f 7420 6f73 2e70 6174 682e 6973  f not os.path.is
+00006750: 6669 6c65 2869 4644 4f66 696c 655f 293a  file(iFDOfile_):
+00006760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006770: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00006780: 6f45 7863 6570 7469 6f6e 2822 6946 444f  oException("iFDO
+00006790: 2066 696c 6520 6e6f 7420 666f 756e 643a   file not found:
+000067a0: 2022 202b 2069 4644 4f66 696c 655f 290a   " + iFDOfile_).
+000067b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000067c0: 2020 2020 2020 2020 2020 6946 444f 6669            iFDOfi
+000067d0: 6c65 5f20 3d20 7365 6c66 2e64 6972 2e74  le_ = self.dir.t
+000067e0: 6f28 7365 6c66 2e64 6972 2e64 742e 7072  o(self.dir.dt.pr
+000067f0: 6f64 7563 7473 292b 7365 6c66 2e63 6f6e  oducts)+self.con
+00006800: 7374 7275 6374 6946 444f 6669 6c65 4e61  structiFDOfileNa
+00006810: 6d65 2873 656c 662e 6469 722e 7072 6f6a  me(self.dir.proj
+00006820: 6563 7428 292c 7365 6c66 2e64 6972 2e65  ect(),self.dir.e
+00006830: 7665 6e74 2829 2c73 656c 662e 6469 722e  vent(),self.dir.
+00006840: 7365 6e73 6f72 2829 290a 0a20 2020 2020  sensor())..     
+00006850: 2020 200a 2020 2020 2020 2020 7365 6c66     .        self
+00006860: 2e5f 696d 6167 6573 496e 496d 6167 6573  ._imagesInImages
+00006870: 4469 7220 3d20 5b5d 0a20 2020 2020 2020  Dir = [].       
+00006880: 2069 6620 7365 6c66 2e69 676e 6f72 655f   if self.ignore_
+00006890: 696d 6167 655f 6669 6c65 733a 0a20 2020  image_files:.   
+000068a0: 2020 2020 2020 2020 2070 7269 6e74 2822           print("
+000068b0: 4361 7574 696f 6e21 2072 756e 6e69 6e67  Caution! running
+000068c0: 2069 6e20 6967 6e6f 7265 5f69 6d61 6765   in ignore_image
+000068d0: 5f66 696c 6573 206d 6f64 652e 2229 0a20  _files mode."). 
+000068e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000068f0: 2020 2020 2020 2020 2073 656c 662e 5f69           self._i
+00006900: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+00006910: 203d 206d 6971 7469 2e62 726f 7773 6546   = miqti.browseF
+00006920: 6f72 496d 6167 6546 696c 6573 2873 656c  orImageFiles(sel
+00006930: 662e 696d 6167 6573 4469 7229 0a20 2020  f.imagesDir).   
+00006940: 2020 2020 2073 656c 662e 5f69 6d61 6765       self._image
+00006950: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
+00006960: 6564 4c69 7374 203d 205b 6669 6c65 2066  edList = [file f
+00006970: 6f72 2066 696c 6520 696e 2073 656c 662e  or file in self.
+00006980: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
+00006990: 6972 5d0a 2020 2020 2020 2020 7365 6c66  ir].        self
+000069a0: 2e5f 696d 6167 6573 496e 496d 6167 6573  ._imagesInImages
+000069b0: 4469 7253 6f72 7465 644c 6973 742e 736f  DirSortedList.so
+000069c0: 7274 2829 0a20 2020 2020 2020 2073 656c  rt().        sel
+000069d0: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
+000069e0: 6765 7344 6972 203d 205b 6f73 2e70 6174  gesDir = [os.pat
+000069f0: 682e 6261 7365 6e61 6d65 2866 696c 6529  h.basename(file)
+00006a00: 2066 6f72 2066 696c 6520 696e 2073 656c   for file in sel
+00006a10: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
+00006a20: 7344 6972 5d0a 0a20 2020 2020 2020 2069  sDir]..        i
+00006a30: 6620 6c65 6e28 7365 6c66 2e5f 696d 6167  f len(self._imag
+00006a40: 6573 496e 496d 6167 6573 4469 7229 203d  esInImagesDir) =
+00006a50: 3d20 3020 616e 6420 6e6f 7420 6967 6e6f  = 0 and not igno
+00006a60: 7265 5f69 6d61 6765 5f66 696c 6573 3a0a  re_image_files:.
+00006a70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00006a80: 6520 4578 6365 7074 696f 6e28 224e 6f20  e Exception("No 
+00006a90: 696d 6167 6573 2066 696c 6573 2066 6f75  images files fou
+00006aa0: 6e64 2069 6e20 2220 2b20 7365 6c66 2e69  nd in " + self.i
+00006ab0: 6d61 6765 7344 6972 202b 2022 2061 6e64  magesDir + " and
+00006ac0: 2069 7473 2073 7562 6469 7265 6374 6f72   its subdirector
+00006ad0: 6965 7322 290a 0a20 2020 2020 2020 2075  ies")..        u
+00006ae0: 6e69 7175 652c 2064 7570 203d 206d 6971  nique, dup = miq
+00006af0: 7474 2e66 696c 6573 4861 7665 556e 6971  tt.filesHaveUniq
+00006b00: 7565 4e61 6d65 2873 656c 662e 5f69 6d61  ueName(self._ima
+00006b10: 6765 7349 6e49 6d61 6765 7344 6972 290a  gesInImagesDir).
+00006b20: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
+00006b30: 6e69 7175 653a 0a20 2020 2020 2020 2020  nique:.         
+00006b40: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
+00006b50: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00006b60: 2020 2020 224e 6f74 2061 6c6c 2066 696c      "Not all fil
+00006b70: 6573 2068 6176 6520 756e 6971 7565 206e  es have unique n
+00006b80: 616d 6573 2e20 4475 706c 6963 6174 6573  ames. Duplicates
+00006b90: 3a20 2220 2b20 7374 7228 6475 7029 290a  : " + str(dup)).
+00006ba0: 0a20 2020 2020 2020 2061 6c6c 7661 6c69  .        allvali
+00006bb0: 642c 206d 7367 203d 206d 6971 7474 2e61  d, msg = miqtt.a
+00006bc0: 6c6c 496d 6167 654e 616d 6573 5661 6c69  llImageNamesVali
+00006bd0: 6428 7365 6c66 2e5f 696d 6167 6573 496e  d(self._imagesIn
+00006be0: 496d 6167 6573 4469 7229 200a 2020 2020  ImagesDir) .    
+00006bf0: 2020 2020 6966 206e 6f74 2061 6c6c 7661      if not allva
+00006c00: 6c69 643a 0a20 2020 2020 2020 2020 2020  lid:.           
+00006c10: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00006c20: 286d 7367 290a 0a20 2020 2020 2020 2073  (msg)..        s
+00006c30: 656c 662e 7072 6f76 2e6c 6f67 2873 7472  elf.prov.log(str
+00006c40: 286c 656e 2873 656c 662e 5f69 6d61 6765  (len(self._image
+00006c50: 7349 6e49 6d61 6765 7344 6972 2929 202b  sInImagesDir)) +
+00006c60: 2022 2069 6d61 6765 2066 696c 6573 2066   " image files f
+00006c70: 6f75 6e64 2e22 290a 2020 2020 2020 2020  ound.").        
+00006c80: 7365 6c66 2e70 726f 762e 6c6f 6728 2222  self.prov.log(""
+00006c90: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+00006ca0: 726f 762e 6c6f 6728 2246 6f6c 6c6f 7769  rov.log("Followi
+00006cb0: 6e67 2069 6e66 6f72 6d61 7469 6f6e 2077  ng information w
+00006cc0: 6173 2070 6172 7365 6420 6672 6f6d 2064  as parsed from d
+00006cd0: 6972 6563 746f 7279 2c20 706c 6561 7365  irectory, please
+00006ce0: 2063 6865 636b 2066 6f72 2063 6f72 7265   check for corre
+00006cf0: 6374 6e65 7373 3a22 290a 2020 2020 2020  ctness:").      
+00006d00: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00006d10: 2250 726f 6a65 6374 3a5c 7422 2b73 656c  "Project:\t"+sel
+00006d20: 662e 6469 722e 7072 6f6a 6563 7428 2929  f.dir.project())
+00006d30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00006d40: 2e64 6972 2e77 6974 685f 6765 6172 3a0a  .dir.with_gear:.
+00006d50: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00006d60: 2e70 726f 762e 6c6f 6728 2247 6561 723a  .prov.log("Gear:
+00006d70: 5c74 5c74 222b 7365 6c66 2e64 6972 2e67  \t\t"+self.dir.g
+00006d80: 6561 7228 2929 0a20 2020 2020 2020 2073  ear()).        s
+00006d90: 656c 662e 7072 6f76 2e6c 6f67 2822 4576  elf.prov.log("Ev
+00006da0: 656e 743a 5c74 5c74 222b 7365 6c66 2e64  ent:\t\t"+self.d
+00006db0: 6972 2e65 7665 6e74 2829 290a 2020 2020  ir.event()).    
+00006dc0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00006dd0: 6728 2253 656e 736f 723a 5c74 5c74 222b  g("Sensor:\t\t"+
+00006de0: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
+00006df0: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
+00006e00: 7072 6f76 2e6c 6f67 2822 2229 0a0a 2020  prov.log("")..  
+00006e10: 2020 2020 2020 2320 696e 7465 726d 6564        # intermed
+00006e20: 6961 7465 2066 696c 6573 0a20 2020 2020  iate files.     
+00006e30: 2020 2073 656c 662e 5f5f 696e 6974 496e     self.__initIn
+00006e40: 7465 726d 6564 6961 7465 4669 6c65 7328  termediateFiles(
+00006e50: 2920 2020 200a 0a20 2020 2020 2020 2023  )    ..        #
+00006e60: 2074 7279 206c 6f61 6420 6578 6973 7469   try load existi
+00006e70: 6e67 2069 4644 4f20 6669 6c65 0a20 2020  ng iFDO file.   
+00006e80: 2020 2020 2069 6628 7365 6c66 2e72 6561       if(self.rea
+00006e90: 6469 4644 4f66 696c 6528 6946 444f 6669  diFDOfile(iFDOfi
+00006ea0: 6c65 5f29 293a 0a20 2020 2020 2020 2020  le_)):.         
+00006eb0: 2020 206c 6f61 6465 6469 4644 4f20 3d20     loadediFDO = 
+00006ec0: 5472 7565 0a20 2020 2020 2020 2065 6c73  True.        els
+00006ed0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
+00006ee0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00006ef0: 2020 2020 7061 7468 203d 2073 656c 662e      path = self.
+00006f00: 6469 722e 746f 2873 656c 662e 6469 722e  dir.to(self.dir.
+00006f10: 6474 2e70 726f 6475 6374 7329 0a20 2020  dt.products).   
+00006f20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00006f30: 2066 696c 655f 2069 6e20 6f73 2e6c 6973   file_ in os.lis
+00006f40: 7464 6972 2870 6174 6829 3a0a 2020 2020  tdir(path):.    
+00006f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f60: 6966 2066 696c 655f 5b2d 3130 3a2d 345d  if file_[-10:-4]
+00006f70: 203d 3d20 225f 6946 444f 2e22 2061 6e64   == "_iFDO." and
+00006f80: 2073 656c 662e 7265 6164 6946 444f 6669   self.readiFDOfi
+00006f90: 6c65 2870 6174 682b 6669 6c65 5f29 3a0a  le(path+file_):.
+00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fb0: 2020 2020 2020 2020 6c6f 6164 6564 6946          loadediF
+00006fc0: 444f 203d 2054 7275 650a 2020 2020 2020  DO = True.      
+00006fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006fe0: 2020 6946 444f 6669 6c65 5f20 3d20 7061    iFDOfile_ = pa
+00006ff0: 7468 2b66 696c 655f 0a20 2020 2020 2020  th+file_.       
+00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007010: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00007020: 2020 2065 7863 6570 7420 4669 6c65 4e6f     except FileNo
+00007030: 7446 6f75 6e64 4572 726f 723a 0a20 2020  tFoundError:.   
+00007040: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00007050: 7320 2020 2020 2020 200a 0a20 2020 2020  s        ..     
+00007060: 2020 2073 656c 662e 7472 7941 7574 6f53     self.tryAutoS
+00007070: 6574 4865 6164 6572 4669 656c 6473 2829  etHeaderFields()
+00007080: 0a20 2020 2020 2020 2073 656c 662e 7365  .        self.se
+00007090: 7448 6561 6465 7249 6d61 6765 4c6f 6361  tHeaderImageLoca
+000070a0: 6c50 6174 6846 6965 6c64 2829 0a20 2020  lPathField().   
+000070b0: 2020 2020 2069 6620 6c6f 6164 6564 6946       if loadediF
+000070c0: 444f 3a0a 2020 2020 2020 2020 2020 2020  DO:.            
+000070d0: 7365 6c66 2e73 6574 6946 444f 4669 6c65  self.setiFDOFile
+000070e0: 4e61 6d65 2869 4644 4f66 696c 655f 290a  Name(iFDOfile_).
+000070f0: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
+00007100: 686f 640a 2020 2020 6465 6620 6f70 656e  hod.    def open
+00007110: 5f69 6664 6f5f 6669 6c65 2866 696c 653a  _ifdo_file(file:
+00007120: 7374 7229 3a20 200a 2020 2020 2020 2020  str):  .        
+00007130: 2222 2220 6f70 656e 2069 6664 6f20 6a73  """ open ifdo js
+00007140: 6f6e 206f 7220 7961 6d6c 2066 696c 6520  on or yaml file 
+00007150: 616e 6420 7265 7475 726e 2061 7320 6469  and return as di
+00007160: 6374 2e20 2222 220a 2020 2020 2020 2020  ct. """.        
+00007170: 7472 795f 7961 6d6c 203d 2046 616c 7365  try_yaml = False
+00007180: 0a0a 2020 2020 2020 2020 2320 6966 2066  ..        # if f
+00007190: 696c 6520 6973 2079 616d 6c20 6669 6c65  ile is yaml file
+000071a0: 206c 6f61 6420 6974 2061 7320 7375 6368   load it as such
+000071b0: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
+000071c0: 2e73 706c 6974 2827 2e27 295b 2d31 5d20  .split('.')[-1] 
+000071d0: 3d3d 2027 7961 6d6c 273a 0a20 2020 2020  == 'yaml':.     
+000071e0: 2020 2020 2020 2074 7279 5f79 616d 6c20         try_yaml 
+000071f0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+00007200: 2020 2066 696c 655f 7961 6d6c 203d 2066     file_yaml = f
+00007210: 696c 650a 0a20 2020 2020 2020 2069 6620  ile..        if 
+00007220: 6e6f 7420 6f73 2e70 6174 682e 6973 6669  not os.path.isfi
+00007230: 6c65 2866 696c 6529 3a0a 2020 2020 2020  le(file):.      
+00007240: 2020 2020 2020 2320 6966 2066 696c 6520        # if file 
+00007250: 646f 6573 206e 6f74 2065 7869 7374 2063  does not exist c
+00007260: 6865 636b 2069 6620 7961 6d6c 2076 6572  heck if yaml ver
+00007270: 7369 6f6e 2065 7873 6973 7420 616e 6420  sion exsist and 
+00007280: 7472 7920 746f 206c 6f61 6420 7468 6174  try to load that
+00007290: 206f 6e65 0a20 2020 2020 2020 2020 2020   one.           
+000072a0: 2066 696c 655f 7961 6d6c 203d 2066 696c   file_yaml = fil
+000072b0: 652e 7265 706c 6163 6528 272e 6a73 6f6e  e.replace('.json
+000072c0: 272c 272e 7961 6d6c 2729 0a20 2020 2020  ','.yaml').     
+000072d0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
+000072e0: 682e 6973 6669 6c65 2866 696c 655f 7961  h.isfile(file_ya
+000072f0: 6d6c 293a 0a20 2020 2020 2020 2020 2020  ml):.           
+00007300: 2020 2020 2074 7279 5f79 616d 6c20 3d20       try_yaml = 
+00007310: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00007320: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00007330: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00007340: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00007350: 2822 4669 6c65 206e 6f74 2066 6f75 6e64  ("File not found
+00007360: 2229 0a0a 2020 2020 2020 2020 2320 7472  ")..        # tr
+00007370: 7920 6c6f 6164 206a 736f 6e2c 206f 7468  y load json, oth
+00007380: 6572 7769 7365 2074 7279 2079 616d 6c0a  erwise try yaml.
+00007390: 2020 2020 2020 2020 6966 2074 7279 5f79          if try_y
+000073a0: 616d 6c3a 0a20 2020 2020 2020 2020 2020  aml:.           
+000073b0: 206f 203d 206f 7065 6e28 6669 6c65 5f79   o = open(file_y
+000073c0: 616d 6c2c 2027 7227 290a 2020 2020 2020  aml, 'r').      
+000073d0: 2020 2020 2020 6966 646f 5f64 6374 203d        ifdo_dct =
+000073e0: 2079 616d 6c2e 6c6f 6164 286f 2c20 4c6f   yaml.load(o, Lo
+000073f0: 6164 6572 3d79 616d 6c2e 434c 6f61 6465  ader=yaml.CLoade
+00007400: 7229 0a20 2020 2020 2020 2065 6c73 653a  r).        else:
+00007410: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
+00007420: 206f 7065 6e28 6669 6c65 2c20 2772 2729   open(file, 'r')
+00007430: 0a20 2020 2020 2020 2020 2020 2069 6664  .            ifd
+00007440: 6f5f 6463 7420 3d20 6a73 6f6e 2e6c 6f61  o_dct = json.loa
+00007450: 6428 6f29 0a20 2020 2020 2020 206f 2e63  d(o).        o.c
+00007460: 6c6f 7365 2829 0a20 2020 2020 2020 2072  lose().        r
+00007470: 6574 7572 6e20 6966 646f 5f64 6374 0a0a  eturn ifdo_dct..
+00007480: 0a20 2020 2064 6566 2072 6561 6469 4644  .    def readiFD
+00007490: 4f66 696c 6528 7365 6c66 2c66 696c 653a  Ofile(self,file:
+000074a0: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
+000074b0: 2220 7265 6164 7320 6946 444f 2066 696c  " reads iFDO fil
+000074c0: 6520 2222 220a 0a20 2020 2020 2020 2073  e """..        s
+000074d0: 203d 206d 6971 7463 2e50 7269 6e74 4c6f   = miqtc.PrintLo
+000074e0: 6164 696e 674d 7367 2822 4c6f 6164 696e  adingMsg("Loadin
+000074f0: 6720 6946 444f 2066 696c 6522 290a 2020  g iFDO file").  
+00007500: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00007510: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+00007520: 5f74 6d70 203d 2073 656c 662e 6f70 656e  _tmp = self.open
+00007530: 5f69 6664 6f5f 6669 6c65 2866 696c 6529  _ifdo_file(file)
+00007540: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00007550: 662e 6966 646f 5f70 6172 7365 6420 3d20  f.ifdo_parsed = 
+00007560: 636f 7079 2e64 6565 7063 6f70 7928 7365  copy.deepcopy(se
+00007570: 6c66 2e69 6664 6f5f 746d 7029 0a20 2020  lf.ifdo_tmp).   
+00007580: 2020 2020 2020 2020 2073 2e73 746f 7028           s.stop(
+00007590: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000075a0: 6c66 2e70 726f 762e 6164 6450 7265 7669  lf.prov.addPrevi
+000075b0: 6f75 7350 726f 7665 6e61 6e63 6528 7365  ousProvenance(se
+000075c0: 6c66 2e70 726f 762e 6765 744c 6173 7450  lf.prov.getLastP
+000075d0: 726f 7665 6e61 6e63 6546 696c 6528 7365  rovenanceFile(se
+000075e0: 6c66 2e64 6972 2e74 6f28 7365 6c66 2e64  lf.dir.to(self.d
+000075f0: 6972 2e64 742e 7072 6f74 6f63 6f6c 292c  ir.dt.protocol),
+00007600: 7365 6c66 2e70 726f 762e 6578 6563 7574  self.prov.execut
+00007610: 6162 6c65 2929 0a20 2020 2020 2020 2065  able)).        e
+00007620: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00007630: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00007640: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00007650: 7374 7228 652e 6172 6773 2929 0a20 2020  str(e.args)).   
+00007660: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00007670: 4661 6c73 650a 2020 2020 2020 2020 732e  False.        s.
+00007680: 7374 6f70 2829 0a0a 2020 2020 2020 2020  stop()..        
+00007690: 2320 7472 7920 746f 2070 6172 7365 2065  # try to parse e
+000076a0: 2e67 2e20 7374 7269 6e67 7320 7468 6174  .g. strings that
+000076b0: 2072 6570 7265 7365 6e74 2064 6963 7473   represent dicts
+000076c0: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
+000076d0: 6563 7572 7369 7665 4576 616c 2873 656c  ecursiveEval(sel
+000076e0: 662e 6966 646f 5f74 6d70 290a 0a20 2020  f.ifdo_tmp)..   
+000076f0: 2020 2020 2069 6620 7365 6c66 2e69 6d61       if self.ima
+00007700: 6765 5365 7448 6561 6465 724b 6579 206e  geSetHeaderKey n
+00007710: 6f74 2069 6e20 7365 6c66 2e69 6664 6f5f  ot in self.ifdo_
+00007720: 746d 703a 0a20 2020 2020 2020 2020 2020  tmp:.           
+00007730: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00007740: 2822 4572 726f 7220 6c6f 6164 696e 6720  ("Error loading 
+00007750: 6946 444f 2066 696c 6522 2c66 696c 652c  iFDO file",file,
+00007760: 2264 6f65 7320 6e6f 7420 636f 6e74 6169  "does not contai
+00007770: 6e22 2c73 656c 662e 696d 6167 6553 6574  n",self.imageSet
+00007780: 4865 6164 6572 4b65 7929 0a20 2020 2020  HeaderKey).     
+00007790: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
+000077a0: 5365 7449 7465 6d73 4b65 7920 6e6f 7420  SetItemsKey not 
+000077b0: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
+000077c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000077d0: 6973 6520 4578 6365 7074 696f 6e28 2245  ise Exception("E
+000077e0: 7272 6f72 206c 6f61 6469 6e67 2069 4644  rror loading iFD
+000077f0: 4f20 6669 6c65 222c 6669 6c65 2c22 646f  O file",file,"do
+00007800: 6573 206e 6f74 2063 6f6e 7461 696e 222c  es not contain",
+00007810: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+00007820: 6d73 4b65 7929 0a0a 2020 2020 2020 2020  msKey)..        
+00007830: 6966 2020 7365 6c66 2e69 6664 6f5f 746d  if  self.ifdo_tm
+00007840: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+00007850: 6561 6465 724b 6579 5d20 3d3d 204e 6f6e  eaderKey] == Non
+00007860: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00007870: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00007880: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+00007890: 4b65 795d 203d 207b 7d0a 2020 2020 2020  Key] = {}.      
+000078a0: 2020 6966 2073 656c 662e 6966 646f 5f74    if self.ifdo_t
+000078b0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+000078c0: 4974 656d 734b 6579 5d20 3d3d 204e 6f6e  ItemsKey] == Non
+000078d0: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+000078e0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+000078f0: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+00007900: 6579 5d20 3d20 7b7d 0a0a 2020 2020 2020  ey] = {}..      
+00007910: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00007920: 2269 4644 4f20 6669 6c65 206c 6f61 6465  "iFDO file loade
+00007930: 643a 5c74 222b 6f73 2e70 6174 682e 6261  d:\t"+os.path.ba
+00007940: 7365 6e61 6d65 2866 696c 6529 290a 0a20  sename(file)).. 
+00007950: 2020 2020 2020 2023 2063 6865 636b 2069         # check i
+00007960: 4644 4f20 7665 7273 696f 6e0a 2020 2020  FDO version.    
+00007970: 2020 2020 7265 6164 5665 7273 696f 6e20      readVersion 
+00007980: 3d20 2276 2e31 2e30 2e30 2220 2320 6469  = "v.1.0.0" # di
+00007990: 6420 6e6f 7420 6861 7665 2074 6865 2027  d not have the '
+000079a0: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
+000079b0: 6572 7369 6f6e 2720 6669 656c 6420 7965  ersion' field ye
+000079c0: 740a 2020 2020 2020 2020 7472 793a 200a  t.        try: .
+000079d0: 2020 2020 2020 2020 2020 2020 7265 6164              read
+000079e0: 5665 7273 696f 6e20 3d20 7365 6c66 2e66  Version = self.f
+000079f0: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
+00007a00: 6765 2d73 6574 2d69 6664 6f2d 7665 7273  ge-set-ifdo-vers
+00007a10: 696f 6e27 290a 2020 2020 2020 2020 6578  ion').        ex
+00007a20: 6365 7074 204b 6579 4572 726f 723a 0a20  cept KeyError:. 
+00007a30: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00007a40: 2020 2020 2020 2020 696e 7452 6561 6456          intReadV
+00007a50: 6572 7369 6f6e 203d 2056 6572 7369 6f6e  ersion = Version
+00007a60: 2872 6561 6456 6572 7369 6f6e 290a 2020  (readVersion).  
+00007a70: 2020 2020 2020 696e 7454 6869 7356 6572        intThisVer
+00007a80: 7369 6f6e 203d 2056 6572 7369 6f6e 286d  sion = Version(m
+00007a90: 6971 7476 2e69 4644 4f5f 7665 7273 696f  iqtv.iFDO_versio
+00007aa0: 6e29 0a20 2020 2020 2020 2069 6620 696e  n).        if in
+00007ab0: 7452 6561 6456 6572 7369 6f6e 203c 2069  tReadVersion < i
+00007ac0: 6e74 5468 6973 5665 7273 696f 6e3a 0a20  ntThisVersion:. 
+00007ad0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007ae0: 7072 6f76 2e6c 6f67 2822 4c6f 6164 6564  prov.log("Loaded
+00007af0: 2069 4644 4f20 6861 7320 7665 7273 696f   iFDO has versio
+00007b00: 6e20 2220 2b20 7265 6164 5665 7273 696f  n " + readVersio
+00007b10: 6e20 2b20 2220 616e 6420 7769 6c6c 2062  n + " and will b
+00007b20: 6520 7570 6461 7465 6420 746f 2076 6572  e updated to ver
+00007b30: 7369 6f6e 2022 202b 206d 6971 7476 2e69  sion " + miqtv.i
+00007b40: 4644 4f5f 7665 7273 696f 6e29 0a20 2020  FDO_version).   
+00007b50: 2020 2020 2069 6620 696e 7452 6561 6456       if intReadV
+00007b60: 6572 7369 6f6e 203e 2069 6e74 5468 6973  ersion > intThis
+00007b70: 5665 7273 696f 6e3a 0a20 2020 2020 2020  Version:.       
+00007b80: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00007b90: 6f67 2822 4361 7574 696f 6e21 204c 6f61  og("Caution! Loa
+00007ba0: 6465 6420 6946 444f 2068 6173 2076 6572  ded iFDO has ver
+00007bb0: 7369 6f6e 2022 202b 2072 6561 6456 6572  sion " + readVer
+00007bc0: 7369 6f6e 202b 2022 2069 7320 6168 6561  sion + " is ahea
+00007bd0: 6420 6f66 2076 6572 7369 6f6e 2075 7365  d of version use
+00007be0: 6420 6865 7265 3a20 2220 2b20 6d69 7174  d here: " + miqt
+00007bf0: 762e 6946 444f 5f76 6572 7369 6f6e 290a  v.iFDO_version).
+00007c00: 0a20 2020 2020 2020 2023 2066 6f72 2073  .        # for s
+00007c10: 6f6f 6f6f 6f6d 6520 7265 6173 6f6e 2074  ooooome reason t
+00007c20: 6869 7320 6669 7865 7320 6120 6869 636b  his fixes a hick
+00007c30: 7570 206f 6620 7468 6520 7072 6f67 2069  up of the prog i
+00007c40: 6e20 6372 6561 7465 6946 444f 2829 0a20  n createiFDO(). 
+00007c50: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
+00007c60: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
+00007c70: 6f67 7265 7373 4d73 6728 2266 6f6f 222c  ogressMsg("foo",
+00007c80: 2031 2c6d 6f64 756c 6f3d 3129 0a20 2020   1,modulo=1).   
+00007c90: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+00007ca0: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00007cb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007cc0: 636f 6e76 6572 7454 6f44 6566 6175 6c74  convertToDefault
+00007cd0: 4461 7465 5469 6d65 466f 726d 6174 2873  DateTimeFormat(s
+00007ce0: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
+00007cf0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00007d00: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
+00007d10: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00007d20: 726f 762e 6c6f 6728 2243 6865 636b 696e  rov.log("Checkin
+00007d30: 6720 6461 7465 7469 6d65 2066 6f72 6d61  g datetime forma
+00007d40: 743a 2022 202b 2073 7472 2865 7829 290a  t: " + str(ex)).
+00007d50: 0a20 2020 2020 2020 2023 2066 6f72 2073  .        # for s
+00007d60: 6f6f 6f6f 6f6d 6520 7265 6173 6f6e 2074  ooooome reason t
+00007d70: 6869 7320 6669 7865 7320 6120 6869 636b  his fixes a hick
+00007d80: 7570 206f 6620 7468 6520 7072 6f67 2069  up of the prog i
+00007d90: 6e20 6372 6561 7465 6946 444f 2829 0a20  n createiFDO(). 
+00007da0: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
+00007db0: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
+00007dc0: 6f67 7265 7373 4d73 6728 2266 6f6f 222c  ogressMsg("foo",
+00007dd0: 2031 2c6d 6f64 756c 6f3d 3129 0a20 2020   1,modulo=1).   
+00007de0: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+00007df0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00007e00: 5f74 7279 5f75 7067 7261 6465 5f74 6f5f  _try_upgrade_to_
+00007e10: 6966 646f 5f76 6572 7369 6f6e 5f32 7828  ifdo_version_2x(
+00007e20: 290a 0a20 2020 2020 2020 2023 2063 6865  )..        # che
+00007e30: 636b 2072 6561 6420 6946 444f 2066 696c  ck read iFDO fil
+00007e40: 650a 2020 2020 2020 2020 7472 793a 0a20  e.        try:. 
+00007e50: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+00007e60: 7420 7365 6c66 2e69 676e 6f72 655f 696d  t self.ignore_im
+00007e70: 6167 655f 6669 6c65 733a 0a20 2020 2020  age_files:.     
+00007e80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00007e90: 6372 6561 7465 6946 444f 2873 656c 662e  createiFDO(self.
+00007ea0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+00007eb0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00007ec0: 2c20 6d69 7174 692e 6372 6561 7465 496d  , miqti.createIm
+00007ed0: 6167 6549 7465 6d73 4c69 7374 4672 6f6d  ageItemsListFrom
+00007ee0: 496d 6167 6549 7465 6d73 4469 6374 2873  ImageItemsDict(s
+00007ef0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00007f00: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+00007f10: 6579 5d29 290a 2020 2020 2020 2020 2020  ey])).          
+00007f20: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00007f30: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00007f40: 6174 6569 4644 4f28 7365 6c66 2e69 6664  ateiFDO(self.ifd
+00007f50: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00007f60: 5365 7448 6561 6465 724b 6579 5d2c 206d  SetHeaderKey], m
+00007f70: 6971 7469 2e63 7265 6174 6549 6d61 6765  iqti.createImage
+00007f80: 4974 656d 734c 6973 7446 726f 6d49 6d61  ItemsListFromIma
+00007f90: 6765 4974 656d 7344 6963 7428 7365 6c66  geItemsDict(self
+00007fa0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00007fb0: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00007fc0: 292c 6865 6164 6572 5f6f 6e6c 793d 7365  ),header_only=se
+00007fd0: 6c66 2e69 676e 6f72 655f 696d 6167 655f  lf.ignore_image_
+00007fe0: 6669 6c65 7329 0a20 2020 2020 2020 2065  files).        e
+00007ff0: 7863 6570 7420 6d69 7174 632e 4966 646f  xcept miqtc.Ifdo
+00008000: 4578 6365 7074 696f 6e20 6173 2065 783a  Exception as ex:
+00008010: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008020: 662e 7072 6f76 2e6c 6f67 2822 4c6f 6164  f.prov.log("Load
+00008030: 6564 2069 4644 4f20 6669 6c65 206e 6f74  ed iFDO file not
+00008040: 2076 616c 6964 2079 6574 3a20 2220 2b20   valid yet: " + 
+00008050: 7374 7228 6578 2929 0a0a 2020 2020 2020  str(ex))..      
+00008060: 2020 7265 7475 726e 2054 7275 650a 0a0a    return True...
+00008070: 2020 2020 6465 6620 7772 6974 655f 6966      def write_if
+00008080: 646f 5f66 696c 6528 7365 6c66 2c61 6c6c  do_file(self,all
+00008090: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
+000080a0: 7265 643d 4661 6c73 6529 3a0a 2020 2020  red=False):.    
+000080b0: 2020 2020 2222 2220 5772 6974 6573 2061      """ Writes a
+000080c0: 6e20 6946 444f 2066 696c 6520 746f 2064  n iFDO file to d
+000080d0: 6973 6b2e 204f 7665 7277 7269 7465 7320  isk. Overwrites 
+000080e0: 706f 7465 6e74 6961 6c6c 7920 6578 6973  potentially exis
+000080f0: 7469 6e67 2066 696c 652e 2222 220a 0a20  ting file.""".. 
+00008100: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
+00008110: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
+00008120: 2822 5772 6974 696e 6720 6946 444f 2066  ("Writing iFDO f
+00008130: 696c 6522 290a 0a20 2020 2020 2020 2023  ile")..        #
+00008140: 2063 6865 636b 2066 6965 6c64 7320 6167   check fields ag
+00008150: 6169 6e20 6966 2063 6861 6e67 6564 2073  ain if changed s
+00008160: 696e 6365 206c 6173 7420 6368 6563 6b20  ince last check 
+00008170: 2863 7265 6174 6569 4644 4f29 0a20 2020  (createiFDO).   
+00008180: 2020 2020 2069 6620 7365 6c66 2e69 6664       if self.ifd
+00008190: 6f5f 746d 7020 213d 2073 656c 662e 6966  o_tmp != self.if
+000081a0: 646f 5f63 6865 636b 6564 3a0a 2020 2020  do_checked:.    
+000081b0: 2020 2020 2020 2020 7365 6c66 2e63 7265          self.cre
+000081c0: 6174 6569 4644 4f28 7365 6c66 2e69 6664  ateiFDO(self.ifd
+000081d0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+000081e0: 5365 7448 6561 6465 724b 6579 5d2c 206d  SetHeaderKey], m
+000081f0: 6971 7469 2e63 7265 6174 6549 6d61 6765  iqti.createImage
+00008200: 4974 656d 734c 6973 7446 726f 6d49 6d61  ItemsListFromIma
+00008210: 6765 4974 656d 7344 6963 7428 7365 6c66  geItemsDict(self
+00008220: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00008230: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00008240: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00008250: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00008260: 6c6c 6f77 5f6d 6973 7369 6e67 5f72 6571  llow_missing_req
+00008270: 7569 7265 643d 616c 6c6f 775f 6d69 7373  uired=allow_miss
+00008280: 696e 675f 7265 7175 6972 6564 290a 2020  ing_required).  
+00008290: 2020 2020 2020 0a20 2020 2020 2020 2023        .        #
+000082a0: 2061 6464 2022 2473 6368 656d 6122 0a20   add "$schema". 
+000082b0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+000082c0: 5f63 6865 636b 6564 5b22 2473 6368 656d  _checked["$schem
+000082d0: 6122 5d20 3d20 6d69 7174 762e 6966 646f  a"] = miqtv.ifdo
+000082e0: 5f73 6368 656d 615b 2724 6964 275d 0a20  _schema['$id']. 
+000082f0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00008300: 6946 444f 5f70 6174 6820 3d20 7365 6c66  iFDO_path = self
+00008310: 2e67 6574 6946 444f 4669 6c65 4e61 6d65  .getiFDOFileName
+00008320: 286f 7665 7277 7269 7465 3d54 7275 6529  (overwrite=True)
+00008330: 0a0a 2020 2020 2020 2020 2320 7075 7473  ..        # puts
+00008340: 2065 7665 7279 7468 696e 6720 696e 206f   everything in o
+00008350: 6e65 206c 696e 650a 2020 2020 2020 2020  ne line.        
+00008360: 2377 6974 6820 6f70 656e 2869 4644 4f5f  #with open(iFDO_
+00008370: 7061 7468 2e72 6570 6c61 6365 2822 7961  path.replace("ya
+00008380: 6d6c 222c 226a 736f 6e22 292c 2027 7727  ml","json"), 'w'
+00008390: 2920 6173 2066 703a 0a20 2020 2020 2020  ) as fp:.       
+000083a0: 2023 2020 2020 6a73 6f6e 2e64 756d 7028   #    json.dump(
+000083b0: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+000083c0: 642c 2066 7029 0a0a 2020 2020 2020 2020  d, fp)..        
+000083d0: 2320 636f 6e76 6572 7420 6469 6374 696f  # convert dictio
+000083e0: 6e61 7279 2074 6f20 4a53 4f4e 2073 7472  nary to JSON str
+000083f0: 696e 670a 2020 2020 2020 2020 6a73 6f6e  ing.        json
+00008400: 5f64 6174 6120 3d20 6a73 6f6e 2e64 756d  _data = json.dum
+00008410: 7073 2873 656c 662e 6966 646f 5f63 6865  ps(self.ifdo_che
+00008420: 636b 6564 2c20 696e 6465 6e74 203d 2034  cked, indent = 4
+00008430: 2c20 736f 7274 5f6b 6579 733d 5472 7565  , sort_keys=True
+00008440: 290a 0a20 2020 2020 2020 2023 2077 7269  )..        # wri
+00008450: 7465 2074 6865 204a 534f 4e20 7374 7269  te the JSON stri
+00008460: 6e67 2074 6f20 6120 6669 6c65 0a20 2020  ng to a file.   
+00008470: 2020 2020 2077 6974 6820 6f70 656e 2869       with open(i
+00008480: 4644 4f5f 7061 7468 2c20 2777 2729 2061  FDO_path, 'w') a
+00008490: 7320 663a 0a20 2020 2020 2020 2020 2020  s f:.           
+000084a0: 2066 2e77 7269 7465 286a 736f 6e5f 6461   f.write(json_da
+000084b0: 7461 290a 2020 2020 2020 2020 0a20 2020  ta).        .   
+000084c0: 2020 2020 2023 206c 6f67 2063 6861 6e67       # log chang
+000084d0: 6573 0a20 2020 2020 2020 2069 6620 6e6f  es.        if no
+000084e0: 7420 7365 6c66 2e69 6664 6f5f 7061 7273  t self.ifdo_pars
+000084f0: 6564 2069 7320 4e6f 6e65 3a0a 2020 2020  ed is None:.    
+00008500: 2020 2020 2020 2020 6966 646f 5f75 7064          ifdo_upd
+00008510: 6174 6520 3d20 4465 6570 4469 6666 2873  ate = DeepDiff(s
+00008520: 656c 662e 6966 646f 5f70 6172 7365 642c  elf.ifdo_parsed,
+00008530: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
+00008540: 6429 0a20 2020 2020 2020 2020 2020 2023  d).            #
+00008550: 7070 7269 6e74 2869 6664 6f5f 7570 6461  pprint(ifdo_upda
+00008560: 7465 290a 2020 2020 2020 2020 2020 2020  te).            
+00008570: 6966 2069 6664 6f5f 7570 6461 7465 2021  if ifdo_update !
+00008580: 3d20 7b7d 3a0a 2020 2020 2020 2020 2020  = {}:.          
+00008590: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
+000085a0: 6c6f 6728 2269 4644 4f20 7570 6461 7465  log("iFDO update
+000085b0: 6422 290a 2020 2020 2020 2020 2020 2020  d").            
+000085c0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+000085d0: 6728 7374 7228 6966 646f 5f75 7064 6174  g(str(ifdo_updat
+000085e0: 6529 2c64 6f6e 7453 686f 773d 5472 7565  e),dontShow=True
+000085f0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
+00008600: 726f 762e 6c6f 6728 2257 726f 7465 2069  rov.log("Wrote i
+00008610: 4644 4f20 746f 2066 696c 6520 2220 2b20  FDO to file " + 
+00008620: 6946 444f 5f70 6174 6829 0a20 2020 2020  iFDO_path).     
+00008630: 2020 2073 656c 662e 7072 6f76 2e77 7269     self.prov.wri
+00008640: 7465 2873 656c 662e 6469 722e 746f 2873  te(self.dir.to(s
+00008650: 656c 662e 6469 722e 6474 2e70 726f 746f  elf.dir.dt.proto
+00008660: 636f 6c29 290a 2020 2020 2020 2020 732e  col)).        s.
+00008670: 7374 6f70 2829 0a0a 2020 2020 6465 6620  stop()..    def 
+00008680: 7772 6974 6569 4644 4f66 696c 6528 7365  writeiFDOfile(se
+00008690: 6c66 2c61 6c6c 6f77 5f6d 6973 7369 6e67  lf,allow_missing
+000086a0: 5f72 6571 7569 7265 643d 4661 6c73 6529  _required=False)
+000086b0: 3a0a 2020 2020 2020 2020 2222 2220 4465  :.        """ De
+000086c0: 7072 6563 6174 6564 202d 2075 7365 2077  precated - use w
+000086d0: 7269 7465 5f69 6664 6f5f 6669 6c65 2022  rite_ifdo_file "
+000086e0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+000086f0: 7772 6974 655f 6966 646f 5f66 696c 6528  write_ifdo_file(
+00008700: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
+00008710: 7175 6972 6564 290a 0a0a 2020 2020 6465  quired)...    de
+00008720: 6620 7365 7469 4644 4f46 696c 654e 616d  f setiFDOFileNam
+00008730: 6528 7365 6c66 2c69 4644 4f66 696c 653a  e(self,iFDOfile:
+00008740: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
+00008750: 2220 5365 7420 7468 6520 6375 7272 656e  " Set the curren
+00008760: 7420 6946 444f 2066 696c 6520 6e61 6d65  t iFDO file name
+00008770: 2077 6974 6820 7061 7468 2e20 5365 7420   with path. Set 
+00008780: 746f 2022 2220 696e 206f 7264 6572 2074  to "" in order t
+00008790: 6f20 6765 7420 6465 6661 756c 7420 6e61  o get default na
+000087a0: 6d65 2061 6e64 206c 6f63 6174 696f 6e2e  me and location.
+000087b0: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+000087c0: 662e 6946 444f 6669 6c65 5f20 3d20 6946  f.iFDOfile_ = iF
+000087d0: 444f 6669 6c65 0a20 2020 2020 2020 2073  DOfile.        s
+000087e0: 656c 662e 6946 444f 6669 6c65 5f20 3d20  elf.iFDOfile_ = 
+000087f0: 7365 6c66 2e67 6574 6946 444f 4669 6c65  self.getiFDOFile
+00008800: 4e61 6d65 2829 2023 2063 6f6e 7374 7275  Name() # constru
+00008810: 6374 2064 6566 6175 6c74 206e 616d 6520  ct default name 
+00008820: 6966 2065 6d70 7479 0a20 2020 2020 2020  if empty.       
+00008830: 2069 6620 6d69 7174 632e 6173 7365 7274   if miqtc.assert
+00008840: 536c 6173 6828 6f73 2e70 6174 682e 6469  Slash(os.path.di
+00008850: 726e 616d 6528 7365 6c66 2e69 4644 4f66  rname(self.iFDOf
+00008860: 696c 655f 2929 2021 3d20 6d69 7174 632e  ile_)) != miqtc.
+00008870: 6173 7365 7274 536c 6173 6828 7365 6c66  assertSlash(self
+00008880: 2e64 6972 2e74 6f28 7365 6c66 2e64 6972  .dir.to(self.dir
+00008890: 2e64 742e 7072 6f64 7563 7473 2929 3a0a  .dt.products)):.
+000088a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000088b0: 2e70 726f 762e 6c6f 6728 2243 6175 7469  .prov.log("Cauti
+000088c0: 6f6e 2120 6946 444f 2066 696c 6520 7061  on! iFDO file pa
+000088d0: 7468 2069 7320 6e6f 7420 696e 2027 7072  th is not in 'pr
+000088e0: 6f64 7563 7473 2720 7375 6220 666f 6c64  oducts' sub fold
+000088f0: 6572 2061 7320 7265 636f 6d6d 656e 6465  er as recommende
+00008900: 642e 2043 6f6e 7369 6465 7220 7265 7365  d. Consider rese
+00008910: 7474 696e 6720 7769 7468 2073 6574 6946  tting with setiF
+00008920: 444f 4669 6c65 4e61 6d65 2829 2e20 2220  DOFileName(). " 
+00008930: 2b20 6946 444f 6669 6c65 290a 2020 2020  + iFDOfile).    
+00008940: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00008950: 2020 2020 2065 7665 6e74 203d 2073 656c       event = sel
+00008960: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+00008970: 696d 6167 652d 6576 656e 7427 295b 276e  image-event')['n
+00008980: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+00008990: 2020 7365 6e73 6f72 203d 2073 656c 662e    sensor = self.
+000089a0: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+000089b0: 6167 652d 7365 6e73 6f72 2729 5b27 6e61  age-sensor')['na
+000089c0: 6d65 275d 0a20 2020 2020 2020 2065 7863  me'].        exc
+000089d0: 6570 7420 6d69 7174 632e 4966 646f 4578  ept miqtc.IfdoEx
+000089e0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+000089f0: 2020 2020 2065 7665 6e74 203d 2073 656c       event = sel
+00008a00: 662e 6469 722e 6576 656e 7428 290a 2020  f.dir.event().  
+00008a10: 2020 2020 2020 2020 2020 7365 6e73 6f72            sensor
+00008a20: 203d 2073 656c 662e 6469 722e 7365 6e73   = self.dir.sens
+00008a30: 6f72 2829 0a0a 2020 2020 2020 2020 6946  or()..        iF
+00008a40: 444f 6669 6c65 4e61 6d65 203d 206f 732e  DOfileName = os.
+00008a50: 7061 7468 2e62 6173 656e 616d 6528 7365  path.basename(se
+00008a60: 6c66 2e69 4644 4f66 696c 655f 290a 2020  lf.iFDOfile_).  
+00008a70: 2020 2020 2020 6966 206e 6f74 2065 7665        if not eve
+00008a80: 6e74 2069 6e20 6946 444f 6669 6c65 4e61  nt in iFDOfileNa
+00008a90: 6d65 206f 7220 6e6f 7420 6946 444f 2e67  me or not iFDO.g
+00008aa0: 6574 5368 6f72 7445 7175 6970 6d65 6e74  etShortEquipment
+00008ab0: 4944 2873 656e 736f 7229 2069 6e20 6946  ID(sensor) in iF
+00008ac0: 444f 6669 6c65 4e61 6d65 3a0a 2020 2020  DOfileName:.    
+00008ad0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00008ae0: 762e 6c6f 6728 2243 6175 7469 6f6e 2120  v.log("Caution! 
+00008af0: 6946 444f 2066 696c 6520 6e61 6d65 2064  iFDO file name d
+00008b00: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
+00008b10: 7072 6f6a 6563 742c 2065 7665 6e74 2061  project, event a
+00008b20: 6e64 2073 656e 736f 7220 6e61 6d65 2061  nd sensor name a
+00008b30: 7320 7265 636f 6d6d 656e 6465 642e 2043  s recommended. C
+00008b40: 6f6e 7369 6465 7220 7265 7365 7474 696e  onsider resettin
+00008b50: 6720 7769 7468 2073 6574 6946 444f 4669  g with setiFDOFi
+00008b60: 6c65 4e61 6d65 2829 2e20 2220 2b20 6946  leName(). " + iF
+00008b70: 444f 6669 6c65 290a 0a0a 2020 2020 6465  DOfile)...    de
+00008b80: 6620 6765 7469 4644 4f46 696c 654e 616d  f getiFDOFileNam
+00008b90: 6528 7365 6c66 2c6f 7665 7277 7269 7465  e(self,overwrite
+00008ba0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00008bb0: 2022 2222 2052 6574 7572 6e73 2074 6865   """ Returns the
+00008bc0: 2063 7572 7265 6e74 2069 4644 4f20 6669   current iFDO fi
+00008bd0: 6c65 2773 206e 616d 6520 7769 7468 2070  le's name with p
+00008be0: 6174 682e 2049 6620 6e6f 7420 7365 7420  ath. If not set 
+00008bf0: 7965 7420 6f72 206f 7665 7277 7269 7465  yet or overwrite
+00008c00: 3d3d 5472 7565 2069 7420 7265 7475 726e  ==True it return
+00008c10: 7320 7468 6520 6f6e 6520 6d61 7463 6869  s the one matchi
+00008c20: 6e67 2069 6d61 6765 2d73 6574 2d6e 616d  ng image-set-nam
+00008c30: 652e 2022 2222 0a20 2020 2020 2020 2069  e. """.        i
+00008c40: 6620 7365 6c66 2e69 4644 4f66 696c 655f  f self.iFDOfile_
+00008c50: 203d 3d20 2222 206f 7220 6f76 6572 7772   == "" or overwr
+00008c60: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
+00008c70: 2066 696c 655f 6e61 6d65 203d 2073 656c   file_name = sel
+00008c80: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+00008c90: 696d 6167 652d 7365 742d 6e61 6d65 2729  image-set-name')
+00008ca0: 202b 2027 5f69 4644 4f2e 6a73 6f6e 270a   + '_iFDO.json'.
+00008cb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00008cc0: 656c 662e 6946 444f 6669 6c65 5f20 213d  elf.iFDOfile_ !=
+00008cd0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00008ce0: 2020 2020 2023 2072 656e 616d 6520 6669       # rename fi
+00008cf0: 6c65 2062 7574 206b 6565 7020 6c6f 6361  le but keep loca
+00008d00: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+00008d10: 2020 2020 2069 6620 6669 6c65 5f6e 616d       if file_nam
+00008d20: 6520 213d 206f 732e 7061 7468 2e62 6173  e != os.path.bas
+00008d30: 656e 616d 6528 7365 6c66 2e69 4644 4f66  ename(self.iFDOf
+00008d40: 696c 655f 2920 616e 6420 6f73 2e70 6174  ile_) and os.pat
+00008d50: 682e 6578 6973 7473 2873 656c 662e 6946  h.exists(self.iF
+00008d60: 444f 6669 6c65 5f29 3a0a 2020 2020 2020  DOfile_):.      
+00008d70: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00008d80: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
+00008d90: 7469 6f6e 2120 6966 646f 2066 696c 6520  tion! ifdo file 
+00008da0: 7265 6e61 6d65 6420 746f 2022 202b 2066  renamed to " + f
+00008db0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+00008dc0: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00008dd0: 4644 4f66 696c 655f 203d 206f 732e 7061  FDOfile_ = os.pa
+00008de0: 7468 2e6a 6f69 6e28 6f73 2e70 6174 682e  th.join(os.path.
+00008df0: 6469 726e 616d 6528 7365 6c66 2e69 4644  dirname(self.iFD
+00008e00: 4f66 696c 655f 292c 6669 6c65 5f6e 616d  Ofile_),file_nam
+00008e10: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+00008e20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00008e30: 2020 2020 2073 656c 662e 6946 444f 6669       self.iFDOfi
+00008e40: 6c65 5f20 3d20 6f73 2e70 6174 682e 6a6f  le_ = os.path.jo
+00008e50: 696e 2873 656c 662e 6469 722e 746f 2873  in(self.dir.to(s
+00008e60: 656c 662e 6469 722e 6474 2e70 726f 6475  elf.dir.dt.produ
+00008e70: 6374 7329 2c20 6669 6c65 5f6e 616d 6529  cts), file_name)
+00008e80: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008e90: 7365 6c66 2e69 4644 4f66 696c 655f 0a0a  self.iFDOfile_..
+00008ea0: 0a20 2020 2064 6566 2073 6574 5f69 6d61  .    def set_ima
+00008eb0: 6765 5f73 6574 5f6e 616d 655f 6669 656c  ge_set_name_fiel
+00008ec0: 645f 6672 6f6d 5f70 726f 6a65 6374 5f65  d_from_project_e
+00008ed0: 7665 6e74 5f73 656e 736f 7228 7365 6c66  vent_sensor(self
+00008ee0: 293a 0a20 2020 2020 2020 2022 2222 2053  ):.        """ S
+00008ef0: 6574 7320 6669 656c 6420 696d 6167 652d  ets field image-
+00008f00: 7365 742d 6e61 6d65 2066 726f 6d20 6375  set-name from cu
+00008f10: 7272 656e 7420 746d 7020 6669 656c 6473  rrent tmp fields
+00008f20: 2066 6f72 2070 726f 6a65 6374 2c20 6576   for project, ev
+00008f30: 656e 7420 616e 6420 7365 6e73 6f72 2e20  ent and sensor. 
+00008f40: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00008f50: 2069 6d61 6765 2d73 6574 2d6e 616d 6520   image-set-name 
+00008f60: 7661 6c75 652e 2022 2222 0a20 2020 2020  value. """.     
+00008f70: 2020 206e 6577 5f69 6d61 6765 5f73 6574     new_image_set
+00008f80: 5f6e 616d 6520 3d20 7365 6c66 2e63 6f6e  _name = self.con
+00008f90: 7374 7275 6374 496d 6167 6553 6574 4e61  structImageSetNa
+00008fa0: 6d65 2873 656c 662e 6966 646f 5f74 6d70  me(self.ifdo_tmp
+00008fb0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00008fc0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+00008fd0: 7072 6f6a 6563 7427 5d5b 276e 616d 6527  project']['name'
+00008fe0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00008ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009010: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+00009020: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+00009030: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+00009040: 6167 652d 6576 656e 7427 5d5b 276e 616d  age-event']['nam
+00009050: 6527 5d2c 0a20 2020 2020 2020 2020 2020  e'],.           
+00009060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009080: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
+00009090: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+000090a0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+000090b0: 696d 6167 652d 7365 6e73 6f72 275d 5b27  image-sensor']['
+000090c0: 6e61 6d65 275d 290a 2020 2020 2020 2020  name']).        
+000090d0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+000090e0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+000090f0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
+00009100: 2d6e 616d 6527 5d20 3d20 6e65 775f 696d  -name'] = new_im
+00009110: 6167 655f 7365 745f 6e61 6d65 0a20 2020  age_set_name.   
+00009120: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+00009130: 696d 6167 655f 7365 745f 6e61 6d65 0a20  image_set_name. 
+00009140: 2020 2020 2020 200a 0a20 2020 2040 7374         ..    @st
+00009150: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+00009160: 6566 2063 6f6e 7374 7275 6374 496d 6167  ef constructImag
+00009170: 6553 6574 4e61 6d65 2870 726f 6a65 6374  eSetName(project
+00009180: 3a73 7472 2c65 7665 6e74 3a73 7472 2c73  :str,event:str,s
+00009190: 656e 736f 723a 7374 7229 3a0a 2020 2020  ensor:str):.    
+000091a0: 2020 2020 2222 2220 7265 7475 726e 7320      """ returns 
+000091b0: 3c70 726f 6a65 6374 3e5f 3c65 7665 6e74  <project>_<event
+000091c0: 3e5f 3c73 656e 736f 723e 2c20 7769 7468  >_<sensor>, with
+000091d0: 2073 686f 7274 2076 6572 7369 6f6e 206f   short version o
+000091e0: 6620 3c73 656e 736f 723e 2028 6f6e 6c79  f <sensor> (only
+000091f0: 2069 6429 2c20 7072 6576 656e 7469 6e67   id), preventing
+00009200: 2070 6f74 656e 7469 616c 2064 6f75 626c   potential doubl
+00009210: 696e 6720 6f66 203c 7072 6f6a 6563 743e  ing of <project>
+00009220: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+00009230: 6e73 6f72 5f73 686f 7274 203d 2069 4644  nsor_short = iFD
+00009240: 4f2e 6765 7453 686f 7274 4571 7569 706d  O.getShortEquipm
+00009250: 656e 7449 4428 7365 6e73 6f72 290a 2020  entID(sensor).  
+00009260: 2020 2020 2020 6966 206c 656e 2865 7665        if len(eve
+00009270: 6e74 2920 3e20 6c65 6e28 7072 6f6a 6563  nt) > len(projec
+00009280: 7429 2061 6e64 2065 7665 6e74 5b30 3a6c  t) and event[0:l
+00009290: 656e 2870 726f 6a65 6374 295d 203d 3d20  en(project)] == 
+000092a0: 7072 6f6a 6563 743a 0a20 2020 2020 2020  project:.       
+000092b0: 2020 2020 2069 6d61 6765 5f73 6574 5f6e       image_set_n
+000092c0: 616d 655f 203d 2065 7665 6e74 202b 2022  ame_ = event + "
+000092d0: 5f22 202b 2073 656e 736f 725f 7368 6f72  _" + sensor_shor
+000092e0: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
+000092f0: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00009300: 655f 7365 745f 6e61 6d65 5f20 3d20 7072  e_set_name_ = pr
+00009310: 6f6a 6563 7420 2b20 225f 2220 2b20 6576  oject + "_" + ev
+00009320: 656e 7420 2b20 225f 2220 2b20 7365 6e73  ent + "_" + sens
+00009330: 6f72 5f73 686f 7274 0a20 2020 2020 2020  or_short.       
+00009340: 2072 6574 7572 6e20 696d 6167 655f 7365   return image_se
+00009350: 745f 6e61 6d65 5f20 2320 544f 444f 2069  t_name_ # TODO i
+00009360: 6e63 6c75 6465 2064 6174 6154 7970 653f  nclude dataType?
+00009370: 0a0a 0a20 2020 2040 7374 6174 6963 6d65  ...    @staticme
+00009380: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00009390: 5368 6f72 7445 7175 6970 6d65 6e74 4944  ShortEquipmentID
+000093a0: 2865 7175 6970 6d65 6e74 4944 3a73 7472  (equipmentID:str
+000093b0: 293a 0a20 2020 2020 2020 2022 2222 2072  ):.        """ r
+000093c0: 6574 7572 6e73 2065 7175 6970 6d65 6e74  eturns equipment
+000093d0: 2069 6420 7769 7468 6f75 7420 706f 7465   id without pote
+000093e0: 6e74 6961 6c6c 206c 6f6e 6720 3c6e 616d  ntiall long <nam
+000093f0: 653e 2070 6172 742c 2069 2e65 2e3a 203c  e> part, i.e.: <
+00009400: 6f77 6e65 723e 5f3c 7479 7065 3e2d 3c74  owner>_<type>-<t
+00009410: 7970 6520 696e 6465 785b 5f3c 7375 6274  ype index[_<subt
+00009420: 7970 653e 5d20 2222 220a 2020 2020 2020  ype>] """.      
+00009430: 2020 7265 7475 726e 2027 5f27 2e6a 6f69    return '_'.joi
+00009440: 6e28 6571 7569 706d 656e 7449 442e 7370  n(equipmentID.sp
+00009450: 6c69 7428 275f 2729 5b30 3a33 5d29 0a0a  lit('_')[0:3])..
+00009460: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
+00009470: 640a 2020 2020 6465 6620 636f 6e73 7472  d.    def constr
+00009480: 7563 7469 4644 4f66 696c 654e 616d 6528  uctiFDOfileName(
+00009490: 7072 6f6a 6563 743a 7374 722c 6576 656e  project:str,even
+000094a0: 743a 7374 722c 7365 6e73 6f72 3a73 7472  t:str,sensor:str
+000094b0: 293a 0a20 2020 2020 2020 2022 2222 2072  ):.        """ r
+000094c0: 6574 7572 6e73 203c 636f 6e73 7472 7563  eturns <construc
+000094d0: 7449 6d61 6765 5365 744e 616d 6528 293e  tImageSetName()>
+000094e0: 5f69 4644 4f2e 6a73 6f6e 2022 2222 0a20  _iFDO.json """. 
+000094f0: 2020 2020 2020 2072 6574 7572 6e20 6946         return iF
+00009500: 444f 2e63 6f6e 7374 7275 6374 496d 6167  DO.constructImag
+00009510: 6553 6574 4e61 6d65 2870 726f 6a65 6374  eSetName(project
+00009520: 2c65 7665 6e74 2c73 656e 736f 7229 202b  ,event,sensor) +
+00009530: 2027 5f69 4644 4f2e 6a73 6f6e 2720 0a0a   '_iFDO.json' ..
+00009540: 2020 2020 0a20 2020 2040 7374 6174 6963      .    @static
+00009550: 6d65 7468 6f64 0a20 2020 2064 6566 205f  method.    def _
+00009560: 5f67 6574 4669 656c 6456 616c 7565 2869  _getFieldValue(i
+00009570: 6664 6f3a 6469 6374 2c6b 6579 733a 6c69  fdo:dict,keys:li
+00009580: 7374 2c64 6566 6175 6c74 5f6f 6e6c 7920  st,default_only 
+00009590: 3d20 4661 6c73 6529 3a0a 2020 2020 2020  = False):.      
+000095a0: 2020 2222 2220 7265 7475 726e 7320 636f    """ returns co
+000095b0: 7079 206f 6620 7365 7420 6f72 2069 7465  py of set or ite
+000095c0: 6d20 6669 656c 6420 7661 6c75 652c 2061  m field value, a
+000095d0: 6c73 6f20 636f 6e73 6964 6572 6e67 2064  lso considerng d
+000095e0: 6566 6175 6c74 2076 616c 7565 7320 6672  efault values fr
+000095f0: 6f6d 2068 6561 6465 722e 0a20 2020 2020  om header..     
+00009600: 2020 2020 2020 2055 7365 206b 6579 7320         Use keys 
+00009610: 6173 2065 2e67 2e20 5b3c 6974 656d 3e2c  as e.g. [<item>,
+00009620: 3c6b 6579 3e2c 2e2e 5d2e 2043 616e 2062  <key>,..]. Can b
+00009630: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
+00009640: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
+00009650: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
+00009660: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
+00009670: 6d20 696e 6465 7820 6361 6e20 6265 206e  m index can be n
+00009680: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
+00009690: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
+000096a0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
+000096b0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
+000096c0: 2069 7320 7265 7475 726e 6564 0a20 2020   is returned.   
+000096d0: 2020 2020 2020 2020 2075 6e6c 6573 7320           unless 
+000096e0: 6465 6661 756c 745f 6f6e 6c79 203d 2046  default_only = F
+000096f0: 616c 7365 2c20 7468 656e 2064 6566 6175  alse, then defau
+00009700: 6c74 2076 616c 7565 7320 6174 2069 6e64  lt values at ind
+00009710: 6578 2030 2069 7320 7265 7475 726e 6564  ex 0 is returned
+00009720: 2e0a 2020 2020 2020 2020 2020 2020 5261  ..            Ra
+00009730: 6973 6573 2049 6664 6f45 7863 6570 7469  ises IfdoExcepti
+00009740: 6f6e 2069 6620 6b65 7973 2064 6f20 6e6f  on if keys do no
+00009750: 7420 6578 6973 742e 2022 2222 0a0a 2020  t exist. """..  
+00009760: 2020 2020 2020 6966 206e 6f74 206d 6971        if not miq
+00009770: 7476 2e69 6d61 6765 5f73 6574 5f69 7465  tv.image_set_ite
+00009780: 6d73 5f6b 6579 2069 6e20 6966 646f 206f  ms_key in ifdo o
+00009790: 7220 6e6f 7420 6d69 7174 762e 696d 6167  r not miqtv.imag
+000097a0: 655f 7365 745f 6865 6164 6572 5f6b 6579  e_set_header_key
+000097b0: 2069 6e20 6966 646f 3a0a 2020 2020 2020   in ifdo:.      
+000097c0: 2020 2020 2020 7261 6973 6520 6d69 7174        raise miqt
+000097d0: 632e 4966 646f 4578 6365 7074 696f 6e28  c.IfdoException(
+000097e0: 2249 6e76 616c 6964 2069 6664 6f20 6469  "Invalid ifdo di
+000097f0: 6374 2c20 6d69 7373 696e 6720 6974 656d  ct, missing item
+00009800: 7320 6f72 2068 6561 6465 7220 6b65 793a  s or header key:
+00009810: 2022 202b 2073 7472 2869 6664 6f29 290a   " + str(ifdo)).
+00009820: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+00009830: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+00009840: 6365 286b 6579 732c 6c69 7374 293a 0a20  ce(keys,list):. 
+00009850: 2020 2020 2020 2020 2020 206b 6579 7320             keys 
+00009860: 3d20 5b6b 6579 735d 0a0a 2020 2020 2020  = [keys]..      
+00009870: 2020 2320 7265 6d6f 7665 2068 6561 6465    # remove heade
+00009880: 7220 6f72 2069 7465 6d20 7072 6566 6978  r or item prefix
+00009890: 6573 2069 6620 7468 6572 650a 2020 2020  es if there.    
+000098a0: 2020 2020 6966 206b 6579 735b 305d 203d      if keys[0] =
+000098b0: 3d20 6d69 7174 762e 696d 6167 655f 7365  = miqtv.image_se
+000098c0: 745f 6974 656d 735f 6b65 7920 6f72 206b  t_items_key or k
+000098d0: 6579 735b 305d 203d 3d20 6d69 7174 762e  eys[0] == miqtv.
+000098e0: 696d 6167 655f 7365 745f 6865 6164 6572  image_set_header
+000098f0: 5f6b 6579 3a0a 2020 2020 2020 2020 2020  _key:.          
+00009900: 2020 6b65 7973 203d 206b 6579 735b 313a    keys = keys[1:
+00009910: 3a5d 0a0a 2020 2020 2020 2020 6865 6164  :]..        head
+00009920: 6572 203d 2069 6664 6f5b 6d69 7174 762e  er = ifdo[miqtv.
+00009930: 696d 6167 655f 7365 745f 6865 6164 6572  image_set_header
+00009940: 5f6b 6579 5d0a 2020 2020 2020 2020 6974  _key].        it
+00009950: 656d 7320 3d20 6966 646f 5b6d 6971 7476  ems = ifdo[miqtv
+00009960: 2e69 6d61 6765 5f73 6574 5f69 7465 6d73  .image_set_items
+00009970: 5f6b 6579 5d0a 2020 2020 2020 2020 2320  _key].        # 
+00009980: 6c6f 6f6b 2066 6f72 2064 6566 6175 6c74  look for default
+00009990: 2076 616c 7565 0a20 2020 2020 2020 2066   value.        f
+000099a0: 6f72 2073 6b69 7070 6564 496e 4865 6164  or skippedInHead
+000099b0: 6572 2069 6e20 7261 6e67 6528 6c65 6e28  er in range(len(
+000099c0: 6b65 7973 2929 3a0a 2020 2020 2020 2020  keys)):.        
+000099d0: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
+000099e0: 2066 696e 6446 6965 6c64 2868 6561 6465   findField(heade
+000099f0: 722c 6b65 7973 5b73 6b69 7070 6564 496e  r,keys[skippedIn
+00009a00: 4865 6164 6572 3a3a 5d29 0a20 2020 2020  Header::]).     
+00009a10: 2020 2020 2020 2069 6620 6465 6661 756c         if defaul
+00009a20: 7456 616c 2021 3d20 2222 3a0a 2020 2020  tVal != "":.    
+00009a30: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00009a40: 6b0a 0a20 2020 2020 2020 2023 2320 6c6f  k..        ## lo
+00009a50: 6f6b 2066 6f72 2069 7465 6d20 7661 6c75  ok for item valu
+00009a60: 650a 2020 2020 2020 2020 2320 6865 6164  e.        # head
+00009a70: 6572 206f 6e6c 7920 7661 6c75 652c 2064  er only value, d
+00009a80: 6f6e 2774 2063 6865 636b 2069 6e20 6974  on't check in it
+00009a90: 656d 730a 2020 2020 2020 2020 6966 2066  ems.        if f
+00009aa0: 696e 6446 6965 6c64 2869 7465 6d73 2c6b  indField(items,k
+00009ab0: 6579 735b 303a 315d 2920 3d3d 2022 2220  eys[0:1]) == "" 
+00009ac0: 616e 6420 736b 6970 7065 6449 6e48 6561  and skippedInHea
+00009ad0: 6465 7220 3d3d 2030 3a0a 2020 2020 2020  der == 0:.      
+00009ae0: 2020 2020 2020 7265 7420 3d20 6465 6661        ret = defa
+00009af0: 756c 7456 616c 0a20 2020 2020 2020 2020  ultVal.         
+00009b00: 2020 2069 6620 7265 7420 3d3d 2022 223a     if ret == "":
+00009b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009b20: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00009b30: 6f45 7863 6570 7469 6f6e 2822 6b65 7920  oException("key 
+00009b40: 646f 6573 206e 6f74 2065 7869 7374 3a22  does not exist:"
+00009b50: 202b 2073 7472 286b 6579 7329 290a 2020   + str(keys)).  
+00009b60: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00009b70: 2020 2020 2020 2020 2320 6966 2066 6972          # if fir
+00009b80: 7374 206b 6579 206e 6f74 2066 6f75 6e64  st key not found
+00009b90: 2069 6e20 6974 656d 732c 2069 2e65 2e20   in items, i.e. 
+00009ba0: 6973 206e 6f74 2061 2069 6d61 6765 206e  is not a image n
+00009bb0: 616d 652c 2061 6e64 2066 6972 7374 206b  ame, and first k
+00009bc0: 6579 2069 7320 6e6f 7420 6120 6865 6164  ey is not a head
+00009bd0: 6572 206b 6579 3a0a 2020 2020 2020 2020  er key:.        
+00009be0: 2020 2020 6966 2066 696e 6446 6965 6c64      if findField
+00009bf0: 2869 7465 6d73 2c6b 6579 735b 303a 315d  (items,keys[0:1]
+00009c00: 2920 3d3d 2022 2220 616e 6420 736b 6970  ) == "" and skip
+00009c10: 7065 6449 6e48 6561 6465 7220 213d 2030  pedInHeader != 0
+00009c20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009c30: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+00009c40: 646f 4578 6365 7074 696f 6e28 2269 7465  doException("ite
+00009c50: 6d20 646f 6573 206e 6f74 2065 7869 7374  m does not exist
+00009c60: 3a22 202b 2073 7472 286b 6579 735b 303a  :" + str(keys[0:
+00009c70: 315d 2929 0a0a 2020 2020 2020 2020 2020  1]))..          
+00009c80: 2020 2320 6368 6563 6b20 6966 2069 6e64    # check if ind
+00009c90: 6578 2070 726f 7669 6465 640a 2020 2020  ex provided.    
+00009ca0: 2020 2020 2020 2020 696e 6465 7850 726f          indexPro
+00009cb0: 7669 6465 6420 3d20 5472 7565 0a20 2020  vided = True.   
+00009cc0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00009cd0: 6b65 7973 2920 3e20 313a 0a20 2020 2020  keys) > 1:.     
+00009ce0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00009cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d00: 2020 2020 696e 6465 7820 3d20 696e 7428      index = int(
+00009d10: 6b65 7973 5b31 5d29 0a20 2020 2020 2020  keys[1]).       
+00009d20: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00009d30: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00009d40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00009d50: 6e64 6578 5072 6f76 6964 6564 203d 2046  ndexProvided = F
+00009d60: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00009d70: 2065 6c69 6620 6c65 6e28 6b65 7973 2920   elif len(keys) 
+00009d80: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00009d90: 2020 2020 2020 696e 6465 7850 726f 7669        indexProvi
+00009da0: 6465 6420 3d20 4661 6c73 650a 2020 2020  ded = False.    
+00009db0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00009dc0: 2020 2020 2020 2020 2069 6d61 6765 4974           imageIt
+00009dd0: 656d 5469 6d65 506f 696e 7473 203d 2069  emTimePoints = i
+00009de0: 7465 6d73 5b6b 6579 735b 305d 5d0a 0a20  tems[keys[0]].. 
+00009df0: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00009e00: 6465 7850 726f 7669 6465 643a 0a20 2020  dexProvided:.   
+00009e10: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00009e20: 6620 6b65 7920 6973 2077 686f 6c65 2069  f key is whole i
+00009e30: 6d61 6765 2061 6464 2061 6c6c 2076 616c  mage add all val
+00009e40: 7565 7320 6672 6f6d 2068 6561 6465 720a  ues from header.
+00009e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009e60: 6966 206c 656e 286b 6579 7329 203d 3d20  if len(keys) == 
+00009e70: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
+00009e80: 2020 2020 2020 2064 6566 6175 6c74 5661         defaultVa
+00009e90: 6c20 3d20 6865 6164 6572 0a20 2020 2020  l = header.     
+00009ea0: 2020 2020 2020 2020 2020 2023 2061 6464             # add
+00009eb0: 2064 6566 6175 6c74 2066 726f 6d20 696e   default from in
+00009ec0: 6465 7820 300a 2020 2020 2020 2020 2020  dex 0.          
+00009ed0: 2020 2020 2020 6966 206c 656e 286b 6579        if len(key
+00009ee0: 7329 203e 2031 2061 6e64 2069 6e64 6578  s) > 1 and index
+00009ef0: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
+00009f00: 2020 2020 2020 2020 2020 206b 6579 735f             keys_
+00009f10: 3020 3d20 636f 7079 2e64 6565 7063 6f70  0 = copy.deepcop
+00009f20: 7928 6b65 7973 290a 2020 2020 2020 2020  y(keys).        
+00009f30: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
+00009f40: 5f30 5b31 5d20 3d20 300a 2020 2020 2020  _0[1] = 0.      
+00009f50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00009f60: 745f 3020 3d20 6946 444f 2e5f 5f67 6574  t_0 = iFDO.__get
+00009f70: 4974 656d 5661 6c75 6528 6974 656d 732c  ItemValue(items,
+00009f80: 6b65 7973 5f30 2c73 6b69 7070 6564 496e  keys_0,skippedIn
+00009f90: 4865 6164 6572 2c64 6566 6175 6c74 5661  Header,defaultVa
+00009fa0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+00009fb0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00009fc0: 616e 6365 2872 6574 5f30 2c64 6963 7429  ance(ret_0,dict)
+00009fd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009fe0: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
+00009ff0: 7456 616c 203d 207b 2a2a 6465 6661 756c  tVal = {**defaul
+0000a000: 7456 616c 2c2a 2a72 6574 5f30 7d0a 2020  tVal,**ret_0}.  
+0000a010: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000a020: 7420 3d20 6946 444f 2e5f 5f67 6574 4974  t = iFDO.__getIt
+0000a030: 656d 5661 6c75 6528 6974 656d 732c 6b65  emValue(items,ke
+0000a040: 7973 2c73 6b69 7070 6564 496e 4865 6164  ys,skippedInHead
+0000a050: 6572 2c64 6566 6175 6c74 5661 6c29 0a20  er,defaultVal). 
+0000a060: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0000a070: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000a080: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a090: 6966 206b 6579 2069 7320 7768 6f6c 6520  if key is whole 
+0000a0a0: 696d 6167 6520 6164 6420 616c 6c20 7661  image add all va
+0000a0b0: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
+0000a0c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a0d0: 2069 6620 6c65 6e28 6b65 7973 2920 3d3d   if len(keys) ==
+0000a0e0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+0000a0f0: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
+0000a100: 616c 203d 2068 6561 6465 720a 0a20 2020  al = header..   
+0000a110: 2020 2020 2020 2020 2020 2020 2023 2070               # p
+0000a120: 6963 7475 7265 202d 3e20 6a75 7374 206f  icture -> just o
+0000a130: 6e65 2065 6e74 7279 2c20 696e 7365 7274  ne entry, insert
+0000a140: 2069 6e64 6578 2030 0a20 2020 2020 2020   index 0.       
+0000a150: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0000a160: 696d 6167 6549 7465 6d54 696d 6550 6f69  imageItemTimePoi
+0000a170: 6e74 7329 203d 3d20 313a 0a20 2020 2020  nts) == 1:.     
+0000a180: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000a190: 6579 7320 3d20 6b65 7973 5b30 3a31 5d20  eys = keys[0:1] 
+0000a1a0: 2b20 5b30 5d20 2b20 6b65 7973 5b31 3a3a  + [0] + keys[1::
+0000a1b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000a1c0: 2020 2020 2020 7265 7420 3d20 6946 444f        ret = iFDO
+0000a1d0: 2e5f 5f67 6574 4974 656d 5661 6c75 6528  .__getItemValue(
+0000a1e0: 6974 656d 732c 6b65 7973 2c73 6b69 7070  items,keys,skipp
+0000a1f0: 6564 496e 4865 6164 6572 2c64 6566 6175  edInHeader,defau
+0000a200: 6c74 5661 6c29 0a20 2020 2020 2020 2020  ltVal).         
+0000a210: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+0000a220: 2020 2020 2020 2020 2020 2020 2320 7669              # vi
+0000a230: 6465 6f20 2d3e 2072 6574 7572 6e20 7661  deo -> return va
+0000a240: 6c75 6573 2066 6f72 2065 6163 6820 7469  lues for each ti
+0000a250: 6d65 2073 7461 6d70 0a20 2020 2020 2020  me stamp.       
+0000a260: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000a270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a280: 2020 2072 6574 203d 207b 7d0a 2020 2020     ret = {}.    
+0000a290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2a0: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+0000a2b0: 656e 2869 6d61 6765 4974 656d 5469 6d65  en(imageItemTime
+0000a2c0: 506f 696e 7473 2929 3a0a 2020 2020 2020  Points)):.      
 0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2e0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a300: 2020 2020 2020 7265 745b 7469 6d65 506f        ret[timePo
-0000a310: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-0000a320: 6174 6574 696d 6527 5d5d 203d 2076 616c  atetime']] = val
-0000a330: 5f69 0a20 2020 2020 2020 2020 2020 2020  _i.             
-0000a340: 2020 2020 2020 2020 2020 2023 2072 656d             # rem
-0000a350: 6f76 6520 696d 6167 652d 6461 7465 7469  ove image-dateti
-0000a360: 6d65 2069 6620 7468 6572 650a 2020 2020  me if there.    
-0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a380: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000a390: 6528 7265 745b 7469 6d65 506f 696e 7444  e(ret[timePointD
-0000a3a0: 6174 615b 2769 6d61 6765 2d64 6174 6574  ata['image-datet
-0000a3b0: 696d 6527 5d5d 2c64 6963 7429 2061 6e64  ime']],dict) and
-0000a3c0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-0000a3d0: 2720 696e 2072 6574 5b74 696d 6550 6f69  ' in ret[timePoi
-0000a3e0: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
-0000a3f0: 7465 7469 6d65 275d 5d3a 0a20 2020 2020  tetime']]:.     
-0000a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a410: 2020 2020 2020 2064 656c 2072 6574 5b74         del ret[t
-0000a420: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
-0000a430: 6167 652d 6461 7465 7469 6d65 275d 5d5b  age-datetime']][
-0000a440: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0000a450: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000a460: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
-0000a470: 6f20 6465 6661 756c 7473 0a20 2020 2020  o defaults.     
-0000a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a490: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
-0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4b0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-0000a4c0: 6e73 7461 6e63 6528 7265 745b 7469 6d65  nstance(ret[time
-0000a4d0: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
-0000a4e0: 2d64 6174 6574 696d 6527 5d5d 2c64 6963  -datetime']],dic
-0000a4f0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0000a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a510: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
-0000a520: 207b 2a2a 6465 6661 756c 7456 616c 2c2a   {**defaultVal,*
-0000a530: 2a72 6574 5b74 696d 6550 6f69 6e74 4461  *ret[timePointDa
-0000a540: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
-0000a550: 6d65 275d 5d7d 0a20 2020 2020 2020 2020  me']]}.         
-0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a570: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a590: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-0000a5a0: 5661 6c20 3d20 7265 745b 7469 6d65 506f  Val = ret[timePo
-0000a5b0: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
-0000a5c0: 6174 6574 696d 6527 5d5d 0a0a 2020 2020  atetime']]..    
+0000a2e0: 2020 7469 6d65 506f 696e 7444 6174 6120    timePointData 
+0000a2f0: 3d20 696d 6167 6549 7465 6d54 696d 6550  = imageItemTimeP
+0000a300: 6f69 6e74 735b 695d 0a20 2020 2020 2020  oints[i].       
+0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a320: 206b 6579 735f 6920 3d20 6b65 7973 5b30   keys_i = keys[0
+0000a330: 3a31 5d20 2b20 5b69 5d20 2b20 6b65 7973  :1] + [i] + keys
+0000a340: 5b31 3a3a 5d0a 2020 2020 2020 2020 2020  [1::].          
+0000a350: 2020 2020 2020 2020 2020 2020 2020 7661                va
+0000a360: 6c5f 6920 3d20 6946 444f 2e5f 5f67 6574  l_i = iFDO.__get
+0000a370: 4974 656d 5661 6c75 6528 6974 656d 732c  ItemValue(items,
+0000a380: 6b65 7973 5f69 2c73 6b69 7070 6564 496e  keys_i,skippedIn
+0000a390: 4865 6164 6572 2c64 6566 6175 6c74 5661  Header,defaultVa
+0000a3a0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+0000a3b0: 2020 2020 2020 2020 2020 2023 2064 6566             # def
+0000a3c0: 6175 6c74 206f 6e6c 790a 2020 2020 2020  ault only.      
+0000a3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3e0: 2020 6966 2064 6566 6175 6c74 5f6f 6e6c    if default_onl
+0000a3f0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000a400: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000a410: 6574 203d 2076 616c 5f69 0a20 2020 2020  et = val_i.     
+0000a420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a430: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0000a440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a450: 2020 2020 2072 6574 5b74 696d 6550 6f69       ret[timePoi
+0000a460: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
+0000a470: 7465 7469 6d65 275d 5d20 3d20 7661 6c5f  tetime']] = val_
+0000a480: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
+0000a490: 2020 2020 2020 2020 2020 2320 7265 6d6f            # remo
+0000a4a0: 7665 2069 6d61 6765 2d64 6174 6574 696d  ve image-datetim
+0000a4b0: 6520 6966 2074 6865 7265 0a20 2020 2020  e if there.     
+0000a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4d0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000a4e0: 2872 6574 5b74 696d 6550 6f69 6e74 4461  (ret[timePointDa
+0000a4f0: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
+0000a500: 6d65 275d 5d2c 6469 6374 2920 616e 6420  me']],dict) and 
+0000a510: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0000a520: 2069 6e20 7265 745b 7469 6d65 506f 696e   in ret[timePoin
+0000a530: 7444 6174 615b 2769 6d61 6765 2d64 6174  tData['image-dat
+0000a540: 6574 696d 6527 5d5d 3a0a 2020 2020 2020  etime']]:.      
+0000a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a560: 2020 2020 2020 6465 6c20 7265 745b 7469        del ret[ti
+0000a570: 6d65 506f 696e 7444 6174 615b 2769 6d61  mePointData['ima
+0000a580: 6765 2d64 6174 6574 696d 6527 5d5d 5b27  ge-datetime']]['
+0000a590: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0000a5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a5b0: 2020 2020 2020 2020 2023 2076 6964 656f           # video
+0000a5c0: 2064 6566 6175 6c74 730a 2020 2020 2020   defaults.      
 0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5e0: 2020 2020 6920 2b3d 2031 0a0a 2020 2020      i += 1..    
-0000a5f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000a600: 6528 7265 742c 6469 6374 2920 6f72 2069  e(ret,dict) or i
-0000a610: 7369 6e73 7461 6e63 6528 7265 742c 6c69  sinstance(ret,li
-0000a620: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0000a630: 2072 6574 203d 2063 6f70 792e 6465 6570   ret = copy.deep
-0000a640: 636f 7079 2872 6574 290a 2020 2020 2020  copy(ret).      
-0000a650: 2020 6966 2072 6574 203d 3d20 2222 206f    if ret == "" o
-0000a660: 7220 7265 7420 3d3d 207b 7d3a 0a20 2020  r ret == {}:.   
-0000a670: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0000a680: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0000a690: 6f6e 2822 6b65 7973 2064 6f20 6e6f 7420  on("keys do not 
-0000a6a0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
-0000a6b0: 7973 2929 0a20 2020 2020 2020 2072 6574  ys)).        ret
-0000a6c0: 7572 6e20 7265 740a 0a0a 2020 2020 4073  urn ret...    @s
-0000a6d0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-0000a6e0: 6465 6620 5f5f 6765 7449 7465 6d56 616c  def __getItemVal
-0000a6f0: 7565 2869 7465 6d73 2c6b 6579 732c 736b  ue(items,keys,sk
-0000a700: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
-0000a710: 6661 756c 7456 616c 293a 0a20 2020 2020  faultVal):.     
-0000a720: 2020 200a 2020 2020 2020 2020 2320 696e     .        # in
-0000a730: 2063 6173 6520 6974 656d 2069 7320 6e6f   case item is no
-0000a740: 7420 6120 6c69 7374 2028 7368 6f75 6c64  t a list (should
-0000a750: 206e 6f74 2062 6520 706f 7373 6962 6c65   not be possible
-0000a760: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0000a770: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-0000a780: 735b 6b65 7973 5b30 5d5d 2c6c 6973 7429  s[keys[0]],list)
-0000a790: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
-0000a7a0: 656d 735b 6b65 7973 5b30 5d5d 203d 205b  ems[keys[0]] = [
-0000a7b0: 6974 656d 735b 6b65 7973 5b30 5d5d 5d0a  items[keys[0]]].
-0000a7c0: 0a20 2020 2020 2020 2069 7465 6d56 616c  .        itemVal
-0000a7d0: 7565 203d 2066 696e 6446 6965 6c64 2869  ue = findField(i
-0000a7e0: 7465 6d73 2c6b 6579 7329 0a0a 2020 2020  tems,keys)..    
-0000a7f0: 2020 2020 6966 2069 7465 6d56 616c 7565      if itemValue
-0000a800: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0000a810: 2020 2020 7265 7420 3d20 6465 6661 756c      ret = defaul
-0000a820: 7456 616c 0a20 2020 2020 2020 2023 2069  tVal.        # i
-0000a830: 6e20 6361 7365 206f 6620 6469 6374 7320  n case of dicts 
-0000a840: 6a6f 696e 7420 6865 6164 6572 2061 6e64  joint header and
-0000a850: 2069 7465 6d20 6669 656c 6473 0a20 2020   item fields.   
-0000a860: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0000a870: 616e 6365 2869 7465 6d56 616c 7565 2c64  ance(itemValue,d
-0000a880: 6963 7429 2061 6e64 2064 6566 6175 6c74  ict) and default
-0000a890: 5661 6c20 213d 2022 223a 0a20 2020 2020  Val != "":.     
-0000a8a0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
-0000a8b0: 696e 7374 616e 6365 2864 6566 6175 6c74  instance(default
-0000a8c0: 5661 6c2c 6469 6374 293a 0a20 2020 2020  Val,dict):.     
-0000a8d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000a8e0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-0000a8f0: 7469 6f6e 2822 4974 656d 2066 6965 6c64  tion("Item field
-0000a900: 2069 7320 6469 6374 2062 7574 2064 6566   is dict but def
-0000a910: 6175 6c74 2076 616c 7565 2069 6e20 6865  ault value in he
-0000a920: 6164 6572 2069 7320 6e6f 743a 2022 202b  ader is not: " +
-0000a930: 2073 7472 286b 6579 7329 290a 2020 2020   str(keys)).    
-0000a940: 2020 2020 2020 2020 7265 7420 3d20 7b2a          ret = {*
-0000a950: 2a64 6566 6175 6c74 5661 6c2c 2a2a 6974  *defaultVal,**it
-0000a960: 656d 5661 6c75 657d 0a20 2020 2020 2020  emValue}.       
-0000a970: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a980: 2020 2072 6574 203d 2069 7465 6d56 616c     ret = itemVal
-0000a990: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
-0000a9a0: 6e20 7265 740a 0a0a 2020 2020 6465 6620  n ret...    def 
-0000a9b0: 5f5f 7374 725f 5f28 7365 6c66 2920 2d3e  __str__(self) ->
-0000a9c0: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-0000a9d0: 2220 5072 696e 7473 2063 7572 7265 6e74  " Prints current
-0000a9e0: 2069 4644 4f20 6669 6c65 2022 2222 0a20   iFDO file """. 
-0000a9f0: 2020 2020 2020 2072 6574 7572 6e20 7961         return ya
-0000aa00: 6d6c 2e64 756d 7028 7365 6c66 2e69 6664  ml.dump(self.ifd
-0000aa10: 6f5f 6368 6563 6b65 642c 2064 6566 6175  o_checked, defau
-0000aa20: 6c74 5f73 7479 6c65 3d4e 6f6e 652c 2064  lt_style=None, d
-0000aa30: 6566 6175 6c74 5f66 6c6f 775f 7374 796c  efault_flow_styl
-0000aa40: 653d 4e6f 6e65 2c20 616c 6c6f 775f 756e  e=None, allow_un
-0000aa50: 6963 6f64 653d 5472 7565 2c20 7769 6474  icode=True, widt
-0000aa60: 683d 666c 6f61 7428 2269 6e66 2229 290a  h=float("inf")).
-0000aa70: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
-0000aa80: 7465 6d5f 5f28 7365 6c66 2c20 6b65 7973  tem__(self, keys
-0000aa90: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
-0000aaa0: 6574 7572 6e73 2063 6f70 7920 6f66 2063  eturns copy of c
-0000aab0: 6865 636b 6564 2069 6664 6f20 7365 7420  hecked ifdo set 
-0000aac0: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
-0000aad0: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
-0000aae0: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
-0000aaf0: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
-0000ab00: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
-0000ab10: 206b 6579 7320 6173 2065 2e67 2e20 273c   keys as e.g. '<
-0000ab20: 6974 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27  item>:<key>:...'
-0000ab30: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
-0000ab40: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
-0000ab50: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
-0000ab60: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
-0000ab70: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
-0000ab80: 616e 2062 6520 6c65 676c 6563 7465 642c  an be leglected,
-0000ab90: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
-0000aba0: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
-0000abb0: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
-0000abc0: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
-0000abd0: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
-0000abe0: 2052 6169 7365 7320 4966 646f 4578 6365   Raises IfdoExce
-0000abf0: 7074 696f 6e20 6966 2069 7465 6d20 646f  ption if item do
-0000ac00: 6573 206e 6f74 2065 7869 7374 2e20 2222  es not exist. ""
-0000ac10: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
-0000ac20: 206b 6579 732e 7370 6c69 7428 273a 2729   keys.split(':')
-0000ac30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000ac40: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
-0000ac50: 616c 7565 2873 656c 662e 6966 646f 5f63  alue(self.ifdo_c
-0000ac60: 6865 636b 6564 2c6b 6579 7329 0a0a 0a20  hecked,keys)... 
-0000ac70: 2020 2064 6566 2066 696e 6454 6d70 4669     def findTmpFi
-0000ac80: 656c 6428 7365 6c66 2c6b 6579 7329 3a0a  eld(self,keys):.
-0000ac90: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
-0000aca0: 726e 7320 636f 7079 206f 6620 7465 6d70  rns copy of temp
-0000acb0: 6f72 6172 7920 756e 6368 6563 6b65 6420  orary unchecked 
-0000acc0: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
-0000acd0: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
-0000ace0: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
-0000acf0: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
-0000ad00: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
-0000ad10: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
-0000ad20: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
-0000ad30: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
-0000ad40: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
-0000ad50: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
-0000ad60: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
-0000ad70: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
-0000ad80: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
-0000ad90: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
-0000ada0: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
-0000adb0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
-0000adc0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
-0000add0: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
-0000ade0: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
-0000adf0: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
-0000ae00: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
-0000ae10: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
-0000ae20: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
-0000ae30: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
-0000ae40: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
-0000ae50: 6765 7446 6965 6c64 5661 6c75 6528 7365  getFieldValue(se
-0000ae60: 6c66 2e69 6664 6f5f 746d 702c 6b65 7973  lf.ifdo_tmp,keys
-0000ae70: 290a 2020 2020 0a0a 2020 2020 6465 6620  ).    ..    def 
-0000ae80: 6669 6e64 546d 7046 6965 6c64 3228 7365  findTmpField2(se
-0000ae90: 6c66 2c6b 6579 7329 3a0a 2020 2020 2020  lf,keys):.      
-0000aea0: 2020 2222 2220 5361 6d65 2061 7320 6669    """ Same as fi
-0000aeb0: 6e64 546d 7046 6965 6c64 2069 6e73 7465  ndTmpField inste
-0000aec0: 6164 206f 6620 7261 6973 696e 6720 6578  ad of raising ex
-0000aed0: 6365 7074 696f 6e20 6974 2072 6574 7572  ception it retur
-0000aee0: 6e20 656d 7074 7920 7374 7269 6e67 2e20  n empty string. 
-0000aef0: 2222 220a 2020 2020 2020 2020 6b65 7973  """.        keys
-0000af00: 203d 206b 6579 732e 7370 6c69 7428 273a   = keys.split(':
-0000af10: 2729 0a20 2020 2020 2020 2074 7279 3a0a  ').        try:.
-0000af20: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
-0000af30: 3d20 7365 6c66 2e5f 5f67 6574 4669 656c  = self.__getFiel
-0000af40: 6456 616c 7565 2873 656c 662e 6966 646f  dValue(self.ifdo
-0000af50: 5f74 6d70 2c6b 6579 7329 0a20 2020 2020  _tmp,keys).     
-0000af60: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
-0000af70: 4966 646f 4578 6365 7074 696f 6e3a 0a20  IfdoException:. 
-0000af80: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
-0000af90: 2022 220a 2020 2020 2020 2020 7265 7475   "".        retu
-0000afa0: 726e 2072 6574 0a0a 0a20 2020 2064 6566  rn ret...    def
-0000afb0: 2073 6574 6946 444f 4865 6164 6572 4669   setiFDOHeaderFi
-0000afc0: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
-0000afd0: 723a 2064 6963 7429 3a0a 2020 2020 2020  r: dict):.      
-0000afe0: 2020 2222 2220 436c 6561 7273 2063 7572    """ Clears cur
-0000aff0: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
-0000b000: 6473 2075 6e64 2073 6574 7320 7072 6f76  ds und sets prov
-0000b010: 6964 6564 2066 6965 6c64 2076 616c 7565  ided field value
-0000b020: 732e 2046 6f72 2075 7064 6174 696e 6720  s. For updating 
-0000b030: 6578 6973 7469 6e67 206f 6e65 7320 7573  existing ones us
-0000b040: 6520 7570 6461 7465 5f69 6664 6f5f 6865  e update_ifdo_he
-0000b050: 6164 6572 5f66 6965 6c64 7328 2920 2222  ader_fields() ""
-0000b060: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
-0000b070: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000b080: 6765 5365 7448 6561 6465 724b 6579 5d20  geSetHeaderKey] 
-0000b090: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
-0000b0a0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000b0b0: 6465 724b 6579 2069 6e20 6865 6164 6572  derKey in header
-0000b0c0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
-0000b0d0: 6164 6572 203d 2068 6561 6465 725b 7365  ader = header[se
-0000b0e0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000b0f0: 724b 6579 5d0a 2020 2020 2020 2020 666f  rKey].        fo
-0000b100: 7220 6669 656c 6420 696e 2068 6561 6465  r field in heade
-0000b110: 723a 0a20 2020 2020 2020 2020 2020 2023  r:.            #
-0000b120: 6966 2066 6965 6c64 206e 6f74 2069 6e20  if field not in 
-0000b130: 6d69 7174 762e 6966 646f 5f68 6561 6465  miqtv.ifdo_heade
-0000b140: 725f 636f 7265 5f66 6965 6c64 733a 0a20  r_core_fields:. 
-0000b150: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-0000b160: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-0000b170: 6175 7469 6f6e 2120 556e 6b6e 6f77 6e20  aution! Unknown 
-0000b180: 6865 6164 6572 2066 6965 6c64 205c 2222  header field \""
-0000b190: 202b 2066 6965 6c64 202b 2022 5c22 2e20   + field + "\". 
-0000b1a0: 4d61 7962 6520 6120 7479 706f 3f20 4f74  Maybe a typo? Ot
-0000b1b0: 6865 7277 6973 6520 6967 6e6f 7265 206d  herwise ignore m
-0000b1c0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
-0000b1d0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000b1e0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000b1f0: 6572 4b65 795d 5b66 6965 6c64 5d20 3d20  erKey][field] = 
-0000b200: 6865 6164 6572 5b66 6965 6c64 5d0a 0a0a  header[field]...
-0000b210: 2020 2020 6465 6620 7570 6461 7465 5f69      def update_i
-0000b220: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
-0000b230: 7328 7365 6c66 2c20 6865 6164 6572 3a20  s(self, header: 
-0000b240: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
-0000b250: 2222 2055 7064 6174 6573 2065 7869 7374  "" Updates exist
-0000b260: 696e 6720 6865 6164 6572 2066 6965 6c64  ing header field
-0000b270: 7320 2222 220a 2020 2020 2020 2020 6966  s """.        if
-0000b280: 2073 656c 662e 696d 6167 6553 6574 4865   self.imageSetHe
-0000b290: 6164 6572 4b65 7920 696e 2068 6561 6465  aderKey in heade
-0000b2a0: 723a 0a20 2020 2020 2020 2020 2020 2068  r:.            h
-0000b2b0: 6561 6465 7220 3d20 6865 6164 6572 5b73  eader = header[s
-0000b2c0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000b2d0: 6572 4b65 795d 0a20 2020 2020 2020 206c  erKey].        l
-0000b2e0: 6f67 203d 206d 6971 7463 2e72 6563 7572  og = miqtc.recur
-0000b2f0: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
-0000b300: 7328 7365 6c66 2e69 6664 6f5f 746d 705b  s(self.ifdo_tmp[
-0000b310: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000b320: 6465 724b 6579 5d2c 2068 6561 6465 7229  derKey], header)
-0000b330: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-0000b340: 6f76 2e6c 6f67 286c 6f67 2c64 6f6e 7453  ov.log(log,dontS
-0000b350: 686f 773d 5472 7565 290a 0a20 2020 2064  how=True)..    d
-0000b360: 6566 2075 7064 6174 6569 4644 4f48 6561  ef updateiFDOHea
-0000b370: 6465 7246 6965 6c64 7328 7365 6c66 2c20  derFields(self, 
-0000b380: 6865 6164 6572 3a20 6469 6374 293a 0a20  header: dict):. 
-0000b390: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
-0000b3a0: 6361 7465 6420 2d20 7573 6520 7570 6461  cated - use upda
-0000b3b0: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
-0000b3c0: 6965 6c64 7320 2222 220a 2020 2020 2020  ields """.      
-0000b3d0: 2020 7365 6c66 2e75 7064 6174 655f 6966    self.update_if
-0000b3e0: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
-0000b3f0: 2868 6561 6465 7229 0a0a 0a20 2020 2064  (header)...    d
-0000b400: 6566 205f 7472 795f 7570 6772 6164 655f  ef _try_upgrade_
-0000b410: 746f 5f69 6664 6f5f 7665 7273 696f 6e5f  to_ifdo_version_
-0000b420: 3278 2873 656c 6629 3a0a 2020 2020 2020  2x(self):.      
-0000b430: 2020 2222 2220 5472 7920 746f 2063 6f6e    """ Try to con
-0000b440: 7665 7274 2066 6965 6c64 7320 6672 6f6d  vert fields from
-0000b450: 2069 4644 4f20 7665 7273 696f 6e20 3c20   iFDO version < 
-0000b460: 322e 302e 3020 746f 2032 2e78 2022 2222  2.0.0 to 2.x """
-0000b470: 0a20 2020 2020 2020 2072 6561 645f 7665  .        read_ve
-0000b480: 7273 696f 6e5f 7374 7220 3d20 2276 312e  rsion_str = "v1.
-0000b490: 302e 3022 2023 2064 6964 206e 6f74 2068  0.0" # did not h
-0000b4a0: 6176 6520 7468 6520 2769 6d61 6765 2d73  ave the 'image-s
-0000b4b0: 6574 2d69 6664 6f2d 7665 7273 696f 6e27  et-ifdo-version'
-0000b4c0: 2066 6965 6c64 2079 6574 0a20 2020 2020   field yet.     
-0000b4d0: 2020 2074 7279 3a20 0a20 2020 2020 2020     try: .       
-0000b4e0: 2020 2020 2072 6561 645f 7665 7273 696f       read_versio
-0000b4f0: 6e5f 7374 7220 3d20 7365 6c66 2e66 696e  n_str = self.fin
-0000b500: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
-0000b510: 2d73 6574 2d69 6664 6f2d 7665 7273 696f  -set-ifdo-versio
-0000b520: 6e27 290a 2020 2020 2020 2020 6578 6365  n').        exce
-0000b530: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
-0000b540: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-0000b550: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-0000b560: 2072 6561 645f 7665 7273 696f 6e20 3d20   read_version = 
-0000b570: 5665 7273 696f 6e28 7265 6164 5f76 6572  Version(read_ver
-0000b580: 7369 6f6e 5f73 7472 290a 0a20 2020 2020  sion_str)..     
-0000b590: 2020 2069 6620 7265 6164 5f76 6572 7369     if read_versi
-0000b5a0: 6f6e 203c 2056 6572 7369 6f6e 2822 322e  on < Version("2.
-0000b5b0: 302e 3022 293a 0a20 2020 2020 2020 2020  0.0"):.         
-0000b5c0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0000b5d0: 2320 6e65 7720 5552 4920 6f62 6a65 6374  # new URI object
-0000b5e0: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
-0000b5f0: 2020 2020 6e65 775f 7572 695f 6669 656c      new_uri_fiel
-0000b600: 6473 203d 205b 2769 6d61 6765 2d73 656e  ds = ['image-sen
-0000b610: 736f 7227 2c27 696d 6167 652d 6576 656e  sor','image-even
-0000b620: 7427 2c27 696d 6167 652d 7072 6f6a 6563  t','image-projec
-0000b630: 7427 2c27 696d 6167 652d 636f 6e74 6578  t','image-contex
-0000b640: 7427 2c27 696d 6167 652d 6c69 6365 6e73  t','image-licens
-0000b650: 6527 2c27 696d 6167 652d 706c 6174 666f  e','image-platfo
-0000b660: 726d 275d 0a20 2020 2020 2020 2020 2020  rm'].           
-0000b670: 2066 6f72 2075 7269 5f66 6965 6c64 2069   for uri_field i
-0000b680: 6e20 6e65 775f 7572 695f 6669 656c 6473  n new_uri_fields
-0000b690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000b6a0: 2020 6f6c 645f 7374 725f 7661 6c20 3d20    old_str_val = 
-0000b6b0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000b6c0: 6432 2875 7269 5f66 6965 6c64 290a 2020  d2(uri_field).  
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000b6e0: 2069 7369 6e73 7461 6e63 6528 6f6c 645f   isinstance(old_
-0000b6f0: 7374 725f 7661 6c2c 7374 7229 2061 6e64  str_val,str) and
-0000b700: 206f 6c64 5f73 7472 5f76 616c 2021 3d20   old_str_val != 
-0000b710: 2222 3a20 2020 2020 2020 2020 2020 2020  "":             
-0000b720: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-0000b730: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000b740: 6f62 6a5f 7661 6c20 3d20 7b27 6e61 6d65  obj_val = {'name
-0000b750: 273a 206f 6c64 5f73 7472 5f76 616c 7d0a  ': old_str_val}.
-0000b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b770: 2020 2020 6973 5f75 7269 2c20 6d73 6720      is_uri, msg 
-0000b780: 3d20 6d69 7174 742e 7661 6c69 6461 7465  = miqtt.validate
-0000b790: 5f61 6761 696e 7374 5f73 6368 656d 6128  _against_schema(
-0000b7a0: 6f6c 645f 7374 725f 7661 6c2c 7b22 7479  old_str_val,{"ty
-0000b7b0: 7065 223a 2022 7374 7269 6e67 222c 2266  pe": "string","f
-0000b7c0: 6f72 6d61 7422 3a20 2275 7269 227d 290a  ormat": "uri"}).
-0000b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7e0: 2020 2020 6966 2069 735f 7572 693a 0a20      if is_uri:. 
-0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b800: 2020 2020 2020 206e 6577 5f6f 626a 5f76         new_obj_v
-0000b810: 616c 5b27 7572 6927 5d20 3d20 6f6c 645f  al['uri'] = old_
-0000b820: 7374 725f 7661 6c0a 2020 2020 2020 2020  str_val.        
-0000b830: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b840: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000b850: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000b860: 5d5b 7572 695f 6669 656c 645d 203d 206e  ][uri_field] = n
-0000b870: 6577 5f6f 626a 5f76 616c 0a20 2020 2020  ew_obj_val.     
-0000b880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b890: 656c 662e 7072 6f76 2e6c 6f67 2822 4175  elf.prov.log("Au
-0000b8a0: 746f 2d75 7067 7261 6465 6420 2220 2b20  to-upgraded " + 
-0000b8b0: 7572 695f 6669 656c 6420 2b20 2220 6672  uri_field + " fr
-0000b8c0: 6f6d 2022 202b 206f 6c64 5f73 7472 5f76  om " + old_str_v
-0000b8d0: 616c 202b 2022 2074 6f20 2220 2b20 7374  al + " to " + st
-0000b8e0: 7228 6e65 775f 6f62 6a5f 7661 6c29 290a  r(new_obj_val)).
-0000b8f0: 0a0a 0a20 2020 2064 6566 2074 7279 4175  ...    def tryAu
-0000b900: 746f 5365 7448 6561 6465 7246 6965 6c64  toSetHeaderField
-0000b910: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-0000b920: 2022 2222 2053 6574 7320 6365 7274 6169   """ Sets certai
-0000b930: 6e20 6865 6164 6572 2066 6965 6c64 7320  n header fields 
-0000b940: 652e 672e 2066 726f 6d20 6469 7265 6374  e.g. from direct
-0000b950: 6f72 7920 6966 2074 6865 7920 6172 6520  ory if they are 
-0000b960: 6e6f 7420 7365 7420 7965 7420 2222 220a  not set yet """.
-0000b970: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000b980: 2e66 696e 6454 6d70 4669 656c 6432 2827  .findTmpField2('
-0000b990: 696d 6167 652d 7365 6e73 6f72 2729 203d  image-sensor') =
-0000b9a0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000b9b0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000b9c0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000b9d0: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
-0000b9e0: 656e 736f 7227 5d20 3d20 7b27 6e61 6d65  ensor'] = {'name
-0000b9f0: 273a 2073 656c 662e 6469 722e 7365 6e73  ': self.dir.sens
-0000ba00: 6f72 2829 7d0a 2020 2020 2020 2020 656c  or()}.        el
-0000ba10: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
-0000ba20: 6965 6c64 2827 696d 6167 652d 7365 6e73  ield('image-sens
-0000ba30: 6f72 2729 5b27 6e61 6d65 275d 2021 3d20  or')['name'] != 
-0000ba40: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
-0000ba50: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000ba60: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-0000ba70: 7574 696f 6e21 2027 696d 6167 652d 7365  ution! 'image-se
-0000ba80: 6e73 6f72 2720 222b 2073 7472 2873 656c  nsor' "+ str(sel
-0000ba90: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
-0000baa0: 696d 6167 652d 7365 6e73 6f72 2729 2920  image-sensor')) 
-0000bab0: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
-0000bac0: 2073 656e 736f 7220 7061 7273 6564 2066   sensor parsed f
-0000bad0: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
-0000bae0: 202b 2073 656c 662e 6469 722e 7365 6e73   + self.dir.sens
-0000baf0: 6f72 2829 290a 0a20 2020 2020 2020 2069  or())..        i
-0000bb00: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
-0000bb10: 656c 6432 2827 696d 6167 652d 6576 656e  eld2('image-even
-0000bb20: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
-0000bb30: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000bb40: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000bb50: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000bb60: 6167 652d 6576 656e 7427 5d20 3d20 7b27  age-event'] = {'
-0000bb70: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
-0000bb80: 6576 656e 7428 297d 0a20 2020 2020 2020  event()}.       
-0000bb90: 2065 6c69 6620 7365 6c66 2e66 696e 6454   elif self.findT
-0000bba0: 6d70 4669 656c 6428 2769 6d61 6765 2d65  mpField('image-e
-0000bbb0: 7665 6e74 2729 5b27 6e61 6d65 275d 2021  vent')['name'] !
-0000bbc0: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
-0000bbd0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000bbe0: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-0000bbf0: 6175 7469 6f6e 2120 2769 6d61 6765 2d65  aution! 'image-e
-0000bc00: 7665 6e74 2720 2220 2b20 7374 7228 7365  vent' " + str(se
-0000bc10: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-0000bc20: 2769 6d61 6765 2d65 7665 6e74 2729 2920  'image-event')) 
-0000bc30: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
-0000bc40: 2065 7665 6e74 2070 6172 7365 6420 6672   event parsed fr
-0000bc50: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
-0000bc60: 2b20 7365 6c66 2e64 6972 2e65 7665 6e74  + self.dir.event
-0000bc70: 2829 290a 0a20 2020 2020 2020 2069 6620  ())..        if 
-0000bc80: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000bc90: 6432 2827 696d 6167 652d 7072 6f6a 6563  d2('image-projec
-0000bca0: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
-0000bcb0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000bcc0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000bcd0: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-0000bce0: 6167 652d 7072 6f6a 6563 7427 5d20 3d20  age-project'] = 
-0000bcf0: 207b 276e 616d 6527 3a20 7365 6c66 2e64   {'name': self.d
-0000bd00: 6972 2e70 726f 6a65 6374 2829 7d0a 2020  ir.project()}.  
-0000bd10: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-0000bd20: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
-0000bd30: 6167 652d 7072 6f6a 6563 7427 295b 276e  age-project')['n
-0000bd40: 616d 6527 5d20 213d 2073 656c 662e 6469  ame'] != self.di
-0000bd50: 722e 7072 6f6a 6563 7428 293a 0a20 2020  r.project():.   
-0000bd60: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000bd70: 6f76 2e6c 6f67 2822 4361 7574 696f 6e21  ov.log("Caution!
-0000bd80: 2027 696d 6167 652d 7072 6f6a 6563 7427   'image-project'
-0000bd90: 2022 202b 2073 7472 2873 656c 662e 6669   " + str(self.fi
-0000bda0: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-0000bdb0: 652d 7072 6f6a 6563 7427 2929 202b 2022  e-project')) + "
-0000bdc0: 2064 6966 6665 7273 2066 726f 6d20 7072   differs from pr
-0000bdd0: 6f6a 6563 7420 7061 7273 6564 2066 726f  oject parsed fro
-0000bde0: 6d20 6469 7265 6374 6f72 793a 2022 202b  m directory: " +
-0000bdf0: 2073 656c 662e 6469 722e 7072 6f6a 6563   self.dir.projec
-0000be00: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
-0000be10: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000be20: 6c64 3228 2769 6d61 6765 2d70 6c61 7466  ld2('image-platf
-0000be30: 6f72 6d27 2920 3d3d 2022 2220 616e 6420  orm') == "" and 
-0000be40: 7365 6c66 2e64 6972 2e67 6561 7228 2920  self.dir.gear() 
-0000be50: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-0000be60: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000be70: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000be80: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000be90: 706c 6174 666f 726d 275d 203d 207b 276e  platform'] = {'n
-0000bea0: 616d 6527 3a20 7365 6c66 2e64 6972 2e67  ame': self.dir.g
-0000beb0: 6561 7228 297d 0a0a 2020 2020 2020 2020  ear()}..        
-0000bec0: 6966 206e 6f74 2027 696d 6167 652d 7365  if not 'image-se
-0000bed0: 742d 7575 6964 2720 696e 2073 656c 662e  t-uuid' in self.
-0000bee0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
-0000bef0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000bf00: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000bf10: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000bf20: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000bf30: 6579 5d5b 2769 6d61 6765 2d73 6574 2d75  ey]['image-set-u
-0000bf40: 7569 6427 5d20 3d20 7374 7228 6d69 7174  uid'] = str(miqt
-0000bf50: 632e 7575 6964 3428 2929 0a20 2020 2020  c.uuid4()).     
-0000bf60: 2020 2069 6620 6e6f 7420 2769 6d61 6765     if not 'image
-0000bf70: 2d73 6574 2d68 616e 646c 6527 2069 6e20  -set-handle' in 
-0000bf80: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000bf90: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000bfa0: 724b 6579 5d3a 0a20 2020 2020 2020 2020  rKey]:.         
-0000bfb0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000bfc0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000bfd0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000bfe0: 7365 742d 6861 6e64 6c65 275d 203d 2073  set-handle'] = s
-0000bff0: 656c 662e 6861 6e64 6c65 5f70 7265 6669  elf.handle_prefi
-0000c000: 7820 2b20 222f 2220 2b20 7365 6c66 2e66  x + "/" + self.f
-0000c010: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
-0000c020: 6765 2d73 6574 2d75 7569 6427 290a 2020  ge-set-uuid').  
-0000c030: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
-0000c040: 6167 652d 7365 742d 6e61 6d65 2720 696e  age-set-name' in
-0000c050: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000c060: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000c070: 6572 4b65 795d 206f 7220 7365 6c66 2e66  erKey] or self.f
-0000c080: 696e 6454 6d70 4669 656c 6432 2827 696d  indTmpField2('im
-0000c090: 6167 652d 7365 742d 6e61 6d65 2729 203d  age-set-name') =
-0000c0a0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000c0b0: 2020 2320 636f 6e73 7472 7563 7420 6173    # construct as
-0000c0c0: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
-0000c0d0: 743e 5f3c 7365 6e73 6f72 3e0a 2020 2020  t>_<sensor>.    
-0000c0e0: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
-0000c0f0: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
-0000c100: 6965 6c64 3228 2269 6d61 6765 2d70 726f  ield2("image-pro
-0000c110: 6a65 6374 2229 5b27 6e61 6d65 275d 0a20  ject")['name']. 
-0000c120: 2020 2020 2020 2020 2020 2065 7665 6e74             event
-0000c130: 5f20 3d20 7365 6c66 2e66 696e 6454 6d70  _ = self.findTmp
-0000c140: 4669 656c 6432 2822 696d 6167 652d 6576  Field2("image-ev
-0000c150: 656e 7422 295b 276e 616d 6527 5d0a 2020  ent")['name'].  
-0000c160: 2020 2020 2020 2020 2020 6966 2065 7665            if eve
-0000c170: 6e74 5f20 3d3d 2022 223a 0a20 2020 2020  nt_ == "":.     
-0000c180: 2020 2020 2020 2020 2020 2065 7665 6e74             event
-0000c190: 5f20 3d20 7365 6c66 2e64 6972 2e65 7665  _ = self.dir.eve
-0000c1a0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-0000c1b0: 2073 656e 736f 725f 203d 2073 656c 662e   sensor_ = self.
-0000c1c0: 6669 6e64 546d 7046 6965 6c64 3228 2269  findTmpField2("i
-0000c1d0: 6d61 6765 2d73 656e 736f 7222 295b 276e  mage-sensor")['n
-0000c1e0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
-0000c1f0: 2020 6966 2073 656e 736f 725f 203d 3d20    if sensor_ == 
-0000c200: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-0000c210: 2020 2020 7365 6e73 6f72 5f20 3d20 7365      sensor_ = se
-0000c220: 6c66 2e64 6972 2e73 656e 736f 7228 290a  lf.dir.sensor().
-0000c230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000c240: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-0000c250: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000c260: 5d5b 2769 6d61 6765 2d73 6574 2d6e 616d  ]['image-set-nam
-0000c270: 6527 5d20 3d20 6946 444f 2e63 6f6e 7374  e'] = iFDO.const
-0000c280: 7275 6374 496d 6167 6553 6574 4e61 6d65  ructImageSetName
-0000c290: 2870 726f 6a65 6374 5f2c 6576 656e 745f  (project_,event_
-0000c2a0: 2c73 656e 736f 725f 290a 0a20 2020 2020  ,sensor_)..     
-0000c2b0: 2020 2023 2073 6574 2076 6572 7369 6f6e     # set version
-0000c2c0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
-0000c2d0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000c2e0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0000c2f0: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
-0000c300: 6572 7369 6f6e 275d 203d 206d 6971 7476  ersion'] = miqtv
-0000c310: 2e69 4644 4f5f 7665 7273 696f 6e0a 0a0a  .iFDO_version...
-0000c320: 2020 2020 6465 6620 7365 7448 6561 6465      def setHeade
-0000c330: 7249 6d61 6765 4c6f 6361 6c50 6174 6846  rImageLocalPathF
-0000c340: 6965 6c64 2873 656c 6629 3a0a 2020 2020  ield(self):.    
-0000c350: 2020 2020 2222 2220 5365 7473 2068 6561      """ Sets hea
-0000c360: 6465 7220 6669 656c 6420 2769 6d61 6765  der field 'image
-0000c370: 2d6c 6f63 616c 2d70 6174 6827 2066 726f  -local-path' fro
-0000c380: 6d20 696d 6167 6520 6469 7220 2222 220a  m image dir """.
-0000c390: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000c3a0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000c3b0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000c3c0: 6d61 6765 2d6c 6f63 616c 2d70 6174 6827  mage-local-path'
-0000c3d0: 5d20 3d20 6f73 2e70 6174 682e 7265 6c70  ] = os.path.relp
-0000c3e0: 6174 6828 7365 6c66 2e69 6d61 6765 7344  ath(self.imagesD
-0000c3f0: 6972 2c20 6f73 2e70 6174 682e 6469 726e  ir, os.path.dirn
-0000c400: 616d 6528 7365 6c66 2e67 6574 6946 444f  ame(self.getiFDO
-0000c410: 4669 6c65 4e61 6d65 2829 2929 0a0a 0a20  FileName()))... 
-0000c420: 2020 2064 6566 2063 7265 6174 655f 6669     def create_fi
-0000c430: 656c 6473 2873 656c 662c 2061 6c6c 6f77  elds(self, allow
-0000c440: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
-0000c450: 643d 4661 6c73 6529 3a0a 2020 2020 2020  d=False):.      
-0000c460: 2020 2222 2220 4372 6561 7465 2061 6e64    """ Create and
-0000c470: 2076 616c 6964 6174 6520 6375 7272 656e   validate curren
-0000c480: 7420 6865 6164 6572 2066 6965 6c64 7320  t header fields 
-0000c490: 616e 6420 6974 656d 2066 6965 6c64 7320  and item fields 
-0000c4a0: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
-0000c4b0: 6520 6669 6c65 732e 204f 7665 7277 7269  e files. Overwri
-0000c4c0: 7465 7320 6578 6973 7469 6e67 2066 6965  tes existing fie
-0000c4d0: 6c64 732e 2022 2222 0a20 2020 2020 2020  lds. """.       
-0000c4e0: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
-0000c4f0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
-0000c500: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
-0000c510: 7465 5f66 696c 6573 2829 0a20 2020 2020  te_files().     
-0000c520: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
-0000c530: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
-0000c540: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000c550: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0000c560: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
-0000c570: 7328 292c 2061 6c6c 6f77 5f6d 6973 7369  s(), allow_missi
-0000c580: 6e67 5f72 6571 7569 7265 643d 616c 6c6f  ng_required=allo
-0000c590: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
-0000c5a0: 6564 290a 0a0a 2020 2020 6465 6620 7570  ed)...    def up
-0000c5b0: 6461 7465 5f66 6965 6c64 7328 7365 6c66  date_fields(self
-0000c5c0: 2c20 6865 6164 6572 5f6f 6e6c 793a 626f  , header_only:bo
-0000c5d0: 6f6c 3d4e 6f6e 6529 3a0a 2020 2020 2020  ol=None):.      
-0000c5e0: 2020 2222 2220 5570 6461 7465 2061 6e64    """ Update and
-0000c5f0: 2076 616c 6964 6174 6520 6375 7272 656e   validate curren
-0000c600: 7420 6865 6164 6572 2066 6965 6c64 7320  t header fields 
-0000c610: 616e 6420 6974 656d 2066 6965 6c64 7320  and item fields 
-0000c620: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
-0000c630: 6520 6669 6c65 732e 2022 2222 0a20 2020  e files. """.   
-0000c640: 2020 2020 2069 6620 6865 6164 6572 5f6f       if header_o
-0000c650: 6e6c 7920 6973 204e 6f6e 653a 0a20 2020  nly is None:.   
-0000c660: 2020 2020 2020 2020 2068 6561 6465 725f           header_
-0000c670: 6f6e 6c79 203d 2073 656c 662e 6967 6e6f  only = self.igno
-0000c680: 7265 5f69 6d61 6765 5f66 696c 6573 0a20  re_image_files. 
-0000c690: 2020 2020 2020 2069 6620 6e6f 7420 6865         if not he
-0000c6a0: 6164 6572 5f6f 6e6c 793a 0a20 2020 2020  ader_only:.     
-0000c6b0: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
-0000c6c0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
-0000c6d0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
-0000c6e0: 726d 6564 6961 7465 5f66 696c 6573 2829  rmediate_files()
-0000c6f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000c700: 7572 6e20 7365 6c66 2e75 7064 6174 6569  urn self.updatei
-0000c710: 4644 4f28 7365 6c66 2e69 6664 6f5f 746d  FDO(self.ifdo_tm
-0000c720: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000c730: 6561 6465 724b 6579 5d2c 2069 7465 6d5f  eaderKey], item_
-0000c740: 6461 7461 2e76 616c 7565 7328 2929 0a20  data.values()). 
-0000c750: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000c760: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000c770: 7365 6c66 2e75 7064 6174 6569 4644 4f28  self.updateiFDO(
-0000c780: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000c790: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000c7a0: 724b 6579 5d2c 205b 5d2c 2068 6561 6465  rKey], [], heade
-0000c7b0: 725f 6f6e 6c79 3d54 7275 6529 0a0a 0a20  r_only=True)... 
-0000c7c0: 2020 2064 6566 2063 7265 6174 6543 6f72     def createCor
-0000c7d0: 6546 6965 6c64 7328 7365 6c66 293a 0a20  eFields(self):. 
-0000c7e0: 2020 2020 2020 2022 2222 2044 4550 5245         """ DEPRE
-0000c7f0: 4341 4445 542c 2075 7365 2063 7265 6174  CADET, use creat
-0000c800: 655f 6669 656c 6473 2829 206f 7220 7570  e_fields() or up
-0000c810: 6461 7465 5f66 6965 6c64 7328 2920 696e  date_fields() in
-0000c820: 7374 6564 2e0a 2020 2020 2020 2020 4669  sted..        Fi
-0000c830: 6c6c 7320 7468 6520 6946 444f 2063 6f72  lls the iFDO cor
-0000c840: 6520 6669 656c 6473 2066 726f 6d20 696e  e fields from in
-0000c850: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
-0000c860: 2e20 5769 7468 6f75 7420 7468 656d 206e  . Without them n
-0000c870: 6f20 7661 6c69 6420 6946 444f 2063 616e  o valid iFDO can
-0000c880: 2062 6520 6372 6561 7465 642e 0a20 2020   be created..   
-0000c890: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000c8a0: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
-0000c8b0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
-0000c8c0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
-0000c8d0: 7465 5f66 696c 6573 5f63 6f72 6528 290a  te_files_core().
-0000c8e0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
-0000c8f0: 6669 656c 6473 2066 6f72 2076 616c 6964  fields for valid
-0000c900: 6974 790a 2020 2020 2020 2020 2320 6974  ity.        # it
-0000c910: 656d 5f64 6174 6120 636f 6e74 6169 6e73  em_data contains
-0000c920: 2066 6965 6c64 2069 6d61 6765 2d66 696c   field image-fil
-0000c930: 656e 616d 652c 2077 6869 6368 2077 6869  ename, which whi
-0000c940: 6368 2077 696c 6c20 6e6f 7420 6265 2073  ch will not be s
-0000c950: 746f 7265 6420 6173 2061 6e20 6974 656d  tored as an item
-0000c960: 2066 6965 6c64 2069 6e20 6946 4f44 2062   field in iFOD b
-0000c970: 7574 2061 7320 7468 6520 6974 656d 206e  ut as the item n
-0000c980: 616d 6520 6974 7365 6c66 0a20 2020 2020  ame itself.     
-0000c990: 2020 2072 6574 7572 6e20 7365 6c66 2e75     return self.u
-0000c9a0: 7064 6174 6569 4644 4f28 7365 6c66 2e69  pdateiFDO(self.i
-0000c9b0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000c9c0: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0000c9d0: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
-0000c9e0: 7328 2929 0a0a 0a20 2020 2064 6566 2063  s())...    def c
-0000c9f0: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
-0000ca00: 6f6e 7465 6e74 4669 656c 6473 2873 656c  ontentFields(sel
-0000ca10: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-0000ca20: 4445 5052 4543 4144 4554 2c20 7573 6520  DEPRECADET, use 
-0000ca30: 6372 6561 7465 5f66 6965 6c64 7328 2920  create_fields() 
-0000ca40: 6f72 2075 7064 6174 655f 6669 656c 6473  or update_fields
-0000ca50: 2829 2069 6e73 7465 642e 0a20 2020 2020  () insted..     
-0000ca60: 2020 2046 696c 6c73 2074 6865 2069 4644     Fills the iFD
-0000ca70: 4f20 6361 7075 7472 6520 616e 6420 636f  O caputre and co
-0000ca80: 6e74 656e 7420 6669 6564 7320 6672 6f6d  ntent fieds from
-0000ca90: 2070 726f 7669 6465 6420 6461 7461 2066   provided data f
-0000caa0: 6965 6c64 7320 0a20 2020 2020 2020 2022  ields .        "
-0000cab0: 2222 0a20 2020 2020 2020 2069 7465 6d5f  "".        item_
-0000cac0: 6461 7461 203d 2073 656c 662e 5f67 6574  data = self._get
-0000cad0: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
-0000cae0: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
-0000caf0: 6573 5f6e 6f6e 655f 636f 7265 2829 0a20  es_none_core(). 
-0000cb00: 2020 2020 2020 2023 2063 6865 636b 2066         # check f
-0000cb10: 6965 6c64 7320 666f 7220 7661 6c69 6469  ields for validi
-0000cb20: 7479 0a20 2020 2020 2020 2023 2069 7465  ty.        # ite
-0000cb30: 6d5f 6461 7461 2063 6f6e 7461 696e 7320  m_data contains 
-0000cb40: 6669 656c 6420 696d 6167 652d 6669 6c65  field image-file
-0000cb50: 6e61 6d65 2c20 7768 6963 6820 7768 6963  name, which whic
-0000cb60: 6820 7769 6c6c 206e 6f74 2062 6520 7374  h will not be st
-0000cb70: 6f72 6564 2061 7320 616e 2069 7465 6d20  ored as an item 
-0000cb80: 6669 656c 6420 696e 2069 464f 4420 6275  field in iFOD bu
-0000cb90: 7420 6173 2074 6865 2069 7465 6d20 6e61  t as the item na
-0000cba0: 6d65 2069 7473 656c 660a 2020 2020 2020  me itself.      
-0000cbb0: 2020 7265 7475 726e 2073 656c 662e 7570    return self.up
-0000cbc0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
-0000cbd0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000cbe0: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
-0000cbf0: 6974 656d 5f64 6174 612e 7661 6c75 6573  item_data.values
-0000cc00: 2829 290a 0a20 2020 200a 2020 2020 6465  ())..    .    de
-0000cc10: 6620 5f67 6574 5f69 7465 6d5f 6461 7461  f _get_item_data
-0000cc20: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
-0000cc30: 7465 5f66 696c 6573 2873 656c 6629 3a0a  te_files(self):.
-0000cc40: 2020 2020 2020 2020 2222 2220 5265 6164          """ Read
-0000cc50: 2064 6174 6120 6672 6f6d 2063 6f72 6520   data from core 
-0000cc60: 616e 6420 6e6f 6e65 2d63 6f72 6520 696e  and none-core in
-0000cc70: 7465 726d 6465 6174 6520 6669 6c65 732c  termdeate files,
-0000cc80: 2063 6865 636b 2066 696c 6573 2065 7869   check files exi
-0000cc90: 7374 2c20 6164 6420 2769 6d61 6765 2d68  st, add 'image-h
-0000cca0: 616e 646c 6527 2e0a 2020 2020 2020 2020  andle'..        
-0000ccb0: 5265 7475 726e 7320 6469 6374 206f 6620  Returns dict of 
-0000ccc0: 666f 726d 207b 696d 6167 652d 6669 6c65  form {image-file
-0000ccd0: 2d6e 616d 653a 7b66 6965 6c64 3a76 616c  -name:{field:val
-0000cce0: 7565 7d2c 2e2e 2e7d 200a 2020 2020 2020  ue},...} .      
-0000ccf0: 2020 2222 220a 2020 2020 2020 2020 6974    """.        it
-0000cd00: 656d 5f64 6174 615f 636f 7265 203d 2073  em_data_core = s
-0000cd10: 656c 662e 5f67 6574 5f69 7465 6d5f 6461  elf._get_item_da
-0000cd20: 7461 5f66 726f 6d5f 696e 7465 726d 6564  ta_from_intermed
-0000cd30: 6961 7465 5f66 696c 6573 5f63 6f72 6528  iate_files_core(
-0000cd40: 290a 2020 2020 2020 2020 6974 656d 5f64  ).        item_d
-0000cd50: 6174 615f 6e6f 6e65 5f63 6f72 6520 3d20  ata_none_core = 
-0000cd60: 7365 6c66 2e5f 6765 745f 6974 656d 5f64  self._get_item_d
-0000cd70: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
-0000cd80: 6469 6174 655f 6669 6c65 735f 6e6f 6e65  diate_files_none
-0000cd90: 5f63 6f72 6528 290a 2020 2020 2020 2020  _core().        
-0000cda0: 2370 7072 696e 7428 6974 656d 5f64 6174  #pprint(item_dat
-0000cdb0: 615f 6e6f 6e65 5f63 6f72 6529 0a20 2020  a_none_core).   
-0000cdc0: 2020 2020 2023 7070 7269 6e74 2869 7465       #pprint(ite
-0000cdd0: 6d5f 6461 7461 5f63 6f72 6529 0a20 2020  m_data_core).   
-0000cde0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
-0000cdf0: 2069 7465 6d5f 6461 7461 5f63 6f72 650a   item_data_core.
-0000ce00: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
-0000ce10: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
-0000ce20: 7064 6174 6544 6963 7473 2869 7465 6d5f  pdateDicts(item_
-0000ce30: 6461 7461 2c20 6974 656d 5f64 6174 615f  data, item_data_
-0000ce40: 6e6f 6e65 5f63 6f72 6529 0a20 2020 2020  none_core).     
-0000ce50: 2020 2023 7070 7269 6e74 2869 7465 6d5f     #pprint(item_
-0000ce60: 6461 7461 290a 2020 2020 2020 2020 7365  data).        se
-0000ce70: 6c66 2e70 726f 762e 6c6f 6728 6c6f 672c  lf.prov.log(log,
-0000ce80: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-0000ce90: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
-0000cea0: 656d 5f64 6174 610a 0a20 2020 2064 6566  em_data..    def
-0000ceb0: 205f 6765 745f 6974 656d 5f64 6174 615f   _get_item_data_
-0000cec0: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
-0000ced0: 655f 6669 6c65 735f 6e6f 6e65 5f63 6f72  e_files_none_cor
-0000cee0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0000cef0: 2022 2222 2052 6561 6420 6461 7461 2066   """ Read data f
-0000cf00: 726f 6d20 6e6f 6e2d 636f 7265 2069 6e74  rom non-core int
-0000cf10: 6572 6d64 6561 7465 2066 696c 6573 2e0a  ermdeate files..
-0000cf20: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-0000cf30: 6469 6374 206f 6620 666f 726d 207b 696d  dict of form {im
-0000cf40: 6167 652d 6669 6c65 2d6e 616d 653a 7b66  age-file-name:{f
-0000cf50: 6965 6c64 3a76 616c 7565 7d2c 2e2e 2e7d  ield:value},...}
-0000cf60: 200a 2020 2020 2020 2020 2222 220a 2020   .        """.  
-0000cf70: 2020 2020 2020 7265 7120 3d20 7365 6c66        req = self
-0000cf80: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
-0000cf90: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-0000cfa0: 6f46 696c 6573 0a0a 2020 2020 2020 2020  oFiles..        
-0000cfb0: 6974 656d 5f64 6174 6120 3d20 7b7d 0a20  item_data = {}. 
-0000cfc0: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
-0000cfd0: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
-0000cfe0: 6f67 7265 7373 4d73 6728 2250 6172 7369  ogressMsg("Parsi
-0000cff0: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
-0000d000: 6164 6469 7469 6f6e 616c 2064 6174 6122  additional data"
-0000d010: 2c20 6c65 6e28 7265 7129 290a 2020 2020  , len(req)).    
-0000d020: 2020 2020 666f 7220 7220 696e 2072 6571      for r in req
-0000d030: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0000d040: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
-0000d050: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
-0000d060: 7061 7468 2e65 7869 7374 7328 722e 6669  path.exists(r.fi
-0000d070: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
-0000d080: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0000d090: 6173 6549 7465 6d44 6174 6146 726f 6d46  aseItemDataFromF
-0000d0a0: 696c 6528 6974 656d 5f64 6174 612c 722e  ile(item_data,r.
-0000d0b0: 6669 6c65 4e61 6d65 2c72 2e73 6570 6172  fileName,r.separ
-0000d0c0: 6174 6f72 2c72 2e68 6561 6465 722c 2072  ator,r.header, r
-0000d0d0: 2e64 6174 6574 696d 655f 666f 726d 6174  .datetime_format
-0000d0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d0f0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000d100: 2250 6172 7365 6420 6974 656d 2064 6174  "Parsed item dat
-0000d110: 6120 6672 6f6d 3a20 2220 2b20 722e 6669  a from: " + r.fi
-0000d120: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
-0000d130: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d140: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000d150: 726f 762e 6c6f 6728 2246 696c 6520 646f  rov.log("File do
-0000d160: 6573 206e 6f74 2065 7869 7374 733a 2022  es not exists: "
-0000d170: 202b 2072 2e66 696c 654e 616d 6529 0a20   + r.fileName). 
-0000d180: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-0000d190: 7228 290a 0a20 2020 2020 2020 2023 2063  r()..        # c
-0000d1a0: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
-0000d1b0: 0a20 2020 2020 2020 2072 656d 6f76 6520  .        remove 
-0000d1c0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0000d1d0: 2069 6d67 2069 6e20 6974 656d 5f64 6174   img in item_dat
-0000d1e0: 613a 0a20 2020 2020 2020 2020 2020 2069  a:.            i
-0000d1f0: 6620 6e6f 7420 696d 6720 696e 2073 656c  f not img in sel
-0000d200: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
-0000d210: 6765 7344 6972 3a0a 2020 2020 2020 2020  gesDir:.        
-0000d220: 2020 2020 2020 2020 7265 6d6f 7665 2e61          remove.a
-0000d230: 7070 656e 6428 696d 6729 0a20 2020 2020  ppend(img).     
-0000d240: 2020 2066 6f72 2069 6d67 2069 6e20 7265     for img in re
-0000d250: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
-0000d260: 2020 6465 6c20 6974 656d 5f64 6174 615b    del item_data[
-0000d270: 696d 675d 0a0a 2020 2020 2020 2020 7265  img]..        re
-0000d280: 7475 726e 2069 7465 6d5f 6461 7461 0a0a  turn item_data..
-0000d290: 0a20 2020 2064 6566 205f 6765 745f 6974  .    def _get_it
-0000d2a0: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
-0000d2b0: 6572 6d65 6469 6174 655f 6669 6c65 735f  ermediate_files_
-0000d2c0: 636f 7265 2873 656c 6629 3a0a 2020 2020  core(self):.    
-0000d2d0: 2020 2020 2222 2220 5265 6164 2064 6174      """ Read dat
-0000d2e0: 6120 6672 6f6d 2063 6f72 6520 696e 7465  a from core inte
-0000d2f0: 726d 6465 6174 6520 6669 6c65 732c 2063  rmdeate files, c
-0000d300: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
-0000d310: 2c20 6164 6420 2769 6d61 6765 2d68 616e  , add 'image-han
-0000d320: 646c 6527 2e0a 2020 2020 2020 2020 5265  dle'..        Re
-0000d330: 7475 726e 7320 6469 6374 206f 6620 666f  turns dict of fo
-0000d340: 726d 207b 696d 6167 652d 6669 6c65 2d6e  rm {image-file-n
-0000d350: 616d 653a 7b66 6965 6c64 3a76 616c 7565  ame:{field:value
-0000d360: 7d2c 2e2e 2e7d 200a 2020 2020 2020 2020  },...} .        
-0000d370: 2222 220a 0a20 2020 2020 2020 2023 2057  """..        # W
-0000d380: 6869 6368 2066 696c 6573 2063 6f6e 7461  hich files conta
-0000d390: 696e 2074 6865 2069 6e66 6f72 6d61 7469  in the informati
-0000d3a0: 6f6e 206e 6565 6465 6420 746f 2063 7265  on needed to cre
-0000d3b0: 6174 6520 7468 6520 6946 444f 2069 7465  ate the iFDO ite
-0000d3c0: 6d73 2063 6f72 6520 696e 666f 726d 6174  ms core informat
-0000d3d0: 696f 6e20 616e 6420 7768 6963 6820 636f  ion and which co
-0000d3e0: 6c75 6d6e 7320 7368 616c 6c20 6265 2075  lumns shall be u
-0000d3f0: 7365 640a 2020 2020 2020 2020 7265 7120  sed.        req 
-0000d400: 3d20 7365 6c66 2e69 6e74 6572 6d65 6469  = self.intermedi
-0000d410: 6174 6546 696c 6573 4465 665f 636f 7265  ateFilesDef_core
-0000d420: 0a0a 2020 2020 2020 2020 6974 656d 5f64  ..        item_d
-0000d430: 6174 6120 3d20 7b7d 0a20 2020 2020 2020  ata = {}.       
-0000d440: 2070 726f 6720 3d20 6d69 7174 632e 5072   prog = miqtc.Pr
-0000d450: 696e 744b 6e6f 776e 5072 6f67 7265 7373  intKnownProgress
-0000d460: 4d73 6728 2250 6172 7369 6e67 2069 6e74  Msg("Parsing int
-0000d470: 6572 6d65 6469 6174 6520 636f 7265 2064  ermediate core d
-0000d480: 6174 6122 2c20 6c65 6e28 7265 7129 290a  ata", len(req)).
-0000d490: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
-0000d4a0: 2072 6571 3a0a 2020 2020 2020 2020 2020   req:.          
-0000d4b0: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
-0000d4c0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
-0000d4d0: 6c65 203d 2073 656c 662e 5f5f 6765 745f  le = self.__get_
-0000d4e0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-0000d4f0: 2920 2b20 7265 715b 725d 5b27 7375 6666  ) + req[r]['suff
-0000d500: 6978 275d 0a20 2020 2020 2020 2020 2020  ix'].           
-0000d510: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
-0000d520: 6578 6973 7473 2866 696c 6529 3a0a 2020  exists(file):.  
-0000d530: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000d540: 6c66 2e70 726f 762e 6c6f 6728 2257 4152  lf.prov.log("WAR
-0000d550: 4e49 4e47 2120 466f 7220 6163 6869 6576  NING! For achiev
-0000d560: 696e 6720 4641 4952 6e65 7373 2061 6e20  ing FAIRness an 
-0000d570: 696e 7465 726d 6564 6961 7465 2069 6d61  intermediate ima
-0000d580: 6765 2069 6e66 6f20 6669 6c65 2069 7320  ge info file is 
-0000d590: 6d69 7373 696e 673a 2022 2b20 7365 6c66  missing: "+ self
-0000d5a0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
-0000d5b0: 7072 6566 6978 2829 202b 2072 6571 5b72  prefix() + req[r
-0000d5c0: 5d5b 2773 7566 6669 7827 5d2b 2022 2072  ]['suffix']+ " r
-0000d5d0: 756e 2066 6972 7374 3a20 2220 2b20 7265  un first: " + re
-0000d5e0: 715b 725d 5b27 6372 6561 7469 6f6e 4663  q[r]['creationFc
-0000d5f0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-0000d600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d610: 2020 2020 2020 2073 656c 662e 7061 7273         self.pars
-0000d620: 6549 7465 6d44 6174 6166 726f 6d54 6162  eItemDatafromTab
-0000d630: 4669 6c65 4461 7461 2869 7465 6d5f 6461  FileData(item_da
-0000d640: 7461 2c20 6669 6c65 2c20 7265 715b 725d  ta, file, req[r]
-0000d650: 5b27 636f 6c73 275d 2c20 7265 715b 725d  ['cols'], req[r]
-0000d660: 5b27 6f70 7469 6f6e 616c 275d 290a 2020  ['optional']).  
-0000d670: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000d680: 6c66 2e70 726f 762e 6c6f 6728 2250 6172  lf.prov.log("Par
-0000d690: 7365 6420 6974 656d 2064 6174 6120 6672  sed item data fr
-0000d6a0: 6f6d 3a20 2220 2b20 6669 6c65 290a 0a20  om: " + file).. 
-0000d6b0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-0000d6c0: 7228 290a 2020 2020 2020 2020 6966 206c  r().        if l
-0000d6d0: 656e 2869 7465 6d5f 6461 7461 2920 3d3d  en(item_data) ==
-0000d6e0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000d6f0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
-0000d700: 224e 6f20 6946 444f 2069 7465 6d73 2229  "No iFDO items")
-0000d710: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
-0000d720: 6b20 6669 6c65 7320 6578 6973 740a 2020  k files exist.  
-0000d730: 2020 2020 2020 7265 6d6f 7665 203d 205b        remove = [
-0000d740: 5d0a 2020 2020 2020 2020 666f 7220 696d  ].        for im
-0000d750: 6720 696e 2069 7465 6d5f 6461 7461 3a0a  g in item_data:.
-0000d760: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000d770: 6f74 2069 6d67 2069 6e20 7365 6c66 2e5f  ot img in self._
-0000d780: 696d 6167 654e 616d 6573 496d 6167 6573  imageNamesImages
-0000d790: 4469 723a 0a20 2020 2020 2020 2020 2020  Dir:.           
-0000d7a0: 2020 2020 2072 656d 6f76 652e 6170 7065       remove.appe
-0000d7b0: 6e64 2869 6d67 290a 2020 2020 2020 2020  nd(img).        
-0000d7c0: 666f 7220 696d 6720 696e 2072 656d 6f76  for img in remov
-0000d7d0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
-0000d7e0: 656c 2069 7465 6d5f 6461 7461 5b69 6d67  el item_data[img
-0000d7f0: 5d0a 0a20 2020 2020 2020 2023 2061 6464  ]..        # add
-0000d800: 2069 6d61 6765 2d75 726c 0a20 2020 2020   image-url.     
-0000d810: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
-0000d820: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
-0000d830: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000d840: 6365 2869 7465 6d5f 6461 7461 5b69 6d67  ce(item_data[img
-0000d850: 5d2c 6c69 7374 293a 2023 2069 7465 6d20  ],list): # item 
-0000d860: 6973 2061 6c72 6561 6479 2061 206c 6973  is already a lis
-0000d870: 7420 2876 6964 656f 2920 6275 7420 7061  t (video) but pa
-0000d880: 7273 6564 2064 6174 6120 6973 206e 6f74  rsed data is not
-0000d890: 2c20 692e 652e 2070 6172 7365 6420 6461  , i.e. parsed da
-0000d8a0: 7461 2072 6566 6572 7320 746f 2077 686f  ta refers to who
-0000d8b0: 6c65 2076 6964 656f 2028 7469 6d65 2069  le video (time i
-0000d8c0: 6e64 6570 656e 6465 6e74 292c 2069 2e65  ndependent), i.e
-0000d8d0: 2e20 7772 6974 6520 746f 2066 6972 7374  . write to first
-0000d8e0: 2065 6e74 7279 0a20 2020 2020 2020 2020   entry.         
-0000d8f0: 2020 2020 2020 2075 7569 6420 3d20 6669         uuid = fi
-0000d900: 6e64 4669 656c 6428 6974 656d 5f64 6174  ndField(item_dat
-0000d910: 615b 696d 675d 5b30 5d2c 2769 6d61 6765  a[img][0],'image
-0000d920: 2d75 7569 6427 290a 2020 2020 2020 2020  -uuid').        
-0000d930: 2020 2020 2020 2020 6966 2075 7569 6420          if uuid 
-0000d940: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
-0000d950: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000d960: 2869 7465 6d5f 6461 7461 5b69 6d67 5d29  (item_data[img])
-0000d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d980: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
-0000d990: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
-0000d9a0: 7575 6964 206e 6f74 2066 6f75 6e64 2028  uuid not found (
-0000d9b0: 6129 2229 0a20 2020 2020 2020 2020 2020  a)").           
-0000d9c0: 2020 2020 2069 7465 6d5f 6461 7461 5b69       item_data[i
-0000d9d0: 6d67 5d5b 305d 5b27 696d 6167 652d 6861  mg][0]['image-ha
-0000d9e0: 6e64 6c65 275d 203d 2073 656c 662e 696d  ndle'] = self.im
-0000d9f0: 6167 655f 6861 6e64 6c65 5f70 7265 6669  age_handle_prefi
-0000da00: 7820 2b20 2740 2720 2b20 7575 6964 0a20  x + '@' + uuid. 
-0000da10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000da20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000da30: 2075 7569 6420 3d20 6669 6e64 4669 656c   uuid = findFiel
-0000da40: 6428 6974 656d 5f64 6174 615b 696d 675d  d(item_data[img]
-0000da50: 2c27 696d 6167 652d 7575 6964 2729 0a20  ,'image-uuid'). 
-0000da60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000da70: 6620 7575 6964 203d 3d20 2222 3a0a 2020  f uuid == "":.  
-0000da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000da90: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-0000daa0: 646f 4578 6365 7074 696f 6e28 2275 7569  doException("uui
-0000dab0: 6420 6e6f 7420 666f 756e 6420 2862 2922  d not found (b)"
-0000dac0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000dad0: 2020 6974 656d 5f64 6174 615b 696d 675d    item_data[img]
-0000dae0: 5b27 696d 6167 652d 6861 6e64 6c65 275d  ['image-handle']
-0000daf0: 203d 2073 656c 662e 696d 6167 655f 6861   = self.image_ha
-0000db00: 6e64 6c65 5f70 7265 6669 7820 2b20 2740  ndle_prefix + '@
-0000db10: 2720 2b20 7575 6964 0a0a 2020 2020 2020  ' + uuid..      
-0000db20: 2020 7265 7475 726e 2069 7465 6d5f 6461    return item_da
-0000db30: 7461 0a0a 0a20 2020 2064 6566 2061 6464  ta...    def add
-0000db40: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
-0000db50: 696c 6528 7365 6c66 2c20 6669 6c65 4e61  ile(self, fileNa
-0000db60: 6d65 3a20 7374 722c 2073 6570 6172 6174  me: str, separat
-0000db70: 6f72 3a73 7472 2c20 6865 6164 6572 3a64  or:str, header:d
-0000db80: 6963 742c 2064 6174 6574 696d 655f 666f  ict, datetime_fo
-0000db90: 726d 6174 203d 206d 6971 7476 2e64 6174  rmat = miqtv.dat
-0000dba0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-0000dbb0: 7427 5d29 3a0a 2020 2020 2020 2020 2222  t']):.        ""
-0000dbc0: 2220 4164 6420 6120 636f 6c75 6d6e 2073  " Add a column s
-0000dbd0: 6570 6572 6174 6564 2074 6578 7420 6669  eperated text fi
-0000dbe0: 6c65 2074 6f20 7061 7273 6520 6974 656d  le to parse item
-0000dbf0: 2064 6174 6120 6672 6f6d 2062 7920 6372   data from by cr
-0000dc00: 6561 7465 4361 7074 7572 6541 6e64 436f  eateCaptureAndCo
-0000dc10: 6e74 656e 7446 6965 6c64 7328 292e 200a  ntentFields(). .
-0000dc20: 2020 2020 2020 2020 436f 6c75 6d6e 7320          Columns 
-0000dc30: 6865 6164 6572 7320 7769 6c6c 2062 6520  headers will be 
-0000dc40: 7365 7420 6173 2069 7465 6d20 6669 656c  set as item fiel
-0000dc50: 6420 6e61 6d65 732e 204d 7573 7420 636f  d names. Must co
-0000dc60: 6e74 6169 6e20 636f 6c75 6d6e 2027 696d  ntain column 'im
-0000dc70: 6167 652d 6669 6c65 6e61 6d65 272e 0a20  age-filename'.. 
-0000dc80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000dc90: 2020 2069 6620 6669 6c65 4e61 6d65 203d     if fileName =
-0000dca0: 3d20 4e6f 6e65 206f 7220 6e6f 7420 6f73  = None or not os
-0000dcb0: 2e70 6174 682e 6578 6973 7473 2866 696c  .path.exists(fil
-0000dcc0: 654e 616d 6529 3a0a 2020 2020 2020 2020  eName):.        
-0000dcd0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0000dce0: 696f 6e28 2246 696c 6522 2c66 696c 654e  ion("File",fileN
-0000dcf0: 616d 652c 226e 6f74 2066 6f75 6e64 2229  ame,"not found")
-0000dd00: 0a0a 2020 2020 2020 2020 666f 7220 6669  ..        for fi
-0000dd10: 656c 6420 696e 2068 6561 6465 723a 0a20  eld in header:. 
-0000dd20: 2020 2020 2020 2020 2020 2069 6620 6865             if he
-0000dd30: 6164 6572 5b66 6965 6c64 5d20 6e6f 7420  ader[field] not 
-0000dd40: 696e 206d 6971 7466 2e74 6162 4669 6c65  in miqtf.tabFile
-0000dd50: 436f 6c75 6d6e 4e61 6d65 7328 6669 6c65  ColumnNames(file
-0000dd60: 4e61 6d65 2c63 6f6c 5f73 6570 6172 6174  Name,col_separat
-0000dd70: 6f72 3d73 6570 6172 6174 6f72 293a 0a20  or=separator):. 
-0000dd80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000dd90: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
-0000dda0: 436f 6c75 6d6e 222c 2068 6561 6465 725b  Column", header[
-0000ddb0: 6669 656c 645d 2c20 226e 6f74 2069 6e20  field], "not in 
-0000ddc0: 6669 6c65 222c 2066 696c 654e 616d 6529  file", fileName)
-0000ddd0: 0a0a 2020 2020 2020 2020 6966 206d 6971  ..        if miq
-0000dde0: 7463 2e61 7373 6572 7453 6c61 7368 286f  tc.assertSlash(o
-0000ddf0: 732e 7061 7468 2e64 6972 6e61 6d65 2866  s.path.dirname(f
-0000de00: 696c 654e 616d 6529 2920 213d 206d 6971  ileName)) != miq
-0000de10: 7463 2e61 7373 6572 7453 6c61 7368 2873  tc.assertSlash(s
-0000de20: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
-0000de30: 6469 722e 6474 2e69 6e74 6572 6d65 6469  dir.dt.intermedi
-0000de40: 6174 6529 293a 0a20 2020 2020 2020 2020  ate)):.         
-0000de50: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000de60: 2820 2243 6175 7469 6f6e 2120 4974 2069  ( "Caution! It i
-0000de70: 7320 7265 636f 6d6d 656e 6465 6420 746f  s recommended to
-0000de80: 2070 7574 2066 696c 6520 696e 2074 6865   put file in the
-0000de90: 2064 6972 6563 746f 7279 2773 2027 696e   directory's 'in
-0000dea0: 7465 726d 6564 6961 7465 2720 666f 6c64  termediate' fold
-0000deb0: 6572 3a20 2220 2b20 6669 6c65 4e61 6d65  er: " + fileName
-0000dec0: 290a 2020 2020 2020 2020 6e63 6669 6966  ).        ncfiif
-0000ded0: 203d 206e 6f6e 436f 7265 4669 656c 6449   = nonCoreFieldI
-0000dee0: 6e74 6572 6d65 6469 6174 6549 7465 6d49  ntermediateItemI
-0000def0: 6e66 6f46 696c 6528 6669 6c65 4e61 6d65  nfoFile(fileName
-0000df00: 2c20 7365 7061 7261 746f 722c 2068 6561  , separator, hea
-0000df10: 6465 722c 2064 6174 6574 696d 655f 666f  der, datetime_fo
-0000df20: 726d 6174 290a 2020 2020 2020 2020 6966  rmat).        if
-0000df30: 206e 6366 6969 6620 6e6f 7420 696e 2073   ncfiif not in s
-0000df40: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
-0000df50: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000df60: 496e 666f 4669 6c65 733a 200a 2020 2020  InfoFiles: .    
-0000df70: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
-0000df80: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
-0000df90: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
-0000dfa0: 6573 2e61 7070 656e 6428 6e63 6669 6966  es.append(ncfiif
-0000dfb0: 290a 0a20 2020 2064 6566 2061 6464 4974  )..    def addIt
-0000dfc0: 656d 496e 666f 5461 6246 696c 6528 7365  emInfoTabFile(se
-0000dfd0: 6c66 2c20 6669 6c65 4e61 6d65 3a20 7374  lf, fileName: st
-0000dfe0: 722c 2073 6570 6172 6174 6f72 3a73 7472  r, separator:str
-0000dff0: 2c20 6865 6164 6572 3a64 6963 742c 2064  , header:dict, d
-0000e000: 6174 6574 696d 655f 666f 726d 6174 203d  atetime_format =
-0000e010: 206d 6971 7476 2e64 6174 655f 666f 726d   miqtv.date_form
-0000e020: 6174 735b 276d 6172 6971 7427 5d29 3a0a  ats['mariqt']):.
-0000e030: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
-0000e040: 6563 6174 6564 202d 2075 7365 2061 6464  ecated - use add
-0000e050: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
-0000e060: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-0000e070: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
-0000e080: 666f 5f74 6162 5f66 696c 6528 6669 6c65  fo_tab_file(file
-0000e090: 4e61 6d65 2c73 6570 6172 6174 6f72 2c68  Name,separator,h
-0000e0a0: 6561 6465 722c 6461 7465 7469 6d65 5f66  eader,datetime_f
-0000e0b0: 6f72 6d61 7429 0a0a 2020 2020 2020 2020  ormat)..        
-0000e0c0: 0a20 2020 2064 6566 2072 656d 6f76 6549  .    def removeI
-0000e0d0: 7465 6d49 6e66 6f54 6162 4669 6c65 2873  temInfoTabFile(s
-0000e0e0: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
-0000e0f0: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
-0000e100: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
-0000e110: 6461 7465 7469 6d65 5f66 6f72 6d61 743a  datetime_format:
-0000e120: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
-0000e130: 2220 7265 6d6f 7665 7320 6669 6c65 2069  " removes file i
-0000e140: 7465 6d20 6672 6f6d 206c 6973 7420 6f66  tem from list of
-0000e150: 2066 696c 6573 2074 6f20 7061 7273 6520   files to parse 
-0000e160: 6974 656d 2064 6174 6120 6672 6f6d 2062  item data from b
-0000e170: 7920 6372 6561 7465 4361 7074 7572 6541  y createCaptureA
-0000e180: 6e64 436f 6e74 656e 7446 6965 6c64 7328  ndContentFields(
-0000e190: 2920 2222 220a 2020 2020 2020 2020 6e63  ) """.        nc
-0000e1a0: 6669 6966 203d 206e 6f6e 436f 7265 4669  fiif = nonCoreFi
-0000e1b0: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
-0000e1c0: 7465 6d49 6e66 6f46 696c 6528 6669 6c65  temInfoFile(file
-0000e1d0: 4e61 6d65 2c20 7365 7061 7261 746f 722c  Name, separator,
-0000e1e0: 2068 6561 6465 722c 2064 6174 6574 696d   header, datetim
-0000e1f0: 655f 666f 726d 6174 290a 2020 2020 2020  e_format).      
-0000e200: 2020 6966 206e 6366 6969 6620 696e 2073    if ncfiif in s
-0000e210: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
-0000e220: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
-0000e230: 496e 666f 4669 6c65 733a 200a 2020 2020  InfoFiles: .    
-0000e240: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
-0000e250: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
-0000e260: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
-0000e270: 6573 2e72 656d 6f76 6528 6e63 6669 6966  es.remove(ncfiif
-0000e280: 290a 0a0a 2020 2020 6465 6620 7570 6461  )...    def upda
-0000e290: 7465 6946 444f 2873 656c 662c 2068 6561  teiFDO(self, hea
-0000e2a0: 6465 723a 2064 6963 742c 2069 7465 6d73  der: dict, items
-0000e2b0: 3a20 6c69 7374 2c20 6865 6164 6572 5f6f  : list, header_o
-0000e2c0: 6e6c 793d 4661 6c73 6529 3a0a 2020 2020  nly=False):.    
-0000e2d0: 2020 2020 2222 2220 5570 6461 7465 7320      """ Updates 
-0000e2e0: 7468 6520 6375 7272 656e 7420 7661 6c75  the current valu
-0000e2f0: 6573 2069 4644 4f20 7769 7468 2074 6865  es iFDO with the
-0000e300: 2070 726f 7669 6465 6420 6e65 7720 7661   provided new va
-0000e310: 6c75 6573 2022 2222 0a20 2020 2020 2020  lues """.       
-0000e320: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
-0000e330: 6174 6569 4644 4f28 6865 6164 6572 2c20  ateiFDO(header, 
-0000e340: 6974 656d 732c 2075 7064 6174 6545 7869  items, updateExi
-0000e350: 7374 696e 673d 5472 7565 2c20 6865 6164  sting=True, head
-0000e360: 6572 4f6e 6c79 3d68 6561 6465 725f 6f6e  erOnly=header_on
-0000e370: 6c79 290a 0a0a 2020 2020 6465 6620 6372  ly)...    def cr
-0000e380: 6561 7465 6946 444f 2873 656c 662c 2068  eateiFDO(self, h
-0000e390: 6561 6465 723a 2064 6963 742c 2069 7465  eader: dict, ite
-0000e3a0: 6d73 3a20 6c69 7374 2c20 7570 6461 7465  ms: list, update
-0000e3b0: 4578 6973 7469 6e67 3d46 616c 7365 2c68  Existing=False,h
-0000e3c0: 6561 6465 724f 6e6c 793d 4661 6c73 652c  eaderOnly=False,
-0000e3d0: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
-0000e3e0: 7175 6972 6564 3d46 616c 7365 2c76 616c  quired=False,val
-0000e3f0: 6964 6174 655f 7369 6e67 6c65 5f69 7465  idate_single_ite
-0000e400: 6d73 3d46 616c 7365 293a 0a20 2020 2020  ms=False):.     
-0000e410: 2020 2022 2222 2043 7265 6174 6573 2046     """ Creates F
-0000e420: 4149 5220 6469 6769 7461 6c20 6f62 6a65  AIR digital obje
-0000e430: 6374 2066 6f72 2074 6865 2069 6d61 6765  ct for the image
-0000e440: 2064 6174 6120 6974 7365 6c66 2e20 5468   data itself. Th
-0000e450: 6973 2063 6f6e 7369 7374 7320 6f66 2068  is consists of h
-0000e460: 6561 6465 7220 696e 666f 726d 6174 696f  eader informatio
-0000e470: 6e20 616e 6420 6974 656d 2069 6e66 6f72  n and item infor
-0000e480: 6d61 7469 6f6e 2e0a 2020 2020 2020 2020  mation..        
-0000e490: 7570 6461 7465 4578 6973 7469 6e67 3a20  updateExisting: 
-0000e4a0: 6966 2046 616c 7365 206f 6c64 2076 616c  if False old val
-0000e4b0: 7565 7320 6172 6520 7265 6d6f 7665 642c  ues are removed,
-0000e4c0: 206f 7468 6572 7769 7365 2074 6865 7920   otherwise they 
-0000e4d0: 6172 6520 7570 6461 7465 642e 0a20 2020  are updated..   
-0000e4e0: 2020 2020 2068 6561 6465 724f 6e6c 793a       headerOnly:
-0000e4f0: 2069 6620 5472 7565 2069 7465 6d73 206d   if True items m
-0000e500: 6179 2062 6520 656d 7074 7920 6c69 7374  ay be empty list
-0000e510: 2e0a 2020 2020 2020 2020 616c 6c6f 775f  ..        allow_
-0000e520: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
-0000e530: 3a20 6966 2054 7275 652c 206e 6f20 6578  : if True, no ex
-0000e540: 6365 7074 696f 6e20 7269 7365 6e20 6966  ception risen if
-0000e550: 2061 2072 6571 7569 7265 6420 6669 656c   a required fiel
-0000e560: 6420 6973 206d 6973 7369 6e67 2e20 2022  d is missing.  "
-0000e570: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
-0000e580: 6f74 2075 7064 6174 6545 7869 7374 696e  ot updateExistin
-0000e590: 6720 616e 6420 6c65 6e28 6974 656d 7329  g and len(items)
-0000e5a0: 203d 3d20 3020 616e 6420 6e6f 7420 6865   == 0 and not he
-0000e5b0: 6164 6572 4f6e 6c79 3a0a 2020 2020 2020  aderOnly:.      
-0000e5c0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
-0000e5d0: 7074 696f 6e28 274e 6f20 6974 656d 2069  ption('No item i
-0000e5e0: 6e66 6f72 6d61 7469 6f6e 2067 6976 656e  nformation given
-0000e5f0: 2729 0a0a 2020 2020 2020 2020 6966 2075  ')..        if u
-0000e600: 7064 6174 6545 7869 7374 696e 673a 0a20  pdateExisting:. 
-0000e610: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
-0000e620: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-0000e630: 7365 6c66 2e75 7064 6174 655f 6966 646f  self.update_ifdo
-0000e640: 5f68 6561 6465 725f 6669 656c 6473 2868  _header_fields(h
-0000e650: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
-0000e660: 2020 2023 2069 7465 6d73 0a20 2020 2020     # items.     
-0000e670: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
-0000e680: 636f 7079 206f 6620 6375 7272 656e 7420  copy of current 
-0000e690: 6974 656d 7320 7769 7468 206e 6577 2069  items with new i
-0000e6a0: 7465 6d73 2066 6965 6c64 730a 2020 2020  tems fields.    
-0000e6b0: 2020 2020 2020 2020 6974 656d 7344 6963          itemsDic
-0000e6c0: 7420 3d20 6d69 7174 692e 6372 6561 7465  t = miqti.create
-0000e6d0: 496d 6167 6549 7465 6d73 4469 6374 4672  ImageItemsDictFr
-0000e6e0: 6f6d 496d 6167 6549 7465 6d73 4c69 7374  omImageItemsList
-0000e6f0: 2869 7465 6d73 290a 2020 2020 2020 2020  (items).        
-0000e700: 2020 2020 7570 6461 7465 6449 7465 6d73      updatedItems
-0000e710: 5f63 6f70 7920 3d20 636f 7079 2e64 6565  _copy = copy.dee
-0000e720: 7063 6f70 7928 7365 6c66 2e69 6664 6f5f  pcopy(self.ifdo_
-0000e730: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000e740: 7449 7465 6d73 4b65 795d 290a 2020 2020  tItemsKey]).    
-0000e750: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
-0000e760: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
-0000e770: 7064 6174 6544 6963 7473 2875 7064 6174  pdateDicts(updat
-0000e780: 6564 4974 656d 735f 636f 7079 2c20 6974  edItems_copy, it
-0000e790: 656d 7344 6963 7429 0a20 2020 2020 2020  emsDict).       
-0000e7a0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000e7b0: 6f67 286c 6f67 2c64 6f6e 7453 686f 773d  og(log,dontShow=
-0000e7c0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-0000e7d0: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
-0000e7e0: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
-0000e7f0: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
-0000e800: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
-0000e810: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
-0000e820: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000e830: 2020 2020 2023 206f 7665 7277 7269 7465       # overwrite
-0000e840: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-0000e850: 2020 2020 7365 6c66 2e73 6574 6946 444f      self.setiFDO
-0000e860: 4865 6164 6572 4669 656c 6473 2868 6561  HeaderFields(hea
-0000e870: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-0000e880: 2023 2063 6c65 6172 2069 7465 6d73 2073   # clear items s
-0000e890: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
-0000e8a0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000e8b0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-0000e8c0: 656d 734b 6579 5d20 3d20 7b7d 0a0a 0a20  emsKey] = {}... 
-0000e8d0: 2020 2020 2020 2023 2050 6172 7365 2069         # Parse i
-0000e8e0: 6d61 6765 2d61 6273 7472 6163 7420 616e  mage-abstract an
-0000e8f0: 6420 6669 6c6c 2069 7473 2070 6c61 6365  d fill its place
-0000e900: 686f 6c64 6572 7320 7769 7468 2069 6e66  holders with inf
-0000e910: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
-0000e920: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000e930: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000e940: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000e950: 6465 724b 6579 5d5b 2769 6d61 6765 2d61  derKey]['image-a
-0000e960: 6273 7472 6163 7427 5d20 3d20 6d69 7174  bstract'] = miqt
-0000e970: 732e 7061 7273 6552 6570 6c61 6365 5661  s.parseReplaceVa
-0000e980: 6c28 7365 6c66 2e69 6664 6f5f 746d 705b  l(self.ifdo_tmp[
-0000e990: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000e9a0: 6465 724b 6579 5d2c 2027 696d 6167 652d  derKey], 'image-
-0000e9b0: 6162 7374 7261 6374 2729 0a20 2020 2020  abstract').     
-0000e9c0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000e9d0: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
-0000e9e0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000e9f0: 2e6c 6f67 2822 436f 756c 6420 6e6f 7420  .log("Could not 
-0000ea00: 7265 706c 6163 6520 6b65 7973 2069 6e20  replace keys in 
-0000ea10: 5c27 696d 6167 652d 6162 7374 7261 6374  \'image-abstract
-0000ea20: 5c27 3a20 2220 2b20 7374 7228 6578 2929  \': " + str(ex))
-0000ea30: 0a0a 0a20 2020 2020 2020 2023 2073 6574  ...        # set
-0000ea40: 2076 6572 7369 6f6e 2028 736f 2069 7420   version (so it 
-0000ea50: 6361 6e6e 6f74 2062 6520 6368 616e 6765  cannot be change
-0000ea60: 6420 6279 2075 7365 7229 0a20 2020 2020  d by user).     
-0000ea70: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
-0000ea80: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000ea90: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000eaa0: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
-0000eab0: 275d 203d 206d 6971 7476 2e69 4644 4f5f  '] = miqtv.iFDO_
-0000eac0: 7665 7273 696f 6e0a 0a20 2020 2020 2020  version..       
-0000ead0: 2023 2056 616c 6964 6174 6520 6974 656d   # Validate item
-0000eae0: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
-0000eaf0: 2020 2020 2069 6d61 6765 5f73 6574 5f69       image_set_i
-0000eb00: 7465 6d73 203d 207b 7d0a 2020 2020 2020  tems = {}.      
-0000eb10: 2020 6966 2068 6561 6465 724f 6e6c 793a    if headerOnly:
-0000eb20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000eb30: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
-0000eb40: 696f 6e21 2069 4644 4f20 6372 6561 7465  ion! iFDO create
-0000eb50: 6420 696e 2068 6561 6465 725f 6f6e 6c79  d in header_only
-0000eb60: 2f69 676e 6f72 655f 696d 6167 655f 6669  /ignore_image_fi
-0000eb70: 6c65 206d 6f64 652e 2049 6d61 6765 2069  le mode. Image i
-0000eb80: 7465 6d73 2061 7265 206e 6569 7468 6572  tems are neither
-0000eb90: 2075 7064 6174 6564 206e 6f72 2063 6865   updated nor che
-0000eba0: 636b 6564 2e22 290a 2020 2020 2020 2020  cked.").        
-0000ebb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000ebc0: 2020 696e 7661 6c69 645f 6974 656d 7320    invalid_items 
-0000ebd0: 3d20 300a 0a20 2020 2020 2020 2020 2020  = 0..           
-0000ebe0: 2070 726f 6720 3d20 6d69 7174 632e 5072   prog = miqtc.Pr
-0000ebf0: 696e 744b 6e6f 776e 5072 6f67 7265 7373  intKnownProgress
-0000ec00: 4d73 6728 2243 6865 636b 696e 6720 6974  Msg("Checking it
-0000ec10: 656d 7322 2c20 6c65 6e28 6974 656d 7329  ems", len(items)
-0000ec20: 2c6d 6f64 756c 6f3d 3529 0a20 2020 2020  ,modulo=5).     
-0000ec30: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
-0000ec40: 696e 2069 7465 6d73 3a0a 2020 2020 2020  in items:.      
-0000ec50: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
-0000ec60: 726f 6772 6573 7328 290a 2020 2020 2020  rogress().      
-0000ec70: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0000ec80: 6b20 6966 2061 6c6c 2063 6f72 6520 6669  k if all core fi
-0000ec90: 656c 6473 2061 7265 2066 696c 6c65 6420  elds are filled 
-0000eca0: 616e 6420 6172 6520 6669 6c6c 6564 2076  and are filled v
-0000ecb0: 616c 6964 6c79 0a20 2020 2020 2020 2020  alidly.         
-0000ecc0: 2020 2020 2020 2074 7279 3a0a 0a20 2020         try:..   
-0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ece0: 2023 2063 6865 636b 2069 7465 6d20 696d   # check item im
-0000ecf0: 6167 6520 6578 6973 7473 0a20 2020 2020  age exists.     
-0000ed00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000ed10: 2069 6620 6974 656d 2069 7320 6120 6c69   if item is a li
-0000ed20: 7374 2028 7669 6465 6f29 2c20 6f6e 6520  st (video), one 
-0000ed30: 776f 756c 6420 6861 7665 2074 6f20 6368  would have to ch
-0000ed40: 6563 6b20 6966 2065 6163 6820 656e 7472  eck if each entr
-0000ed50: 7920 6973 2076 616c 6964 2067 6976 656e  y is valid given
-0000ed60: 2074 6865 2064 6566 6175 6c74 2076 616c   the default val
-0000ed70: 7565 7320 696e 2066 6972 7374 2065 6e74  ues in first ent
-0000ed80: 7279 2070 6c75 7320 6769 7665 6e20 6465  ry plus given de
-0000ed90: 6661 756c 7420 7661 6c75 6573 2069 6e20  fault values in 
-0000eda0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-0000edb0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000edc0: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
-0000edd0: 6d2c 6c69 7374 293a 0a20 2020 2020 2020  m,list):.       
-0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edf0: 2069 7465 6d20 3d20 5b69 7465 6d5d 0a20   item = [item]. 
-0000ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee10: 2020 2073 7562 4974 656d 4465 6661 756c     subItemDefaul
-0000ee20: 7420 3d20 6974 656d 5b30 5d20 0a20 2020  t = item[0] .   
-0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee40: 2066 6f72 2073 7562 4974 656d 2069 6e20   for subItem in 
-0000ee50: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
-0000ee60: 2020 2020 2020 2020 2020 2020 2020 6669                fi
-0000ee70: 6c65 5f6e 616d 6520 3d20 7375 6249 7465  le_name = subIte
-0000ee80: 6d5b 2769 6d61 6765 2d66 696c 656e 616d  m['image-filenam
-0000ee90: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-0000eea0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000eeb0: 6f74 2073 656c 662e 6967 6e6f 7265 5f69  ot self.ignore_i
-0000eec0: 6d61 6765 5f66 696c 6573 2061 6e64 2066  mage_files and f
-0000eed0: 696c 655f 6e61 6d65 206e 6f74 2069 6e20  ile_name not in 
-0000eee0: 7365 6c66 2e5f 696d 6167 654e 616d 6573  self._imageNames
-0000eef0: 496d 6167 6573 4469 723a 0a20 2020 2020  ImagesDir:.     
-0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef10: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000ef20: 6570 7469 6f6e 2822 4974 656d 2027 2220  eption("Item '" 
-0000ef30: 2b20 6669 6c65 5f6e 616d 6520 2b20 2227  + file_name + "'
-0000ef40: 206e 6f74 2066 6f75 6e64 2069 6e20 2f72   not found in /r
-0000ef50: 6177 2064 6972 6563 746f 7279 2e22 290a  aw directory.").
-0000ef60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ef70: 2020 2020 2020 2020 2069 6620 7661 6c69           if vali
-0000ef80: 6461 7465 5f73 696e 676c 655f 6974 656d  date_single_item
-0000ef90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000efb0: 6971 7474 2e61 7265 5f76 616c 6964 5f69  iqtt.are_valid_i
-0000efc0: 6664 6f5f 6669 656c 6473 2873 7562 4974  fdo_fields(subIt
-0000efd0: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
-0000efe0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000eff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f000: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000f010: 7220 6669 656c 645f 6e61 6d65 2c66 6965  r field_name,fie
-0000f020: 6c64 5f76 616c 2069 6e20 7375 6249 7465  ld_val in subIte
-0000f030: 6d2e 6974 656d 7328 293a 0a20 2020 2020  m.items():.     
-0000f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f050: 2020 2020 2020 2020 2020 206d 6971 7474             miqtt
-0000f060: 2e69 6664 6f5f 6669 656c 645f 6164 6469  .ifdo_field_addi
-0000f070: 7469 6f6e 616c 5f63 6865 636b 7328 6669  tional_checks(fi
-0000f080: 656c 645f 6e61 6d65 2c66 6965 6c64 5f76  eld_name,field_v
-0000f090: 616c 2920 2020 2020 2020 2020 2020 2020  al)             
-0000f0a0: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
-0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0c0: 2069 6d61 6765 5f73 6574 5f69 7465 6d73   image_set_items
-0000f0d0: 5b73 7562 4974 656d 4465 6661 756c 745b  [subItemDefault[
-0000f0e0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-0000f0f0: 5d5d 203d 205b 5d20 2320 636f 756c 6420  ]] = [] # could 
-0000f100: 6d61 6b65 2061 6e20 6578 7472 6120 6361  make an extra ca
-0000f110: 7365 2066 6f72 2069 6d61 6765 7320 6f6d  se for images om
-0000f120: 6974 7469 6e67 2074 6865 206c 6973 740a  itting the list.
+0000a5e0: 2020 6966 2069 203d 3d20 303a 0a20 2020    if i == 0:.   
+0000a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a600: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0000a610: 7374 616e 6365 2872 6574 5b74 696d 6550  stance(ret[timeP
+0000a620: 6f69 6e74 4461 7461 5b27 696d 6167 652d  ointData['image-
+0000a630: 6461 7465 7469 6d65 275d 5d2c 6469 6374  datetime']],dict
+0000a640: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a660: 2020 2064 6566 6175 6c74 5661 6c20 3d20     defaultVal = 
+0000a670: 7b2a 2a64 6566 6175 6c74 5661 6c2c 2a2a  {**defaultVal,**
+0000a680: 7265 745b 7469 6d65 506f 696e 7444 6174  ret[timePointDat
+0000a690: 615b 2769 6d61 6765 2d64 6174 6574 696d  a['image-datetim
+0000a6a0: 6527 5d5d 7d0a 2020 2020 2020 2020 2020  e']]}.          
+0000a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000a6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a6e0: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
+0000a6f0: 616c 203d 2072 6574 5b74 696d 6550 6f69  al = ret[timePoi
+0000a700: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
+0000a710: 7465 7469 6d65 275d 5d0a 0a20 2020 2020  tetime']]..     
+0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a730: 2020 2069 202b 3d20 310a 0a20 2020 2020     i += 1..     
+0000a740: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000a750: 2872 6574 2c64 6963 7429 206f 7220 6973  (ret,dict) or is
+0000a760: 696e 7374 616e 6365 2872 6574 2c6c 6973  instance(ret,lis
+0000a770: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000a780: 7265 7420 3d20 636f 7079 2e64 6565 7063  ret = copy.deepc
+0000a790: 6f70 7928 7265 7429 0a20 2020 2020 2020  opy(ret).       
+0000a7a0: 2069 6620 7265 7420 3d3d 2022 2220 6f72   if ret == "" or
+0000a7b0: 2072 6574 203d 3d20 7b7d 3a0a 2020 2020   ret == {}:.    
+0000a7c0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+0000a7d0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+0000a7e0: 6e28 226b 6579 7320 646f 206e 6f74 2065  n("keys do not e
+0000a7f0: 7869 7374 3a22 202b 2073 7472 286b 6579  xist:" + str(key
+0000a800: 7329 290a 2020 2020 2020 2020 7265 7475  s)).        retu
+0000a810: 726e 2072 6574 0a0a 0a20 2020 2040 7374  rn ret...    @st
+0000a820: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
+0000a830: 6566 205f 5f67 6574 4974 656d 5661 6c75  ef __getItemValu
+0000a840: 6528 6974 656d 732c 6b65 7973 2c73 6b69  e(items,keys,ski
+0000a850: 7070 6564 496e 4865 6164 6572 2c64 6566  ppedInHeader,def
+0000a860: 6175 6c74 5661 6c29 3a0a 2020 2020 2020  aultVal):.      
+0000a870: 2020 0a20 2020 2020 2020 2023 2069 6e20    .        # in 
+0000a880: 6361 7365 2069 7465 6d20 6973 206e 6f74  case item is not
+0000a890: 2061 206c 6973 7420 2873 686f 756c 6420   a list (should 
+0000a8a0: 6e6f 7420 6265 2070 6f73 7369 626c 6529  not be possible)
+0000a8b0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000a8c0: 6973 696e 7374 616e 6365 2869 7465 6d73  isinstance(items
+0000a8d0: 5b6b 6579 735b 305d 5d2c 6c69 7374 293a  [keys[0]],list):
+0000a8e0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+0000a8f0: 6d73 5b6b 6579 735b 305d 5d20 3d20 5b69  ms[keys[0]] = [i
+0000a900: 7465 6d73 5b6b 6579 735b 305d 5d5d 0a0a  tems[keys[0]]]..
+0000a910: 2020 2020 2020 2020 6974 656d 5661 6c75          itemValu
+0000a920: 6520 3d20 6669 6e64 4669 656c 6428 6974  e = findField(it
+0000a930: 656d 732c 6b65 7973 290a 0a20 2020 2020  ems,keys)..     
+0000a940: 2020 2069 6620 6974 656d 5661 6c75 6520     if itemValue 
+0000a950: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000a960: 2020 2072 6574 203d 2064 6566 6175 6c74     ret = default
+0000a970: 5661 6c0a 2020 2020 2020 2020 2320 696e  Val.        # in
+0000a980: 2063 6173 6520 6f66 2064 6963 7473 206a   case of dicts j
+0000a990: 6f69 6e74 2068 6561 6465 7220 616e 6420  oint header and 
+0000a9a0: 6974 656d 2066 6965 6c64 730a 2020 2020  item fields.    
+0000a9b0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
+0000a9c0: 6e63 6528 6974 656d 5661 6c75 652c 6469  nce(itemValue,di
+0000a9d0: 6374 2920 616e 6420 6465 6661 756c 7456  ct) and defaultV
+0000a9e0: 616c 2021 3d20 2222 3a0a 2020 2020 2020  al != "":.      
+0000a9f0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
+0000aa00: 6e73 7461 6e63 6528 6465 6661 756c 7456  nstance(defaultV
+0000aa10: 616c 2c64 6963 7429 3a0a 2020 2020 2020  al,dict):.      
+0000aa20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000aa30: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+0000aa40: 696f 6e28 2249 7465 6d20 6669 656c 6420  ion("Item field 
+0000aa50: 6973 2064 6963 7420 6275 7420 6465 6661  is dict but defa
+0000aa60: 756c 7420 7661 6c75 6520 696e 2068 6561  ult value in hea
+0000aa70: 6465 7220 6973 206e 6f74 3a20 2220 2b20  der is not: " + 
+0000aa80: 7374 7228 6b65 7973 2929 0a20 2020 2020  str(keys)).     
+0000aa90: 2020 2020 2020 2072 6574 203d 207b 2a2a         ret = {**
+0000aaa0: 6465 6661 756c 7456 616c 2c2a 2a69 7465  defaultVal,**ite
+0000aab0: 6d56 616c 7565 7d0a 2020 2020 2020 2020  mValue}.        
+0000aac0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000aad0: 2020 7265 7420 3d20 6974 656d 5661 6c75    ret = itemValu
+0000aae0: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+0000aaf0: 2072 6574 0a0a 0a20 2020 2064 6566 205f   ret...    def _
+0000ab00: 5f73 7472 5f5f 2873 656c 6629 202d 3e20  _str__(self) -> 
+0000ab10: 7374 723a 0a20 2020 2020 2020 2022 2222  str:.        """
+0000ab20: 2050 7269 6e74 7320 6375 7272 656e 7420   Prints current 
+0000ab30: 6946 444f 2066 696c 6520 2222 220a 2020  iFDO file """.  
+0000ab40: 2020 2020 2020 7265 7475 726e 2079 616d        return yam
+0000ab50: 6c2e 6475 6d70 2873 656c 662e 6966 646f  l.dump(self.ifdo
+0000ab60: 5f63 6865 636b 6564 2c20 6465 6661 756c  _checked, defaul
+0000ab70: 745f 7374 796c 653d 4e6f 6e65 2c20 6465  t_style=None, de
+0000ab80: 6661 756c 745f 666c 6f77 5f73 7479 6c65  fault_flow_style
+0000ab90: 3d4e 6f6e 652c 2061 6c6c 6f77 5f75 6e69  =None, allow_uni
+0000aba0: 636f 6465 3d54 7275 652c 2077 6964 7468  code=True, width
+0000abb0: 3d66 6c6f 6174 2822 696e 6622 2929 0a0a  =float("inf"))..
+0000abc0: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
+0000abd0: 656d 5f5f 2873 656c 662c 206b 6579 7329  em__(self, keys)
+0000abe0: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+0000abf0: 7475 726e 7320 636f 7079 206f 6620 6368  turns copy of ch
+0000ac00: 6563 6b65 6420 6966 646f 2073 6574 206f  ecked ifdo set o
+0000ac10: 7220 6974 656d 2066 6965 6c64 2076 616c  r item field val
+0000ac20: 7565 2c20 616c 736f 2063 6f6e 7369 6465  ue, also conside
+0000ac30: 726e 6720 6465 6661 756c 7420 7661 6c75  rng default valu
+0000ac40: 6573 2066 726f 6d20 6865 6164 6572 2e0a  es from header..
+0000ac50: 2020 2020 2020 2020 2020 2020 5573 6520              Use 
+0000ac60: 6b65 7973 2061 7320 652e 672e 2027 3c69  keys as e.g. '<i
+0000ac70: 7465 6d3e 3a3c 6b65 793e 3a2e 2e2e 272e  tem>:<key>:...'.
+0000ac80: 2043 616e 2062 6520 7573 6564 2066 6f72   Can be used for
+0000ac90: 2068 6561 6465 7220 6669 656c 6473 2061   header fields a
+0000aca0: 7320 7765 6c6c 2061 7320 6974 656d 2066  s well as item f
+0000acb0: 6965 6c64 732e 0a20 2020 2020 2020 2020  ields..         
+0000acc0: 2020 2049 7465 6d20 696e 6465 7820 6361     Item index ca
+0000acd0: 6e20 6265 206c 6567 6c65 6374 6564 2c20  n be leglected, 
+0000ace0: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
+0000acf0: 2061 2064 6963 7420 7b3c 696d 6167 652d   a dict {<image-
+0000ad00: 6461 7461 7469 6d65 3e3a 3c76 616c 7565  datatime>:<value
+0000ad10: 3e2c 2e2e 2e7d 2069 7320 7265 7475 726e  >,...} is return
+0000ad20: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+0000ad30: 5261 6973 6573 2049 6664 6f45 7863 6570  Raises IfdoExcep
+0000ad40: 7469 6f6e 2069 6620 6974 656d 2064 6f65  tion if item doe
+0000ad50: 7320 6e6f 7420 6578 6973 742e 2022 2222  s not exist. """
+0000ad60: 0a20 2020 2020 2020 206b 6579 7320 3d20  .        keys = 
+0000ad70: 6b65 7973 2e73 706c 6974 2827 3a27 290a  keys.split(':').
+0000ad80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000ad90: 656c 662e 5f5f 6765 7446 6965 6c64 5661  elf.__getFieldVa
+0000ada0: 6c75 6528 7365 6c66 2e69 6664 6f5f 6368  lue(self.ifdo_ch
+0000adb0: 6563 6b65 642c 6b65 7973 290a 0a0a 2020  ecked,keys)...  
+0000adc0: 2020 6465 6620 6669 6e64 546d 7046 6965    def findTmpFie
+0000add0: 6c64 2873 656c 662c 6b65 7973 293a 0a20  ld(self,keys):. 
+0000ade0: 2020 2020 2020 2022 2222 2052 6574 7572         """ Retur
+0000adf0: 6e73 2063 6f70 7920 6f66 2074 656d 706f  ns copy of tempo
+0000ae00: 7261 7279 2075 6e63 6865 636b 6564 2069  rary unchecked i
+0000ae10: 6664 6f20 7365 7420 6f72 2069 7465 6d20  fdo set or item 
+0000ae20: 6669 656c 6420 7661 6c75 652c 2061 6c73  field value, als
+0000ae30: 6f20 636f 6e73 6964 6572 6e67 2064 6566  o considerng def
+0000ae40: 6175 6c74 2076 616c 7565 7320 6672 6f6d  ault values from
+0000ae50: 2068 6561 6465 722e 0a20 2020 2020 2020   header..       
+0000ae60: 2020 2020 2055 7365 206b 6579 7320 6173       Use keys as
+0000ae70: 2065 2e67 2e20 273c 6974 656d 3e3a 3c6b   e.g. '<item>:<k
+0000ae80: 6579 3e3a 2e2e 2e27 2e20 4361 6e20 6265  ey>:...'. Can be
+0000ae90: 2075 7365 6420 666f 7220 6865 6164 6572   used for header
+0000aea0: 2066 6965 6c64 7320 6173 2077 656c 6c20   fields as well 
+0000aeb0: 6173 2069 7465 6d20 6669 656c 6473 2e0a  as item fields..
+0000aec0: 2020 2020 2020 2020 2020 2020 4974 656d              Item
+0000aed0: 2069 6e64 6578 2063 616e 2062 6520 6c65   index can be le
+0000aee0: 676c 6563 7465 642c 2069 6e20 6361 7365  glected, in case
+0000aef0: 206f 6620 7669 6465 6f20 6120 6469 6374   of video a dict
+0000af00: 207b 3c69 6d61 6765 2d64 6174 6174 696d   {<image-datatim
+0000af10: 653e 3a3c 7661 6c75 653e 2c2e 2e2e 7d20  e>:<value>,...} 
+0000af20: 6973 2072 6574 7572 6e65 642e 0a20 2020  is returned..   
+0000af30: 2020 2020 2020 2020 2052 6169 7365 7320           Raises 
+0000af40: 4966 646f 4578 6365 7074 696f 6e20 6966  IfdoException if
+0000af50: 2069 7465 6d20 646f 6573 206e 6f74 2065   item does not e
+0000af60: 7869 7374 2e20 2222 220a 2020 2020 2020  xist. """.      
+0000af70: 2020 6b65 7973 203d 206b 6579 732e 7370    keys = keys.sp
+0000af80: 6c69 7428 273a 2729 0a20 2020 2020 2020  lit(':').       
+0000af90: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
+0000afa0: 6574 4669 656c 6456 616c 7565 2873 656c  etFieldValue(sel
+0000afb0: 662e 6966 646f 5f74 6d70 2c6b 6579 7329  f.ifdo_tmp,keys)
+0000afc0: 0a20 2020 200a 0a20 2020 2064 6566 2066  .    ..    def f
+0000afd0: 696e 6454 6d70 4669 656c 6432 2873 656c  indTmpField2(sel
+0000afe0: 662c 6b65 7973 293a 0a20 2020 2020 2020  f,keys):.       
+0000aff0: 2022 2222 2053 616d 6520 6173 2066 696e   """ Same as fin
+0000b000: 6454 6d70 4669 656c 6420 696e 7374 6561  dTmpField instea
+0000b010: 6420 6f66 2072 6169 7369 6e67 2065 7863  d of raising exc
+0000b020: 6570 7469 6f6e 2069 7420 7265 7475 726e  eption it return
+0000b030: 2065 6d70 7479 2073 7472 696e 672e 2022   empty string. "
+0000b040: 2222 0a20 2020 2020 2020 206b 6579 7320  "".        keys 
+0000b050: 3d20 6b65 7973 2e73 706c 6974 2827 3a27  = keys.split(':'
+0000b060: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+0000b070: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+0000b080: 2073 656c 662e 5f5f 6765 7446 6965 6c64   self.__getField
+0000b090: 5661 6c75 6528 7365 6c66 2e69 6664 6f5f  Value(self.ifdo_
+0000b0a0: 746d 702c 6b65 7973 290a 2020 2020 2020  tmp,keys).      
+0000b0b0: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
+0000b0c0: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
+0000b0d0: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
+0000b0e0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000b0f0: 6e20 7265 740a 0a0a 2020 2020 6465 6620  n ret...    def 
+0000b100: 7365 7469 4644 4f48 6561 6465 7246 6965  setiFDOHeaderFie
+0000b110: 6c64 7328 7365 6c66 2c20 6865 6164 6572  lds(self, header
+0000b120: 3a20 6469 6374 293a 0a20 2020 2020 2020  : dict):.       
+0000b130: 2022 2222 2043 6c65 6172 7320 6375 7272   """ Clears curr
+0000b140: 656e 7420 6865 6164 6572 2066 6965 6c64  ent header field
+0000b150: 7320 756e 6420 7365 7473 2070 726f 7669  s und sets provi
+0000b160: 6465 6420 6669 656c 6420 7661 6c75 6573  ded field values
+0000b170: 2e20 466f 7220 7570 6461 7469 6e67 2065  . For updating e
+0000b180: 7869 7374 696e 6720 6f6e 6573 2075 7365  xisting ones use
+0000b190: 2075 7064 6174 655f 6966 646f 5f68 6561   update_ifdo_hea
+0000b1a0: 6465 725f 6669 656c 6473 2829 2022 2222  der_fields() """
+0000b1b0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
+0000b1c0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000b1d0: 6553 6574 4865 6164 6572 4b65 795d 203d  eSetHeaderKey] =
+0000b1e0: 207b 7d0a 2020 2020 2020 2020 6966 2073   {}.        if s
+0000b1f0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000b200: 6572 4b65 7920 696e 2068 6561 6465 723a  erKey in header:
+0000b210: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+0000b220: 6465 7220 3d20 6865 6164 6572 5b73 656c  der = header[sel
+0000b230: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000b240: 4b65 795d 0a20 2020 2020 2020 2066 6f72  Key].        for
+0000b250: 2066 6965 6c64 2069 6e20 6865 6164 6572   field in header
+0000b260: 3a0a 2020 2020 2020 2020 2020 2020 2369  :.            #i
+0000b270: 6620 6669 656c 6420 6e6f 7420 696e 206d  f field not in m
+0000b280: 6971 7476 2e69 6664 6f5f 6865 6164 6572  iqtv.ifdo_header
+0000b290: 5f63 6f72 655f 6669 656c 6473 3a0a 2020  _core_fields:.  
+0000b2a0: 2020 2020 2020 2020 2020 2320 2020 2073            #    s
+0000b2b0: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0000b2c0: 7574 696f 6e21 2055 6e6b 6e6f 776e 2068  ution! Unknown h
+0000b2d0: 6561 6465 7220 6669 656c 6420 5c22 2220  eader field \"" 
+0000b2e0: 2b20 6669 656c 6420 2b20 225c 222e 204d  + field + "\". M
+0000b2f0: 6179 6265 2061 2074 7970 6f3f 204f 7468  aybe a typo? Oth
+0000b300: 6572 7769 7365 2069 676e 6f72 6520 6d65  erwise ignore me
+0000b310: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+0000b320: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000b330: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000b340: 724b 6579 5d5b 6669 656c 645d 203d 2068  rKey][field] = h
+0000b350: 6561 6465 725b 6669 656c 645d 0a0a 0a20  eader[field]... 
+0000b360: 2020 2064 6566 2075 7064 6174 655f 6966     def update_if
+0000b370: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
+0000b380: 2873 656c 662c 2068 6561 6465 723a 2064  (self, header: d
+0000b390: 6963 7429 3a0a 2020 2020 2020 2020 2222  ict):.        ""
+0000b3a0: 2220 5570 6461 7465 7320 6578 6973 7469  " Updates existi
+0000b3b0: 6e67 2068 6561 6465 7220 6669 656c 6473  ng header fields
+0000b3c0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0000b3d0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b3e0: 6465 724b 6579 2069 6e20 6865 6164 6572  derKey in header
+0000b3f0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+0000b400: 6164 6572 203d 2068 6561 6465 725b 7365  ader = header[se
+0000b410: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000b420: 724b 6579 5d0a 2020 2020 2020 2020 6c6f  rKey].        lo
+0000b430: 6720 3d20 6d69 7174 632e 7265 6375 7273  g = miqtc.recurs
+0000b440: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
+0000b450: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+0000b460: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000b470: 6572 4b65 795d 2c20 6865 6164 6572 290a  erKey], header).
+0000b480: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+0000b490: 762e 6c6f 6728 6c6f 672c 646f 6e74 5368  v.log(log,dontSh
+0000b4a0: 6f77 3d54 7275 6529 0a0a 2020 2020 6465  ow=True)..    de
+0000b4b0: 6620 7570 6461 7465 6946 444f 4865 6164  f updateiFDOHead
+0000b4c0: 6572 4669 656c 6473 2873 656c 662c 2068  erFields(self, h
+0000b4d0: 6561 6465 723a 2064 6963 7429 3a0a 2020  eader: dict):.  
+0000b4e0: 2020 2020 2020 2222 2220 4465 7072 6563        """ Deprec
+0000b4f0: 6174 6564 202d 2075 7365 2075 7064 6174  ated - use updat
+0000b500: 655f 6966 646f 5f68 6561 6465 725f 6669  e_ifdo_header_fi
+0000b510: 656c 6473 2022 2222 0a20 2020 2020 2020  elds """.       
+0000b520: 2073 656c 662e 7570 6461 7465 5f69 6664   self.update_ifd
+0000b530: 6f5f 6865 6164 6572 5f66 6965 6c64 7328  o_header_fields(
+0000b540: 6865 6164 6572 290a 0a0a 2020 2020 6465  header)...    de
+0000b550: 6620 5f74 7279 5f75 7067 7261 6465 5f74  f _try_upgrade_t
+0000b560: 6f5f 6966 646f 5f76 6572 7369 6f6e 5f32  o_ifdo_version_2
+0000b570: 7828 7365 6c66 293a 0a20 2020 2020 2020  x(self):.       
+0000b580: 2022 2222 2054 7279 2074 6f20 636f 6e76   """ Try to conv
+0000b590: 6572 7420 6669 656c 6473 2066 726f 6d20  ert fields from 
+0000b5a0: 6946 444f 2076 6572 7369 6f6e 203c 2032  iFDO version < 2
+0000b5b0: 2e30 2e30 2074 6f20 322e 7820 2222 220a  .0.0 to 2.x """.
+0000b5c0: 2020 2020 2020 2020 7265 6164 5f76 6572          read_ver
+0000b5d0: 7369 6f6e 5f73 7472 203d 2022 7631 2e30  sion_str = "v1.0
+0000b5e0: 2e30 2220 2320 6469 6420 6e6f 7420 6861  .0" # did not ha
+0000b5f0: 7665 2074 6865 2027 696d 6167 652d 7365  ve the 'image-se
+0000b600: 742d 6966 646f 2d76 6572 7369 6f6e 2720  t-ifdo-version' 
+0000b610: 6669 656c 6420 7965 740a 2020 2020 2020  field yet.      
+0000b620: 2020 7472 793a 200a 2020 2020 2020 2020    try: .        
+0000b630: 2020 2020 7265 6164 5f76 6572 7369 6f6e      read_version
+0000b640: 5f73 7472 203d 2073 656c 662e 6669 6e64  _str = self.find
+0000b650: 546d 7046 6965 6c64 2827 696d 6167 652d  TmpField('image-
+0000b660: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
+0000b670: 2729 0a20 2020 2020 2020 2065 7863 6570  ').        excep
+0000b680: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
+0000b690: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+0000b6a0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0000b6b0: 7265 6164 5f76 6572 7369 6f6e 203d 2056  read_version = V
+0000b6c0: 6572 7369 6f6e 2872 6561 645f 7665 7273  ersion(read_vers
+0000b6d0: 696f 6e5f 7374 7229 0a0a 2020 2020 2020  ion_str)..      
+0000b6e0: 2020 6966 2072 6561 645f 7665 7273 696f    if read_versio
+0000b6f0: 6e20 3c20 5665 7273 696f 6e28 2232 2e30  n < Version("2.0
+0000b700: 2e30 2229 3a0a 2020 2020 2020 2020 2020  .0"):.          
+0000b710: 2020 0a20 2020 2020 2020 2020 2020 2023    .            #
+0000b720: 206e 6577 2055 5249 206f 626a 6563 7420   new URI object 
+0000b730: 6669 656c 6473 0a20 2020 2020 2020 2020  fields.         
+0000b740: 2020 206e 6577 5f75 7269 5f66 6965 6c64     new_uri_field
+0000b750: 7320 3d20 5b27 696d 6167 652d 7365 6e73  s = ['image-sens
+0000b760: 6f72 272c 2769 6d61 6765 2d65 7665 6e74  or','image-event
+0000b770: 272c 2769 6d61 6765 2d70 726f 6a65 6374  ','image-project
+0000b780: 272c 2769 6d61 6765 2d63 6f6e 7465 7874  ','image-context
+0000b790: 272c 2769 6d61 6765 2d6c 6963 656e 7365  ','image-license
+0000b7a0: 272c 2769 6d61 6765 2d70 6c61 7466 6f72  ','image-platfor
+0000b7b0: 6d27 5d0a 2020 2020 2020 2020 2020 2020  m'].            
+0000b7c0: 666f 7220 7572 695f 6669 656c 6420 696e  for uri_field in
+0000b7d0: 206e 6577 5f75 7269 5f66 6965 6c64 733a   new_uri_fields:
+0000b7e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b7f0: 206f 6c64 5f73 7472 5f76 616c 203d 2073   old_str_val = s
+0000b800: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000b810: 3228 7572 695f 6669 656c 6429 0a20 2020  2(uri_field).   
+0000b820: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000b830: 6973 696e 7374 616e 6365 286f 6c64 5f73  isinstance(old_s
+0000b840: 7472 5f76 616c 2c73 7472 2920 616e 6420  tr_val,str) and 
+0000b850: 6f6c 645f 7374 725f 7661 6c20 213d 2022  old_str_val != "
+0000b860: 223a 2020 2020 2020 2020 2020 2020 2020  ":              
+0000b870: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0000b880: 2020 2020 2020 2020 2020 206e 6577 5f6f             new_o
+0000b890: 626a 5f76 616c 203d 207b 276e 616d 6527  bj_val = {'name'
+0000b8a0: 3a20 6f6c 645f 7374 725f 7661 6c7d 0a20  : old_str_val}. 
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2020 2069 735f 7572 692c 206d 7367 203d     is_uri, msg =
+0000b8d0: 206d 6971 7474 2e76 616c 6964 6174 655f   miqtt.validate_
+0000b8e0: 6167 6169 6e73 745f 7363 6865 6d61 286f  against_schema(o
+0000b8f0: 6c64 5f73 7472 5f76 616c 2c7b 2274 7970  ld_str_val,{"typ
+0000b900: 6522 3a20 2273 7472 696e 6722 2c22 666f  e": "string","fo
+0000b910: 726d 6174 223a 2022 7572 6922 7d29 0a20  rmat": "uri"}). 
+0000b920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b930: 2020 2069 6620 6973 5f75 7269 3a0a 2020     if is_uri:.  
+0000b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b950: 2020 2020 2020 6e65 775f 6f62 6a5f 7661        new_obj_va
+0000b960: 6c5b 2775 7269 275d 203d 206f 6c64 5f73  l['uri'] = old_s
+0000b970: 7472 5f76 616c 0a20 2020 2020 2020 2020  tr_val.         
+0000b980: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b990: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000b9a0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000b9b0: 5b75 7269 5f66 6965 6c64 5d20 3d20 6e65  [uri_field] = ne
+0000b9c0: 775f 6f62 6a5f 7661 6c0a 2020 2020 2020  w_obj_val.      
+0000b9d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000b9e0: 6c66 2e70 726f 762e 6c6f 6728 2241 7574  lf.prov.log("Aut
+0000b9f0: 6f2d 7570 6772 6164 6564 2022 202b 2075  o-upgraded " + u
+0000ba00: 7269 5f66 6965 6c64 202b 2022 2066 726f  ri_field + " fro
+0000ba10: 6d20 2220 2b20 6f6c 645f 7374 725f 7661  m " + old_str_va
+0000ba20: 6c20 2b20 2220 746f 2022 202b 2073 7472  l + " to " + str
+0000ba30: 286e 6577 5f6f 626a 5f76 616c 2929 0a0a  (new_obj_val))..
+0000ba40: 0a0a 2020 2020 6465 6620 7472 7941 7574  ..    def tryAut
+0000ba50: 6f53 6574 4865 6164 6572 4669 656c 6473  oSetHeaderFields
+0000ba60: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000ba70: 2222 2220 5365 7473 2063 6572 7461 696e  """ Sets certain
+0000ba80: 2068 6561 6465 7220 6669 656c 6473 2065   header fields e
+0000ba90: 2e67 2e20 6672 6f6d 2064 6972 6563 746f  .g. from directo
+0000baa0: 7279 2069 6620 7468 6579 2061 7265 206e  ry if they are n
+0000bab0: 6f74 2073 6574 2079 6574 2022 2222 0a0a  ot set yet """..
+0000bac0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000bad0: 6669 6e64 546d 7046 6965 6c64 3228 2769  findTmpField2('i
+0000bae0: 6d61 6765 2d73 656e 736f 7227 2920 3d3d  mage-sensor') ==
+0000baf0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+0000bb00: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000bb10: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000bb20: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
+0000bb30: 6e73 6f72 275d 203d 207b 276e 616d 6527  nsor'] = {'name'
+0000bb40: 3a20 7365 6c66 2e64 6972 2e73 656e 736f  : self.dir.senso
+0000bb50: 7228 297d 0a20 2020 2020 2020 2065 6c69  r()}.        eli
+0000bb60: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
+0000bb70: 656c 6428 2769 6d61 6765 2d73 656e 736f  eld('image-senso
+0000bb80: 7227 295b 276e 616d 6527 5d20 213d 2073  r')['name'] != s
+0000bb90: 656c 662e 6469 722e 7365 6e73 6f72 2829  elf.dir.sensor()
+0000bba0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000bbb0: 6c66 2e70 726f 762e 6c6f 6728 2243 6175  lf.prov.log("Cau
+0000bbc0: 7469 6f6e 2120 2769 6d61 6765 2d73 656e  tion! 'image-sen
+0000bbd0: 736f 7227 2022 2b20 7374 7228 7365 6c66  sor' "+ str(self
+0000bbe0: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
+0000bbf0: 6d61 6765 2d73 656e 736f 7227 2929 202b  mage-sensor')) +
+0000bc00: 2022 2064 6966 6665 7273 2066 726f 6d20   " differs from 
+0000bc10: 7365 6e73 6f72 2070 6172 7365 6420 6672  sensor parsed fr
+0000bc20: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
+0000bc30: 2b20 7365 6c66 2e64 6972 2e73 656e 736f  + self.dir.senso
+0000bc40: 7228 2929 0a0a 2020 2020 2020 2020 6966  r())..        if
+0000bc50: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000bc60: 6c64 3228 2769 6d61 6765 2d65 7665 6e74  ld2('image-event
+0000bc70: 2729 203d 3d20 2222 3a0a 2020 2020 2020  ') == "":.      
+0000bc80: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000bc90: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000bca0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000bcb0: 6765 2d65 7665 6e74 275d 203d 207b 276e  ge-event'] = {'n
+0000bcc0: 616d 6527 3a20 7365 6c66 2e64 6972 2e65  ame': self.dir.e
+0000bcd0: 7665 6e74 2829 7d0a 2020 2020 2020 2020  vent()}.        
+0000bce0: 656c 6966 2073 656c 662e 6669 6e64 546d  elif self.findTm
+0000bcf0: 7046 6965 6c64 2827 696d 6167 652d 6576  pField('image-ev
+0000bd00: 656e 7427 295b 276e 616d 6527 5d20 213d  ent')['name'] !=
+0000bd10: 2073 656c 662e 6469 722e 6576 656e 7428   self.dir.event(
+0000bd20: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000bd30: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0000bd40: 7574 696f 6e21 2027 696d 6167 652d 6576  ution! 'image-ev
+0000bd50: 656e 7427 2022 202b 2073 7472 2873 656c  ent' " + str(sel
+0000bd60: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+0000bd70: 696d 6167 652d 6576 656e 7427 2929 202b  image-event')) +
+0000bd80: 2022 2064 6966 6665 7273 2066 726f 6d20   " differs from 
+0000bd90: 6576 656e 7420 7061 7273 6564 2066 726f  event parsed fro
+0000bda0: 6d20 6469 7265 6374 6f72 793a 2022 202b  m directory: " +
+0000bdb0: 2073 656c 662e 6469 722e 6576 656e 7428   self.dir.event(
+0000bdc0: 2929 0a0a 2020 2020 2020 2020 6966 2073  ))..        if s
+0000bdd0: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+0000bde0: 3228 2769 6d61 6765 2d70 726f 6a65 6374  2('image-project
+0000bdf0: 2729 203d 3d20 2222 3a0a 2020 2020 2020  ') == "":.      
+0000be00: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000be10: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000be20: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
+0000be30: 6765 2d70 726f 6a65 6374 275d 203d 2020  ge-project'] =  
+0000be40: 7b27 6e61 6d65 273a 2073 656c 662e 6469  {'name': self.di
+0000be50: 722e 7072 6f6a 6563 7428 297d 0a20 2020  r.project()}.   
+0000be60: 2020 2020 2065 6c69 6620 7365 6c66 2e66       elif self.f
+0000be70: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
+0000be80: 6765 2d70 726f 6a65 6374 2729 5b27 6e61  ge-project')['na
+0000be90: 6d65 275d 2021 3d20 7365 6c66 2e64 6972  me'] != self.dir
+0000bea0: 2e70 726f 6a65 6374 2829 3a0a 2020 2020  .project():.    
+0000beb0: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+0000bec0: 762e 6c6f 6728 2243 6175 7469 6f6e 2120  v.log("Caution! 
+0000bed0: 2769 6d61 6765 2d70 726f 6a65 6374 2720  'image-project' 
+0000bee0: 2220 2b20 7374 7228 7365 6c66 2e66 696e  " + str(self.fin
+0000bef0: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
+0000bf00: 2d70 726f 6a65 6374 2729 2920 2b20 2220  -project')) + " 
+0000bf10: 6469 6666 6572 7320 6672 6f6d 2070 726f  differs from pro
+0000bf20: 6a65 6374 2070 6172 7365 6420 6672 6f6d  ject parsed from
+0000bf30: 2064 6972 6563 746f 7279 3a20 2220 2b20   directory: " + 
+0000bf40: 7365 6c66 2e64 6972 2e70 726f 6a65 6374  self.dir.project
+0000bf50: 2829 290a 0a20 2020 2020 2020 2069 6620  ())..        if 
+0000bf60: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000bf70: 6432 2827 696d 6167 652d 706c 6174 666f  d2('image-platfo
+0000bf80: 726d 2729 203d 3d20 2222 2061 6e64 2073  rm') == "" and s
+0000bf90: 656c 662e 6469 722e 6765 6172 2829 2021  elf.dir.gear() !
+0000bfa0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000bfb0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000bfc0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000bfd0: 6465 724b 6579 5d5b 2769 6d61 6765 2d70  derKey]['image-p
+0000bfe0: 6c61 7466 6f72 6d27 5d20 3d20 7b27 6e61  latform'] = {'na
+0000bff0: 6d65 273a 2073 656c 662e 6469 722e 6765  me': self.dir.ge
+0000c000: 6172 2829 7d0a 0a20 2020 2020 2020 2069  ar()}..        i
+0000c010: 6620 6e6f 7420 2769 6d61 6765 2d73 6574  f not 'image-set
+0000c020: 2d75 7569 6427 2069 6e20 7365 6c66 2e69  -uuid' in self.i
+0000c030: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000c040: 6765 5365 7448 6561 6465 724b 6579 5d3a  geSetHeaderKey]:
+0000c050: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000c060: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000c070: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000c080: 795d 5b27 696d 6167 652d 7365 742d 7575  y]['image-set-uu
+0000c090: 6964 275d 203d 2073 7472 286d 6971 7463  id'] = str(miqtc
+0000c0a0: 2e75 7569 6434 2829 290a 2020 2020 2020  .uuid4()).      
+0000c0b0: 2020 6966 206e 6f74 2027 696d 6167 652d    if not 'image-
+0000c0c0: 7365 742d 6861 6e64 6c65 2720 696e 2073  set-handle' in s
+0000c0d0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+0000c0e0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000c0f0: 4b65 795d 3a0a 2020 2020 2020 2020 2020  Key]:.          
+0000c100: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000c110: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000c120: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
+0000c130: 6574 2d68 616e 646c 6527 5d20 3d20 7365  et-handle'] = se
+0000c140: 6c66 2e68 616e 646c 655f 7072 6566 6978  lf.handle_prefix
+0000c150: 202b 2022 2f22 202b 2073 656c 662e 6669   + "/" + self.fi
+0000c160: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+0000c170: 652d 7365 742d 7575 6964 2729 0a20 2020  e-set-uuid').   
+0000c180: 2020 2020 2069 6620 6e6f 7420 2769 6d61       if not 'ima
+0000c190: 6765 2d73 6574 2d6e 616d 6527 2069 6e20  ge-set-name' in 
+0000c1a0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000c1b0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000c1c0: 724b 6579 5d20 6f72 2073 656c 662e 6669  rKey] or self.fi
+0000c1d0: 6e64 546d 7046 6965 6c64 3228 2769 6d61  ndTmpField2('ima
+0000c1e0: 6765 2d73 6574 2d6e 616d 6527 2920 3d3d  ge-set-name') ==
+0000c1f0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+0000c200: 2023 2063 6f6e 7374 7275 6374 2061 7320   # construct as 
+0000c210: 3c70 726f 6a65 6374 3e5f 3c65 7665 6e74  <project>_<event
+0000c220: 3e5f 3c73 656e 736f 723e 0a20 2020 2020  >_<sensor>.     
+0000c230: 2020 2020 2020 2070 726f 6a65 6374 5f20         project_ 
+0000c240: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
+0000c250: 656c 6432 2822 696d 6167 652d 7072 6f6a  eld2("image-proj
+0000c260: 6563 7422 295b 276e 616d 6527 5d0a 2020  ect")['name'].  
+0000c270: 2020 2020 2020 2020 2020 6576 656e 745f            event_
+0000c280: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
+0000c290: 6965 6c64 3228 2269 6d61 6765 2d65 7665  ield2("image-eve
+0000c2a0: 6e74 2229 5b27 6e61 6d65 275d 0a20 2020  nt")['name'].   
+0000c2b0: 2020 2020 2020 2020 2069 6620 6576 656e           if even
+0000c2c0: 745f 203d 3d20 2222 3a0a 2020 2020 2020  t_ == "":.      
+0000c2d0: 2020 2020 2020 2020 2020 6576 656e 745f            event_
+0000c2e0: 203d 2073 656c 662e 6469 722e 6576 656e   = self.dir.even
+0000c2f0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0000c300: 7365 6e73 6f72 5f20 3d20 7365 6c66 2e66  sensor_ = self.f
+0000c310: 696e 6454 6d70 4669 656c 6432 2822 696d  indTmpField2("im
+0000c320: 6167 652d 7365 6e73 6f72 2229 5b27 6e61  age-sensor")['na
+0000c330: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
+0000c340: 2069 6620 7365 6e73 6f72 5f20 3d3d 2022   if sensor_ == "
+0000c350: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c360: 2020 2073 656e 736f 725f 203d 2073 656c     sensor_ = sel
+0000c370: 662e 6469 722e 7365 6e73 6f72 2829 0a20  f.dir.sensor(). 
+0000c380: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000c390: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000c3a0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000c3b0: 5b27 696d 6167 652d 7365 742d 6e61 6d65  ['image-set-name
+0000c3c0: 275d 203d 2069 4644 4f2e 636f 6e73 7472  '] = iFDO.constr
+0000c3d0: 7563 7449 6d61 6765 5365 744e 616d 6528  uctImageSetName(
+0000c3e0: 7072 6f6a 6563 745f 2c65 7665 6e74 5f2c  project_,event_,
+0000c3f0: 7365 6e73 6f72 5f29 0a0a 2020 2020 2020  sensor_)..      
+0000c400: 2020 2320 7365 7420 7665 7273 696f 6e0a    # set version.
+0000c410: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000c420: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000c430: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000c440: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
+0000c450: 7273 696f 6e27 5d20 3d20 6d69 7174 762e  rsion'] = miqtv.
+0000c460: 6946 444f 5f76 6572 7369 6f6e 0a0a 0a20  iFDO_version... 
+0000c470: 2020 2064 6566 2073 6574 4865 6164 6572     def setHeader
+0000c480: 496d 6167 654c 6f63 616c 5061 7468 4669  ImageLocalPathFi
+0000c490: 656c 6428 7365 6c66 293a 0a20 2020 2020  eld(self):.     
+0000c4a0: 2020 2022 2222 2053 6574 7320 6865 6164     """ Sets head
+0000c4b0: 6572 2066 6965 6c64 2027 696d 6167 652d  er field 'image-
+0000c4c0: 7365 742d 6c6f 6361 6c2d 7061 7468 2720  set-local-path' 
+0000c4d0: 6672 6f6d 2069 6d61 6765 2064 6972 2022  from image dir "
+0000c4e0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0000c4f0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000c500: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000c510: 5b27 696d 6167 652d 7365 742d 6c6f 6361  ['image-set-loca
+0000c520: 6c2d 7061 7468 275d 203d 206f 732e 7061  l-path'] = os.pa
+0000c530: 7468 2e72 656c 7061 7468 2873 656c 662e  th.relpath(self.
+0000c540: 696d 6167 6573 4469 722c 206f 732e 7061  imagesDir, os.pa
+0000c550: 7468 2e64 6972 6e61 6d65 2873 656c 662e  th.dirname(self.
+0000c560: 6765 7469 4644 4f46 696c 654e 616d 6528  getiFDOFileName(
+0000c570: 2929 290a 0a0a 2020 2020 6465 6620 6372  )))...    def cr
+0000c580: 6561 7465 5f66 6965 6c64 7328 7365 6c66  eate_fields(self
+0000c590: 2c20 616c 6c6f 775f 6d69 7373 696e 675f  , allow_missing_
+0000c5a0: 7265 7175 6972 6564 3d46 616c 7365 293a  required=False):
+0000c5b0: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
+0000c5c0: 6174 6520 616e 6420 7661 6c69 6461 7465  ate and validate
+0000c5d0: 2063 7572 7265 6e74 2068 6561 6465 7220   current header 
+0000c5e0: 6669 656c 6473 2061 6e64 2069 7465 6d20  fields and item 
+0000c5f0: 6669 656c 6473 2066 726f 6d20 696e 7465  fields from inte
+0000c600: 726d 6564 6961 7465 2066 696c 6573 2e20  rmediate files. 
+0000c610: 4f76 6572 7772 6974 6573 2065 7869 7374  Overwrites exist
+0000c620: 696e 6720 6669 656c 6473 2e20 2222 220a  ing fields. """.
+0000c630: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+0000c640: 6120 3d20 7365 6c66 2e5f 6765 745f 6974  a = self._get_it
+0000c650: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
+0000c660: 6572 6d65 6469 6174 655f 6669 6c65 7328  ermediate_files(
+0000c670: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000c680: 2073 656c 662e 6372 6561 7465 6946 444f   self.createiFDO
+0000c690: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+0000c6a0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000c6b0: 6572 4b65 795d 2c20 6974 656d 5f64 6174  erKey], item_dat
+0000c6c0: 612e 7661 6c75 6573 2829 2c20 616c 6c6f  a.values(), allo
+0000c6d0: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+0000c6e0: 6564 3d61 6c6c 6f77 5f6d 6973 7369 6e67  ed=allow_missing
+0000c6f0: 5f72 6571 7569 7265 6429 0a0a 0a20 2020  _required)...   
+0000c700: 2064 6566 2075 7064 6174 655f 6669 656c   def update_fiel
+0000c710: 6473 2873 656c 662c 2068 6561 6465 725f  ds(self, header_
+0000c720: 6f6e 6c79 3a62 6f6f 6c3d 4e6f 6e65 293a  only:bool=None):
+0000c730: 0a20 2020 2020 2020 2022 2222 2055 7064  .        """ Upd
+0000c740: 6174 6520 616e 6420 7661 6c69 6461 7465  ate and validate
+0000c750: 2063 7572 7265 6e74 2068 6561 6465 7220   current header 
+0000c760: 6669 656c 6473 2061 6e64 2069 7465 6d20  fields and item 
+0000c770: 6669 656c 6473 2066 726f 6d20 696e 7465  fields from inte
+0000c780: 726d 6564 6961 7465 2066 696c 6573 2e20  rmediate files. 
+0000c790: 2222 220a 2020 2020 2020 2020 6966 2068  """.        if h
+0000c7a0: 6561 6465 725f 6f6e 6c79 2069 7320 4e6f  eader_only is No
+0000c7b0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000c7c0: 6865 6164 6572 5f6f 6e6c 7920 3d20 7365  header_only = se
+0000c7d0: 6c66 2e69 676e 6f72 655f 696d 6167 655f  lf.ignore_image_
+0000c7e0: 6669 6c65 730a 2020 2020 2020 2020 6966  files.        if
+0000c7f0: 206e 6f74 2068 6561 6465 725f 6f6e 6c79   not header_only
+0000c800: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
+0000c810: 656d 5f64 6174 6120 3d20 7365 6c66 2e5f  em_data = self._
+0000c820: 6765 745f 6974 656d 5f64 6174 615f 6672  get_item_data_fr
+0000c830: 6f6d 5f69 6e74 6572 6d65 6469 6174 655f  om_intermediate_
+0000c840: 6669 6c65 7328 290a 2020 2020 2020 2020  files().        
+0000c850: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000c860: 7570 6461 7465 6946 444f 2873 656c 662e  updateiFDO(self.
+0000c870: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000c880: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000c890: 2c20 6974 656d 5f64 6174 612e 7661 6c75  , item_data.valu
+0000c8a0: 6573 2829 290a 2020 2020 2020 2020 656c  es()).        el
+0000c8b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000c8c0: 7265 7475 726e 2073 656c 662e 7570 6461  return self.upda
+0000c8d0: 7465 6946 444f 2873 656c 662e 6966 646f  teiFDO(self.ifdo
+0000c8e0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000c8f0: 6574 4865 6164 6572 4b65 795d 2c20 5b5d  etHeaderKey], []
+0000c900: 2c20 6865 6164 6572 5f6f 6e6c 793d 5472  , header_only=Tr
+0000c910: 7565 290a 0a0a 2020 2020 6465 6620 6372  ue)...    def cr
+0000c920: 6561 7465 436f 7265 4669 656c 6473 2873  eateCoreFields(s
+0000c930: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+0000c940: 2220 4445 5052 4543 4144 4554 2c20 7573  " DEPRECADET, us
+0000c950: 6520 6372 6561 7465 5f66 6965 6c64 7328  e create_fields(
+0000c960: 2920 6f72 2075 7064 6174 655f 6669 656c  ) or update_fiel
+0000c970: 6473 2829 2069 6e73 7465 642e 0a20 2020  ds() insted..   
+0000c980: 2020 2020 2046 696c 6c73 2074 6865 2069       Fills the i
+0000c990: 4644 4f20 636f 7265 2066 6965 6c64 7320  FDO core fields 
+0000c9a0: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
+0000c9b0: 6520 6669 6c65 732e 2057 6974 686f 7574  e files. Without
+0000c9c0: 2074 6865 6d20 6e6f 2076 616c 6964 2069   them no valid i
+0000c9d0: 4644 4f20 6361 6e20 6265 2063 7265 6174  FDO can be creat
+0000c9e0: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
+0000c9f0: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
+0000ca00: 6120 3d20 7365 6c66 2e5f 6765 745f 6974  a = self._get_it
+0000ca10: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
+0000ca20: 6572 6d65 6469 6174 655f 6669 6c65 735f  ermediate_files_
+0000ca30: 636f 7265 2829 0a20 2020 2020 2020 2023  core().        #
+0000ca40: 2063 6865 636b 2066 6965 6c64 7320 666f   check fields fo
+0000ca50: 7220 7661 6c69 6469 7479 0a20 2020 2020  r validity.     
+0000ca60: 2020 2023 2069 7465 6d5f 6461 7461 2063     # item_data c
+0000ca70: 6f6e 7461 696e 7320 6669 656c 6420 696d  ontains field im
+0000ca80: 6167 652d 6669 6c65 6e61 6d65 2c20 7768  age-filename, wh
+0000ca90: 6963 6820 7768 6963 6820 7769 6c6c 206e  ich which will n
+0000caa0: 6f74 2062 6520 7374 6f72 6564 2061 7320  ot be stored as 
+0000cab0: 616e 2069 7465 6d20 6669 656c 6420 696e  an item field in
+0000cac0: 2069 464f 4420 6275 7420 6173 2074 6865   iFOD but as the
+0000cad0: 2069 7465 6d20 6e61 6d65 2069 7473 656c   item name itsel
+0000cae0: 660a 2020 2020 2020 2020 7265 7475 726e  f.        return
+0000caf0: 2073 656c 662e 7570 6461 7465 6946 444f   self.updateiFDO
+0000cb00: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+0000cb10: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000cb20: 6572 4b65 795d 2c20 6974 656d 5f64 6174  erKey], item_dat
+0000cb30: 612e 7661 6c75 6573 2829 290a 0a0a 2020  a.values())...  
+0000cb40: 2020 6465 6620 6372 6561 7465 4361 7074    def createCapt
+0000cb50: 7572 6541 6e64 436f 6e74 656e 7446 6965  ureAndContentFie
+0000cb60: 6c64 7328 7365 6c66 293a 0a20 2020 2020  lds(self):.     
+0000cb70: 2020 2022 2222 2044 4550 5245 4341 4445     """ DEPRECADE
+0000cb80: 542c 2075 7365 2063 7265 6174 655f 6669  T, use create_fi
+0000cb90: 656c 6473 2829 206f 7220 7570 6461 7465  elds() or update
+0000cba0: 5f66 6965 6c64 7328 2920 696e 7374 6564  _fields() insted
+0000cbb0: 2e0a 2020 2020 2020 2020 4669 6c6c 7320  ..        Fills 
+0000cbc0: 7468 6520 6946 444f 2063 6170 7574 7265  the iFDO caputre
+0000cbd0: 2061 6e64 2063 6f6e 7465 6e74 2066 6965   and content fie
+0000cbe0: 6473 2066 726f 6d20 7072 6f76 6964 6564  ds from provided
+0000cbf0: 2064 6174 6120 6669 656c 6473 200a 2020   data fields .  
+0000cc00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000cc10: 2020 6974 656d 5f64 6174 6120 3d20 7365    item_data = se
+0000cc20: 6c66 2e5f 6765 745f 6974 656d 5f64 6174  lf._get_item_dat
+0000cc30: 615f 6672 6f6d 5f69 6e74 6572 6d65 6469  a_from_intermedi
+0000cc40: 6174 655f 6669 6c65 735f 6e6f 6e65 5f63  ate_files_none_c
+0000cc50: 6f72 6528 290a 2020 2020 2020 2020 2320  ore().        # 
+0000cc60: 6368 6563 6b20 6669 656c 6473 2066 6f72  check fields for
+0000cc70: 2076 616c 6964 6974 790a 2020 2020 2020   validity.      
+0000cc80: 2020 2320 6974 656d 5f64 6174 6120 636f    # item_data co
+0000cc90: 6e74 6169 6e73 2066 6965 6c64 2069 6d61  ntains field ima
+0000cca0: 6765 2d66 696c 656e 616d 652c 2077 6869  ge-filename, whi
+0000ccb0: 6368 2077 6869 6368 2077 696c 6c20 6e6f  ch which will no
+0000ccc0: 7420 6265 2073 746f 7265 6420 6173 2061  t be stored as a
+0000ccd0: 6e20 6974 656d 2066 6965 6c64 2069 6e20  n item field in 
+0000cce0: 6946 4f44 2062 7574 2061 7320 7468 6520  iFOD but as the 
+0000ccf0: 6974 656d 206e 616d 6520 6974 7365 6c66  item name itself
+0000cd00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000cd10: 7365 6c66 2e75 7064 6174 6569 4644 4f28  self.updateiFDO(
+0000cd20: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000cd30: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000cd40: 724b 6579 5d2c 2069 7465 6d5f 6461 7461  rKey], item_data
+0000cd50: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
+0000cd60: 0a20 2020 2064 6566 205f 6765 745f 6974  .    def _get_it
+0000cd70: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
+0000cd80: 6572 6d65 6469 6174 655f 6669 6c65 7328  ermediate_files(
+0000cd90: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+0000cda0: 2222 2052 6561 6420 6461 7461 2066 726f  "" Read data fro
+0000cdb0: 6d20 636f 7265 2061 6e64 206e 6f6e 652d  m core and none-
+0000cdc0: 636f 7265 2069 6e74 6572 6d64 6561 7465  core intermdeate
+0000cdd0: 2066 696c 6573 2c20 6368 6563 6b20 6669   files, check fi
+0000cde0: 6c65 7320 6578 6973 742c 2061 6464 2027  les exist, add '
+0000cdf0: 696d 6167 652d 6861 6e64 6c65 272e 0a20  image-handle'.. 
+0000ce00: 2020 2020 2020 2052 6574 7572 6e73 2064         Returns d
+0000ce10: 6963 7420 6f66 2066 6f72 6d20 7b69 6d61  ict of form {ima
+0000ce20: 6765 2d66 696c 652d 6e61 6d65 3a7b 6669  ge-file-name:{fi
+0000ce30: 656c 643a 7661 6c75 657d 2c2e 2e2e 7d20  eld:value},...} 
+0000ce40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ce50: 2020 2020 2069 7465 6d5f 6461 7461 5f63       item_data_c
+0000ce60: 6f72 6520 3d20 7365 6c66 2e5f 6765 745f  ore = self._get_
+0000ce70: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
+0000ce80: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+0000ce90: 735f 636f 7265 2829 0a20 2020 2020 2020  s_core().       
+0000cea0: 2069 7465 6d5f 6461 7461 5f6e 6f6e 655f   item_data_none_
+0000ceb0: 636f 7265 203d 2073 656c 662e 5f67 6574  core = self._get
+0000cec0: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
+0000ced0: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
+0000cee0: 6573 5f6e 6f6e 655f 636f 7265 2829 0a20  es_none_core(). 
+0000cef0: 2020 2020 2020 2023 7070 7269 6e74 2869         #pprint(i
+0000cf00: 7465 6d5f 6461 7461 5f6e 6f6e 655f 636f  tem_data_none_co
+0000cf10: 7265 290a 2020 2020 2020 2020 2370 7072  re).        #ppr
+0000cf20: 696e 7428 6974 656d 5f64 6174 615f 636f  int(item_data_co
+0000cf30: 7265 290a 2020 2020 2020 2020 6974 656d  re).        item
+0000cf40: 5f64 6174 6120 3d20 6974 656d 5f64 6174  _data = item_dat
+0000cf50: 615f 636f 7265 0a20 2020 2020 2020 206c  a_core.        l
+0000cf60: 6f67 203d 206d 6971 7463 2e72 6563 7572  og = miqtc.recur
+0000cf70: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
+0000cf80: 7328 6974 656d 5f64 6174 612c 2069 7465  s(item_data, ite
+0000cf90: 6d5f 6461 7461 5f6e 6f6e 655f 636f 7265  m_data_none_core
+0000cfa0: 290a 2020 2020 2020 2020 2370 7072 696e  ).        #pprin
+0000cfb0: 7428 6974 656d 5f64 6174 6129 0a20 2020  t(item_data).   
+0000cfc0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000cfd0: 6f67 286c 6f67 2c64 6f6e 7453 686f 773d  og(log,dontShow=
+0000cfe0: 5472 7565 290a 2020 2020 2020 2020 7265  True).        re
+0000cff0: 7475 726e 2069 7465 6d5f 6461 7461 0a0a  turn item_data..
+0000d000: 2020 2020 6465 6620 5f67 6574 5f69 7465      def _get_ite
+0000d010: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000d020: 726d 6564 6961 7465 5f66 696c 6573 5f6e  rmediate_files_n
+0000d030: 6f6e 655f 636f 7265 2873 656c 6629 3a0a  one_core(self):.
+0000d040: 2020 2020 2020 2020 2222 2220 5265 6164          """ Read
+0000d050: 2064 6174 6120 6672 6f6d 206e 6f6e 2d63   data from non-c
+0000d060: 6f72 6520 696e 7465 726d 6465 6174 6520  ore intermdeate 
+0000d070: 6669 6c65 732e 0a20 2020 2020 2020 2052  files..        R
+0000d080: 6574 7572 6e73 2064 6963 7420 6f66 2066  eturns dict of f
+0000d090: 6f72 6d20 7b69 6d61 6765 2d66 696c 652d  orm {image-file-
+0000d0a0: 6e61 6d65 3a7b 6669 656c 643a 7661 6c75  name:{field:valu
+0000d0b0: 657d 2c2e 2e2e 7d20 0a20 2020 2020 2020  e},...} .       
+0000d0c0: 2022 2222 0a20 2020 2020 2020 2072 6571   """.        req
+0000d0d0: 203d 2073 656c 662e 6e6f 6e43 6f72 6546   = self.nonCoreF
+0000d0e0: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
+0000d0f0: 4974 656d 496e 666f 4669 6c65 730a 0a20  ItemInfoFiles.. 
+0000d100: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
+0000d110: 203d 207b 7d0a 2020 2020 2020 2020 7072   = {}.        pr
+0000d120: 6f67 203d 206d 6971 7463 2e50 7269 6e74  og = miqtc.Print
+0000d130: 4b6e 6f77 6e50 726f 6772 6573 734d 7367  KnownProgressMsg
+0000d140: 2822 5061 7273 696e 6720 696e 7465 726d  ("Parsing interm
+0000d150: 6564 6961 7465 2061 6464 6974 696f 6e61  ediate additiona
+0000d160: 6c20 6461 7461 222c 206c 656e 2872 6571  l data", len(req
+0000d170: 2929 0a20 2020 2020 2020 2066 6f72 2072  )).        for r
+0000d180: 2069 6e20 7265 713a 0a20 2020 2020 2020   in req:.       
+0000d190: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
+0000d1a0: 7373 2829 0a20 2020 2020 2020 2020 2020  ss().           
+0000d1b0: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
+0000d1c0: 7473 2872 2e66 696c 654e 616d 6529 3a0a  ts(r.fileName):.
+0000d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d1e0: 7365 6c66 2e70 7261 7365 4974 656d 4461  self.praseItemDa
+0000d1f0: 7461 4672 6f6d 4669 6c65 2869 7465 6d5f  taFromFile(item_
+0000d200: 6461 7461 2c72 2e66 696c 654e 616d 652c  data,r.fileName,
+0000d210: 722e 7365 7061 7261 746f 722c 722e 6865  r.separator,r.he
+0000d220: 6164 6572 2c20 722e 6461 7465 7469 6d65  ader, r.datetime
+0000d230: 5f66 6f72 6d61 7429 0a20 2020 2020 2020  _format).       
+0000d240: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000d250: 6f76 2e6c 6f67 2822 5061 7273 6564 2069  ov.log("Parsed i
+0000d260: 7465 6d20 6461 7461 2066 726f 6d3a 2022  tem data from: "
+0000d270: 202b 2072 2e66 696c 654e 616d 6529 0a20   + r.fileName). 
+0000d280: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000d290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d2a0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000d2b0: 4669 6c65 2064 6f65 7320 6e6f 7420 6578  File does not ex
+0000d2c0: 6973 7473 3a20 2220 2b20 722e 6669 6c65  ists: " + r.file
+0000d2d0: 4e61 6d65 290a 2020 2020 2020 2020 7072  Name).        pr
+0000d2e0: 6f67 2e63 6c65 6172 2829 0a0a 2020 2020  og.clear()..    
+0000d2f0: 2020 2020 2320 6368 6563 6b20 6669 6c65      # check file
+0000d300: 7320 6578 6973 740a 2020 2020 2020 2020  s exist.        
+0000d310: 7265 6d6f 7665 203d 205b 5d0a 2020 2020  remove = [].    
+0000d320: 2020 2020 666f 7220 696d 6720 696e 2069      for img in i
+0000d330: 7465 6d5f 6461 7461 3a0a 2020 2020 2020  tem_data:.      
+0000d340: 2020 2020 2020 6966 206e 6f74 2069 6d67        if not img
+0000d350: 2069 6e20 7365 6c66 2e5f 696d 6167 654e   in self._imageN
+0000d360: 616d 6573 496d 6167 6573 4469 723a 0a20  amesImagesDir:. 
+0000d370: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d380: 656d 6f76 652e 6170 7065 6e64 2869 6d67  emove.append(img
+0000d390: 290a 2020 2020 2020 2020 666f 7220 696d  ).        for im
+0000d3a0: 6720 696e 2072 656d 6f76 653a 0a20 2020  g in remove:.   
+0000d3b0: 2020 2020 2020 2020 2064 656c 2069 7465           del ite
+0000d3c0: 6d5f 6461 7461 5b69 6d67 5d0a 0a20 2020  m_data[img]..   
+0000d3d0: 2020 2020 2072 6574 7572 6e20 6974 656d       return item
+0000d3e0: 5f64 6174 610a 0a0a 2020 2020 6465 6620  _data...    def 
+0000d3f0: 5f67 6574 5f69 7465 6d5f 6461 7461 5f66  _get_item_data_f
+0000d400: 726f 6d5f 696e 7465 726d 6564 6961 7465  rom_intermediate
+0000d410: 5f66 696c 6573 5f63 6f72 6528 7365 6c66  _files_core(self
+0000d420: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
+0000d430: 6561 6420 6461 7461 2066 726f 6d20 636f  ead data from co
+0000d440: 7265 2069 6e74 6572 6d64 6561 7465 2066  re intermdeate f
+0000d450: 696c 6573 2c20 6368 6563 6b20 6669 6c65  iles, check file
+0000d460: 7320 6578 6973 742c 2061 6464 2027 696d  s exist, add 'im
+0000d470: 6167 652d 6861 6e64 6c65 272e 0a20 2020  age-handle'..   
+0000d480: 2020 2020 2052 6574 7572 6e73 2064 6963       Returns dic
+0000d490: 7420 6f66 2066 6f72 6d20 7b69 6d61 6765  t of form {image
+0000d4a0: 2d66 696c 652d 6e61 6d65 3a7b 6669 656c  -file-name:{fiel
+0000d4b0: 643a 7661 6c75 657d 2c2e 2e2e 7d20 0a20  d:value},...} . 
+0000d4c0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000d4d0: 2020 2020 2320 5768 6963 6820 6669 6c65      # Which file
+0000d4e0: 7320 636f 6e74 6169 6e20 7468 6520 696e  s contain the in
+0000d4f0: 666f 726d 6174 696f 6e20 6e65 6564 6564  formation needed
+0000d500: 2074 6f20 6372 6561 7465 2074 6865 2069   to create the i
+0000d510: 4644 4f20 6974 656d 7320 636f 7265 2069  FDO items core i
+0000d520: 6e66 6f72 6d61 7469 6f6e 2061 6e64 2077  nformation and w
+0000d530: 6869 6368 2063 6f6c 756d 6e73 2073 6861  hich columns sha
+0000d540: 6c6c 2062 6520 7573 6564 0a20 2020 2020  ll be used.     
+0000d550: 2020 2072 6571 203d 2073 656c 662e 696e     req = self.in
+0000d560: 7465 726d 6564 6961 7465 4669 6c65 7344  termediateFilesD
+0000d570: 6566 5f63 6f72 650a 0a20 2020 2020 2020  ef_core..       
+0000d580: 2069 7465 6d5f 6461 7461 203d 207b 7d0a   item_data = {}.
+0000d590: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
+0000d5a0: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
+0000d5b0: 726f 6772 6573 734d 7367 2822 5061 7273  rogressMsg("Pars
+0000d5c0: 696e 6720 696e 7465 726d 6564 6961 7465  ing intermediate
+0000d5d0: 2063 6f72 6520 6461 7461 222c 206c 656e   core data", len
+0000d5e0: 2872 6571 2929 0a20 2020 2020 2020 2066  (req)).        f
+0000d5f0: 6f72 2072 2069 6e20 7265 713a 0a20 2020  or r in req:.   
+0000d600: 2020 2020 2020 2020 2070 726f 672e 7072           prog.pr
+0000d610: 6f67 7265 7373 2829 0a20 2020 2020 2020  ogress().       
+0000d620: 2020 2020 2066 696c 6520 3d20 7365 6c66       file = self
+0000d630: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0000d640: 7072 6566 6978 2829 202b 2072 6571 5b72  prefix() + req[r
+0000d650: 5d5b 2773 7566 6669 7827 5d0a 2020 2020  ]['suffix'].    
+0000d660: 2020 2020 2020 2020 6966 206e 6f74 206f          if not o
+0000d670: 732e 7061 7468 2e65 7869 7374 7328 6669  s.path.exists(fi
+0000d680: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
+0000d690: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000d6a0: 6f67 2822 5741 524e 494e 4721 2046 6f72  og("WARNING! For
+0000d6b0: 2061 6368 6965 7669 6e67 2046 4149 526e   achieving FAIRn
+0000d6c0: 6573 7320 616e 2069 6e74 6572 6d65 6469  ess an intermedi
+0000d6d0: 6174 6520 696d 6167 6520 696e 666f 2066  ate image info f
+0000d6e0: 696c 6520 6973 206d 6973 7369 6e67 3a20  ile is missing: 
+0000d6f0: 222b 2073 656c 662e 5f5f 6765 745f 696e  "+ self.__get_in
+0000d700: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
+0000d710: 2b20 7265 715b 725d 5b27 7375 6666 6978  + req[r]['suffix
+0000d720: 275d 2b20 2220 7275 6e20 6669 7273 743a  ']+ " run first:
+0000d730: 2022 202b 2072 6571 5b72 5d5b 2763 7265   " + req[r]['cre
+0000d740: 6174 696f 6e46 6374 275d 290a 2020 2020  ationFct']).    
+0000d750: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000d760: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000d770: 6c66 2e70 6172 7365 4974 656d 4461 7461  lf.parseItemData
+0000d780: 6672 6f6d 5461 6246 696c 6544 6174 6128  fromTabFileData(
+0000d790: 6974 656d 5f64 6174 612c 2066 696c 652c  item_data, file,
+0000d7a0: 2072 6571 5b72 5d5b 2763 6f6c 7327 5d2c   req[r]['cols'],
+0000d7b0: 2072 6571 5b72 5d5b 276f 7074 696f 6e61   req[r]['optiona
+0000d7c0: 6c27 5d29 0a20 2020 2020 2020 2020 2020  l']).           
+0000d7d0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000d7e0: 6f67 2822 5061 7273 6564 2069 7465 6d20  og("Parsed item 
+0000d7f0: 6461 7461 2066 726f 6d3a 2022 202b 2066  data from: " + f
+0000d800: 696c 6529 0a0a 2020 2020 2020 2020 7072  ile)..        pr
+0000d810: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
+0000d820: 2020 2069 6620 6c65 6e28 6974 656d 5f64     if len(item_d
+0000d830: 6174 6129 203d 3d20 303a 0a20 2020 2020  ata) == 0:.     
+0000d840: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000d850: 6570 7469 6f6e 2822 4e6f 2069 4644 4f20  eption("No iFDO 
+0000d860: 6974 656d 7322 290a 0a20 2020 2020 2020  items")..       
+0000d870: 2023 2063 6865 636b 2066 696c 6573 2065   # check files e
+0000d880: 7869 7374 0a20 2020 2020 2020 2072 656d  xist.        rem
+0000d890: 6f76 6520 3d20 5b5d 0a20 2020 2020 2020  ove = [].       
+0000d8a0: 2066 6f72 2069 6d67 2069 6e20 6974 656d   for img in item
+0000d8b0: 5f64 6174 613a 0a20 2020 2020 2020 2020  _data:.         
+0000d8c0: 2020 2069 6620 6e6f 7420 696d 6720 696e     if not img in
+0000d8d0: 2073 656c 662e 5f69 6d61 6765 4e61 6d65   self._imageName
+0000d8e0: 7349 6d61 6765 7344 6972 3a0a 2020 2020  sImagesDir:.    
+0000d8f0: 2020 2020 2020 2020 2020 2020 7265 6d6f              remo
+0000d900: 7665 2e61 7070 656e 6428 696d 6729 0a20  ve.append(img). 
+0000d910: 2020 2020 2020 2066 6f72 2069 6d67 2069         for img i
+0000d920: 6e20 7265 6d6f 7665 3a0a 2020 2020 2020  n remove:.      
+0000d930: 2020 2020 2020 6465 6c20 6974 656d 5f64        del item_d
+0000d940: 6174 615b 696d 675d 0a0a 2020 2020 2020  ata[img]..      
+0000d950: 2020 2320 6164 6420 696d 6167 652d 7572    # add image-ur
+0000d960: 6c0a 2020 2020 2020 2020 666f 7220 696d  l.        for im
+0000d970: 6720 696e 2069 7465 6d5f 6461 7461 3a0a  g in item_data:.
+0000d980: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0000d990: 7369 6e73 7461 6e63 6528 6974 656d 5f64  sinstance(item_d
+0000d9a0: 6174 615b 696d 675d 2c6c 6973 7429 3a20  ata[img],list): 
+0000d9b0: 2320 6974 656d 2069 7320 616c 7265 6164  # item is alread
+0000d9c0: 7920 6120 6c69 7374 2028 7669 6465 6f29  y a list (video)
+0000d9d0: 2062 7574 2070 6172 7365 6420 6461 7461   but parsed data
+0000d9e0: 2069 7320 6e6f 742c 2069 2e65 2e20 7061   is not, i.e. pa
+0000d9f0: 7273 6564 2064 6174 6120 7265 6665 7273  rsed data refers
+0000da00: 2074 6f20 7768 6f6c 6520 7669 6465 6f20   to whole video 
+0000da10: 2874 696d 6520 696e 6465 7065 6e64 656e  (time independen
+0000da20: 7429 2c20 692e 652e 2077 7269 7465 2074  t), i.e. write t
+0000da30: 6f20 6669 7273 7420 656e 7472 790a 2020  o first entry.  
+0000da40: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+0000da50: 6964 203d 2066 696e 6446 6965 6c64 2869  id = findField(i
+0000da60: 7465 6d5f 6461 7461 5b69 6d67 5d5b 305d  tem_data[img][0]
+0000da70: 2c27 696d 6167 652d 7575 6964 2729 0a20  ,'image-uuid'). 
+0000da80: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000da90: 6620 7575 6964 203d 3d20 2222 3a0a 2020  f uuid == "":.  
+0000daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dab0: 2020 7070 7269 6e74 2869 7465 6d5f 6461    pprint(item_da
+0000dac0: 7461 5b69 6d67 5d5b 305d 290a 2020 2020  ta[img][0]).    
+0000dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dae0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+0000daf0: 4578 6365 7074 696f 6e28 2275 7569 6420  Exception("uuid 
+0000db00: 6e6f 7420 666f 756e 6420 2861 2922 290a  not found (a)").
+0000db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000db20: 6974 656d 5f64 6174 615b 696d 675d 5b30  item_data[img][0
+0000db30: 5d5b 2769 6d61 6765 2d68 616e 646c 6527  ]['image-handle'
+0000db40: 5d20 3d20 7365 6c66 2e69 6d61 6765 5f68  ] = self.image_h
+0000db50: 616e 646c 655f 7072 6566 6978 202b 2027  andle_prefix + '
+0000db60: 4027 202b 2075 7569 640a 2020 2020 2020  @' + uuid.      
+0000db70: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000db80: 2020 2020 2020 2020 2020 2020 7575 6964              uuid
+0000db90: 203d 2066 696e 6446 6965 6c64 2869 7465   = findField(ite
+0000dba0: 6d5f 6461 7461 5b69 6d67 5d2c 2769 6d61  m_data[img],'ima
+0000dbb0: 6765 2d75 7569 6427 290a 2020 2020 2020  ge-uuid').      
+0000dbc0: 2020 2020 2020 2020 2020 6966 2075 7569            if uui
+0000dbd0: 6420 3d3d 2022 223a 0a20 2020 2020 2020  d == "":.       
+0000dbe0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000dbf0: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0000dc00: 6570 7469 6f6e 2822 7575 6964 206e 6f74  eption("uuid not
+0000dc10: 2066 6f75 6e64 2028 6229 2229 0a20 2020   found (b)").   
+0000dc20: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0000dc30: 6d5f 6461 7461 5b69 6d67 5d5b 2769 6d61  m_data[img]['ima
+0000dc40: 6765 2d68 616e 646c 6527 5d20 3d20 7365  ge-handle'] = se
+0000dc50: 6c66 2e69 6d61 6765 5f68 616e 646c 655f  lf.image_handle_
+0000dc60: 7072 6566 6978 202b 2027 4027 202b 2075  prefix + '@' + u
+0000dc70: 7569 640a 0a20 2020 2020 2020 2072 6574  uid..        ret
+0000dc80: 7572 6e20 6974 656d 5f64 6174 610a 0a0a  urn item_data...
+0000dc90: 2020 2020 6465 6620 6164 645f 6974 656d      def add_item
+0000dca0: 5f69 6e66 6f5f 7461 625f 6669 6c65 2873  _info_tab_file(s
+0000dcb0: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
+0000dcc0: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
+0000dcd0: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
+0000dce0: 6461 7465 7469 6d65 5f66 6f72 6d61 7420  datetime_format 
+0000dcf0: 3d20 6d69 7174 762e 6461 7465 5f66 6f72  = miqtv.date_for
+0000dd00: 6d61 7473 5b27 6d61 7269 7174 275d 293a  mats['mariqt']):
+0000dd10: 0a20 2020 2020 2020 2022 2222 2041 6464  .        """ Add
+0000dd20: 2061 2063 6f6c 756d 6e20 7365 7065 7261   a column sepera
+0000dd30: 7465 6420 7465 7874 2066 696c 6520 746f  ted text file to
+0000dd40: 2070 6172 7365 2069 7465 6d20 6461 7461   parse item data
+0000dd50: 2066 726f 6d20 6279 2063 7265 6174 6543   from by createC
+0000dd60: 6170 7475 7265 416e 6443 6f6e 7465 6e74  aptureAndContent
+0000dd70: 4669 656c 6473 2829 2e20 0a20 2020 2020  Fields(). .     
+0000dd80: 2020 2043 6f6c 756d 6e73 2068 6561 6465     Columns heade
+0000dd90: 7273 2077 696c 6c20 6265 2073 6574 2061  rs will be set a
+0000dda0: 7320 6974 656d 2066 6965 6c64 206e 616d  s item field nam
+0000ddb0: 6573 2e20 4d75 7374 2063 6f6e 7461 696e  es. Must contain
+0000ddc0: 2063 6f6c 756d 6e20 2769 6d61 6765 2d66   column 'image-f
+0000ddd0: 696c 656e 616d 6527 2e0a 2020 2020 2020  ilename'..      
+0000dde0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000ddf0: 2066 696c 654e 616d 6520 3d3d 204e 6f6e   fileName == Non
+0000de00: 6520 6f72 206e 6f74 206f 732e 7061 7468  e or not os.path
+0000de10: 2e65 7869 7374 7328 6669 6c65 4e61 6d65  .exists(fileName
+0000de20: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000de30: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+0000de40: 4669 6c65 222c 6669 6c65 4e61 6d65 2c22  File",fileName,"
+0000de50: 6e6f 7420 666f 756e 6422 290a 0a20 2020  not found")..   
+0000de60: 2020 2020 2066 6f72 2066 6965 6c64 2069       for field i
+0000de70: 6e20 6865 6164 6572 3a0a 2020 2020 2020  n header:.      
+0000de80: 2020 2020 2020 6966 2068 6561 6465 725b        if header[
+0000de90: 6669 656c 645d 206e 6f74 2069 6e20 6d69  field] not in mi
+0000dea0: 7174 662e 7461 6246 696c 6543 6f6c 756d  qtf.tabFileColum
+0000deb0: 6e4e 616d 6573 2866 696c 654e 616d 652c  nNames(fileName,
+0000dec0: 636f 6c5f 7365 7061 7261 746f 723d 7365  col_separator=se
+0000ded0: 7061 7261 746f 7229 3a0a 2020 2020 2020  parator):.      
+0000dee0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000def0: 4578 6365 7074 696f 6e28 2243 6f6c 756d  Exception("Colum
+0000df00: 6e22 2c20 6865 6164 6572 5b66 6965 6c64  n", header[field
+0000df10: 5d2c 2022 6e6f 7420 696e 2066 696c 6522  ], "not in file"
+0000df20: 2c20 6669 6c65 4e61 6d65 290a 0a20 2020  , fileName)..   
+0000df30: 2020 2020 2069 6620 6d69 7174 632e 6173       if miqtc.as
+0000df40: 7365 7274 536c 6173 6828 6f73 2e70 6174  sertSlash(os.pat
+0000df50: 682e 6469 726e 616d 6528 6669 6c65 4e61  h.dirname(fileNa
+0000df60: 6d65 2929 2021 3d20 6d69 7174 632e 6173  me)) != miqtc.as
+0000df70: 7365 7274 536c 6173 6828 7365 6c66 2e64  sertSlash(self.d
+0000df80: 6972 2e74 6f28 7365 6c66 2e64 6972 2e64  ir.to(self.dir.d
+0000df90: 742e 696e 7465 726d 6564 6961 7465 2929  t.intermediate))
+0000dfa0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000dfb0: 6c66 2e70 726f 762e 6c6f 6728 2022 4361  lf.prov.log( "Ca
+0000dfc0: 7574 696f 6e21 2049 7420 6973 2072 6563  ution! It is rec
+0000dfd0: 6f6d 6d65 6e64 6564 2074 6f20 7075 7420  ommended to put 
+0000dfe0: 6669 6c65 2069 6e20 7468 6520 6469 7265  file in the dire
+0000dff0: 6374 6f72 7927 7320 2769 6e74 6572 6d65  ctory's 'interme
+0000e000: 6469 6174 6527 2066 6f6c 6465 723a 2022  diate' folder: "
+0000e010: 202b 2066 696c 654e 616d 6529 0a20 2020   + fileName).   
+0000e020: 2020 2020 206e 6366 6969 6620 3d20 6e6f       ncfiif = no
+0000e030: 6e43 6f72 6546 6965 6c64 496e 7465 726d  nCoreFieldInterm
+0000e040: 6564 6961 7465 4974 656d 496e 666f 4669  ediateItemInfoFi
+0000e050: 6c65 2866 696c 654e 616d 652c 2073 6570  le(fileName, sep
+0000e060: 6172 6174 6f72 2c20 6865 6164 6572 2c20  arator, header, 
+0000e070: 6461 7465 7469 6d65 5f66 6f72 6d61 7429  datetime_format)
+0000e080: 0a20 2020 2020 2020 2069 6620 6e63 6669  .        if ncfi
+0000e090: 6966 206e 6f74 2069 6e20 7365 6c66 2e6e  if not in self.n
+0000e0a0: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
+0000e0b0: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
+0000e0c0: 696c 6573 3a20 0a20 2020 2020 2020 2020  iles: .         
+0000e0d0: 2020 2073 656c 662e 6e6f 6e43 6f72 6546     self.nonCoreF
+0000e0e0: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
+0000e0f0: 4974 656d 496e 666f 4669 6c65 732e 6170  ItemInfoFiles.ap
+0000e100: 7065 6e64 286e 6366 6969 6629 0a0a 2020  pend(ncfiif)..  
+0000e110: 2020 6465 6620 6164 6449 7465 6d49 6e66    def addItemInf
+0000e120: 6f54 6162 4669 6c65 2873 656c 662c 2066  oTabFile(self, f
+0000e130: 696c 654e 616d 653a 2073 7472 2c20 7365  ileName: str, se
+0000e140: 7061 7261 746f 723a 7374 722c 2068 6561  parator:str, hea
+0000e150: 6465 723a 6469 6374 2c20 6461 7465 7469  der:dict, dateti
+0000e160: 6d65 5f66 6f72 6d61 7420 3d20 6d69 7174  me_format = miqt
+0000e170: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+0000e180: 6d61 7269 7174 275d 293a 0a20 2020 2020  mariqt']):.     
+0000e190: 2020 2022 2222 2044 6570 7265 6361 7465     """ Deprecate
+0000e1a0: 6420 2d20 7573 6520 6164 645f 6974 656d  d - use add_item
+0000e1b0: 5f69 6e66 6f5f 7461 625f 6669 6c65 2022  _info_tab_file "
+0000e1c0: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+0000e1d0: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
+0000e1e0: 625f 6669 6c65 2866 696c 654e 616d 652c  b_file(fileName,
+0000e1f0: 7365 7061 7261 746f 722c 6865 6164 6572  separator,header
+0000e200: 2c64 6174 6574 696d 655f 666f 726d 6174  ,datetime_format
+0000e210: 290a 0a20 2020 2020 2020 200a 2020 2020  )..        .    
+0000e220: 6465 6620 7265 6d6f 7665 4974 656d 496e  def removeItemIn
+0000e230: 666f 5461 6246 696c 6528 7365 6c66 2c20  foTabFile(self, 
+0000e240: 6669 6c65 4e61 6d65 3a20 7374 722c 2073  fileName: str, s
+0000e250: 6570 6172 6174 6f72 3a73 7472 2c20 6865  eparator:str, he
+0000e260: 6164 6572 3a64 6963 742c 2064 6174 6574  ader:dict, datet
+0000e270: 696d 655f 666f 726d 6174 3a73 7472 293a  ime_format:str):
+0000e280: 0a20 2020 2020 2020 2022 2222 2072 656d  .        """ rem
+0000e290: 6f76 6573 2066 696c 6520 6974 656d 2066  oves file item f
+0000e2a0: 726f 6d20 6c69 7374 206f 6620 6669 6c65  rom list of file
+0000e2b0: 7320 746f 2070 6172 7365 2069 7465 6d20  s to parse item 
+0000e2c0: 6461 7461 2066 726f 6d20 6279 2063 7265  data from by cre
+0000e2d0: 6174 6543 6170 7475 7265 416e 6443 6f6e  ateCaptureAndCon
+0000e2e0: 7465 6e74 4669 656c 6473 2829 2022 2222  tentFields() """
+0000e2f0: 0a20 2020 2020 2020 206e 6366 6969 6620  .        ncfiif 
+0000e300: 3d20 6e6f 6e43 6f72 6546 6965 6c64 496e  = nonCoreFieldIn
+0000e310: 7465 726d 6564 6961 7465 4974 656d 496e  termediateItemIn
+0000e320: 666f 4669 6c65 2866 696c 654e 616d 652c  foFile(fileName,
+0000e330: 2073 6570 6172 6174 6f72 2c20 6865 6164   separator, head
+0000e340: 6572 2c20 6461 7465 7469 6d65 5f66 6f72  er, datetime_for
+0000e350: 6d61 7429 0a20 2020 2020 2020 2069 6620  mat).        if 
+0000e360: 6e63 6669 6966 2069 6e20 7365 6c66 2e6e  ncfiif in self.n
+0000e370: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
+0000e380: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
+0000e390: 696c 6573 3a20 0a20 2020 2020 2020 2020  iles: .         
+0000e3a0: 2020 2073 656c 662e 6e6f 6e43 6f72 6546     self.nonCoreF
+0000e3b0: 6965 6c64 496e 7465 726d 6564 6961 7465  ieldIntermediate
+0000e3c0: 4974 656d 496e 666f 4669 6c65 732e 7265  ItemInfoFiles.re
+0000e3d0: 6d6f 7665 286e 6366 6969 6629 0a0a 0a20  move(ncfiif)... 
+0000e3e0: 2020 2064 6566 2075 7064 6174 6569 4644     def updateiFD
+0000e3f0: 4f28 7365 6c66 2c20 6865 6164 6572 3a20  O(self, header: 
+0000e400: 6469 6374 2c20 6974 656d 733a 206c 6973  dict, items: lis
+0000e410: 742c 2068 6561 6465 725f 6f6e 6c79 3d46  t, header_only=F
+0000e420: 616c 7365 293a 0a20 2020 2020 2020 2022  alse):.        "
+0000e430: 2222 2055 7064 6174 6573 2074 6865 2063  "" Updates the c
+0000e440: 7572 7265 6e74 2076 616c 7565 7320 6946  urrent values iF
+0000e450: 444f 2077 6974 6820 7468 6520 7072 6f76  DO with the prov
+0000e460: 6964 6564 206e 6577 2076 616c 7565 7320  ided new values 
+0000e470: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000e480: 726e 2073 656c 662e 6372 6561 7465 6946  rn self.createiF
+0000e490: 444f 2868 6561 6465 722c 2069 7465 6d73  DO(header, items
+0000e4a0: 2c20 7570 6461 7465 4578 6973 7469 6e67  , updateExisting
+0000e4b0: 3d54 7275 652c 2068 6561 6465 724f 6e6c  =True, headerOnl
+0000e4c0: 793d 6865 6164 6572 5f6f 6e6c 7929 0a0a  y=header_only)..
+0000e4d0: 0a20 2020 2064 6566 2063 7265 6174 6569  .    def createi
+0000e4e0: 4644 4f28 7365 6c66 2c20 6865 6164 6572  FDO(self, header
+0000e4f0: 3a20 6469 6374 2c20 6974 656d 733a 206c  : dict, items: l
+0000e500: 6973 742c 2075 7064 6174 6545 7869 7374  ist, updateExist
+0000e510: 696e 673d 4661 6c73 652c 6865 6164 6572  ing=False,header
+0000e520: 4f6e 6c79 3d46 616c 7365 2c61 6c6c 6f77  Only=False,allow
+0000e530: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
+0000e540: 643d 4661 6c73 652c 7661 6c69 6461 7465  d=False,validate
+0000e550: 5f73 696e 676c 655f 6974 656d 733d 4661  _single_items=Fa
+0000e560: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+0000e570: 2220 4372 6561 7465 7320 4641 4952 2064  " Creates FAIR d
+0000e580: 6967 6974 616c 206f 626a 6563 7420 666f  igital object fo
+0000e590: 7220 7468 6520 696d 6167 6520 6461 7461  r the image data
+0000e5a0: 2069 7473 656c 662e 2054 6869 7320 636f   itself. This co
+0000e5b0: 6e73 6973 7473 206f 6620 6865 6164 6572  nsists of header
+0000e5c0: 2069 6e66 6f72 6d61 7469 6f6e 2061 6e64   information and
+0000e5d0: 2069 7465 6d20 696e 666f 726d 6174 696f   item informatio
+0000e5e0: 6e2e 0a20 2020 2020 2020 2075 7064 6174  n..        updat
+0000e5f0: 6545 7869 7374 696e 673a 2069 6620 4661  eExisting: if Fa
+0000e600: 6c73 6520 6f6c 6420 7661 6c75 6573 2061  lse old values a
+0000e610: 7265 2072 656d 6f76 6564 2c20 6f74 6865  re removed, othe
+0000e620: 7277 6973 6520 7468 6579 2061 7265 2075  rwise they are u
+0000e630: 7064 6174 6564 2e0a 2020 2020 2020 2020  pdated..        
+0000e640: 6865 6164 6572 4f6e 6c79 3a20 6966 2054  headerOnly: if T
+0000e650: 7275 6520 6974 656d 7320 6d61 7920 6265  rue items may be
+0000e660: 2065 6d70 7479 206c 6973 742e 0a20 2020   empty list..   
+0000e670: 2020 2020 2061 6c6c 6f77 5f6d 6973 7369       allow_missi
+0000e680: 6e67 5f72 6571 7569 7265 643a 2069 6620  ng_required: if 
+0000e690: 5472 7565 2c20 6e6f 2065 7863 6570 7469  True, no excepti
+0000e6a0: 6f6e 2072 6973 656e 2069 6620 6120 7265  on risen if a re
+0000e6b0: 7175 6972 6564 2066 6965 6c64 2069 7320  quired field is 
+0000e6c0: 6d69 7373 696e 672e 2020 2222 220a 0a20  missing.  """.. 
+0000e6d0: 2020 2020 2020 2069 6620 6e6f 7420 7570         if not up
+0000e6e0: 6461 7465 4578 6973 7469 6e67 2061 6e64  dateExisting and
+0000e6f0: 206c 656e 2869 7465 6d73 2920 3d3d 2030   len(items) == 0
+0000e700: 2061 6e64 206e 6f74 2068 6561 6465 724f   and not headerO
+0000e710: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
+0000e720: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0000e730: 2827 4e6f 2069 7465 6d20 696e 666f 726d  ('No item inform
+0000e740: 6174 696f 6e20 6769 7665 6e27 290a 0a20  ation given').. 
+0000e750: 2020 2020 2020 2069 6620 7570 6461 7465         if update
+0000e760: 4578 6973 7469 6e67 3a0a 2020 2020 2020  Existing:.      
+0000e770: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
+0000e780: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e790: 7570 6461 7465 5f69 6664 6f5f 6865 6164  update_ifdo_head
+0000e7a0: 6572 5f66 6965 6c64 7328 6865 6164 6572  er_fields(header
+0000e7b0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+0000e7c0: 6974 656d 730a 2020 2020 2020 2020 2020  items.          
+0000e7d0: 2020 2320 7570 6461 7465 2063 6f70 7920    # update copy 
+0000e7e0: 6f66 2063 7572 7265 6e74 2069 7465 6d73  of current items
+0000e7f0: 2077 6974 6820 6e65 7720 6974 656d 7320   with new items 
+0000e800: 6669 656c 6473 0a20 2020 2020 2020 2020  fields.         
+0000e810: 2020 2069 7465 6d73 4469 6374 203d 206d     itemsDict = m
+0000e820: 6971 7469 2e63 7265 6174 6549 6d61 6765  iqti.createImage
+0000e830: 4974 656d 7344 6963 7446 726f 6d49 6d61  ItemsDictFromIma
+0000e840: 6765 4974 656d 734c 6973 7428 6974 656d  geItemsList(item
+0000e850: 7329 0a20 2020 2020 2020 2020 2020 2075  s).            u
+0000e860: 7064 6174 6564 4974 656d 735f 636f 7079  pdatedItems_copy
+0000e870: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0000e880: 2873 656c 662e 6966 646f 5f74 6d70 5b73  (self.ifdo_tmp[s
+0000e890: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+0000e8a0: 734b 6579 5d29 0a20 2020 2020 2020 2020  sKey]).         
+0000e8b0: 2020 206c 6f67 203d 206d 6971 7463 2e72     log = miqtc.r
+0000e8c0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
+0000e8d0: 4469 6374 7328 7570 6461 7465 6449 7465  Dicts(updatedIte
+0000e8e0: 6d73 5f63 6f70 792c 2069 7465 6d73 4469  ms_copy, itemsDi
+0000e8f0: 6374 290a 2020 2020 2020 2020 2020 2020  ct).            
+0000e900: 7365 6c66 2e70 726f 762e 6c6f 6728 6c6f  self.prov.log(lo
+0000e910: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
+0000e920: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
+0000e930: 6d73 203d 206d 6971 7469 2e63 7265 6174  ms = miqti.creat
+0000e940: 6549 6d61 6765 4974 656d 734c 6973 7446  eImageItemsListF
+0000e950: 726f 6d49 6d61 6765 4974 656d 7344 6963  romImageItemsDic
+0000e960: 7428 7570 6461 7465 6449 7465 6d73 5f63  t(updatedItems_c
+0000e970: 6f70 7929 0a0a 2020 2020 2020 2020 656c  opy)..        el
+0000e980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000e990: 2320 6f76 6572 7772 6974 6520 6865 6164  # overwrite head
+0000e9a0: 6572 0a20 2020 2020 2020 2020 2020 2073  er.            s
+0000e9b0: 656c 662e 7365 7469 4644 4f48 6561 6465  elf.setiFDOHeade
+0000e9c0: 7246 6965 6c64 7328 6865 6164 6572 290a  rFields(header).
+0000e9d0: 2020 2020 2020 2020 2020 2020 2320 636c              # cl
+0000e9e0: 6561 7220 6974 656d 7320 7365 6374 696f  ear items sectio
+0000e9f0: 6e0a 2020 2020 2020 2020 2020 2020 7365  n.            se
+0000ea00: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000ea10: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+0000ea20: 795d 203d 207b 7d0a 0a20 2020 2020 2020  y] = {}..       
+0000ea30: 2023 2050 6172 7365 2069 6d61 6765 2d61   # Parse image-a
+0000ea40: 6273 7472 6163 7420 616e 6420 6669 6c6c  bstract and fill
+0000ea50: 2069 7473 2070 6c61 6365 686f 6c64 6572   its placeholder
+0000ea60: 7320 7769 7468 2069 6e66 6f72 6d61 7469  s with informati
+0000ea70: 6f6e 0a20 2020 2020 2020 2074 7279 3a0a  on.        try:.
+0000ea80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000ea90: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000eaa0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000eab0: 5d5b 2769 6d61 6765 2d61 6273 7472 6163  ]['image-abstrac
+0000eac0: 7427 5d20 3d20 6d69 7174 732e 7061 7273  t'] = miqts.pars
+0000ead0: 6552 6570 6c61 6365 5661 6c28 7365 6c66  eReplaceVal(self
+0000eae0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000eaf0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000eb00: 5d2c 2027 696d 6167 652d 6162 7374 7261  ], 'image-abstra
+0000eb10: 6374 2729 0a20 2020 2020 2020 2065 7863  ct').        exc
+0000eb20: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0000eb30: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
+0000eb40: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000eb50: 436f 756c 6420 6e6f 7420 7265 706c 6163  Could not replac
+0000eb60: 6520 6b65 7973 2069 6e20 5c27 696d 6167  e keys in \'imag
+0000eb70: 652d 6162 7374 7261 6374 5c27 3a20 2220  e-abstract\': " 
+0000eb80: 2b20 7374 7228 6578 2929 0a0a 0a20 2020  + str(ex))...   
+0000eb90: 2020 2020 2023 2073 6574 2076 6572 7369       # set versi
+0000eba0: 6f6e 2028 736f 2069 7420 6361 6e6e 6f74  on (so it cannot
+0000ebb0: 2062 6520 6368 616e 6765 6420 6279 2075   be changed by u
+0000ebc0: 7365 7229 0a20 2020 2020 2020 2073 656c  ser).        sel
+0000ebd0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+0000ebe0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+0000ebf0: 795d 5b27 696d 6167 652d 7365 742d 6966  y]['image-set-if
+0000ec00: 646f 2d76 6572 7369 6f6e 275d 203d 206d  do-version'] = m
+0000ec10: 6971 7476 2e69 4644 4f5f 7665 7273 696f  iqtv.iFDO_versio
+0000ec20: 6e0a 0a20 2020 2020 2020 2023 2056 616c  n..        # Val
+0000ec30: 6964 6174 6520 6974 656d 2069 6e66 6f72  idate item infor
+0000ec40: 6d61 7469 6f6e 0a20 2020 2020 2020 2069  mation.        i
+0000ec50: 6d61 6765 5f73 6574 5f69 7465 6d73 203d  mage_set_items =
+0000ec60: 207b 7d0a 2020 2020 2020 2020 6966 2068   {}.        if h
+0000ec70: 6561 6465 724f 6e6c 793a 0a20 2020 2020  eaderOnly:.     
+0000ec80: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000ec90: 2e6c 6f67 2822 4361 7574 696f 6e21 2069  .log("Caution! i
+0000eca0: 4644 4f20 6372 6561 7465 6420 696e 2068  FDO created in h
+0000ecb0: 6561 6465 725f 6f6e 6c79 2f69 676e 6f72  eader_only/ignor
+0000ecc0: 655f 696d 6167 655f 6669 6c65 206d 6f64  e_image_file mod
+0000ecd0: 652e 2049 6d61 6765 2069 7465 6d73 2061  e. Image items a
+0000ece0: 7265 206e 6569 7468 6572 2075 7064 6174  re neither updat
+0000ecf0: 6564 206e 6f72 2063 6865 636b 6564 2e22  ed nor checked."
+0000ed00: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000ed10: 2020 2020 2020 2020 2020 2020 696e 7661              inva
+0000ed20: 6c69 645f 6974 656d 7320 3d20 300a 0a20  lid_items = 0.. 
+0000ed30: 2020 2020 2020 2020 2020 2070 726f 6720             prog 
+0000ed40: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
+0000ed50: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
+0000ed60: 6865 636b 696e 6720 6974 656d 7322 2c20  hecking items", 
+0000ed70: 6c65 6e28 6974 656d 7329 2c6d 6f64 756c  len(items),modul
+0000ed80: 6f3d 3529 0a20 2020 2020 2020 2020 2020  o=5).           
+0000ed90: 2066 6f72 2069 7465 6d20 696e 2069 7465   for item in ite
+0000eda0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+0000edb0: 2020 2020 7072 6f67 2e70 726f 6772 6573      prog.progres
+0000edc0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0000edd0: 2020 2020 2320 6368 6563 6b20 6966 2061      # check if a
+0000ede0: 6c6c 2063 6f72 6520 6669 656c 6473 2061  ll core fields a
+0000edf0: 7265 2066 696c 6c65 6420 616e 6420 6172  re filled and ar
+0000ee00: 6520 6669 6c6c 6564 2076 616c 6964 6c79  e filled validly
+0000ee10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ee20: 2074 7279 3a0a 0a20 2020 2020 2020 2020   try:..         
+0000ee30: 2020 2020 2020 2020 2020 2023 2063 6865             # che
+0000ee40: 636b 2069 7465 6d20 696d 6167 6520 6578  ck item image ex
+0000ee50: 6973 7473 0a20 2020 2020 2020 2020 2020  ists.           
+0000ee60: 2020 2020 2020 2020 2023 2069 6620 6974           # if it
+0000ee70: 656d 2069 7320 6120 6c69 7374 2028 7669  em is a list (vi
+0000ee80: 6465 6f29 2c20 6f6e 6520 776f 756c 6420  deo), one would 
+0000ee90: 6861 7665 2074 6f20 6368 6563 6b20 6966  have to check if
+0000eea0: 2065 6163 6820 656e 7472 7920 6973 2076   each entry is v
+0000eeb0: 616c 6964 2067 6976 656e 2074 6865 2064  alid given the d
+0000eec0: 6566 6175 6c74 2076 616c 7565 7320 696e  efault values in
+0000eed0: 2066 6972 7374 2065 6e74 7279 2070 6c75   first entry plu
+0000eee0: 7320 6769 7665 6e20 6465 6661 756c 7420  s given default 
+0000eef0: 7661 6c75 6573 2069 6e20 6865 6164 6572  values in header
+0000ef00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef10: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0000ef20: 7374 616e 6365 2869 7465 6d2c 6c69 7374  stance(item,list
+0000ef30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000ef40: 2020 2020 2020 2020 2020 2069 7465 6d20             item 
+0000ef50: 3d20 5b69 7465 6d5d 0a20 2020 2020 2020  = [item].       
+0000ef60: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+0000ef70: 4974 656d 4465 6661 756c 7420 3d20 6974  ItemDefault = it
+0000ef80: 656d 5b30 5d20 0a20 2020 2020 2020 2020  em[0] .         
+0000ef90: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+0000efa0: 7562 4974 656d 2069 6e20 6974 656d 3a0a  ubItem in item:.
+0000efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efc0: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
+0000efd0: 6520 3d20 7375 6249 7465 6d5b 2769 6d61  e = subItem['ima
+0000efe0: 6765 2d66 696c 656e 616d 6527 5d0a 2020  ge-filename'].  
+0000eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f000: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0000f010: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
+0000f020: 696c 6573 2061 6e64 2066 696c 655f 6e61  iles and file_na
+0000f030: 6d65 206e 6f74 2069 6e20 7365 6c66 2e5f  me not in self._
+0000f040: 696d 6167 654e 616d 6573 496d 6167 6573  imageNamesImages
+0000f050: 4469 723a 0a20 2020 2020 2020 2020 2020  Dir:.           
+0000f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f070: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+0000f080: 2822 4974 656d 2027 2220 2b20 6669 6c65  ("Item '" + file
+0000f090: 5f6e 616d 6520 2b20 2227 206e 6f74 2066  _name + "' not f
+0000f0a0: 6f75 6e64 2069 6e20 2f72 6177 2064 6972  ound in /raw dir
+0000f0b0: 6563 746f 7279 2e22 290a 0a20 2020 2020  ectory.")..     
+0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0d0: 2020 2069 6620 7661 6c69 6461 7465 5f73     if validate_s
+0000f0e0: 696e 676c 655f 6974 656d 733a 0a20 2020  ingle_items:.   
+0000f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f100: 2020 2020 2020 2020 206d 6971 7474 2e61           miqtt.a
+0000f110: 7265 5f76 616c 6964 5f69 6664 6f5f 6669  re_valid_ifdo_fi
+0000f120: 656c 6473 2873 7562 4974 656d 290a 2020  elds(subItem).  
 0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f140: 2020 2020 666f 7220 7375 6249 7465 6d20      for subItem 
-0000f150: 696e 2069 7465 6d3a 0a20 2020 2020 2020  in item:.       
-0000f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f170: 2073 7562 4974 656d 4469 6374 203d 207b   subItemDict = {
-0000f180: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
-0000f190: 2020 2020 2020 2020 2020 666f 7220 6974            for it
-0000f1a0: 2069 6e20 7375 6249 7465 6d3a 0a20 2020   in subItem:.   
-0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f1c0: 2020 2020 2020 2020 2069 6620 6974 2021           if it !
-0000f1d0: 3d20 2769 6d61 6765 2d66 696c 656e 616d  = 'image-filenam
-0000f1e0: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
+0000f140: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f160: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
+0000f170: 645f 6e61 6d65 2c66 6965 6c64 5f76 616c  d_name,field_val
+0000f180: 2069 6e20 7375 6249 7465 6d2e 6974 656d   in subItem.item
+0000f190: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1b0: 2020 2020 206d 6971 7474 2e69 6664 6f5f       miqtt.ifdo_
+0000f1c0: 6669 656c 645f 6164 6469 7469 6f6e 616c  field_additional
+0000f1d0: 5f63 6865 636b 7328 6669 656c 645f 6e61  _checks(field_na
+0000f1e0: 6d65 2c66 6965 6c64 5f76 616c 2920 2020  me,field_val)   
 0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f200: 2020 2020 7375 6249 7465 6d44 6963 745b      subItemDict[
-0000f210: 6974 5d20 3d20 7375 6249 7465 6d5b 6974  it] = subItem[it
-0000f220: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000f230: 2020 2020 2020 2020 2020 696d 6167 655f            image_
-0000f240: 7365 745f 6974 656d 735b 7375 6249 7465  set_items[subIte
-0000f250: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
-0000f260: 6669 6c65 6e61 6d65 275d 5d2e 6170 7065  filename']].appe
-0000f270: 6e64 2873 7562 4974 656d 4469 6374 290a  nd(subItemDict).
-0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f2a0: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-0000f2b0: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
-0000f2c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f2d0: 2020 2020 2020 696e 7661 6c69 645f 6974        invalid_it
-0000f2e0: 656d 7320 2b3d 2031 0a20 2020 2020 2020  ems += 1.       
-0000f2f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000f300: 662e 7072 6f76 2e6c 6f67 2822 496e 7661  f.prov.log("Inva
-0000f310: 6c69 6420 696d 6167 6520 6974 656d 3a20  lid image item: 
-0000f320: 222b 2073 7472 2869 7465 6d29 2c64 6f6e  "+ str(item),don
-0000f330: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+0000f200: 2020 2020 200a 0a20 2020 2020 2020 2020       ..         
+0000f210: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0000f220: 5f73 6574 5f69 7465 6d73 5b73 7562 4974  _set_items[subIt
+0000f230: 656d 4465 6661 756c 745b 2769 6d61 6765  emDefault['image
+0000f240: 2d66 696c 656e 616d 6527 5d5d 203d 205b  -filename']] = [
+0000f250: 5d20 2320 636f 756c 6420 6d61 6b65 2061  ] # could make a
+0000f260: 6e20 6578 7472 6120 6361 7365 2066 6f72  n extra case for
+0000f270: 2069 6d61 6765 7320 6f6d 6974 7469 6e67   images omitting
+0000f280: 2074 6865 206c 6973 740a 2020 2020 2020   the list.      
+0000f290: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000f2a0: 7220 7375 6249 7465 6d20 696e 2069 7465  r subItem in ite
+0000f2b0: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+0000f2c0: 2020 2020 2020 2020 2020 2073 7562 4974             subIt
+0000f2d0: 656d 4469 6374 203d 207b 7d0a 2020 2020  emDict = {}.    
+0000f2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f2f0: 2020 2020 666f 7220 6974 2069 6e20 7375      for it in su
+0000f300: 6249 7465 6d3a 0a20 2020 2020 2020 2020  bItem:.         
+0000f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f320: 2020 2069 6620 6974 2021 3d20 2769 6d61     if it != 'ima
+0000f330: 6765 2d66 696c 656e 616d 6527 3a0a 2020  ge-filename':.  
 0000f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f350: 7365 6c66 2e70 726f 762e 6c6f 6728 2245  self.prov.log("E
-0000f360: 7863 6570 7469 6f6e 3a5c 6e22 2b20 7374  xception:\n"+ st
-0000f370: 7228 652e 6172 6773 292c 646f 6e74 5368  r(e.args),dontSh
-0000f380: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-0000f390: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000f3a0: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-0000f3b0: 6570 7469 6f6e 2822 496e 7661 6c69 6420  eption("Invalid 
-0000f3c0: 696d 6167 6520 6974 656d 2022 2b20 6669  image item "+ fi
-0000f3d0: 6c65 5f6e 616d 6520 2b20 223a 5c6e 4578  le_name + ":\nEx
-0000f3e0: 6365 7074 696f 6e3a 5c6e 222b 2073 7472  ception:\n"+ str
-0000f3f0: 2865 2e61 7267 7329 2920 2320 6f74 6865  (e.args)) # othe
-0000f400: 7277 6973 652c 2069 6e20 6361 7365 206f  rwise, in case o
-0000f410: 6620 6d61 6e79 2069 6d61 6765 732c 2069  f many images, i
-0000f420: 7420 6d61 7920 6b65 6570 2072 756e 6e69  t may keep runni
-0000f430: 6e67 2061 6e64 2074 6872 6f77 696e 6720  ng and throwing 
-0000f440: 6572 726f 7273 2066 6f72 2071 7569 7420  errors for quit 
-0000f450: 736f 6d65 2074 696d 650a 2020 2020 2020  some time.      
-0000f460: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
-0000f470: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-0000f480: 6966 206c 656e 2869 7465 6d73 2920 213d  if len(items) !=
-0000f490: 2030 2061 6e64 2069 6e76 616c 6964 5f69   0 and invalid_i
-0000f4a0: 7465 6d73 203d 3d20 6c65 6e28 6974 656d  tems == len(item
-0000f4b0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000f4c0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
-0000f4d0: 696f 6e28 2241 6c6c 2069 7465 6d73 2061  ion("All items a
-0000f4e0: 7265 2069 6e76 616c 6964 2229 0a20 2020  re invalid").   
-0000f4f0: 2020 2020 2020 2020 2065 6c69 6620 696e           elif in
-0000f500: 7661 6c69 645f 6974 656d 7320 3e20 303a  valid_items > 0:
-0000f510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f520: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000f530: 4174 206c 6561 7374 2022 202b 2073 7472  At least " + str
-0000f540: 2869 6e76 616c 6964 5f69 7465 6d73 2920  (invalid_items) 
-0000f550: 2b20 2220 6974 656d 7320 7765 7265 2069  + " items were i
-0000f560: 6e76 616c 6964 2028 6f66 2220 2b20 7374  nvalid (of" + st
-0000f570: 7228 6c65 6e28 6974 656d 7329 292b 2022  r(len(items))+ "
-0000f580: 2922 290a 0a20 2020 2020 2020 2023 2056  )")..        # V
-0000f590: 616c 6964 6174 6520 6865 6164 6572 2069  alidate header i
-0000f5a0: 6e66 6f72 6d61 7469 6f6e 0a20 2020 2020  nformation.     
-0000f5b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f5c0: 2020 2020 6d69 7174 742e 6172 655f 7661      miqtt.are_va
-0000f5d0: 6c69 645f 6966 646f 5f66 6965 6c64 7328  lid_ifdo_fields(
-0000f5e0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000f5f0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000f600: 724b 6579 5d29 0a20 2020 2020 2020 2065  rKey]).        e
-0000f610: 7863 6570 7420 6d69 7174 632e 4966 646f  xcept miqtc.Ifdo
-0000f620: 4578 6365 7074 696f 6e20 6173 2065 783a  Exception as ex:
-0000f630: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
-0000f640: 203d 2022 496e 7661 6c69 6420 6865 6164   = "Invalid head
-0000f650: 6572 2066 6965 6c64 3a20 2220 2b20 7374  er field: " + st
-0000f660: 7228 6578 290a 2020 2020 2020 2020 2020  r(ex).          
-0000f670: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000f680: 2245 7863 6570 7469 6f6e 3a20 2220 2b20  "Exception: " + 
-0000f690: 6d73 672c 2064 6f6e 7453 686f 773d 5472  msg, dontShow=Tr
-0000f6a0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-0000f6b0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-0000f6c0: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
-0000f6d0: 2020 2020 2020 2020 2320 7075 7420 6974          # put it
-0000f6e0: 656d 2069 6e66 6f20 696e 746f 2073 656c  em info into sel
-0000f6f0: 662e 6966 646f 5f74 6d70 0a20 2020 2020  f.ifdo_tmp.     
-0000f700: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
-0000f710: 6e74 4c6f 6164 696e 674d 7367 2822 5570  ntLoadingMsg("Up
-0000f720: 6461 7469 6e67 2229 0a20 2020 2020 2020  dating").       
-0000f730: 206c 6f67 203d 206d 6971 7463 2e72 6563   log = miqtc.rec
-0000f740: 7572 7369 7665 6c79 5570 6461 7465 4469  ursivelyUpdateDi
-0000f750: 6374 7328 7365 6c66 2e69 6664 6f5f 746d  cts(self.ifdo_tm
-0000f760: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-0000f770: 7465 6d73 4b65 795d 2c20 696d 6167 655f  temsKey], image_
-0000f780: 7365 745f 6974 656d 7329 0a20 2020 2020  set_items).     
-0000f790: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
-0000f7a0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000f7b0: 6728 6c6f 6729 0a0a 2020 2020 2020 2020  g(log)..        
-0000f7c0: 2320 7365 7420 6c61 7420 6c6f 6e20 626f  # set lat lon bo
-0000f7d0: 756e 6469 6e67 2062 6f78 0a20 2020 2020  unding box.     
-0000f7e0: 2020 2073 656c 662e 5f73 6574 5f6c 6174     self._set_lat
-0000f7f0: 5f6c 6f6e 5f62 6f75 6e64 696e 675f 626f  _lon_bounding_bo
-0000f800: 7828 7365 6c66 2e69 6664 6f5f 746d 7029  x(self.ifdo_tmp)
-0000f810: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-0000f820: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
-0000f830: 6561 6465 7220 6669 656c 6473 2064 6174  eader fields dat
-0000f840: 6574 696d 652c 206c 6174 2c20 6c6f 6e2c  etime, lat, lon,
-0000f850: 2061 6c74 0a20 2020 2020 2020 2073 656c   alt.        sel
-0000f860: 662e 5f73 6574 5f72 6570 5f68 6561 6465  f._set_rep_heade
-0000f870: 725f 6669 656c 6473 5f64 745f 6c61 745f  r_fields_dt_lat_
-0000f880: 6c6f 6e5f 616c 7428 7365 6c66 2e69 6664  lon_alt(self.ifd
-0000f890: 6f5f 746d 7029 0a0a 2020 2020 2020 2020  o_tmp)..        
-0000f8a0: 7365 6c66 2e5f 7365 745f 696d 6167 655f  self._set_image_
-0000f8b0: 6974 656d 5f69 6465 6e74 6966 6963 6174  item_identificat
-0000f8c0: 696f 6e5f 7363 6865 6d65 2873 656c 662e  ion_scheme(self.
-0000f8d0: 6966 646f 5f74 6d70 290a 0a20 2020 2020  ifdo_tmp)..     
-0000f8e0: 2020 2023 2072 656d 6f76 6520 656d 7470     # remove emtp
-0000f8f0: 7920 6669 656c 6473 0a20 2020 2020 2020  y fields.       
-0000f900: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
-0000f910: 4c6f 6164 696e 674d 7367 2822 5265 6d6f  LoadingMsg("Remo
-0000f920: 7669 6e67 2065 6d70 7479 2066 6965 6c64  ving empty field
-0000f930: 7322 290a 2020 2020 2020 2020 7365 6c66  s").        self
-0000f940: 2e69 6664 6f5f 746d 7020 3d20 6d69 7174  .ifdo_tmp = miqt
-0000f950: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
-0000f960: 6f76 6545 6d70 7479 4669 656c 6473 2873  oveEmptyFields(s
-0000f970: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
-0000f980: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000f990: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
-0000f9a0: 6579 2069 6e20 7365 6c66 2e69 6664 6f5f  ey in self.ifdo_
-0000f9b0: 746d 703a 0a20 2020 2020 2020 2020 2020  tmp:.           
-0000f9c0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000f9d0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
-0000f9e0: 734b 6579 5d20 3d20 5b5d 0a20 2020 2020  sKey] = [].     
-0000f9f0: 2020 2023 2072 656d 6f76 6520 6669 656c     # remove fiel
-0000fa00: 6473 2074 6861 7420 636f 6e74 6169 6e20  ds that contain 
-0000fa10: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0000fa20: 206f 6e6c 790a 2020 2020 2020 2020 7365   only.        se
-0000fa30: 6c66 2e72 656d 6f76 6549 7465 6d46 6965  lf.removeItemFie
-0000fa40: 6c64 7357 6974 684f 6e6c 7944 6174 6554  ldsWithOnlyDateT
-0000fa50: 696d 6528 290a 2020 2020 2020 2020 732e  ime().        s.
-0000fa60: 7374 6f70 2829 0a0a 2020 2020 2020 2020  stop()..        
-0000fa70: 6966 206e 6f74 2073 656c 662e 6967 6e6f  if not self.igno
-0000fa80: 7265 5f69 6d61 6765 5f66 696c 6573 3a0a  re_image_files:.
-0000fa90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000faa0: 2e63 6865 636b 416c 6c49 7465 6d48 6173  .checkAllItemHas
-0000fab0: 6865 7328 290a 0a20 2020 2020 2020 2023  hes()..        #
-0000fac0: 2063 6865 636b 2061 6761 696e 7374 2073   check against s
-0000fad0: 6368 656d 610a 2020 2020 2020 2020 7661  chema.        va
-0000fae0: 6c69 642c 206d 7367 203d 206d 6971 7474  lid, msg = miqtt
-0000faf0: 2e76 616c 6964 6174 655f 6966 646f 2873  .validate_ifdo(s
-0000fb00: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
-0000fb10: 2020 2020 2020 6966 206e 6f74 2076 616c        if not val
-0000fb20: 6964 2061 6e64 206e 6f74 2061 6c6c 6f77  id and not allow
-0000fb30: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
-0000fb40: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
-0000fb50: 656c 662e 7072 6f76 2e6c 6f67 2822 5761  elf.prov.log("Wa
-0000fb60: 726e 696e 6721 2069 4644 4f20 6e6f 2076  rning! iFDO no v
-0000fb70: 616c 6964 2079 6574 3a20 2220 2b20 6d73  alid yet: " + ms
-0000fb80: 6729 0a20 2020 2020 2020 2020 2020 2072  g).            r
-0000fb90: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-0000fba0: 7863 6570 7469 6f6e 286d 7367 290a 0a20  xception(msg).. 
-0000fbb0: 2020 2020 2020 2023 2073 6574 2066 696e         # set fin
-0000fbc0: 616c 206f 6e65 0a20 2020 2020 2020 2073  al one.        s
-0000fbd0: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-0000fbe0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
-0000fbf0: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
-0000fc00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000fc10: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
-0000fc20: 0a0a 0a20 2020 2064 6566 205f 7365 745f  ...    def _set_
-0000fc30: 696d 6167 655f 6974 656d 5f69 6465 6e74  image_item_ident
-0000fc40: 6966 6963 6174 696f 6e5f 7363 6865 6d65  ification_scheme
-0000fc50: 2873 656c 662c 6966 646f 3a64 6963 7429  (self,ifdo:dict)
-0000fc60: 3a0a 2020 2020 2020 2020 2222 2220 5365  :.        """ Se
-0000fc70: 7420 696d 6167 652d 6974 656d 2d69 6465  t image-item-ide
-0000fc80: 6e74 6966 6963 6174 696f 6e2d 7363 6865  ntification-sche
-0000fc90: 6d65 2074 6f20 6069 6d61 6765 2d70 726f  me to `image-pro
-0000fca0: 6a65 6374 5f69 6d61 6765 2d65 7665 6e74  ject_image-event
-0000fcb0: 5f69 6d61 6765 2d73 656e 736f 725f 696d  _image-sensor_im
-0000fcc0: 6167 652d 6461 7465 7469 6d65 2e65 7874  age-datetime.ext
-0000fcd0: 6020 6966 2065 6d70 7479 2e20 2222 220a  ` if empty. """.
-0000fce0: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
-0000fcf0: 6965 6c64 2869 6664 6f5b 7365 6c66 2e69  ield(ifdo[self.i
-0000fd00: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-0000fd10: 5d2c 2769 6d61 6765 2d69 7465 6d2d 6964  ],'image-item-id
-0000fd20: 656e 7469 6669 6361 7469 6f6e 2d73 6368  entification-sch
-0000fd30: 656d 6527 2920 3d3d 2022 223a 0a20 2020  eme') == "":.   
-0000fd40: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
-0000fd50: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000fd60: 724b 6579 5d5b 2769 6d61 6765 2d69 7465  rKey]['image-ite
-0000fd70: 6d2d 6964 656e 7469 6669 6361 7469 6f6e  m-identification
-0000fd80: 2d73 6368 656d 6527 5d20 3d20 2027 696d  -scheme'] =  'im
-0000fd90: 6167 652d 7072 6f6a 6563 745f 696d 6167  age-project_imag
-0000fda0: 652d 6576 656e 745f 696d 6167 652d 7365  e-event_image-se
-0000fdb0: 6e73 6f72 5f69 6d61 6765 2d64 6174 6574  nsor_image-datet
-0000fdc0: 696d 652e 6578 7427 0a0a 0a20 2020 2064  ime.ext'...    d
-0000fdd0: 6566 205f 7365 745f 7265 705f 6865 6164  ef _set_rep_head
-0000fde0: 6572 5f66 6965 6c64 735f 6474 5f6c 6174  er_fields_dt_lat
-0000fdf0: 5f6c 6f6e 5f61 6c74 2873 656c 662c 6966  _lon_alt(self,if
-0000fe00: 646f 3a64 6963 7429 3a0a 2020 2020 2020  do:dict):.      
-0000fe10: 2020 2222 2220 4669 6c6c 2068 6561 6465    """ Fill heade
-0000fe20: 7220 6669 656c 6473 2069 6d61 6765 2d64  r fields image-d
-0000fe30: 6174 6574 696d 6520 616e 6420 2d6c 6174  atetime and -lat
-0000fe40: 6974 7564 652c 202d 6c6f 6e67 6974 7565  itude, -longitue
-0000fe50: 6465 2c20 2d61 6c74 6974 7564 652d 6d65  de, -altitude-me
-0000fe60: 7465 7273 2c20 2d63 6f6f 7264 696e 6174  ters, -coordinat
-0000fe70: 652d 756e 6365 7274 6169 6e74 792d 6d65  e-uncertainty-me
-0000fe80: 7465 7273 2c20 6966 2065 6d70 7479 2c0a  ters, if empty,.
-0000fe90: 2020 2020 2020 2020 7265 7072 6573 656e          represen
-0000fea0: 7461 7469 7665 6c79 2077 6974 6820 6669  tatively with fi
-0000feb0: 7273 7420 6974 656d 7320 656e 7472 7920  rst items entry 
-0000fec0: 616e 6420 6d65 6469 616e 206f 6620 616c  and median of al
-0000fed0: 6c20 6974 656d 7320 7661 6c75 6573 2c20  l items values, 
-0000fee0: 7265 7370 6563 7469 7665 6c79 2e20 2222  respectively. ""
-0000fef0: 220a 0a20 2020 2020 2020 2023 2027 696d  "..        # 'im
-0000ff00: 6167 652d 6461 7465 7469 6d65 270a 2020  age-datetime'.  
-0000ff10: 2020 2020 2020 6669 7273 745f 696d 6167        first_imag
-0000ff20: 6520 3d20 736f 7274 6564 2869 6664 6f5b  e = sorted(ifdo[
-0000ff30: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-0000ff40: 6d73 4b65 795d 2e6b 6579 7328 2929 5b30  msKey].keys())[0
-0000ff50: 5d0a 2020 2020 2020 2020 6669 656c 6420  ].        field 
-0000ff60: 3d20 2769 6d61 6765 2d64 6174 6574 696d  = 'image-datetim
-0000ff70: 6527 0a20 2020 2020 2020 2069 6620 6669  e'.        if fi
-0000ff80: 6e64 4669 656c 6428 6966 646f 5b73 656c  ndField(ifdo[sel
-0000ff90: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000ffa0: 4b65 795d 2c66 6965 6c64 2920 3d3d 2022  Key],field) == "
-0000ffb0: 223a 0a20 2020 2020 2020 2020 2020 2074  ":.            t
-0000ffc0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000ffd0: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-0000ffe0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-0000fff0: 5b66 6965 6c64 5d20 3d20 7365 6c66 2e5f  [field] = self._
-00010000: 5f67 6574 4669 656c 6456 616c 7565 2869  _getFieldValue(i
-00010010: 6664 6f2c 5b66 6972 7374 5f69 6d61 6765  fdo,[first_image
-00010020: 2c66 6965 6c64 5d2c 6465 6661 756c 745f  ,field],default_
-00010030: 6f6e 6c79 3d54 7275 6529 0a20 2020 2020  only=True).     
-00010040: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00010050: 7072 6f76 2e6c 6f67 2822 5365 7420 7265  prov.log("Set re
-00010060: 7072 6573 656e 7461 7469 7665 2068 6561  presentative hea
-00010070: 6465 7220 6669 656c 6420 2722 202b 2066  der field '" + f
-00010080: 6965 6c64 202b 2022 2720 746f 2022 202b  ield + "' to " +
-00010090: 2073 7472 2869 6664 6f5b 7365 6c66 2e69   str(ifdo[self.i
-000100a0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
-000100b0: 5d5b 6669 656c 645d 2920 2b20 2220 6672  ][field]) + " fr
-000100c0: 6f6d 2066 6972 7374 2069 6d61 6765 2e22  om first image."
-000100d0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-000100e0: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
-000100f0: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
-00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010110: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-00010120: 6f75 6c64 206e 6f74 2073 6574 2072 6570  ould not set rep
-00010130: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
-00010140: 6572 2066 6965 6c64 3a20 2220 2b20 7374  er field: " + st
-00010150: 7228 6578 2929 0a20 2020 2020 2020 2020  r(ex)).         
-00010160: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
-00010170: 2020 2020 2023 2072 6573 740a 2020 2020       # rest.    
-00010180: 2020 2020 7265 705f 6865 6164 6572 5f66      rep_header_f
-00010190: 6965 6c64 735f 6d65 6469 616e 203d 205b  ields_median = [
-000101a0: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
-000101b0: 2c27 696d 6167 652d 6c6f 6e67 6974 7564  ,'image-longitud
-000101c0: 6527 2c27 696d 6167 652d 616c 7469 7475  e','image-altitu
-000101d0: 6465 2d6d 6574 6572 7327 2c27 696d 6167  de-meters','imag
-000101e0: 652d 636f 6f72 6469 6e61 7465 2d75 6e63  e-coordinate-unc
-000101f0: 6572 7461 696e 7479 2d6d 6574 6572 7327  ertainty-meters'
-00010200: 5d0a 2020 2020 2020 2020 666f 7220 6669  ].        for fi
-00010210: 656c 6420 696e 2072 6570 5f68 6561 6465  eld in rep_heade
-00010220: 725f 6669 656c 6473 5f6d 6564 6961 6e3a  r_fields_median:
-00010230: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00010240: 6669 6e64 4669 656c 6428 6966 646f 5b73  findField(ifdo[s
-00010250: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-00010260: 6572 4b65 795d 2c66 6965 6c64 2920 3d3d  erKey],field) ==
-00010270: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00010280: 2020 2020 2076 616c 7565 7320 3d20 5b5d       values = []
-00010290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000102a0: 2066 6f72 2069 6d61 6765 5f6e 616d 6520   for image_name 
-000102b0: 696e 2069 6664 6f5b 7365 6c66 2e69 6d61  in ifdo[self.ima
-000102c0: 6765 5365 7449 7465 6d73 4b65 795d 2e6b  geSetItemsKey].k
-000102d0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-000102e0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-000102f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010300: 2020 2020 2020 2020 6974 656d 5f76 616c          item_val
-00010310: 203d 2073 656c 662e 5f5f 6765 7446 6965   = self.__getFie
-00010320: 6c64 5661 6c75 6528 6966 646f 2c5b 696d  ldValue(ifdo,[im
-00010330: 6167 655f 6e61 6d65 2c66 6965 6c64 5d29  age_name,field])
-00010340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010350: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00010360: 7374 616e 6365 2869 7465 6d5f 7661 6c2c  stance(item_val,
-00010370: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-00010380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010390: 2020 2076 616c 7565 7320 2b3d 206c 6973     values += lis
-000103a0: 7428 6974 656d 5f76 616c 2e76 616c 7565  t(item_val.value
-000103b0: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
-000103c0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-000103d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-000103f0: 616c 7565 732e 6170 7065 6e64 2869 7465  alues.append(ite
-00010400: 6d5f 7661 6c29 0a20 2020 2020 2020 2020  m_val).         
-00010410: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00010420: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
-00010430: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
-00010440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010450: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-00010460: 2020 2020 2020 2020 2020 7661 6c75 6573            values
-00010470: 203d 205b 6920 666f 7220 6920 696e 2076   = [i for i in v
-00010480: 616c 7565 7320 6966 2069 2021 3d20 2727  alues if i != ''
-00010490: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000104a0: 2020 6966 206c 656e 2876 616c 7565 7329    if len(values)
-000104b0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-000104c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000104d0: 7072 6f76 2e6c 6f67 2822 436f 756c 6420  prov.log("Could 
-000104e0: 6e6f 7420 7365 7420 7265 7072 6573 656e  not set represen
-000104f0: 7461 7469 7665 2068 6561 6465 7220 6669  tative header fi
-00010500: 656c 642c 206e 6f20 7661 6c75 6573 2066  eld, no values f
-00010510: 6f75 6e64 3a20 2220 2b20 6669 656c 6429  ound: " + field)
-00010520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010530: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00010540: 2020 2020 2020 2020 2020 2023 2069 676e             # ign
-00010550: 6f72 6520 756e 6b6e 6f6e 772c 2069 2e65  ore unknonw, i.e
-00010560: 2e20 302e 302c 2076 616c 7565 730a 2020  . 0.0, values.  
-00010570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010580: 2020 7661 6c75 6573 203d 205b 6920 666f    values = [i fo
-00010590: 7220 6920 696e 2076 616c 7565 7320 6966  r i in values if
-000105a0: 2069 2021 3d20 302e 305d 0a20 2020 2020   i != 0.0].     
-000105b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000105c0: 6620 6c65 6e28 7661 6c75 6573 2920 3d3d  f len(values) ==
-000105d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000105e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-000105f0: 6573 2e61 7070 656e 6428 302e 3029 200a  es.append(0.0) .
-00010600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010610: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-00010620: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00010630: 5b66 6965 6c64 5d20 3d20 7374 6174 6973  [field] = statis
-00010640: 7469 6373 2e6d 6564 6961 6e28 7661 6c75  tics.median(valu
-00010650: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00010660: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00010670: 762e 6c6f 6728 2253 6574 2072 6570 7265  v.log("Set repre
-00010680: 7365 6e74 6174 6976 6520 6865 6164 6572  sentative header
-00010690: 2066 6965 6c64 2027 2220 2b20 6669 656c   field '" + fiel
-000106a0: 6420 2b20 2227 2074 6f20 6d65 6469 616e  d + "' to median
-000106b0: 3a20 2220 2b20 7374 7228 6966 646f 5b73  : " + str(ifdo[s
-000106c0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-000106d0: 6572 4b65 795d 5b66 6965 6c64 5d29 202b  erKey][field]) +
-000106e0: 2022 2e22 290a 0a0a 2020 2020 6465 6620   ".")...    def 
-000106f0: 5f73 6574 5f6c 6174 5f6c 6f6e 5f62 6f75  _set_lat_lon_bou
-00010700: 6e64 696e 675f 626f 7828 7365 6c66 2c69  nding_box(self,i
-00010710: 6664 6f3a 6469 6374 293a 0a20 2020 2020  fdo:dict):.     
-00010720: 2020 2022 2222 2053 6574 2069 6d61 6765     """ Set image
-00010730: 2d73 6574 2d5b 6d69 6e2c 6d61 785d 2d5b  -set-[min,max]-[
-00010740: 6c61 7469 7475 6465 2c6c 6f6e 6769 7475  latitude,longitu
-00010750: 6465 5d2d 6465 6772 6565 7320 2222 220a  de]-degrees """.
-00010760: 2020 2020 2020 2020 6c61 745f 6d69 6e2c          lat_min,
-00010770: 206c 6174 5f6d 6178 2c20 6c6f 6e5f 6d69   lat_max, lon_mi
-00010780: 6e2c 206c 6f6e 5f6d 6178 203d 2073 656c  n, lon_max = sel
-00010790: 662e 5f67 6574 5f6c 6174 5f6c 6f6e 5f62  f._get_lat_lon_b
-000107a0: 6f75 6e64 696e 675f 626f 7828 6966 646f  ounding_box(ifdo
-000107b0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-000107c0: 656d 734b 6579 5d29 0a20 2020 2020 2020  emsKey]).       
-000107d0: 2069 6620 6e6f 7420 4e6f 6e65 2069 6e20   if not None in 
-000107e0: 5b6c 6174 5f6d 696e 2c20 6c61 745f 6d61  [lat_min, lat_ma
-000107f0: 782c 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f  x, lon_min, lon_
-00010800: 6d61 785d 3a0a 2020 2020 2020 2020 2020  max]:.          
-00010810: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
-00010820: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-00010830: 696d 6167 652d 7365 742d 6d69 6e2d 6c61  image-set-min-la
-00010840: 7469 7475 6465 2d64 6567 7265 6573 275d  titude-degrees']
-00010850: 203d 206c 6174 5f6d 696e 0a20 2020 2020   = lat_min.     
-00010860: 2020 2020 2020 2069 6664 6f5b 7365 6c66         ifdo[self
-00010870: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00010880: 6579 5d5b 2769 6d61 6765 2d73 6574 2d6d  ey]['image-set-m
-00010890: 6178 2d6c 6174 6974 7564 652d 6465 6772  ax-latitude-degr
-000108a0: 6565 7327 5d20 3d20 6c61 745f 6d61 780a  ees'] = lat_max.
-000108b0: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
-000108c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-000108d0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-000108e0: 7365 742d 6d69 6e2d 6c6f 6e67 6974 7564  set-min-longitud
-000108f0: 652d 6465 6772 6565 7327 5d20 3d20 6c6f  e-degrees'] = lo
-00010900: 6e5f 6d69 6e0a 2020 2020 2020 2020 2020  n_min.          
-00010910: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
-00010920: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-00010930: 696d 6167 652d 7365 742d 6d61 782d 6c6f  image-set-max-lo
-00010940: 6e67 6974 7564 652d 6465 6772 6565 7327  ngitude-degrees'
-00010950: 5d20 3d20 6c6f 6e5f 6d61 780a 0a0a 2020  ] = lon_max...  
-00010960: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
-00010970: 2020 2020 6465 6620 5f67 6574 5f6c 6174      def _get_lat
-00010980: 5f6c 6f6e 5f62 6f75 6e64 696e 675f 626f  _lon_bounding_bo
-00010990: 7828 6974 656d 733a 6469 6374 293a 0a20  x(items:dict):. 
-000109a0: 2020 2020 2020 2022 2222 2052 6574 7572         """ Retur
-000109b0: 6e73 206c 6174 5f6d 696e 2c20 6c61 745f  ns lat_min, lat_
-000109c0: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
-000109d0: 6e5f 6d61 7820 2222 220a 2020 2020 2020  n_max """.      
-000109e0: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
-000109f0: 6178 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e  ax, lon_min, lon
-00010a00: 5f6d 6178 203d 204e 6f6e 652c 204e 6f6e  _max = None, Non
-00010a10: 652c 204e 6f6e 652c 204e 6f6e 650a 2020  e, None, None.  
-00010a20: 2020 2020 2020 6920 3d20 300a 2020 2020        i = 0.    
-00010a30: 2020 2020 666f 7220 696d 6167 652c 2064      for image, d
-00010a40: 6174 6120 696e 2069 7465 6d73 2e69 7465  ata in items.ite
-00010a50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-00010a60: 2020 2320 6d61 6b65 2069 6d61 6765 2065    # make image e
-00010a70: 6e74 7279 206c 6973 7420 2861 6c73 6f20  ntry list (also 
-00010a80: 6966 2069 7473 2061 2070 6963 7475 7265  if its a picture
-00010a90: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00010aa0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00010ab0: 6461 7461 2c20 6c69 7374 293a 0a20 2020  data, list):.   
-00010ac0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00010ad0: 6120 3d20 5b64 6174 615d 0a20 2020 2020  a = [data].     
-00010ae0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
-00010af0: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
-00010b00: 745f 6461 7461 2069 6e20 6461 7461 3a0a  t_data in data:.
-00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00010b30: 2020 2020 2020 2020 206c 6174 203d 2074           lat = t
-00010b40: 696d 6570 6f69 6e74 5f64 6174 615b 2769  imepoint_data['i
-00010b50: 6d61 6765 2d6c 6174 6974 7564 6527 5d0a  mage-latitude'].
-00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b70: 2020 2020 6c6f 6e20 3d20 7469 6d65 706f      lon = timepo
-00010b80: 696e 745f 6461 7461 5b27 696d 6167 652d  int_data['image-
-00010b90: 6c6f 6e67 6974 7564 6527 5d0a 2020 2020  longitude'].    
-00010ba0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00010bb0: 7074 204b 6579 4572 726f 7220 6173 2065  pt KeyError as e
-00010bc0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
-00010bd0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00010be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010bf0: 2069 6620 6920 3d3d 2030 3a0a 2020 2020   if i == 0:.    
-00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c10: 6c61 745f 6d69 6e2c 206c 6174 5f6d 6178  lat_min, lat_max
-00010c20: 203d 206c 6174 2c20 6c61 740a 2020 2020   = lat, lat.    
-00010c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010c40: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
-00010c50: 203d 206c 6f6e 2c20 6c6f 6e0a 2020 2020   = lon, lon.    
-00010c60: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00010c70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010c80: 2020 2020 2020 6966 206c 6174 203c 206c        if lat < l
-00010c90: 6174 5f6d 696e 3a0a 2020 2020 2020 2020  at_min:.        
-00010ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cb0: 6c61 745f 6d69 6e20 3d20 6c61 740a 2020  lat_min = lat.  
-00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010cd0: 2020 6966 206c 6174 203e 206c 6174 5f6d    if lat > lat_m
-00010ce0: 6178 3a0a 2020 2020 2020 2020 2020 2020  ax:.            
-00010cf0: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
-00010d00: 6d61 7820 3d20 6c61 740a 2020 2020 2020  max = lat.      
-00010d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00010d20: 206c 6f6e 203c 206c 6f6e 5f6d 696e 3a0a   lon < lon_min:.
-00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d40: 2020 2020 2020 2020 6c6f 6e5f 6d69 6e20          lon_min 
-00010d50: 3d20 6c6f 6e0a 2020 2020 2020 2020 2020  = lon.          
-00010d60: 2020 2020 2020 2020 2020 6966 206c 6f6e            if lon
-00010d70: 203e 206c 6f6e 5f6d 6178 3a0a 2020 2020   > lon_max:.    
-00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010d90: 2020 2020 6c6f 6e5f 6d61 7820 3d20 6c6f      lon_max = lo
-00010da0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00010db0: 2020 6920 2b3d 2031 0a20 2020 2020 2020    i += 1.       
-00010dc0: 2072 6574 7572 6e20 6c61 745f 6d69 6e2c   return lat_min,
-00010dd0: 206c 6174 5f6d 6178 2c20 6c6f 6e5f 6d69   lat_max, lon_mi
-00010de0: 6e2c 206c 6f6e 5f6d 6178 0a0a 0a20 2020  n, lon_max...   
-00010df0: 2064 6566 2072 656d 6f76 6549 7465 6d46   def removeItemF
-00010e00: 6965 6c64 7357 6974 684f 6e6c 7944 6174  ieldsWithOnlyDat
-00010e10: 6554 696d 6528 7365 6c66 293a 0a20 2020  eTime(self):.   
-00010e20: 2020 2020 2022 2222 2069 7420 6361 6e20       """ it can 
-00010e30: 6861 7070 656e 2074 6861 7420 616e 2069  happen that an i
-00010e40: 6d61 6765 2074 696d 6573 7461 6d70 2064  mage timestamp d
-00010e50: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
-00010e60: 616e 7920 6669 656c 6473 2062 7574 2074  any fields but t
-00010e70: 6865 2074 696d 6573 7461 6d70 2061 6e79  he timestamp any
-00010e80: 206d 6f72 652e 2054 686f 7365 2061 7265   more. Those are
-00010e90: 2072 656d 6f76 6564 2068 6572 652e 2022   removed here. "
-00010ea0: 2222 200a 2020 2020 2020 2020 666f 7220  "" .        for 
-00010eb0: 6974 656d 2069 6e20 7365 6c66 2e69 6664  item in self.ifd
-00010ec0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00010ed0: 5365 7449 7465 6d73 4b65 795d 3a0a 2020  SetItemsKey]:.  
-00010ee0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00010ef0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00010f00: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00010f10: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-00010f20: 5b69 7465 6d5d 2c6c 6973 7429 3a0a 2020  [item],list):.  
-00010f30: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00010f40: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00010f50: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00010f60: 795d 5b69 7465 6d5d 203d 205b 7365 6c66  y][item] = [self
-00010f70: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00010f80: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-00010f90: 5b69 7465 6d5d 5d0a 2020 2020 2020 2020  [item]].        
-00010fa0: 2020 2020 746f 4265 5265 6d6f 7665 6420      toBeRemoved 
-00010fb0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00010fc0: 2066 6f72 2065 6e74 7279 2069 6e20 7365   for entry in se
-00010fd0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00010fe0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00010ff0: 795d 5b69 7465 6d5d 3a0a 2020 2020 2020  y][item]:.      
-00011000: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
-00011010: 2865 6e74 7279 290a 2020 2020 2020 2020  (entry).        
-00011020: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
-00011030: 6e74 7279 2920 3d3d 2031 2061 6e64 2027  ntry) == 1 and '
-00011040: 696d 6167 652d 6461 7465 7469 6d65 2720  image-datetime' 
-00011050: 696e 2065 6e74 7279 3a0a 2020 2020 2020  in entry:.      
-00011060: 2020 2020 2020 2020 2020 2020 2020 746f                to
-00011070: 4265 5265 6d6f 7665 642e 6170 7065 6e64  BeRemoved.append
-00011080: 2865 6e74 7279 290a 2020 2020 2020 2020  (entry).        
-00011090: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
-000110a0: 2074 6f42 6552 656d 6f76 6564 3a0a 2020   toBeRemoved:.  
-000110b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000110c0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-000110d0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-000110e0: 795d 5b69 7465 6d5d 2e72 656d 6f76 6528  y][item].remove(
-000110f0: 656e 7472 7929 200a 0a0a 2020 2020 6465  entry) ...    de
-00011100: 6620 6368 6563 6b41 6c6c 4974 656d 4861  f checkAllItemHa
-00011110: 7368 6573 2873 656c 662c 2068 6172 643d  shes(self, hard=
-00011120: 4661 6c73 652c 2072 6169 7365 4578 6365  False, raiseExce
-00011130: 7074 696f 6e20 3d20 5472 7565 293a 0a20  ption = True):. 
-00011140: 2020 2020 2020 2022 2222 200a 2020 2020         """ .    
-00011150: 2020 2020 4368 6563 6b73 2069 6620 6861      Checks if ha
-00011160: 7368 6573 2069 6e20 6946 444f 206d 6174  shes in iFDO mat
-00011170: 6368 2068 6173 6865 7320 696e 2069 6e74  ch hashes in int
-00011180: 6572 6d65 6964 6174 6520 6861 7368 2066  ermeidate hash f
-00011190: 696c 6520 6966 2074 6865 206c 6174 7465  ile if the latte
-000111a0: 7220 7761 7320 6368 616e 6765 6420 6c61  r was changed la
-000111b0: 7374 2061 6674 6572 2074 6865 2069 6d61  st after the ima
-000111c0: 6765 7320 6861 7320 6368 616e 6765 642e  ges has changed.
-000111d0: 0a20 2020 2020 2020 204f 7468 6572 7769  .        Otherwi
-000111e0: 7365 206f 7220 6966 2068 6172 643d 3d54  se or if hard==T
-000111f0: 7275 6520 6974 2072 6564 6574 6572 6d69  rue it redetermi
-00011200: 6e65 7320 7468 6520 6163 7475 616c 6c20  nes the actuall 
-00011210: 6669 6c65 2773 2068 6173 6820 616e 6420  file's hash and 
-00011220: 636f 6d70 6172 6573 2074 6865 2069 4644  compares the iFD
-00011230: 4f20 6974 656d 2773 2068 6173 6820 7769  O item's hash wi
-00011240: 7468 2074 6861 742e 0a20 2020 2020 2020  th that..       
-00011250: 2049 6620 6861 7368 6573 2064 6f20 6e6f   If hashes do no
-00011260: 7420 6d61 7463 6820 6120 6d61 7269 7174  t match a mariqt
-00011270: 2e63 6f72 652e 4966 646f 4578 6365 7074  .core.IfdoExcept
-00011280: 696f 6e20 6973 2072 6973 656e 2075 6e73  ion is risen uns
-00011290: 6c65 7373 2072 6169 7365 4578 6365 7074  less raiseExcept
-000112a0: 696f 6e20 3d3d 2046 616c 7365 2c20 7468  ion == False, th
-000112b0: 656e 2061 206c 6973 7420 6f66 206c 6973  en a list of lis
-000112c0: 7473 205b 3c66 696c 653e 2c3c 6578 6365  ts [<file>,<exce
-000112d0: 7074 696f 6e3e 5d20 6973 2072 6574 7572  ption>] is retur
-000112e0: 6e65 642e 0a20 2020 2020 2020 2022 2222  ned..        """
-000112f0: 0a20 2020 2020 2020 2068 6173 6865 7320  .        hashes 
-00011300: 3d20 7b7d 0a20 2020 2020 2020 2068 6173  = {}.        has
-00011310: 6846 696c 654d 6f64 5469 6d65 203d 2031  hFileModTime = 1
-00011320: 3065 2b31 3030 0a20 2020 2020 2020 2069  0e+100.        i
-00011330: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
-00011340: 2873 656c 662e 6765 745f 696e 745f 6861  (self.get_int_ha
-00011350: 7368 5f66 696c 6528 2929 3a0a 2020 2020  sh_file()):.    
-00011360: 2020 2020 2020 2020 6861 7368 6573 203d          hashes =
-00011370: 206d 6971 7466 2e74 6162 4669 6c65 4461   miqtf.tabFileDa
-00011380: 7461 2873 656c 662e 6765 745f 696e 745f  ta(self.get_int_
-00011390: 6861 7368 5f66 696c 6528 292c 205b 6d69  hash_file(), [mi
-000113a0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-000113b0: 6d61 7269 7174 275d 5b27 696d 6727 5d2c  mariqt']['img'],
-000113c0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-000113d0: 725b 276d 6172 6971 7427 5d5b 2768 6173  r['mariqt']['has
-000113e0: 6827 5d5d 2c20 6b65 795f 636f 6c3d 6d69  h']], key_col=mi
-000113f0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00011400: 6d61 7269 7174 275d 5b27 696d 6727 5d29  mariqt']['img'])
-00011410: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
-00011420: 6846 696c 654d 6f64 5469 6d65 203d 206f  hFileModTime = o
-00011430: 732e 7061 7468 2e67 6574 6d74 696d 6528  s.path.getmtime(
-00011440: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
-00011450: 685f 6669 6c65 2829 290a 0a20 2020 2020  h_file())..     
-00011460: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
-00011470: 203d 205b 5d0a 0a20 2020 2020 2020 2068   = []..        h
-00011480: 6173 6855 6e63 6865 636b 496d 6167 6573  ashUncheckImages
-00011490: 496e 5261 7720 3d20 7365 6c66 2e69 6d61  InRaw = self.ima
-000114a0: 6765 7349 6e49 6d61 6765 7344 6972 2829  gesInImagesDir()
-000114b0: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
-000114c0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
-000114d0: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
-000114e0: 636b 696e 6720 6974 656d 2068 6173 6865  cking item hashe
-000114f0: 7322 2c20 6c65 6e28 7365 6c66 2e69 6664  s", len(self.ifd
-00011500: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-00011510: 5365 7449 7465 6d73 4b65 795d 2929 0a20  SetItemsKey])). 
-00011520: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
-00011530: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
-00011540: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-00011550: 656d 734b 6579 5d3a 0a20 2020 2020 2020  emsKey]:.       
-00011560: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
-00011570: 7373 2829 0a0a 2020 2020 2020 2020 2020  ss()..          
-00011580: 2020 666f 756e 6420 3d20 4661 6c73 650a    found = False.
-00011590: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000115a0: 696d 6167 6520 696e 2068 6173 6855 6e63  image in hashUnc
-000115b0: 6865 636b 496d 6167 6573 496e 5261 773a  heckImagesInRaw:
-000115c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000115d0: 2066 696c 654e 616d 6520 3d20 6f73 2e70   fileName = os.p
-000115e0: 6174 682e 6261 7365 6e61 6d65 2869 6d61  ath.basename(ima
-000115f0: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
-00011600: 2020 2020 6966 2066 696c 654e 616d 6520      if fileName 
-00011610: 3d3d 2069 7465 6d3a 0a20 2020 2020 2020  == item:.       
-00011620: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-00011630: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-00011640: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00011650: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00011660: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
-00011670: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-00011680: 5b69 7465 6d5d 2c6c 6973 7429 3a20 2320  [item],list): # 
-00011690: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
-000116a0: 2077 6974 6820 6974 656d 2061 7320 6c69   with item as li
-000116b0: 7374 2074 6865 2066 6972 7374 2065 6e74  st the first ent
-000116c0: 7279 2068 6f6c 6473 2074 6865 2064 6566  ry holds the def
-000116d0: 6175 6c74 2061 6e64 2074 6865 2068 6173  ault and the has
-000116e0: 6820 6361 6e6e 6f74 2076 6172 7920 666f  h cannot vary fo
-000116f0: 7220 7468 6520 7361 6d65 2069 6d61 6765  r the same image
-00011700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011710: 2020 2020 2020 2020 2069 7465 6d45 6e74           itemEnt
-00011720: 7279 203d 2073 656c 662e 6966 646f 5f74  ry = self.ifdo_t
-00011730: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-00011740: 4974 656d 734b 6579 5d5b 6974 656d 5d5b  ItemsKey][item][
-00011750: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
-00011760: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011780: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
-00011790: 3d20 7365 6c66 2e69 6664 6f5f 746d 705b  = self.ifdo_tmp[
-000117a0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-000117b0: 6d73 4b65 795d 5b69 7465 6d5d 0a0a 2020  msKey][item]..  
-000117c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117d0: 2020 696d 6167 654d 6f64 5469 6d65 203d    imageModTime =
-000117e0: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
-000117f0: 6528 696d 6167 6529 0a20 2020 2020 2020  e(image).       
-00011800: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011810: 6e6f 7420 6861 7264 2061 6e64 2069 6d61  not hard and ima
-00011820: 6765 4d6f 6454 696d 6520 3c20 6861 7368  geModTime < hash
-00011830: 4669 6c65 4d6f 6454 696d 653a 0a20 2020  FileModTime:.   
-00011840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011850: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
-00011860: 6174 682e 6261 7365 6e61 6d65 2869 6d61  ath.basename(ima
-00011870: 6765 2920 696e 2068 6173 6865 733a 0a20  ge) in hashes:. 
-00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011890: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
-000118a0: 6973 6545 7863 6570 7469 6f6e 3a0a 2020  iseException:.  
+0000f350: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000f360: 6249 7465 6d44 6963 745b 6974 5d20 3d20  bItemDict[it] = 
+0000f370: 7375 6249 7465 6d5b 6974 5d0a 2020 2020  subItem[it].    
+0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f390: 2020 2020 696d 6167 655f 7365 745f 6974      image_set_it
+0000f3a0: 656d 735b 7375 6249 7465 6d44 6566 6175  ems[subItemDefau
+0000f3b0: 6c74 5b27 696d 6167 652d 6669 6c65 6e61  lt['image-filena
+0000f3c0: 6d65 275d 5d2e 6170 7065 6e64 2873 7562  me']].append(sub
+0000f3d0: 4974 656d 4469 6374 290a 2020 2020 2020  ItemDict).      
+0000f3e0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+0000f3f0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000f400: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
+0000f410: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+0000f420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f430: 696e 7661 6c69 645f 6974 656d 7320 2b3d  invalid_items +=
+0000f440: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0000f450: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000f460: 2e6c 6f67 2822 496e 7661 6c69 6420 696d  .log("Invalid im
+0000f470: 6167 6520 6974 656d 3a20 222b 2073 7472  age item: "+ str
+0000f480: 2869 7465 6d29 2c64 6f6e 7453 686f 773d  (item),dontShow=
+0000f490: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000f4a0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000f4b0: 726f 762e 6c6f 6728 2245 7863 6570 7469  rov.log("Excepti
+0000f4c0: 6f6e 3a5c 6e22 2b20 7374 7228 652e 6172  on:\n"+ str(e.ar
+0000f4d0: 6773 292c 646f 6e74 5368 6f77 3d54 7275  gs),dontShow=Tru
+0000f4e0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+0000f4f0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+0000f500: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+0000f510: 2822 496e 7661 6c69 6420 696d 6167 6520  ("Invalid image 
+0000f520: 6974 656d 2022 2b20 6669 6c65 5f6e 616d  item "+ file_nam
+0000f530: 6520 2b20 223a 5c6e 4578 6365 7074 696f  e + ":\nExceptio
+0000f540: 6e3a 5c6e 222b 2073 7472 2865 2e61 7267  n:\n"+ str(e.arg
+0000f550: 7329 2920 2320 6f74 6865 7277 6973 652c  s)) # otherwise,
+0000f560: 2069 6e20 6361 7365 206f 6620 6d61 6e79   in case of many
+0000f570: 2069 6d61 6765 732c 2069 7420 6d61 7920   images, it may 
+0000f580: 6b65 6570 2072 756e 6e69 6e67 2061 6e64  keep running and
+0000f590: 2074 6872 6f77 696e 6720 6572 726f 7273   throwing errors
+0000f5a0: 2066 6f72 2071 7569 7420 736f 6d65 2074   for quit some t
+0000f5b0: 696d 650a 2020 2020 2020 2020 2020 2020  ime.            
+0000f5c0: 7072 6f67 2e63 6c65 6172 2829 0a0a 2020  prog.clear()..  
+0000f5d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0000f5e0: 2869 7465 6d73 2920 213d 2030 2061 6e64  (items) != 0 and
+0000f5f0: 2069 6e76 616c 6964 5f69 7465 6d73 203d   invalid_items =
+0000f600: 3d20 6c65 6e28 6974 656d 7329 3a0a 2020  = len(items):.  
+0000f610: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000f620: 6973 6520 4578 6365 7074 696f 6e28 2241  ise Exception("A
+0000f630: 6c6c 2069 7465 6d73 2061 7265 2069 6e76  ll items are inv
+0000f640: 616c 6964 2229 0a20 2020 2020 2020 2020  alid").         
+0000f650: 2020 2065 6c69 6620 696e 7661 6c69 645f     elif invalid_
+0000f660: 6974 656d 7320 3e20 303a 0a20 2020 2020  items > 0:.     
+0000f670: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f680: 7072 6f76 2e6c 6f67 2822 4174 206c 6561  prov.log("At lea
+0000f690: 7374 2022 202b 2073 7472 2869 6e76 616c  st " + str(inval
+0000f6a0: 6964 5f69 7465 6d73 2920 2b20 2220 6974  id_items) + " it
+0000f6b0: 656d 7320 7765 7265 2069 6e76 616c 6964  ems were invalid
+0000f6c0: 2028 6f66 2220 2b20 7374 7228 6c65 6e28   (of" + str(len(
+0000f6d0: 6974 656d 7329 292b 2022 2922 290a 0a20  items))+ ")").. 
+0000f6e0: 2020 2020 2020 2023 2056 616c 6964 6174         # Validat
+0000f6f0: 6520 6865 6164 6572 2069 6e66 6f72 6d61  e header informa
+0000f700: 7469 6f6e 0a20 2020 2020 2020 2074 7279  tion.        try
+0000f710: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
+0000f720: 7174 742e 6172 655f 7661 6c69 645f 6966  qtt.are_valid_if
+0000f730: 646f 5f66 6965 6c64 7328 7365 6c66 2e69  do_fields(self.i
+0000f740: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000f750: 6765 5365 7448 6561 6465 724b 6579 5d29  geSetHeaderKey])
+0000f760: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000f770: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+0000f780: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
+0000f790: 2020 2020 2020 206d 7367 203d 2022 496e         msg = "In
+0000f7a0: 7661 6c69 6420 6865 6164 6572 2066 6965  valid header fie
+0000f7b0: 6c64 3a20 2220 2b20 7374 7228 6578 290a  ld: " + str(ex).
+0000f7c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f7d0: 2e70 726f 762e 6c6f 6728 2245 7863 6570  .prov.log("Excep
+0000f7e0: 7469 6f6e 3a20 2220 2b20 6d73 672c 2064  tion: " + msg, d
+0000f7f0: 6f6e 7453 686f 773d 5472 7565 290a 2020  ontShow=True).  
+0000f800: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000f810: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+0000f820: 696f 6e28 6d73 6729 0a0a 2020 2020 2020  ion(msg)..      
+0000f830: 2020 2320 7075 7420 6974 656d 2069 6e66    # put item inf
+0000f840: 6f20 696e 746f 2073 656c 662e 6966 646f  o into self.ifdo
+0000f850: 5f74 6d70 0a20 2020 2020 2020 2073 203d  _tmp.        s =
+0000f860: 206d 6971 7463 2e50 7269 6e74 4c6f 6164   miqtc.PrintLoad
+0000f870: 696e 674d 7367 2822 5570 6461 7469 6e67  ingMsg("Updating
+0000f880: 2229 0a20 2020 2020 2020 206c 6f67 203d  ").        log =
+0000f890: 206d 6971 7463 2e72 6563 7572 7369 7665   miqtc.recursive
+0000f8a0: 6c79 5570 6461 7465 4469 6374 7328 7365  lyUpdateDicts(se
+0000f8b0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000f8c0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+0000f8d0: 795d 2c20 696d 6167 655f 7365 745f 6974  y], image_set_it
+0000f8e0: 656d 7329 0a20 2020 2020 2020 2073 2e73  ems).        s.s
+0000f8f0: 746f 7028 290a 2020 2020 2020 2020 7365  top().        se
+0000f900: 6c66 2e70 726f 762e 6c6f 6728 6c6f 6729  lf.prov.log(log)
+0000f910: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
+0000f920: 6c61 7420 6c6f 6e20 626f 756e 6469 6e67  lat lon bounding
+0000f930: 2062 6f78 0a20 2020 2020 2020 2073 656c   box.        sel
+0000f940: 662e 5f73 6574 5f6c 6174 5f6c 6f6e 5f62  f._set_lat_lon_b
+0000f950: 6f75 6e64 696e 675f 626f 7828 7365 6c66  ounding_box(self
+0000f960: 2e69 6664 6f5f 746d 7029 0a0a 2020 2020  .ifdo_tmp)..    
+0000f970: 2020 2020 2320 7365 7420 7265 7072 6573      # set repres
+0000f980: 656e 7461 7469 7665 2068 6561 6465 7220  entative header 
+0000f990: 6669 656c 6473 2064 6174 6574 696d 652c  fields datetime,
+0000f9a0: 206c 6174 2c20 6c6f 6e2c 2061 6c74 0a20   lat, lon, alt. 
+0000f9b0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+0000f9c0: 5f72 6570 5f68 6561 6465 725f 6669 656c  _rep_header_fiel
+0000f9d0: 6473 5f64 745f 6c61 745f 6c6f 6e5f 616c  ds_dt_lat_lon_al
+0000f9e0: 7428 7365 6c66 2e69 6664 6f5f 746d 7029  t(self.ifdo_tmp)
+0000f9f0: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0000fa00: 7365 745f 696d 6167 655f 6974 656d 5f69  set_image_item_i
+0000fa10: 6465 6e74 6966 6963 6174 696f 6e5f 7363  dentification_sc
+0000fa20: 6865 6d65 2873 656c 662e 6966 646f 5f74  heme(self.ifdo_t
+0000fa30: 6d70 290a 0a20 2020 2020 2020 2023 2072  mp)..        # r
+0000fa40: 656d 6f76 6520 656d 7470 7920 6669 656c  emove emtpy fiel
+0000fa50: 6473 0a20 2020 2020 2020 2073 203d 206d  ds.        s = m
+0000fa60: 6971 7463 2e50 7269 6e74 4c6f 6164 696e  iqtc.PrintLoadin
+0000fa70: 674d 7367 2822 5265 6d6f 7669 6e67 2065  gMsg("Removing e
+0000fa80: 6d70 7479 2066 6965 6c64 7322 290a 2020  mpty fields").  
+0000fa90: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
+0000faa0: 746d 7020 3d20 6d69 7174 632e 7265 6375  tmp = miqtc.recu
+0000fab0: 7273 6976 656c 7952 656d 6f76 6545 6d70  rsivelyRemoveEmp
+0000fac0: 7479 4669 656c 6473 2873 656c 662e 6966  tyFields(self.if
+0000fad0: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
+0000fae0: 6966 206e 6f74 2073 656c 662e 696d 6167  if not self.imag
+0000faf0: 6553 6574 4974 656d 734b 6579 2069 6e20  eSetItemsKey in 
+0000fb00: 7365 6c66 2e69 6664 6f5f 746d 703a 0a20  self.ifdo_tmp:. 
+0000fb10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fb20: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000fb30: 6167 6553 6574 4974 656d 734b 6579 5d20  ageSetItemsKey] 
+0000fb40: 3d20 5b5d 0a20 2020 2020 2020 2023 2072  = [].        # r
+0000fb50: 656d 6f76 6520 6669 656c 6473 2074 6861  emove fields tha
+0000fb60: 7420 636f 6e74 6169 6e20 2769 6d61 6765  t contain 'image
+0000fb70: 2d64 6174 6574 696d 6527 206f 6e6c 790a  -datetime' only.
+0000fb80: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
+0000fb90: 6f76 6549 7465 6d46 6965 6c64 7357 6974  oveItemFieldsWit
+0000fba0: 684f 6e6c 7944 6174 6554 696d 6528 290a  hOnlyDateTime().
+0000fbb0: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+0000fbc0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+0000fbd0: 2073 656c 662e 6967 6e6f 7265 5f69 6d61   self.ignore_ima
+0000fbe0: 6765 5f66 696c 6573 3a0a 2020 2020 2020  ge_files:.      
+0000fbf0: 2020 2020 2020 7365 6c66 2e63 6865 636b        self.check
+0000fc00: 416c 6c49 7465 6d48 6173 6865 7328 290a  AllItemHashes().
+0000fc10: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+0000fc20: 2061 6761 696e 7374 2073 6368 656d 610a   against schema.
+0000fc30: 2020 2020 2020 2020 7661 6c69 642c 206d          valid, m
+0000fc40: 7367 203d 206d 6971 7474 2e76 616c 6964  sg = miqtt.valid
+0000fc50: 6174 655f 6966 646f 2873 656c 662e 6966  ate_ifdo(self.if
+0000fc60: 646f 5f74 6d70 290a 2020 2020 2020 2020  do_tmp).        
+0000fc70: 6966 206e 6f74 2076 616c 6964 2061 6e64  if not valid and
+0000fc80: 206e 6f74 2061 6c6c 6f77 5f6d 6973 7369   not allow_missi
+0000fc90: 6e67 5f72 6571 7569 7265 643a 0a20 2020  ng_required:.   
+0000fca0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000fcb0: 6f76 2e6c 6f67 2822 5761 726e 696e 6721  ov.log("Warning!
+0000fcc0: 2069 4644 4f20 6e6f 2076 616c 6964 2079   iFDO no valid y
+0000fcd0: 6574 3a20 2220 2b20 6d73 6729 0a20 2020  et: " + msg).   
+0000fce0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0000fcf0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0000fd00: 6f6e 286d 7367 290a 0a20 2020 2020 2020  on(msg)..       
+0000fd10: 2023 2073 6574 2066 696e 616c 206f 6e65   # set final one
+0000fd20: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
+0000fd30: 646f 5f63 6865 636b 6564 203d 2063 6f70  do_checked = cop
+0000fd40: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0000fd50: 6966 646f 5f74 6d70 290a 2020 2020 2020  ifdo_tmp).      
+0000fd60: 2020 7265 7475 726e 2073 656c 662e 6966    return self.if
+0000fd70: 646f 5f63 6865 636b 6564 0a0a 0a20 2020  do_checked...   
+0000fd80: 2064 6566 205f 7365 745f 696d 6167 655f   def _set_image_
+0000fd90: 6974 656d 5f69 6465 6e74 6966 6963 6174  item_identificat
+0000fda0: 696f 6e5f 7363 6865 6d65 2873 656c 662c  ion_scheme(self,
+0000fdb0: 6966 646f 3a64 6963 7429 3a0a 2020 2020  ifdo:dict):.    
+0000fdc0: 2020 2020 2222 2220 5365 7420 696d 6167      """ Set imag
+0000fdd0: 652d 6974 656d 2d69 6465 6e74 6966 6963  e-item-identific
+0000fde0: 6174 696f 6e2d 7363 6865 6d65 2074 6f20  ation-scheme to 
+0000fdf0: 6069 6d61 6765 2d70 726f 6a65 6374 5f69  `image-project_i
+0000fe00: 6d61 6765 2d65 7665 6e74 5f69 6d61 6765  mage-event_image
+0000fe10: 2d73 656e 736f 725f 696d 6167 652d 6461  -sensor_image-da
+0000fe20: 7465 7469 6d65 2e65 7874 6020 6966 2065  tetime.ext` if e
+0000fe30: 6d70 7479 2e20 2222 220a 2020 2020 2020  mpty. """.      
+0000fe40: 2020 6966 2066 696e 6446 6965 6c64 2869    if findField(i
+0000fe50: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+0000fe60: 7448 6561 6465 724b 6579 5d2c 2769 6d61  tHeaderKey],'ima
+0000fe70: 6765 2d69 7465 6d2d 6964 656e 7469 6669  ge-item-identifi
+0000fe80: 6361 7469 6f6e 2d73 6368 656d 6527 2920  cation-scheme') 
+0000fe90: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000fea0: 2020 2069 6664 6f5b 7365 6c66 2e69 6d61     ifdo[self.ima
+0000feb0: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
+0000fec0: 2769 6d61 6765 2d69 7465 6d2d 6964 656e  'image-item-iden
+0000fed0: 7469 6669 6361 7469 6f6e 2d73 6368 656d  tification-schem
+0000fee0: 6527 5d20 3d20 2027 696d 6167 652d 7072  e'] =  'image-pr
+0000fef0: 6f6a 6563 745f 696d 6167 652d 6576 656e  oject_image-even
+0000ff00: 745f 696d 6167 652d 7365 6e73 6f72 5f69  t_image-sensor_i
+0000ff10: 6d61 6765 2d64 6174 6574 696d 652e 6578  mage-datetime.ex
+0000ff20: 7427 0a0a 0a20 2020 2064 6566 205f 7365  t'...    def _se
+0000ff30: 745f 7265 705f 6865 6164 6572 5f66 6965  t_rep_header_fie
+0000ff40: 6c64 735f 6474 5f6c 6174 5f6c 6f6e 5f61  lds_dt_lat_lon_a
+0000ff50: 6c74 2873 656c 662c 6966 646f 3a64 6963  lt(self,ifdo:dic
+0000ff60: 7429 3a0a 2020 2020 2020 2020 2222 2220  t):.        """ 
+0000ff70: 4669 6c6c 2068 6561 6465 7220 6669 656c  Fill header fiel
+0000ff80: 6473 2069 6d61 6765 2d64 6174 6574 696d  ds image-datetim
+0000ff90: 6520 616e 6420 2d6c 6174 6974 7564 652c  e and -latitude,
+0000ffa0: 202d 6c6f 6e67 6974 7565 6465 2c20 2d61   -longituede, -a
+0000ffb0: 6c74 6974 7564 652d 6d65 7465 7273 2c20  ltitude-meters, 
+0000ffc0: 2d63 6f6f 7264 696e 6174 652d 756e 6365  -coordinate-unce
+0000ffd0: 7274 6169 6e74 792d 6d65 7465 7273 2c20  rtainty-meters, 
+0000ffe0: 6966 2065 6d70 7479 2c0a 2020 2020 2020  if empty,.      
+0000fff0: 2020 7265 7072 6573 656e 7461 7469 7665    representative
+00010000: 6c79 2077 6974 6820 6669 7273 7420 6974  ly with first it
+00010010: 656d 7320 656e 7472 7920 616e 6420 6d65  ems entry and me
+00010020: 6469 616e 206f 6620 616c 6c20 6974 656d  dian of all item
+00010030: 7320 7661 6c75 6573 2c20 7265 7370 6563  s values, respec
+00010040: 7469 7665 6c79 2e20 2222 220a 0a20 2020  tively. """..   
+00010050: 2020 2020 2023 2027 696d 6167 652d 6461       # 'image-da
+00010060: 7465 7469 6d65 270a 2020 2020 2020 2020  tetime'.        
+00010070: 6669 7273 745f 696d 6167 6520 3d20 736f  first_image = so
+00010080: 7274 6564 2869 6664 6f5b 7365 6c66 2e69  rted(ifdo[self.i
+00010090: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+000100a0: 2e6b 6579 7328 2929 5b30 5d0a 2020 2020  .keys())[0].    
+000100b0: 2020 2020 6669 656c 6420 3d20 2769 6d61      field = 'ima
+000100c0: 6765 2d64 6174 6574 696d 6527 0a20 2020  ge-datetime'.   
+000100d0: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
+000100e0: 6428 6966 646f 5b73 656c 662e 696d 6167  d(ifdo[self.imag
+000100f0: 6553 6574 4865 6164 6572 4b65 795d 2c66  eSetHeaderKey],f
+00010100: 6965 6c64 2920 3d3d 2022 223a 0a20 2020  ield) == "":.   
+00010110: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+00010120: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010130: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+00010140: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
+00010150: 5d20 3d20 7365 6c66 2e5f 5f67 6574 4669  ] = self.__getFi
+00010160: 656c 6456 616c 7565 2869 6664 6f2c 5b66  eldValue(ifdo,[f
+00010170: 6972 7374 5f69 6d61 6765 2c66 6965 6c64  irst_image,field
+00010180: 5d2c 6465 6661 756c 745f 6f6e 6c79 3d54  ],default_only=T
+00010190: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000101a0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+000101b0: 6f67 2822 5365 7420 7265 7072 6573 656e  og("Set represen
+000101c0: 7461 7469 7665 2068 6561 6465 7220 6669  tative header fi
+000101d0: 656c 6420 2722 202b 2066 6965 6c64 202b  eld '" + field +
+000101e0: 2022 2720 746f 2022 202b 2073 7472 2869   "' to " + str(i
+000101f0: 6664 6f5b 7365 6c66 2e69 6d61 6765 5365  fdo[self.imageSe
+00010200: 7448 6561 6465 724b 6579 5d5b 6669 656c  tHeaderKey][fiel
+00010210: 645d 2920 2b20 2220 6672 6f6d 2066 6972  d]) + " from fir
+00010220: 7374 2069 6d61 6765 2e22 290a 2020 2020  st image.").    
+00010230: 2020 2020 2020 2020 6578 6365 7074 206d          except m
+00010240: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+00010250: 6f6e 2061 7320 6578 3a0a 2020 2020 2020  on as ex:.      
+00010260: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00010270: 726f 762e 6c6f 6728 2243 6f75 6c64 206e  rov.log("Could n
+00010280: 6f74 2073 6574 2072 6570 7265 7365 6e74  ot set represent
+00010290: 6174 6976 6520 6865 6164 6572 2066 6965  ative header fie
+000102a0: 6c64 3a20 2220 2b20 7374 7228 6578 2929  ld: " + str(ex))
+000102b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000102c0: 2070 6173 730a 0a20 2020 2020 2020 2023   pass..        #
+000102d0: 2072 6573 740a 2020 2020 2020 2020 7265   rest.        re
+000102e0: 705f 6865 6164 6572 5f66 6965 6c64 735f  p_header_fields_
+000102f0: 6d65 6469 616e 203d 205b 2769 6d61 6765  median = ['image
+00010300: 2d6c 6174 6974 7564 6527 2c27 696d 6167  -latitude','imag
+00010310: 652d 6c6f 6e67 6974 7564 6527 2c27 696d  e-longitude','im
+00010320: 6167 652d 616c 7469 7475 6465 2d6d 6574  age-altitude-met
+00010330: 6572 7327 2c27 696d 6167 652d 636f 6f72  ers','image-coor
+00010340: 6469 6e61 7465 2d75 6e63 6572 7461 696e  dinate-uncertain
+00010350: 7479 2d6d 6574 6572 7327 5d0a 2020 2020  ty-meters'].    
+00010360: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
+00010370: 2072 6570 5f68 6561 6465 725f 6669 656c   rep_header_fiel
+00010380: 6473 5f6d 6564 6961 6e3a 0a20 2020 2020  ds_median:.     
+00010390: 2020 2020 2020 2069 6620 6669 6e64 4669         if findFi
+000103a0: 656c 6428 6966 646f 5b73 656c 662e 696d  eld(ifdo[self.im
+000103b0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+000103c0: 2c66 6965 6c64 2920 3d3d 2022 223a 0a20  ,field) == "":. 
+000103d0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000103e0: 616c 7565 7320 3d20 5b5d 0a20 2020 2020  alues = [].     
+000103f0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00010400: 6d61 6765 5f6e 616d 6520 696e 2069 6664  mage_name in ifd
+00010410: 6f5b 7365 6c66 2e69 6d61 6765 5365 7449  o[self.imageSetI
+00010420: 7465 6d73 4b65 795d 2e6b 6579 7328 293a  temsKey].keys():
+00010430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010440: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00010450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010460: 2020 6974 656d 5f76 616c 203d 2073 656c    item_val = sel
+00010470: 662e 5f5f 6765 7446 6965 6c64 5661 6c75  f.__getFieldValu
+00010480: 6528 6966 646f 2c5b 696d 6167 655f 6e61  e(ifdo,[image_na
+00010490: 6d65 2c66 6965 6c64 5d29 0a20 2020 2020  me,field]).     
+000104a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000104b0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+000104c0: 2869 7465 6d5f 7661 6c2c 6469 6374 293a  (item_val,dict):
+000104d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000104e0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+000104f0: 7565 7320 2b3d 206c 6973 7428 6974 656d  ues += list(item
+00010500: 5f76 616c 2e76 616c 7565 7328 2929 0a20  _val.values()). 
+00010510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010520: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010540: 2020 2020 2020 2020 2076 616c 7565 732e           values.
+00010550: 6170 7065 6e64 2869 7465 6d5f 7661 6c29  append(item_val)
+00010560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010570: 2020 2020 2065 7863 6570 7420 6d69 7174       except miqt
+00010580: 632e 4966 646f 4578 6365 7074 696f 6e20  c.IfdoException 
+00010590: 6173 2065 783a 0a20 2020 2020 2020 2020  as ex:.         
+000105a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000105b0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+000105c0: 2020 2020 7661 6c75 6573 203d 205b 6920      values = [i 
+000105d0: 666f 7220 6920 696e 2076 616c 7565 7320  for i in values 
+000105e0: 6966 2069 2021 3d20 2727 5d0a 2020 2020  if i != ''].    
+000105f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00010600: 656e 2876 616c 7565 7329 203d 3d20 303a  en(values) == 0:
+00010610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010620: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00010630: 6f67 2822 436f 756c 6420 6e6f 7420 7365  og("Could not se
+00010640: 7420 7265 7072 6573 656e 7461 7469 7665  t representative
+00010650: 2068 6561 6465 7220 6669 656c 642c 206e   header field, n
+00010660: 6f20 7661 6c75 6573 2066 6f75 6e64 3a20  o values found: 
+00010670: 2220 2b20 6669 656c 6429 0a20 2020 2020  " + field).     
+00010680: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00010690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000106a0: 2020 2020 2023 2069 676e 6f72 6520 756e       # ignore un
+000106b0: 6b6e 6f6e 772c 2069 2e65 2e20 302e 302c  knonw, i.e. 0.0,
+000106c0: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+000106d0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000106e0: 6573 203d 205b 6920 666f 7220 6920 696e  es = [i for i in
+000106f0: 2076 616c 7565 7320 6966 2069 2021 3d20   values if i != 
+00010700: 302e 305d 0a20 2020 2020 2020 2020 2020  0.0].           
+00010710: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+00010720: 7661 6c75 6573 2920 3d3d 2030 3a0a 2020  values) == 0:.  
+00010730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010740: 2020 2020 2020 7661 6c75 6573 2e61 7070        values.app
+00010750: 656e 6428 302e 3029 200a 2020 2020 2020  end(0.0) .      
+00010760: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010770: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
+00010780: 4865 6164 6572 4b65 795d 5b66 6965 6c64  HeaderKey][field
+00010790: 5d20 3d20 7374 6174 6973 7469 6373 2e6d  ] = statistics.m
+000107a0: 6564 6961 6e28 7661 6c75 6573 290a 2020  edian(values).  
+000107b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000107c0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+000107d0: 2253 6574 2072 6570 7265 7365 6e74 6174  "Set representat
+000107e0: 6976 6520 6865 6164 6572 2066 6965 6c64  ive header field
+000107f0: 2027 2220 2b20 6669 656c 6420 2b20 2227   '" + field + "'
+00010800: 2074 6f20 6d65 6469 616e 3a20 2220 2b20   to median: " + 
+00010810: 7374 7228 6966 646f 5b73 656c 662e 696d  str(ifdo[self.im
+00010820: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00010830: 5b66 6965 6c64 5d29 202b 2022 2e22 290a  [field]) + ".").
+00010840: 0a0a 2020 2020 6465 6620 5f73 6574 5f6c  ..    def _set_l
+00010850: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
+00010860: 626f 7828 7365 6c66 2c69 6664 6f3a 6469  box(self,ifdo:di
+00010870: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
+00010880: 2053 6574 2069 6d61 6765 2d73 6574 2d5b   Set image-set-[
+00010890: 6d69 6e2c 6d61 785d 2d5b 6c61 7469 7475  min,max]-[latitu
+000108a0: 6465 2c6c 6f6e 6769 7475 6465 5d2d 6465  de,longitude]-de
+000108b0: 6772 6565 7320 2222 220a 2020 2020 2020  grees """.      
+000108c0: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
+000108d0: 6178 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e  ax, lon_min, lon
+000108e0: 5f6d 6178 203d 2073 656c 662e 5f67 6574  _max = self._get
+000108f0: 5f6c 6174 5f6c 6f6e 5f62 6f75 6e64 696e  _lat_lon_boundin
+00010900: 675f 626f 7828 6966 646f 5b73 656c 662e  g_box(ifdo[self.
+00010910: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+00010920: 5d29 0a20 2020 2020 2020 2069 6620 6e6f  ]).        if no
+00010930: 7420 4e6f 6e65 2069 6e20 5b6c 6174 5f6d  t None in [lat_m
+00010940: 696e 2c20 6c61 745f 6d61 782c 206c 6f6e  in, lat_max, lon
+00010950: 5f6d 696e 2c20 6c6f 6e5f 6d61 785d 3a0a  _min, lon_max]:.
+00010960: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
+00010970: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00010980: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+00010990: 7365 742d 6d69 6e2d 6c61 7469 7475 6465  set-min-latitude
+000109a0: 2d64 6567 7265 6573 275d 203d 206c 6174  -degrees'] = lat
+000109b0: 5f6d 696e 0a20 2020 2020 2020 2020 2020  _min.           
+000109c0: 2069 6664 6f5b 7365 6c66 2e69 6d61 6765   ifdo[self.image
+000109d0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+000109e0: 6d61 6765 2d73 6574 2d6d 6178 2d6c 6174  mage-set-max-lat
+000109f0: 6974 7564 652d 6465 6772 6565 7327 5d20  itude-degrees'] 
+00010a00: 3d20 6c61 745f 6d61 780a 2020 2020 2020  = lat_max.      
+00010a10: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
+00010a20: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
+00010a30: 795d 5b27 696d 6167 652d 7365 742d 6d69  y]['image-set-mi
+00010a40: 6e2d 6c6f 6e67 6974 7564 652d 6465 6772  n-longitude-degr
+00010a50: 6565 7327 5d20 3d20 6c6f 6e5f 6d69 6e0a  ees'] = lon_min.
+00010a60: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
+00010a70: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+00010a80: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+00010a90: 7365 742d 6d61 782d 6c6f 6e67 6974 7564  set-max-longitud
+00010aa0: 652d 6465 6772 6565 7327 5d20 3d20 6c6f  e-degrees'] = lo
+00010ab0: 6e5f 6d61 780a 0a0a 2020 2020 4073 7461  n_max...    @sta
+00010ac0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
+00010ad0: 6620 5f67 6574 5f6c 6174 5f6c 6f6e 5f62  f _get_lat_lon_b
+00010ae0: 6f75 6e64 696e 675f 626f 7828 6974 656d  ounding_box(item
+00010af0: 733a 6469 6374 293a 0a20 2020 2020 2020  s:dict):.       
+00010b00: 2022 2222 2052 6574 7572 6e73 206c 6174   """ Returns lat
+00010b10: 5f6d 696e 2c20 6c61 745f 6d61 782c 206c  _min, lat_max, l
+00010b20: 6f6e 5f6d 696e 2c20 6c6f 6e5f 6d61 7820  on_min, lon_max 
+00010b30: 2222 220a 2020 2020 2020 2020 6c61 745f  """.        lat_
+00010b40: 6d69 6e2c 206c 6174 5f6d 6178 2c20 6c6f  min, lat_max, lo
+00010b50: 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178 203d  n_min, lon_max =
+00010b60: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
+00010b70: 652c 204e 6f6e 650a 2020 2020 2020 2020  e, None.        
+00010b80: 6920 3d20 300a 2020 2020 2020 2020 666f  i = 0.        fo
+00010b90: 7220 696d 6167 652c 2064 6174 6120 696e  r image, data in
+00010ba0: 2069 7465 6d73 2e69 7465 6d73 2829 3a0a   items.items():.
+00010bb0: 2020 2020 2020 2020 2020 2020 2320 6d61              # ma
+00010bc0: 6b65 2069 6d61 6765 2065 6e74 7279 206c  ke image entry l
+00010bd0: 6973 7420 2861 6c73 6f20 6966 2069 7473  ist (also if its
+00010be0: 2061 2070 6963 7475 7265 290a 2020 2020   a picture).    
+00010bf0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00010c00: 7369 6e73 7461 6e63 6528 6461 7461 2c20  sinstance(data, 
+00010c10: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
+00010c20: 2020 2020 2020 2064 6174 6120 3d20 5b64         data = [d
+00010c30: 6174 615d 0a20 2020 2020 2020 2020 2020  ata].           
+00010c40: 200a 2020 2020 2020 2020 2020 2020 666f   .            fo
+00010c50: 7220 7469 6d65 706f 696e 745f 6461 7461  r timepoint_data
+00010c60: 2069 6e20 6461 7461 3a0a 2020 2020 2020   in data:.      
+00010c70: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00010c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c90: 2020 206c 6174 203d 2074 696d 6570 6f69     lat = timepoi
+00010ca0: 6e74 5f64 6174 615b 2769 6d61 6765 2d6c  nt_data['image-l
+00010cb0: 6174 6974 7564 6527 5d0a 2020 2020 2020  atitude'].      
+00010cc0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00010cd0: 6e20 3d20 7469 6d65 706f 696e 745f 6461  n = timepoint_da
+00010ce0: 7461 5b27 696d 6167 652d 6c6f 6e67 6974  ta['image-longit
+00010cf0: 7564 6527 5d0a 2020 2020 2020 2020 2020  ude'].          
+00010d00: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00010d10: 4572 726f 7220 6173 2065 783a 0a20 2020  Error as ex:.   
+00010d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d30: 2063 6f6e 7469 6e75 650a 0a20 2020 2020   continue..     
+00010d40: 2020 2020 2020 2020 2020 2069 6620 6920             if i 
+00010d50: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00010d60: 2020 2020 2020 2020 2020 6c61 745f 6d69            lat_mi
+00010d70: 6e2c 206c 6174 5f6d 6178 203d 206c 6174  n, lat_max = lat
+00010d80: 2c20 6c61 740a 2020 2020 2020 2020 2020  , lat.          
+00010d90: 2020 2020 2020 2020 2020 6c6f 6e5f 6d69            lon_mi
+00010da0: 6e2c 206c 6f6e 5f6d 6178 203d 206c 6f6e  n, lon_max = lon
+00010db0: 2c20 6c6f 6e0a 2020 2020 2020 2020 2020  , lon.          
+00010dc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00010dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010de0: 6966 206c 6174 203c 206c 6174 5f6d 696e  if lat < lat_min
+00010df0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010e00: 2020 2020 2020 2020 2020 6c61 745f 6d69            lat_mi
+00010e10: 6e20 3d20 6c61 740a 2020 2020 2020 2020  n = lat.        
+00010e20: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00010e30: 6174 203e 206c 6174 5f6d 6178 3a0a 2020  at > lat_max:.  
+00010e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010e50: 2020 2020 2020 6c61 745f 6d61 7820 3d20        lat_max = 
+00010e60: 6c61 740a 2020 2020 2020 2020 2020 2020  lat.            
+00010e70: 2020 2020 2020 2020 6966 206c 6f6e 203c          if lon <
+00010e80: 206c 6f6e 5f6d 696e 3a0a 2020 2020 2020   lon_min:.      
+00010e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ea0: 2020 6c6f 6e5f 6d69 6e20 3d20 6c6f 6e0a    lon_min = lon.
+00010eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010ec0: 2020 2020 6966 206c 6f6e 203e 206c 6f6e      if lon > lon
+00010ed0: 5f6d 6178 3a0a 2020 2020 2020 2020 2020  _max:.          
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00010ef0: 6e5f 6d61 7820 3d20 6c6f 6e0a 2020 2020  n_max = lon.    
+00010f00: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
+00010f10: 2031 0a20 2020 2020 2020 2072 6574 7572   1.        retur
+00010f20: 6e20 6c61 745f 6d69 6e2c 206c 6174 5f6d  n lat_min, lat_m
+00010f30: 6178 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e  ax, lon_min, lon
+00010f40: 5f6d 6178 0a0a 0a20 2020 2064 6566 2072  _max...    def r
+00010f50: 656d 6f76 6549 7465 6d46 6965 6c64 7357  emoveItemFieldsW
+00010f60: 6974 684f 6e6c 7944 6174 6554 696d 6528  ithOnlyDateTime(
+00010f70: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+00010f80: 2222 2069 7420 6361 6e20 6861 7070 656e  "" it can happen
+00010f90: 2074 6861 7420 616e 2069 6d61 6765 2074   that an image t
+00010fa0: 696d 6573 7461 6d70 2064 6f65 7320 6e6f  imestamp does no
+00010fb0: 7420 636f 6e74 6169 6e20 616e 7920 6669  t contain any fi
+00010fc0: 656c 6473 2062 7574 2074 6865 2074 696d  elds but the tim
+00010fd0: 6573 7461 6d70 2061 6e79 206d 6f72 652e  estamp any more.
+00010fe0: 2054 686f 7365 2061 7265 2072 656d 6f76   Those are remov
+00010ff0: 6564 2068 6572 652e 2022 2222 200a 2020  ed here. """ .  
+00011000: 2020 2020 2020 666f 7220 6974 656d 2069        for item i
+00011010: 6e20 7365 6c66 2e69 6664 6f5f 746d 705b  n self.ifdo_tmp[
+00011020: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+00011030: 6d73 4b65 795d 3a0a 2020 2020 2020 2020  msKey]:.        
+00011040: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+00011050: 7461 6e63 6528 7365 6c66 2e69 6664 6f5f  tance(self.ifdo_
+00011060: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+00011070: 7449 7465 6d73 4b65 795d 5b69 7465 6d5d  tItemsKey][item]
+00011080: 2c6c 6973 7429 3a0a 2020 2020 2020 2020  ,list):.        
+00011090: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+000110a0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+000110b0: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
+000110c0: 6d5d 203d 205b 7365 6c66 2e69 6664 6f5f  m] = [self.ifdo_
+000110d0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+000110e0: 7449 7465 6d73 4b65 795d 5b69 7465 6d5d  tItemsKey][item]
+000110f0: 5d0a 2020 2020 2020 2020 2020 2020 746f  ].            to
+00011100: 4265 5265 6d6f 7665 6420 3d20 5b5d 0a20  BeRemoved = []. 
+00011110: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
+00011120: 6e74 7279 2069 6e20 7365 6c66 2e69 6664  ntry in self.ifd
+00011130: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00011140: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
+00011150: 6d5d 3a0a 2020 2020 2020 2020 2020 2020  m]:.            
+00011160: 2020 2020 2370 7269 6e74 2865 6e74 7279      #print(entry
+00011170: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011180: 2020 6966 206c 656e 2865 6e74 7279 2920    if len(entry) 
+00011190: 3d3d 2031 2061 6e64 2027 696d 6167 652d  == 1 and 'image-
+000111a0: 6461 7465 7469 6d65 2720 696e 2065 6e74  datetime' in ent
+000111b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000111c0: 2020 2020 2020 2020 746f 4265 5265 6d6f          toBeRemo
+000111d0: 7665 642e 6170 7065 6e64 2865 6e74 7279  ved.append(entry
+000111e0: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
+000111f0: 7220 656e 7472 7920 696e 2074 6f42 6552  r entry in toBeR
+00011200: 656d 6f76 6564 3a0a 2020 2020 2020 2020  emoved:.        
+00011210: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+00011220: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00011230: 5365 7449 7465 6d73 4b65 795d 5b69 7465  SetItemsKey][ite
+00011240: 6d5d 2e72 656d 6f76 6528 656e 7472 7929  m].remove(entry)
+00011250: 200a 0a0a 2020 2020 6465 6620 6368 6563   ...    def chec
+00011260: 6b41 6c6c 4974 656d 4861 7368 6573 2873  kAllItemHashes(s
+00011270: 656c 662c 2068 6172 643d 4661 6c73 652c  elf, hard=False,
+00011280: 2072 6169 7365 4578 6365 7074 696f 6e20   raiseException 
+00011290: 3d20 5472 7565 293a 0a20 2020 2020 2020  = True):.       
+000112a0: 2022 2222 200a 2020 2020 2020 2020 4368   """ .        Ch
+000112b0: 6563 6b73 2069 6620 6861 7368 6573 2069  ecks if hashes i
+000112c0: 6e20 6946 444f 206d 6174 6368 2068 6173  n iFDO match has
+000112d0: 6865 7320 696e 2069 6e74 6572 6d65 6964  hes in intermeid
+000112e0: 6174 6520 6861 7368 2066 696c 6520 6966  ate hash file if
+000112f0: 2074 6865 206c 6174 7465 7220 7761 7320   the latter was 
+00011300: 6368 616e 6765 6420 6c61 7374 2061 6674  changed last aft
+00011310: 6572 2074 6865 2069 6d61 6765 7320 6861  er the images ha
+00011320: 7320 6368 616e 6765 642e 0a20 2020 2020  s changed..     
+00011330: 2020 204f 7468 6572 7769 7365 206f 7220     Otherwise or 
+00011340: 6966 2068 6172 643d 3d54 7275 6520 6974  if hard==True it
+00011350: 2072 6564 6574 6572 6d69 6e65 7320 7468   redetermines th
+00011360: 6520 6163 7475 616c 6c20 6669 6c65 2773  e actuall file's
+00011370: 2068 6173 6820 616e 6420 636f 6d70 6172   hash and compar
+00011380: 6573 2074 6865 2069 4644 4f20 6974 656d  es the iFDO item
+00011390: 2773 2068 6173 6820 7769 7468 2074 6861  's hash with tha
+000113a0: 742e 0a20 2020 2020 2020 2049 6620 6861  t..        If ha
+000113b0: 7368 6573 2064 6f20 6e6f 7420 6d61 7463  shes do not matc
+000113c0: 6820 6120 6d61 7269 7174 2e63 6f72 652e  h a mariqt.core.
+000113d0: 4966 646f 4578 6365 7074 696f 6e20 6973  IfdoException is
+000113e0: 2072 6973 656e 2075 6e73 6c65 7373 2072   risen unsless r
+000113f0: 6169 7365 4578 6365 7074 696f 6e20 3d3d  aiseException ==
+00011400: 2046 616c 7365 2c20 7468 656e 2061 206c   False, then a l
+00011410: 6973 7420 6f66 206c 6973 7473 205b 3c66  ist of lists [<f
+00011420: 696c 653e 2c3c 6578 6365 7074 696f 6e3e  ile>,<exception>
+00011430: 5d20 6973 2072 6574 7572 6e65 642e 0a20  ] is returned.. 
+00011440: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00011450: 2020 2068 6173 6865 7320 3d20 7b7d 0a20     hashes = {}. 
+00011460: 2020 2020 2020 2068 6173 6846 696c 654d         hashFileM
+00011470: 6f64 5469 6d65 203d 2031 3065 2b31 3030  odTime = 10e+100
+00011480: 0a20 2020 2020 2020 2069 6620 6f73 2e70  .        if os.p
+00011490: 6174 682e 6578 6973 7473 2873 656c 662e  ath.exists(self.
+000114a0: 6765 745f 696e 745f 6861 7368 5f66 696c  get_int_hash_fil
+000114b0: 6528 2929 3a0a 2020 2020 2020 2020 2020  e()):.          
+000114c0: 2020 6861 7368 6573 203d 206d 6971 7466    hashes = miqtf
+000114d0: 2e74 6162 4669 6c65 4461 7461 2873 656c  .tabFileData(sel
+000114e0: 662e 6765 745f 696e 745f 6861 7368 5f66  f.get_int_hash_f
+000114f0: 696c 6528 292c 205b 6d69 7174 762e 636f  ile(), [miqtv.co
+00011500: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00011510: 275d 5b27 696d 6727 5d2c 206d 6971 7476  ']['img'], miqtv
+00011520: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00011530: 6971 7427 5d5b 2768 6173 6827 5d5d 2c20  iqt']['hash']], 
+00011540: 6b65 795f 636f 6c3d 6d69 7174 762e 636f  key_col=miqtv.co
+00011550: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00011560: 275d 5b27 696d 6727 5d29 0a20 2020 2020  ']['img']).     
+00011570: 2020 2020 2020 2068 6173 6846 696c 654d         hashFileM
+00011580: 6f64 5469 6d65 203d 206f 732e 7061 7468  odTime = os.path
+00011590: 2e67 6574 6d74 696d 6528 7365 6c66 2e67  .getmtime(self.g
+000115a0: 6574 5f69 6e74 5f68 6173 685f 6669 6c65  et_int_hash_file
+000115b0: 2829 290a 0a20 2020 2020 2020 2065 7863  ())..        exc
+000115c0: 6570 7469 6f6e 4c69 7374 203d 205b 5d0a  eptionList = [].
+000115d0: 0a20 2020 2020 2020 2068 6173 6855 6e63  .        hashUnc
+000115e0: 6865 636b 496d 6167 6573 496e 5261 7720  heckImagesInRaw 
+000115f0: 3d20 7365 6c66 2e69 6d61 6765 7349 6e49  = self.imagesInI
+00011600: 6d61 6765 7344 6972 2829 0a20 2020 2020  magesDir().     
+00011610: 2020 2070 726f 6720 3d20 6d69 7174 632e     prog = miqtc.
+00011620: 5072 696e 744b 6e6f 776e 5072 6f67 7265  PrintKnownProgre
+00011630: 7373 4d73 6728 2243 6865 636b 696e 6720  ssMsg("Checking 
+00011640: 6974 656d 2068 6173 6865 7322 2c20 6c65  item hashes", le
+00011650: 6e28 7365 6c66 2e69 6664 6f5f 746d 705b  n(self.ifdo_tmp[
+00011660: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+00011670: 6d73 4b65 795d 2929 0a20 2020 2020 2020  msKey])).       
+00011680: 2066 6f72 2069 7465 6d20 696e 2073 656c   for item in sel
+00011690: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+000116a0: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+000116b0: 5d3a 0a20 2020 2020 2020 2020 2020 2070  ]:.            p
+000116c0: 726f 672e 7072 6f67 7265 7373 2829 0a0a  rog.progress()..
+000116d0: 2020 2020 2020 2020 2020 2020 666f 756e              foun
+000116e0: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+000116f0: 2020 2020 2020 666f 7220 696d 6167 6520        for image 
+00011700: 696e 2068 6173 6855 6e63 6865 636b 496d  in hashUncheckIm
+00011710: 6167 6573 496e 5261 773a 0a20 2020 2020  agesInRaw:.     
+00011720: 2020 2020 2020 2020 2020 2066 696c 654e             fileN
+00011730: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+00011740: 7365 6e61 6d65 2869 6d61 6765 290a 2020  sename(image).  
+00011750: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011760: 2066 696c 654e 616d 6520 3d3d 2069 7465   fileName == ite
+00011770: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+00011780: 2020 2020 2020 2066 6f75 6e64 203d 2054         found = T
+00011790: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+000117a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000117b0: 7461 6e63 6528 7365 6c66 2e69 6664 6f5f  tance(self.ifdo_
+000117c0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+000117d0: 7449 7465 6d73 4b65 795d 5b69 7465 6d5d  tItemsKey][item]
+000117e0: 2c6c 6973 7429 3a20 2320 696e 2063 6173  ,list): # in cas
+000117f0: 6520 6f66 2076 6964 656f 2077 6974 6820  e of video with 
+00011800: 6974 656d 2061 7320 6c69 7374 2074 6865  item as list the
+00011810: 2066 6972 7374 2065 6e74 7279 2068 6f6c   first entry hol
+00011820: 6473 2074 6865 2064 6566 6175 6c74 2061  ds the default a
+00011830: 6e64 2074 6865 2068 6173 6820 6361 6e6e  nd the hash cann
+00011840: 6f74 2076 6172 7920 666f 7220 7468 6520  ot vary for the 
+00011850: 7361 6d65 2069 6d61 6765 0a20 2020 2020  same image.     
+00011860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011870: 2020 2069 7465 6d45 6e74 7279 203d 2073     itemEntry = s
+00011880: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00011890: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+000118a0: 6579 5d5b 6974 656d 5d5b 305d 200a 2020  ey][item][0] .  
 000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000118d0: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
-000118e0: 6365 7074 696f 6e28 6974 656d 2c20 226e  ception(item, "n
-000118f0: 6f74 2066 6f75 6e64 2069 6e20 696e 7465  ot found in inte
-00011900: 726d 6569 6461 7465 2068 6173 6820 6669  rmeidate hash fi
-00011910: 6c65 222c 7365 6c66 2e67 6574 5f69 6e74  le",self.get_int
-00011920: 5f68 6173 685f 6669 6c65 2829 2c22 2072  _hash_file()," r
-00011930: 756e 2063 7265 6174 655f 696d 6167 655f  un create_image_
-00011940: 7368 6132 3536 5f66 696c 6528 2920 6669  sha256_file() fi
-00011950: 7273 7422 2920 0a20 2020 2020 2020 2020  rst") .         
-00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011970: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011990: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
-000119a0: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
-000119b0: 696c 654e 616d 652c 226e 6f74 2066 6f75  ileName,"not fou
-000119c0: 6e64 2069 6e20 696e 7465 726d 6569 6461  nd in intermeida
-000119d0: 7465 2068 6173 6820 6669 6c65 2022 202b  te hash file " +
-000119e0: 2073 7472 2873 656c 662e 6765 745f 696e   str(self.get_in
-000119f0: 745f 6861 7368 5f66 696c 6528 2929 5d29  t_hash_file())])
-00011a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a10: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00011a20: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-00011a30: 2d68 6173 682d 7368 6132 3536 275d 203d  -hash-sha256'] =
-00011a40: 3d20 6861 7368 6573 5b6f 732e 7061 7468  = hashes[os.path
-00011a50: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
-00011a60: 5d5b 2769 6d61 6765 2d68 6173 682d 7368  ]['image-hash-sh
-00011a70: 6132 3536 275d 3a0a 2020 2020 2020 2020  a256']:.        
-00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a90: 2020 2020 6966 2072 6169 7365 4578 6365      if raiseExce
-00011aa0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-00011ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ac0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-00011ad0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-00011ae0: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
-00011af0: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
-00011b00: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
-00011b10: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
-00011b20: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
-00011b30: 6d65 2c22 2072 756e 2063 7265 6174 655f  me," run create_
-00011b40: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
-00011b50: 6528 2920 6669 7273 7422 290a 2020 2020  e() first").    
+000118c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000118d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118e0: 6974 656d 456e 7472 7920 3d20 7365 6c66  itemEntry = self
+000118f0: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00011900: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00011910: 5b69 7465 6d5d 0a0a 2020 2020 2020 2020  [item]..        
+00011920: 2020 2020 2020 2020 2020 2020 696d 6167              imag
+00011930: 654d 6f64 5469 6d65 203d 206f 732e 7061  eModTime = os.pa
+00011940: 7468 2e67 6574 6d74 696d 6528 696d 6167  th.getmtime(imag
+00011950: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00011960: 2020 2020 2020 2069 6620 6e6f 7420 6861         if not ha
+00011970: 7264 2061 6e64 2069 6d61 6765 4d6f 6454  rd and imageModT
+00011980: 696d 6520 3c20 6861 7368 4669 6c65 4d6f  ime < hashFileMo
+00011990: 6454 696d 653a 0a20 2020 2020 2020 2020  dTime:.         
+000119a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000119b0: 6620 6e6f 7420 6f73 2e70 6174 682e 6261  f not os.path.ba
+000119c0: 7365 6e61 6d65 2869 6d61 6765 2920 696e  sename(image) in
+000119d0: 2068 6173 6865 733a 0a20 2020 2020 2020   hashes:.       
+000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119f0: 2020 2020 2069 6620 7261 6973 6545 7863       if raiseExc
+00011a00: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00011a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a20: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+00011a30: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+00011a40: 6e28 6974 656d 2c20 226e 6f74 2066 6f75  n(item, "not fou
+00011a50: 6e64 2069 6e20 696e 7465 726d 6569 6461  nd in intermeida
+00011a60: 7465 2068 6173 6820 6669 6c65 222c 7365  te hash file",se
+00011a70: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
+00011a80: 6669 6c65 2829 2c22 2072 756e 2063 7265  file()," run cre
+00011a90: 6174 655f 696d 6167 655f 7368 6132 3536  ate_image_sha256
+00011aa0: 5f66 696c 6528 2920 6669 7273 7422 2920  _file() first") 
+00011ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011ac0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00011ad0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00011ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011af0: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
+00011b00: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
+00011b10: 652c 226e 6f74 2066 6f75 6e64 2069 6e20  e,"not found in 
+00011b20: 696e 7465 726d 6569 6461 7465 2068 6173  intermeidate has
+00011b30: 6820 6669 6c65 2022 202b 2073 7472 2873  h file " + str(s
+00011b40: 656c 662e 6765 745f 696e 745f 6861 7368  elf.get_int_hash
+00011b50: 5f66 696c 6528 2929 5d29 0a20 2020 2020  _file())]).     
 00011b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00011b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011b90: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00011ba0: 6365 7074 696f 6e4c 6973 742e 6170 7065  ceptionList.appe
-00011bb0: 6e64 285b 6669 6c65 4e61 6d65 2c22 696e  nd([fileName,"in
-00011bc0: 636f 7272 6563 7420 7368 6132 3536 2068  correct sha256 h
-00011bd0: 6173 6822 5d29 0a20 2020 2020 2020 2020  ash"]).         
-00011be0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00011bf0: 6e6f 7420 6974 656d 456e 7472 795b 2769  not itemEntry['i
-00011c00: 6d61 6765 2d68 6173 682d 7368 6132 3536  mage-hash-sha256
-00011c10: 275d 203d 3d20 6d69 7174 632e 7368 6132  '] == miqtc.sha2
-00011c20: 3536 4861 7368 4669 6c65 2869 6d61 6765  56HashFile(image
-00011c30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00011c40: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
-00011c50: 6973 6545 7863 6570 7469 6f6e 3a0a 2020  iseException:.  
-00011c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00011c80: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-00011c90: 696f 6e28 6974 656d 2c20 2269 6e63 6f72  ion(item, "incor
-00011ca0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
-00011cb0: 222c 2069 7465 6d45 6e74 7279 5b27 696d  ", itemEntry['im
-00011cc0: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
-00011cd0: 5d2c 2266 6f72 2066 696c 6522 2c66 696c  ],"for file",fil
-00011ce0: 654e 616d 652c 2220 7275 6e20 6372 6561  eName," run crea
-00011cf0: 7465 5f69 6d61 6765 5f73 6861 3235 365f  te_image_sha256_
-00011d00: 6669 6c65 2829 2066 6972 7374 2229 0a20  file() first"). 
-00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00011d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011d40: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
-00011d50: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
-00011d60: 696c 654e 616d 652c 2269 6e63 6f72 7265  ileName,"incorre
-00011d70: 6374 2073 6861 3235 3620 6861 7368 225d  ct sha256 hash"]
-00011d80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00011d90: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-00011da0: 2020 2020 2020 2020 6966 2066 6f75 6e64          if found
-00011db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011dc0: 2020 6465 6c20 6861 7368 556e 6368 6563    del hashUnchec
-00011dd0: 6b49 6d61 6765 7349 6e52 6177 5b69 6d61  kImagesInRaw[ima
-00011de0: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
-00011df0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00011e00: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
-00011e10: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00011e20: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-00011e30: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-00011e40: 6570 7469 6f6e 2820 2269 6d61 6765 222c  eption( "image",
-00011e50: 2069 7465 6d2c 2022 6e6f 7420 666f 756e   item, "not foun
-00011e60: 6420 696e 2064 6972 6563 746f 7279 2773  d in directory's
-00011e70: 2072 6177 2066 6f6c 6465 7221 2229 0a20   raw folder!"). 
-00011e80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00011e90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00011ea0: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
-00011eb0: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
-00011ec0: 696c 654e 616d 652c 2266 696c 6520 6e6f  ileName,"file no
-00011ed0: 7420 666f 756e 6422 5d29 0a20 2020 2020  t found"]).     
-00011ee0: 2020 2070 726f 672e 636c 6561 7228 290a     prog.clear().
-00011ef0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-00011f00: 6169 7365 4578 6365 7074 696f 6e3a 0a20  aiseException:. 
-00011f10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011f20: 6e20 6578 6365 7074 696f 6e4c 6973 740a  n exceptionList.
-00011f30: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00011f40: 5f75 7569 645f 6669 6c65 2873 656c 662c  _uuid_file(self,
-00011f50: 636c 6561 6e3d 5472 7565 293a 0a20 2020  clean=True):.   
-00011f60: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
-00011f70: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
-00011f80: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
-00011f90: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
-00011fa0: 6765 2061 2063 7265 6174 6564 2075 7569  ge a created uui
-00011fb0: 6420 2876 6572 7369 6f6e 2034 292e 0a0a  d (version 4)...
-00011fc0: 2020 2020 2020 2020 5468 6520 5555 4944          The UUID
-00011fd0: 2069 7320 6f6e 6c79 202a 7461 6b65 6e2a   is only *taken*
-00011fe0: 2066 726f 6d20 7468 6520 6d65 7461 6461   from the metada
-00011ff0: 7461 206f 6620 7468 6520 696d 6167 6573  ta of the images
-00012000: 2e20 4974 2064 6f65 7320 6e6f 7420 7772  . It does not wr
-00012010: 6974 6520 5555 4944 7320 746f 2074 6865  ite UUIDs to the
-00012020: 206d 6574 6164 6174 6120 696e 2063 6173   metadata in cas
-00012030: 6520 736f 6d65 2066 696c 6573 2061 7265  e some files are
-00012040: 206d 6973 7369 6e67 2069 742e 0a20 2020   missing it..   
-00012050: 2020 2020 2042 7574 2c20 6974 2063 7265       But, it cre
-00012060: 6174 6573 2061 2043 5356 2066 696c 6520  ates a CSV file 
-00012070: 696e 2074 6861 7420 6361 7365 2074 6861  in that case tha
-00012080: 7420 796f 7520 6361 6e20 7573 6520 746f  t you can use to
-00012090: 6765 7468 6572 2077 6974 6820 6578 6966  gether with exif
-000120a0: 746f 6f6c 2074 6f20 6164 6420 7468 6520  tool to add the 
-000120b0: 5555 4944 2074 6f20 796f 7572 2064 6174  UUID to your dat
-000120c0: 612e 2042 6577 6172 6521 2074 6869 7320  a. Beware! this 
-000120d0: 6361 6e20 6465 7374 726f 7920 796f 7572  can destroy your
-000120e0: 2069 6d61 6765 730a 2020 2020 2020 2020   images.        
-000120f0: 6966 206e 6f74 2064 6f6e 6520 7072 6f70  if not done prop
-00012100: 6572 6c79 2120 4e6f 2067 7561 7261 6e74  erly! No guarant
-00012110: 6565 2069 7320 6769 7665 6e20 6974 2077  ee is given it w
-00012120: 696c 6c20 776f 726b 2e20 4265 2063 6172  ill work. Be car
-00012130: 6566 756c 210a 0a20 2020 2020 2020 2055  eful!..        U
-00012140: 7365 2063 6c65 616e 3d46 616c 7365 2074  se clean=False t
-00012150: 6f20 6e6f 7420 6368 6563 6b20 7468 6f73  o not check thos
-00012160: 6520 6669 6c65 7320 6167 6169 6e20 7768  e files again wh
-00012170: 6963 6820 6172 6520 616c 7265 6164 7920  ich are already 
-00012180: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
-00012190: 6469 6174 6520 7575 6964 2066 696c 650a  diate uuid file.
-000121a0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-000121b0: 2020 2020 2075 7569 6473 203d 207b 7d0a       uuids = {}.
-000121c0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
-000121d0: 7768 6574 6865 7220 6120 6669 6c65 2077  whether a file w
-000121e0: 6974 6820 5555 4944 7320 6578 6973 7473  ith UUIDs exists
-000121f0: 2c20 7468 656e 2072 6561 6420 6974 0a20  , then read it. 
-00012200: 2020 2020 2020 2069 6620 6e6f 7420 636c         if not cl
-00012210: 6561 6e20 616e 6420 6f73 2e70 6174 682e  ean and os.path.
-00012220: 6578 6973 7473 2873 656c 662e 6765 745f  exists(self.get_
-00012230: 696e 745f 7575 6964 5f66 696c 6528 2929  int_uuid_file())
-00012240: 3a0a 2020 2020 2020 2020 2020 2020 7575  :.            uu
-00012250: 6964 7320 3d20 6d69 7174 662e 7461 6246  ids = miqtf.tabF
-00012260: 696c 6544 6174 6128 7365 6c66 2e67 6574  ileData(self.get
-00012270: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
-00012280: 2c20 5b6d 6971 7476 2e63 6f6c 5f68 6561  , [miqtv.col_hea
-00012290: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-000122a0: 6d67 275d 2c20 6d69 7174 762e 636f 6c5f  mg'], miqtv.col_
-000122b0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000122c0: 5b27 7575 6964 275d 5d2c 206b 6579 5f63  ['uuid']], key_c
-000122d0: 6f6c 3d6d 6971 7476 2e63 6f6c 5f68 6561  ol=miqtv.col_hea
-000122e0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-000122f0: 6d67 275d 290a 2020 2020 2020 2020 2020  mg']).          
-00012300: 2020 0a20 2020 2020 2020 2069 6620 6f73    .        if os
-00012310: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-00012320: 662e 696d 6167 6573 4469 7229 3a0a 0a20  f.imagesDir):.. 
-00012330: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-00012340: 6e67 5f75 7569 6473 203d 207b 7d0a 2020  ng_uuids = {}.  
-00012350: 2020 2020 2020 2020 2020 6164 6465 645f            added_
-00012360: 7575 6964 7320 3d20 300a 0a20 2020 2020  uuids = 0..     
-00012370: 2020 2020 2020 2075 6e6b 6e6f 776e 4669         unknownFi
-00012380: 6c65 7320 3d20 5b5d 0a20 2020 2020 2020  les = [].       
-00012390: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-000123a0: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
-000123b0: 6167 6573 4469 7228 293a 0a20 2020 2020  agesDir():.     
-000123c0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
-000123d0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
-000123e0: 6173 656e 616d 6528 6669 6c65 290a 2020  asename(file).  
-000123f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00012400: 2066 696c 655f 6e61 6d65 206e 6f74 2069   file_name not i
-00012410: 6e20 7575 6964 733a 0a20 2020 2020 2020  n uuids:.       
-00012420: 2020 2020 2020 2020 2020 2020 2075 6e6b               unk
-00012430: 6e6f 776e 4669 6c65 732e 6170 7065 6e64  nownFiles.append
-00012440: 2866 696c 6529 0a20 2020 2020 2020 2020  (file).         
-00012450: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00012460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012470: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
-00012480: 5d20 3d20 7575 6964 735b 6669 6c65 5f6e  ] = uuids[file_n
-00012490: 616d 655d 5b6d 6971 7476 2e63 6f6c 5f68  ame][miqtv.col_h
-000124a0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-000124b0: 2775 7569 6427 5d5d 0a0a 2020 2020 2020  'uuid']]..      
-000124c0: 2020 2020 2020 756e 6b6e 6f77 6e46 696c        unknownFil
-000124d0: 6573 5555 4944 7320 3d20 6d69 7174 692e  esUUIDs = miqti.
-000124e0: 696d 6167 6573 436f 6e74 6169 6e56 616c  imagesContainVal
-000124f0: 6964 5555 4944 2875 6e6b 6e6f 776e 4669  idUUID(unknownFi
-00012500: 6c65 7329 0a20 2020 2020 2020 2020 2020  les).           
-00012510: 2066 6f72 2066 696c 6520 696e 2075 6e6b   for file in unk
-00012520: 6e6f 776e 4669 6c65 7355 5549 4473 3a0a  nownFilesUUIDs:.
-00012530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012540: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
-00012550: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
-00012560: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00012570: 2020 2069 6620 6e6f 7420 756e 6b6e 6f77     if not unknow
-00012580: 6e46 696c 6573 5555 4944 735b 6669 6c65  nFilesUUIDs[file
-00012590: 5d5b 2776 616c 6964 275d 3a0a 2020 2020  ]['valid']:.    
-000125a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000125b0: 7575 6964 203d 206d 6971 7463 2e75 7569  uuid = miqtc.uui
-000125c0: 6434 2829 0a20 2020 2020 2020 2020 2020  d4().           
-000125d0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
-000125e0: 5f75 7569 6473 5b66 696c 655d 203d 2075  _uuids[file] = u
-000125f0: 7569 640a 2020 2020 2020 2020 2020 2020  uid.            
-00012600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00012610: 2020 2020 2020 2020 2020 2020 2020 7575                uu
-00012620: 6964 735b 6669 6c65 5f6e 616d 655d 203d  ids[file_name] =
-00012630: 2075 6e6b 6e6f 776e 4669 6c65 7355 5549   unknownFilesUUI
-00012640: 4473 5b66 696c 655d 5b27 7575 6964 275d  Ds[file]['uuid']
-00012650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012660: 2020 2020 2061 6464 6564 5f75 7569 6473       added_uuids
-00012670: 202b 3d20 310a 0a20 2020 2020 2020 2020   += 1..         
-00012680: 2020 2023 2049 6620 7072 6576 696f 7573     # If previous
-00012690: 6c79 2075 6e6b 6e6f 776e 2055 5549 4473  ly unknown UUIDs
-000126a0: 2077 6572 6520 666f 756e 6420 696e 2074   were found in t
-000126b0: 6865 2066 696c 6520 6865 6164 6572 732c  he file headers,
-000126c0: 2061 6464 2074 6865 6d20 746f 2074 6865   add them to the
-000126d0: 2055 5549 4420 6669 6c65 0a20 2020 2020   UUID file.     
-000126e0: 2020 2020 2020 2069 6620 6164 6465 645f         if added_
-000126f0: 7575 6964 7320 3e20 303a 0a20 2020 2020  uuids > 0:.     
-00012700: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00012710: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
-00012720: 6e74 5f75 7569 645f 6669 6c65 2829 2c20  nt_uuid_file(), 
-00012730: 2277 2229 0a20 2020 2020 2020 2020 2020  "w").           
-00012740: 2020 2020 2072 6573 2e77 7269 7465 286d       res.write(m
-00012750: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00012760: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
-00012770: 202b 225c 7422 2b6d 6971 7476 2e63 6f6c   +"\t"+miqtv.col
-00012780: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00012790: 5d5b 2775 7569 6427 5d2b 225c 6e22 290a  ]['uuid']+"\n").
-000127a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127b0: 666f 7220 6669 6c65 2069 6e20 7575 6964  for file in uuid
-000127c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-000127d0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000127e0: 2866 696c 652b 225c 7422 2b73 7472 2875  (file+"\t"+str(u
-000127f0: 7569 6473 5b66 696c 655d 292b 225c 6e22  uids[file])+"\n"
-00012800: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012810: 2020 7265 732e 636c 6f73 6528 290a 0a20    res.close().. 
-00012820: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00012830: 6e28 6d69 7373 696e 675f 7575 6964 7329  n(missing_uuids)
-00012840: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-00012850: 2020 2020 2020 6563 7376 5f70 6174 6820        ecsv_path 
-00012860: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
-00012870: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
-00012880: 2022 5f65 7869 662d 6164 642d 7575 6964   "_exif-add-uuid
-00012890: 2e63 7376 220a 2020 2020 2020 2020 2020  .csv".          
-000128a0: 2020 2020 2020 6373 7620 3d20 6f70 656e        csv = open
-000128b0: 2865 6373 765f 7061 7468 2c20 2277 2229  (ecsv_path, "w")
-000128c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000128d0: 2063 7376 2e77 7269 7465 286d 6971 7476   csv.write(miqtv
-000128e0: 2e63 6f6c 5f68 6561 6465 725b 2765 7869  .col_header['exi
-000128f0: 6627 5d5b 2769 6d67 275d 202b 0a20 2020  f']['img'] +.   
-00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012910: 2020 2020 2020 2022 2c22 2b6d 6971 7476         ","+miqtv
-00012920: 2e63 6f6c 5f68 6561 6465 725b 2765 7869  .col_header['exi
-00012930: 6627 5d5b 2775 7569 6427 5d2b 225c 6e22  f']['uuid']+"\n"
-00012940: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012950: 2020 6469 6666 6572 656e 745f 7061 7468    different_path
-00012960: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-00012970: 2020 2020 2020 2066 6f72 2069 6d67 2069         for img i
-00012980: 6e20 6d69 7373 696e 675f 7575 6964 733a  n missing_uuids:
-00012990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000129a0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-000129b0: 6261 7365 6e61 6d65 2869 6d67 2920 6e6f  basename(img) no
-000129c0: 7420 696e 2064 6966 6665 7265 6e74 5f70  t in different_p
-000129d0: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
-000129e0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-000129f0: 6666 6572 656e 745f 7061 7468 732e 6170  fferent_paths.ap
-00012a00: 7065 6e64 286f 732e 7061 7468 2e62 6173  pend(os.path.bas
-00012a10: 656e 616d 6528 696d 6729 290a 2020 2020  ename(img)).    
-00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a30: 6373 762e 7772 6974 6528 696d 672b 222c  csv.write(img+",
-00012a40: 222b 7374 7228 6d69 7373 696e 675f 7575  "+str(missing_uu
-00012a50: 6964 735b 696d 675d 292b 225c 6e22 290a  ids[img])+"\n").
+00011b70: 2020 2069 6620 6e6f 7420 6974 656d 456e     if not itemEn
+00011b80: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
+00011b90: 7368 6132 3536 275d 203d 3d20 6861 7368  sha256'] == hash
+00011ba0: 6573 5b6f 732e 7061 7468 2e62 6173 656e  es[os.path.basen
+00011bb0: 616d 6528 696d 6167 6529 5d5b 2769 6d61  ame(image)]['ima
+00011bc0: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
+00011bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011be0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011bf0: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
+00011c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c20: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
+00011c30: 6f45 7863 6570 7469 6f6e 2869 7465 6d2c  oException(item,
+00011c40: 2022 696e 636f 7272 6563 7420 7368 6132   "incorrect sha2
+00011c50: 3536 2068 6173 6822 2c20 6974 656d 456e  56 hash", itemEn
+00011c60: 7472 795b 2769 6d61 6765 2d68 6173 682d  try['image-hash-
+00011c70: 7368 6132 3536 275d 2c22 666f 7220 6669  sha256'],"for fi
+00011c80: 6c65 222c 6669 6c65 4e61 6d65 2c22 2072  le",fileName," r
+00011c90: 756e 2063 7265 6174 655f 696d 6167 655f  un create_image_
+00011ca0: 7368 6132 3536 5f66 696c 6528 2920 6669  sha256_file() fi
+00011cb0: 7273 7422 290a 2020 2020 2020 2020 2020  rst").          
+00011cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cd0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00011ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011cf0: 2020 2020 2020 2020 6578 6365 7074 696f          exceptio
+00011d00: 6e4c 6973 742e 6170 7065 6e64 285b 6669  nList.append([fi
+00011d10: 6c65 4e61 6d65 2c22 696e 636f 7272 6563  leName,"incorrec
+00011d20: 7420 7368 6132 3536 2068 6173 6822 5d29  t sha256 hash"])
+00011d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d40: 2020 2020 2065 6c69 6620 6e6f 7420 6974       elif not it
+00011d50: 656d 456e 7472 795b 2769 6d61 6765 2d68  emEntry['image-h
+00011d60: 6173 682d 7368 6132 3536 275d 203d 3d20  ash-sha256'] == 
+00011d70: 6d69 7174 632e 7368 6132 3536 4861 7368  miqtc.sha256Hash
+00011d80: 4669 6c65 2869 6d61 6765 293a 0a20 2020  File(image):.   
+00011d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011da0: 2020 2020 2069 6620 7261 6973 6545 7863       if raiseExc
+00011db0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00011dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011dd0: 2020 2020 7261 6973 6520 6d69 7174 632e      raise miqtc.
+00011de0: 4966 646f 4578 6365 7074 696f 6e28 6974  IfdoException(it
+00011df0: 656d 2c20 2269 6e63 6f72 7265 6374 2073  em, "incorrect s
+00011e00: 6861 3235 3620 6861 7368 222c 2069 7465  ha256 hash", ite
+00011e10: 6d45 6e74 7279 5b27 696d 6167 652d 6861  mEntry['image-ha
+00011e20: 7368 2d73 6861 3235 3627 5d2c 2266 6f72  sh-sha256'],"for
+00011e30: 2066 696c 6522 2c66 696c 654e 616d 652c   file",fileName,
+00011e40: 2220 7275 6e20 6372 6561 7465 5f69 6d61  " run create_ima
+00011e50: 6765 5f73 6861 3235 365f 6669 6c65 2829  ge_sha256_file()
+00011e60: 2066 6972 7374 2229 0a20 2020 2020 2020   first").       
+00011e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e80: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00011e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ea0: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
+00011eb0: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
+00011ec0: 652c 2269 6e63 6f72 7265 6374 2073 6861  e,"incorrect sha
+00011ed0: 3235 3620 6861 7368 225d 290a 2020 2020  256 hash"]).    
+00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ef0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+00011f00: 2020 6966 2066 6f75 6e64 3a0a 2020 2020    if found:.    
+00011f10: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00011f20: 6861 7368 556e 6368 6563 6b49 6d61 6765  hashUncheckImage
+00011f30: 7349 6e52 6177 5b69 6d61 6765 5d0a 2020  sInRaw[image].  
+00011f40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00011f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011f60: 6966 2072 6169 7365 4578 6365 7074 696f  if raiseExceptio
+00011f70: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+00011f80: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00011f90: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00011fa0: 2820 2269 6d61 6765 222c 2069 7465 6d2c  ( "image", item,
+00011fb0: 2022 6e6f 7420 666f 756e 6420 696e 2064   "not found in d
+00011fc0: 6972 6563 746f 7279 2773 2072 6177 2066  irectory's raw f
+00011fd0: 6f6c 6465 7221 2229 0a20 2020 2020 2020  older!").       
+00011fe0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00011ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012000: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
+00012010: 2e61 7070 656e 6428 5b66 696c 654e 616d  .append([fileNam
+00012020: 652c 2266 696c 6520 6e6f 7420 666f 756e  e,"file not foun
+00012030: 6422 5d29 0a20 2020 2020 2020 2070 726f  d"]).        pro
+00012040: 672e 636c 6561 7228 290a 2020 2020 2020  g.clear().      
+00012050: 2020 6966 206e 6f74 2072 6169 7365 4578    if not raiseEx
+00012060: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00012070: 2020 2020 2072 6574 7572 6e20 6578 6365       return exce
+00012080: 7074 696f 6e4c 6973 740a 0a0a 2020 2020  ptionList...    
+00012090: 6465 6620 6372 6561 7465 5f75 7569 645f  def create_uuid_
+000120a0: 6669 6c65 2873 656c 662c 636c 6561 6e3d  file(self,clean=
+000120b0: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
+000120c0: 2222 2043 7265 6174 6573 2069 6e20 2f69  "" Creates in /i
+000120d0: 6e74 6572 6d65 6469 6174 6520 6120 7465  ntermediate a te
+000120e0: 7874 2066 696c 6520 636f 6e74 6169 6e69  xt file containi
+000120f0: 6e67 2070 6572 2069 6d61 6765 2061 2063  ng per image a c
+00012100: 7265 6174 6564 2075 7569 6420 2876 6572  reated uuid (ver
+00012110: 7369 6f6e 2034 292e 0a0a 2020 2020 2020  sion 4)...      
+00012120: 2020 5468 6520 5555 4944 2069 7320 6f6e    The UUID is on
+00012130: 6c79 202a 7461 6b65 6e2a 2066 726f 6d20  ly *taken* from 
+00012140: 7468 6520 6d65 7461 6461 7461 206f 6620  the metadata of 
+00012150: 7468 6520 696d 6167 6573 2e20 4974 2064  the images. It d
+00012160: 6f65 7320 6e6f 7420 7772 6974 6520 5555  oes not write UU
+00012170: 4944 7320 746f 2074 6865 206d 6574 6164  IDs to the metad
+00012180: 6174 6120 696e 2063 6173 6520 736f 6d65  ata in case some
+00012190: 2066 696c 6573 2061 7265 206d 6973 7369   files are missi
+000121a0: 6e67 2069 742e 0a20 2020 2020 2020 2042  ng it..        B
+000121b0: 7574 2c20 6974 2063 7265 6174 6573 2061  ut, it creates a
+000121c0: 2043 5356 2066 696c 6520 696e 2074 6861   CSV file in tha
+000121d0: 7420 6361 7365 2074 6861 7420 796f 7520  t case that you 
+000121e0: 6361 6e20 7573 6520 746f 6765 7468 6572  can use together
+000121f0: 2077 6974 6820 6578 6966 746f 6f6c 2074   with exiftool t
+00012200: 6f20 6164 6420 7468 6520 5555 4944 2074  o add the UUID t
+00012210: 6f20 796f 7572 2064 6174 612e 2042 6577  o your data. Bew
+00012220: 6172 6521 2074 6869 7320 6361 6e20 6465  are! this can de
+00012230: 7374 726f 7920 796f 7572 2069 6d61 6765  stroy your image
+00012240: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
+00012250: 2064 6f6e 6520 7072 6f70 6572 6c79 2120   done properly! 
+00012260: 4e6f 2067 7561 7261 6e74 6565 2069 7320  No guarantee is 
+00012270: 6769 7665 6e20 6974 2077 696c 6c20 776f  given it will wo
+00012280: 726b 2e20 4265 2063 6172 6566 756c 210a  rk. Be careful!.
+00012290: 0a20 2020 2020 2020 2055 7365 2063 6c65  .        Use cle
+000122a0: 616e 3d46 616c 7365 2074 6f20 6e6f 7420  an=False to not 
+000122b0: 6368 6563 6b20 7468 6f73 6520 6669 6c65  check those file
+000122c0: 7320 6167 6169 6e20 7768 6963 6820 6172  s again which ar
+000122d0: 6520 616c 7265 6164 7920 666f 756e 6420  e already found 
+000122e0: 696e 2069 6e74 6572 6d65 6469 6174 6520  in intermediate 
+000122f0: 7575 6964 2066 696c 650a 2020 2020 2020  uuid file.      
+00012300: 2020 2222 220a 0a20 2020 2020 2020 2075    """..        u
+00012310: 7569 6473 203d 207b 7d0a 2020 2020 2020  uids = {}.      
+00012320: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
+00012330: 7220 6120 6669 6c65 2077 6974 6820 5555  r a file with UU
+00012340: 4944 7320 6578 6973 7473 2c20 7468 656e  IDs exists, then
+00012350: 2072 6561 6420 6974 0a20 2020 2020 2020   read it.       
+00012360: 2069 6620 6e6f 7420 636c 6561 6e20 616e   if not clean an
+00012370: 6420 6f73 2e70 6174 682e 6578 6973 7473  d os.path.exists
+00012380: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
+00012390: 6964 5f66 696c 6528 2929 3a0a 2020 2020  id_file()):.    
+000123a0: 2020 2020 2020 2020 7575 6964 7320 3d20          uuids = 
+000123b0: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
+000123c0: 6128 7365 6c66 2e67 6574 5f69 6e74 5f75  a(self.get_int_u
+000123d0: 7569 645f 6669 6c65 2829 2c20 5b6d 6971  uid_file(), [miq
+000123e0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+000123f0: 6172 6971 7427 5d5b 2769 6d67 275d 2c20  ariqt']['img'], 
+00012400: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00012410: 5b27 6d61 7269 7174 275d 5b27 7575 6964  ['mariqt']['uuid
+00012420: 275d 5d2c 206b 6579 5f63 6f6c 3d6d 6971  ']], key_col=miq
+00012430: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00012440: 6172 6971 7427 5d5b 2769 6d67 275d 290a  ariqt']['img']).
+00012450: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00012460: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00012470: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
+00012480: 6573 4469 7229 3a0a 0a20 2020 2020 2020  esDir):..       
+00012490: 2020 2020 206d 6973 7369 6e67 5f75 7569       missing_uui
+000124a0: 6473 203d 207b 7d0a 2020 2020 2020 2020  ds = {}.        
+000124b0: 2020 2020 6164 6465 645f 7575 6964 7320      added_uuids 
+000124c0: 3d20 300a 0a20 2020 2020 2020 2020 2020  = 0..           
+000124d0: 2075 6e6b 6e6f 776e 4669 6c65 7320 3d20   unknownFiles = 
+000124e0: 5b5d 0a20 2020 2020 2020 2020 2020 2066  [].            f
+000124f0: 6f72 2066 696c 6520 696e 2073 656c 662e  or file in self.
+00012500: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+00012510: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+00012520: 2020 2020 2066 696c 655f 6e61 6d65 203d       file_name =
+00012530: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+00012540: 6528 6669 6c65 290a 2020 2020 2020 2020  e(file).        
+00012550: 2020 2020 2020 2020 6966 2066 696c 655f          if file_
+00012560: 6e61 6d65 206e 6f74 2069 6e20 7575 6964  name not in uuid
+00012570: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00012580: 2020 2020 2020 2075 6e6b 6e6f 776e 4669         unknownFi
+00012590: 6c65 732e 6170 7065 6e64 2866 696c 6529  les.append(file)
+000125a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000125b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000125c0: 2020 2020 2020 2020 2020 2075 7569 6473             uuids
+000125d0: 5b66 696c 655f 6e61 6d65 5d20 3d20 7575  [file_name] = uu
+000125e0: 6964 735b 6669 6c65 5f6e 616d 655d 5b6d  ids[file_name][m
+000125f0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00012600: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
+00012610: 5d5d 0a0a 2020 2020 2020 2020 2020 2020  ]]..            
+00012620: 756e 6b6e 6f77 6e46 696c 6573 5555 4944  unknownFilesUUID
+00012630: 7320 3d20 6d69 7174 692e 696d 6167 6573  s = miqti.images
+00012640: 436f 6e74 6169 6e56 616c 6964 5555 4944  ContainValidUUID
+00012650: 2875 6e6b 6e6f 776e 4669 6c65 7329 0a20  (unknownFiles). 
+00012660: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+00012670: 696c 6520 696e 2075 6e6b 6e6f 776e 4669  ile in unknownFi
+00012680: 6c65 7355 5549 4473 3a0a 2020 2020 2020  lesUUIDs:.      
+00012690: 2020 2020 2020 2020 2020 6669 6c65 5f6e            file_n
+000126a0: 616d 6520 3d20 6f73 2e70 6174 682e 6261  ame = os.path.ba
+000126b0: 7365 6e61 6d65 2866 696c 6529 0a20 2020  sename(file).   
+000126c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000126d0: 6e6f 7420 756e 6b6e 6f77 6e46 696c 6573  not unknownFiles
+000126e0: 5555 4944 735b 6669 6c65 5d5b 2776 616c  UUIDs[file]['val
+000126f0: 6964 275d 3a0a 2020 2020 2020 2020 2020  id']:.          
+00012700: 2020 2020 2020 2020 2020 7575 6964 203d            uuid =
+00012710: 206d 6971 7463 2e75 7569 6434 2829 0a20   miqtc.uuid4(). 
+00012720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012730: 2020 206d 6973 7369 6e67 5f75 7569 6473     missing_uuids
+00012740: 5b66 696c 655d 203d 2075 7569 640a 2020  [file] = uuid.  
+00012750: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00012760: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00012770: 2020 2020 2020 2020 7575 6964 735b 6669          uuids[fi
+00012780: 6c65 5f6e 616d 655d 203d 2075 6e6b 6e6f  le_name] = unkno
+00012790: 776e 4669 6c65 7355 5549 4473 5b66 696c  wnFilesUUIDs[fil
+000127a0: 655d 5b27 7575 6964 275d 0a20 2020 2020  e]['uuid'].     
+000127b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000127c0: 6464 6564 5f75 7569 6473 202b 3d20 310a  dded_uuids += 1.
+000127d0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+000127e0: 6620 7072 6576 696f 7573 6c79 2075 6e6b  f previously unk
+000127f0: 6e6f 776e 2055 5549 4473 2077 6572 6520  nown UUIDs were 
+00012800: 666f 756e 6420 696e 2074 6865 2066 696c  found in the fil
+00012810: 6520 6865 6164 6572 732c 2061 6464 2074  e headers, add t
+00012820: 6865 6d20 746f 2074 6865 2055 5549 4420  hem to the UUID 
+00012830: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
+00012840: 2069 6620 6164 6465 645f 7575 6964 7320   if added_uuids 
+00012850: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+00012860: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
+00012870: 7365 6c66 2e67 6574 5f69 6e74 5f75 7569  self.get_int_uui
+00012880: 645f 6669 6c65 2829 2c20 2277 2229 0a20  d_file(), "w"). 
+00012890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000128a0: 6573 2e77 7269 7465 286d 6971 7476 2e63  es.write(miqtv.c
+000128b0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+000128c0: 7427 5d5b 2769 6d67 275d 202b 225c 7422  t']['img'] +"\t"
+000128d0: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
+000128e0: 725b 276d 6172 6971 7427 5d5b 2775 7569  r['mariqt']['uui
+000128f0: 6427 5d2b 225c 6e22 290a 2020 2020 2020  d']+"\n").      
+00012900: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+00012910: 6c65 2069 6e20 7575 6964 733a 0a20 2020  le in uuids:.   
+00012920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012930: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
+00012940: 225c 7422 2b73 7472 2875 7569 6473 5b66  "\t"+str(uuids[f
+00012950: 696c 655d 292b 225c 6e22 290a 2020 2020  ile])+"\n").    
+00012960: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00012970: 636c 6f73 6528 290a 0a20 2020 2020 2020  close()..       
+00012980: 2020 2020 2069 6620 6c65 6e28 6d69 7373       if len(miss
+00012990: 696e 675f 7575 6964 7329 203e 2030 3a0a  ing_uuids) > 0:.
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129b0: 6563 7376 5f70 6174 6820 3d20 7365 6c66  ecsv_path = self
+000129c0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+000129d0: 7072 6566 6978 2829 202b 2022 5f65 7869  prefix() + "_exi
+000129e0: 662d 6164 642d 7575 6964 2e63 7376 220a  f-add-uuid.csv".
+000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a00: 6373 7620 3d20 6f70 656e 2865 6373 765f  csv = open(ecsv_
+00012a10: 7061 7468 2c20 2277 2229 0a20 2020 2020  path, "w").     
+00012a20: 2020 2020 2020 2020 2020 2063 7376 2e77             csv.w
+00012a30: 7269 7465 286d 6971 7476 2e63 6f6c 5f68  rite(miqtv.col_h
+00012a40: 6561 6465 725b 2765 7869 6627 5d5b 2769  eader['exif']['i
+00012a50: 6d67 275d 202b 0a20 2020 2020 2020 2020  mg'] +.         
 00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012a70: 2372 6574 7572 6e20 4661 6c73 652c 2022  #return False, "
-00012a80: 6578 6966 746f 6f6c 202d 6373 763d 222b  exiftool -csv="+
-00012a90: 6563 7376 5f70 6174 682b 2220 222b 2220  ecsv_path+" "+" 
-00012aa0: 222e 6a6f 696e 2864 6966 6665 7265 6e74  ".join(different
-00012ab0: 5f70 6174 6873 290a 2020 2020 2020 2020  _paths).        
-00012ac0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00012ad0: 616c 7365 2c20 224e 6f74 2061 6c6c 2069  alse, "Not all i
-00012ae0: 6d61 6765 7320 6861 7665 2076 616c 6964  mages have valid
-00012af0: 2055 5549 4473 2e20 4d69 7373 696e 6720   UUIDs. Missing 
-00012b00: 666f 7220 666f 6c6c 6f77 696e 6720 6669  for following fi
-00012b10: 6c65 733a 5c6e 222b 225c c586 222e 6a6f  les:\n"+"\..".jo
-00012b20: 696e 2864 6966 6665 7265 6e74 5f70 6174  in(different_pat
-00012b30: 6873 290a 2020 2020 2020 2020 2020 2020  hs).            
-00012b40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00012b50: 662e 5f5f 616c 6c55 5549 4473 4368 6563  f.__allUUIDsChec
-00012b60: 6b65 6420 3d20 5472 7565 0a20 2020 2020  ked = True.     
-00012b70: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00012b80: 7565 2c20 2241 6c6c 2069 6d61 6765 7320  ue, "All images 
-00012b90: 6861 7665 2061 2055 5549 4422 0a20 2020  have a UUID".   
-00012ba0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00012bb0: 652c 2022 5061 7468 2022 2b73 656c 662e  e, "Path "+self.
-00012bc0: 696d 6167 6573 4469 7220 2b20 2220 6e6f  imagesDir + " no
-00012bd0: 7420 666f 756e 642e 220a 0a20 2020 2064  t found."..    d
-00012be0: 6566 2063 7265 6174 6555 5549 4446 696c  ef createUUIDFil
-00012bf0: 6528 7365 6c66 2c63 6c65 616e 3d54 7275  e(self,clean=Tru
-00012c00: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-00012c10: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
-00012c20: 2063 7265 6174 655f 7575 6964 5f66 696c   create_uuid_fil
-00012c30: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
-00012c40: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
-00012c50: 5f75 7569 645f 6669 6c65 2863 6c65 616e  _uuid_file(clean
-00012c60: 290a 0a0a 2020 2020 6465 6620 7365 745f  )...    def set_
-00012c70: 696d 6167 655f 7365 745f 6174 7469 7475  image_set_attitu
-00012c80: 6465 2873 656c 662c 7961 775f 6672 616d  de(self,yaw_fram
-00012c90: 653a 666c 6f61 742c 7069 7463 685f 6672  e:float,pitch_fr
-00012ca0: 616d 653a 666c 6f61 742c 726f 6c6c 5f66  ame:float,roll_f
-00012cb0: 7261 6d65 3a66 6c6f 6174 2c79 6177 5f63  rame:float,yaw_c
-00012cc0: 616d 3266 7261 6d65 3a66 6c6f 6174 2c70  am2frame:float,p
-00012cd0: 6974 6368 5f63 616d 3266 7261 6d65 3a66  itch_cam2frame:f
-00012ce0: 6c6f 6174 2c72 6f6c 6c5f 6361 6d32 6672  loat,roll_cam2fr
-00012cf0: 616d 653a 666c 6f61 7429 3a0a 2020 2020  ame:float):.    
-00012d00: 2020 2020 2222 2220 6361 6c63 756c 6174      """ calculat
-00012d10: 6573 2074 6865 2074 6865 2063 616d 6572  es the the camer
-00012d20: 6173 2061 6273 6f6c 7574 6520 6174 7469  as absolute atti
-00012d30: 7475 6465 2061 6e64 2073 6574 7320 6974  tude and sets it
-00012d40: 2074 6f20 696d 6167 6520 7365 7420 6865   to image set he
-00012d50: 6164 6572 2e20 416c 6c20 616e 676c 6573  ader. All angles
-00012d60: 2061 7265 2065 7870 6563 7465 6420 696e   are expected in
-00012d70: 2064 6567 7265 6573 2e20 0a20 2020 2020   degrees. .     
-00012d80: 2020 2063 616d 6572 6132 6672 616d 6520     camera2frame 
-00012d90: 616e 676c 6573 3a20 726f 7461 7469 6f6e  angles: rotation
-00012da0: 206f 6620 6361 6d65 7261 2063 6f6f 7264   of camera coord
-00012db0: 696e 6174 6573 2028 782c 792c 7a20 3d20  inates (x,y,z = 
-00012dc0: 746f 702c 2072 6967 6874 2c20 6c69 6e65  top, right, line
-00012dd0: 206f 6620 7369 6768 7429 2077 6974 6820   of sight) with 
-00012de0: 7265 7370 6563 7420 746f 2076 6568 6963  respect to vehic
-00012df0: 6c65 2063 6f6f 7264 696e 6174 6573 2028  le coordinates (
-00012e00: 782c 792c 7a20 3d20 666f 7277 6172 642c  x,y,z = forward,
-00012e10: 7269 6768 742c 646f 776e 2920 0a20 2020  right,down) .   
-00012e20: 2020 2020 2069 6e20 6163 636f 7264 616e       in accordan
-00012e30: 6365 2077 6974 6820 7468 6520 7961 772c  ce with the yaw,
-00012e40: 7069 7463 682c 726f 6c6c 2072 6f74 6174  pitch,roll rotat
-00012e50: 696f 6e20 6f72 6465 7220 636f 6e76 656e  ion order conven
-00012e60: 7469 6f6e 3a0a 0a20 2020 2020 2020 2031  tion:..        1
-00012e70: 2e20 7961 7720 6172 6f75 6e64 207a 2c0a  . yaw around z,.
-00012e80: 2020 2020 2020 2020 322e 2070 6974 6368          2. pitch
-00012e90: 2061 726f 756e 6420 726f 7461 7465 6420   around rotated 
-00012ea0: 792c 0a20 2020 2020 2020 2033 2e20 726f  y,.        3. ro
-00012eb0: 6c6c 2061 726f 756e 6420 726f 7461 7465  ll around rotate
-00012ec0: 6420 780a 0a20 2020 2020 2020 2052 6f74  d x..        Rot
-00012ed0: 6174 696f 6e20 6469 7265 6374 696f 6e73  ation directions
-00012ee0: 2061 6363 6f72 6469 6e67 2074 6f20 5c27   according to \'
-00012ef0: 7269 6768 742d 6861 6e64 2072 756c 655c  right-hand rule\
-00012f00: 272e 0a0a 2020 2020 2020 2020 492e 652e  '...        I.e.
-00012f10: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
-00012f20: 676c 6573 203d 2030 2c30 2c30 2063 616d  gles = 0,0,0 cam
-00012f30: 6572 6120 6973 2066 6163 696e 6720 646f  era is facing do
-00012f40: 776e 7761 7264 2077 6974 6820 746f 7020  wnward with top 
-00012f50: 7369 6465 2074 6f77 6172 6473 2076 6568  side towards veh
-00012f60: 6963 6c65 2773 2066 6f72 7761 7264 2064  icle's forward d
-00012f70: 6972 6563 7469 6f6e 2720 2222 220a 0a20  irection' """.. 
-00012f80: 2020 2020 2020 2052 5f66 7261 6d65 326e         R_frame2n
-00012f90: 6564 203d 206d 6971 7467 2e52 5f59 6177  ed = miqtg.R_Yaw
-00012fa0: 5069 7463 6852 6f6c 6c28 7961 775f 6672  PitchRoll(yaw_fr
-00012fb0: 616d 652c 7069 7463 685f 6672 616d 652c  ame,pitch_frame,
-00012fc0: 726f 6c6c 5f66 7261 6d65 290a 2020 2020  roll_frame).    
-00012fd0: 2020 2020 525f 6361 6d32 6672 616d 6520      R_cam2frame 
-00012fe0: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
-00012ff0: 6368 526f 6c6c 2879 6177 5f63 616d 3266  chRoll(yaw_cam2f
-00013000: 7261 6d65 2c70 6974 6368 5f63 616d 3266  rame,pitch_cam2f
-00013010: 7261 6d65 2c72 6f6c 6c5f 6361 6d32 6672  rame,roll_cam2fr
-00013020: 616d 6529 0a20 2020 2020 2020 2052 5f63  ame).        R_c
-00013030: 616d 326e 6564 203d 2052 5f66 7261 6d65  am2ned = R_frame
-00013040: 326e 6564 2e64 6f74 2852 5f63 616d 3266  2ned.dot(R_cam2f
-00013050: 7261 6d65 290a 2020 2020 2020 2020 7961  rame).        ya
-00013060: 772c 7069 7463 682c 726f 6c6c 203d 206d  w,pitch,roll = m
-00013070: 6971 7467 2e79 6177 5069 7463 6852 6f6c  iqtg.yawPitchRol
-00013080: 6c28 525f 6361 6d32 6e65 6429 0a0a 2020  l(R_cam2ned)..  
-00013090: 2020 2020 2020 2320 706f 7365 206d 6174        # pose mat
-000130a0: 7269 7820 6361 6d32 7574 6d0a 2020 2020  rix cam2utm.    
-000130b0: 2020 2020 525f 6361 6d53 7464 3275 746d      R_camStd2utm
-000130c0: 203d 2073 656c 662e 6765 745f 525f 6361   = self.get_R_ca
-000130d0: 6d53 7464 3275 746d 2852 5f63 616d 3266  mStd2utm(R_cam2f
-000130e0: 7261 6d65 2c52 5f66 7261 6d65 326e 6564  rame,R_frame2ned
-000130f0: 290a 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
-00013100: 2020 2020 2020 2078 203d 206e 702e 6172         x = np.ar
-00013110: 7261 7928 5b31 2c30 2c30 5d29 0a20 2020  ray([1,0,0]).   
-00013120: 2020 2020 2079 203d 206e 702e 6172 7261       y = np.arra
-00013130: 7928 5b30 2c31 2c30 5d29 0a20 2020 2020  y([0,1,0]).     
-00013140: 2020 207a 203d 206e 702e 6172 7261 7928     z = np.array(
-00013150: 5b30 2c30 2c31 5d29 0a20 2020 2020 2020  [0,0,1]).       
-00013160: 2070 7269 6e74 2827 7827 2c52 5f63 616d   print('x',R_cam
-00013170: 5374 6432 7574 6d2e 646f 7428 7829 2e72  Std2utm.dot(x).r
-00013180: 6f75 6e64 2835 2929 0a20 2020 2020 2020  ound(5)).       
-00013190: 2070 7269 6e74 2827 7927 2c52 5f63 616d   print('y',R_cam
-000131a0: 5374 6432 7574 6d2e 646f 7428 7929 2e72  Std2utm.dot(y).r
-000131b0: 6f75 6e64 2835 2929 0a20 2020 2020 2020  ound(5)).       
-000131c0: 2070 7269 6e74 2827 7a27 2c52 5f63 616d   print('z',R_cam
-000131d0: 5374 6432 7574 6d2e 646f 7428 7a29 2e72  Std2utm.dot(z).r
-000131e0: 6f75 6e64 2835 2929 0a20 2020 2020 2020  ound(5)).       
-000131f0: 2022 2222 0a0a 2020 2020 2020 2020 6865   """..        he
-00013200: 6164 6572 5570 6461 7465 203d 207b 0a20  aderUpdate = {. 
-00013210: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
-00013220: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00013230: 6971 7427 5d5b 2779 6177 275d 3a79 6177  iqt']['yaw']:yaw
-00013240: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
-00013250: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00013260: 6d61 7269 7174 275d 5b27 7069 7463 6827  mariqt']['pitch'
-00013270: 5d3a 7069 7463 682c 0a20 2020 2020 2020  ]:pitch,.       
-00013280: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
-00013290: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-000132a0: 2772 6f6c 6c27 5d3a 726f 6c6c 2c0a 2020  'roll']:roll,.  
-000132b0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-000132c0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-000132d0: 7174 275d 5b27 706f 7365 275d 3a7b 2770  qt']['pose']:{'p
-000132e0: 6f73 652d 6162 736f 6c75 7465 2d6f 7269  ose-absolute-ori
-000132f0: 656e 7461 7469 6f6e 2d75 746d 2d6d 6174  entation-utm-mat
-00013300: 7269 7827 3a52 5f63 616d 5374 6432 7574  rix':R_camStd2ut
-00013310: 6d2e 666c 6174 7465 6e28 292e 746f 6c69  m.flatten().toli
-00013320: 7374 2829 7d0a 2020 2020 2020 2020 7d0a  st()}.        }.
-00013330: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-00013340: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
-00013350: 6669 656c 6473 2868 6561 6465 7255 7064  fields(headerUpd
-00013360: 6174 6529 0a0a 2020 2020 6465 6620 7365  ate)..    def se
-00013370: 7449 6d61 6765 5365 7441 7474 6974 7564  tImageSetAttitud
-00013380: 6528 7365 6c66 2c79 6177 5f66 7261 6d65  e(self,yaw_frame
-00013390: 3a66 6c6f 6174 2c70 6974 6368 5f66 7261  :float,pitch_fra
-000133a0: 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f 6672  me:float,roll_fr
-000133b0: 616d 653a 666c 6f61 742c 7961 775f 6361  ame:float,yaw_ca
-000133c0: 6d32 6672 616d 653a 666c 6f61 742c 7069  m2frame:float,pi
-000133d0: 7463 685f 6361 6d32 6672 616d 653a 666c  tch_cam2frame:fl
-000133e0: 6f61 742c 726f 6c6c 5f63 616d 3266 7261  oat,roll_cam2fra
-000133f0: 6d65 3a66 6c6f 6174 293a 0a20 2020 2020  me:float):.     
-00013400: 2020 2022 2222 2044 6570 7265 6361 7465     """ Deprecate
-00013410: 6420 2d20 7573 6520 7365 745f 696d 6167  d - use set_imag
-00013420: 655f 7365 745f 6174 7469 7475 6465 2022  e_set_attitude "
-00013430: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-00013440: 7365 745f 696d 6167 655f 7365 745f 6174  set_image_set_at
-00013450: 7469 7475 6465 2879 6177 5f66 7261 6d65  titude(yaw_frame
-00013460: 2c20 7069 7463 685f 6672 616d 652c 2072  , pitch_frame, r
-00013470: 6f6c 6c5f 6672 616d 652c 2079 6177 5f63  oll_frame, yaw_c
-00013480: 616d 3266 7261 6d65 2c20 7069 7463 685f  am2frame, pitch_
-00013490: 6361 6d32 6672 616d 652c 2072 6f6c 6c5f  cam2frame, roll_
-000134a0: 6361 6d32 6672 616d 6529 0a0a 0a20 2020  cam2frame)...   
-000134b0: 2064 6566 2063 7265 6174 655f 696d 6167   def create_imag
-000134c0: 655f 6174 7469 7475 6465 5f66 696c 6528  e_attitude_file(
-000134d0: 7365 6c66 2c20 6174 745f 7061 7468 3a73  self, att_path:s
-000134e0: 7472 2c20 6672 616d 655f 6174 745f 6865  tr, frame_att_he
-000134f0: 6164 6572 3a64 6963 742c 2063 616d 6572  ader:dict, camer
-00013500: 6132 4672 616d 655f 7961 773a 666c 6f61  a2Frame_yaw:floa
-00013510: 742c 6361 6d65 7261 3246 7261 6d65 5f70  t,camera2Frame_p
-00013520: 6974 6368 3a66 6c6f 6174 2c63 616d 6572  itch:float,camer
-00013530: 6132 4672 616d 655f 726f 6c6c 3a66 6c6f  a2Frame_roll:flo
-00013540: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
-00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013560: 2020 2020 6461 7465 5f66 6f72 6d61 743d      date_format=
-00013570: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
-00013580: 7473 5b27 7061 6e67 6165 6127 5d2c 2063  ts['pangaea'], c
-00013590: 6f6e 7374 5f76 616c 7565 7320 3d20 7b7d  onst_values = {}
-000135a0: 2c20 6f76 6572 7772 6974 653d 4661 6c73  , overwrite=Fals
-000135b0: 652c 2063 6f6c 5f73 6570 6172 6174 6f72  e, col_separator
-000135c0: 203d 2022 5c74 222c 0a20 2020 2020 2020   = "\t",.       
-000135d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135e0: 2020 2020 2020 2020 2061 7474 5f70 6174           att_pat
-000135f0: 685f 616e 676c 6573 5f69 6e5f 7261 6420  h_angles_in_rad 
-00013600: 3d20 4661 6c73 652c 2076 6964 656f 5361  = False, videoSa
-00013610: 6d70 6c65 5365 636f 6e64 733d 312c 7265  mpleSeconds=1,re
-00013620: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-00013630: 3d5b 5d29 3a0a 2020 2020 2020 2020 2222  =[]):.        ""
-00013640: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
-00013650: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
-00013660: 7420 6669 6c65 2077 6974 6820 6361 6d65  t file with came
-00013670: 7261 2061 7474 6974 7564 6520 6461 7461  ra attitude data
-00013680: 2066 6f72 2065 6163 6820 696d 6167 652e   for each image.
-00013690: 2041 6c6c 2061 6e67 6c65 7320 6172 6520   All angles are 
-000136a0: 6578 7065 6374 6564 2069 6e20 6465 6772  expected in degr
-000136b0: 6565 732e 2055 7365 2061 7474 5f70 6174  ees. Use att_pat
-000136c0: 685f 616e 676c 6573 5f69 6e5f 7261 6420  h_angles_in_rad 
-000136d0: 6966 206e 6563 6573 7361 7279 2e20 0a20  if necessary. . 
-000136e0: 2020 2020 2020 2063 616d 6572 6132 4672         camera2Fr
-000136f0: 616d 6520 616e 676c 6573 3a20 726f 7461  ame angles: rota
-00013700: 7469 6f6e 206f 6620 6361 6d65 7261 2063  tion of camera c
-00013710: 6f6f 7264 696e 6174 6573 2028 782c 792c  oordinates (x,y,
-00013720: 7a20 3d20 746f 702c 2072 6967 6874 2c20  z = top, right, 
-00013730: 6c69 6e65 206f 6620 7369 6768 7429 2077  line of sight) w
-00013740: 6974 6820 7265 7370 6563 7420 746f 2076  ith respect to v
-00013750: 6568 6963 6c65 2063 6f6f 7264 696e 6174  ehicle coordinat
-00013760: 6573 2028 782c 792c 7a20 3d20 666f 7277  es (x,y,z = forw
-00013770: 6172 642c 7269 6768 742c 646f 776e 2920  ard,right,down) 
-00013780: 0a20 2020 2020 2020 2069 6e20 6163 636f  .        in acco
-00013790: 7264 616e 6365 2077 6974 6820 7468 6520  rdance with the 
-000137a0: 7961 772c 7069 7463 682c 726f 6c6c 2072  yaw,pitch,roll r
-000137b0: 6f74 6174 696f 6e20 6f72 6465 7220 636f  otation order co
-000137c0: 6e76 656e 7469 6f6e 3a0a 2020 2020 2020  nvention:.      
-000137d0: 2020 312e 2079 6177 2061 726f 756e 6420    1. yaw around 
-000137e0: 7a2c 0a20 2020 2020 2020 2032 2e20 7069  z,.        2. pi
-000137f0: 7463 6820 6172 6f75 6e64 2072 6f74 6174  tch around rotat
-00013800: 6564 2079 2c0a 2020 2020 2020 2020 332e  ed y,.        3.
-00013810: 2072 6f6c 6c20 6172 6f75 6e64 2072 6f74   roll around rot
-00013820: 6174 6564 2078 0a0a 2020 2020 2020 2020  ated x..        
-00013830: 526f 7461 7469 6f6e 2064 6972 6563 7469  Rotation directi
-00013840: 6f6e 7320 6163 636f 7264 696e 6720 746f  ons according to
-00013850: 205c 2772 6967 6874 2d68 616e 6420 7275   \'right-hand ru
-00013860: 6c65 5c27 2e0a 0a20 2020 2020 2020 2049  le\'...        I
-00013870: 2e65 2e20 6361 6d65 7261 3246 7261 6d65  .e. camera2Frame
-00013880: 2061 6e67 6c65 7320 3d20 302c 302c 3020   angles = 0,0,0 
-00013890: 6361 6d65 7261 2069 7320 6661 6369 6e67  camera is facing
-000138a0: 2064 6f77 6e77 6172 6420 7769 7468 2074   downward with t
-000138b0: 6f70 2073 6964 6520 746f 7761 7264 7320  op side towards 
-000138c0: 7665 6869 636c 6527 7320 666f 7277 6172  vehicle's forwar
-000138d0: 6420 6469 7265 6374 696f 6e27 2022 2222  d direction' """
-000138e0: 0a0a 2020 2020 2020 2020 696e 745f 6174  ..        int_at
-000138f0: 7475 7475 6465 5f66 696c 6520 3d20 7365  tutude_file = se
-00013900: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-00013910: 655f 7072 6566 6978 2829 202b 2027 5f69  e_prefix() + '_i
-00013920: 6d61 6765 2d61 7474 6974 7564 652e 7478  mage-attitude.tx
-00013930: 7427 0a20 2020 2020 2020 206f 7574 7075  t'.        outpu
-00013940: 745f 6865 6164 6572 5f61 7474 203d 207b  t_header_att = {
-00013950: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
-00013960: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00013970: 6d67 275d 3a20 206d 6971 7476 2e63 6f6c  mg']:  miqtv.col
-00013980: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013990: 5d5b 2769 6d67 275d 2c0a 2020 2020 2020  ]['img'],.      
-000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139b0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-000139c0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-000139d0: 7174 275d 5b27 7574 6327 5d3a 6d69 7174  qt']['utc']:miqt
-000139e0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000139f0: 7269 7174 275d 5b27 7574 6327 5d2c 0a20  riqt']['utc'],. 
-00013a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00013a20: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00013a30: 276d 6172 6971 7427 5d5b 2779 6177 275d  'mariqt']['yaw']
-00013a40: 3a6d 6971 7476 2e63 6f6c 5f68 6561 6465  :miqtv.col_heade
-00013a50: 725b 276d 6172 6971 7427 5d5b 2779 6177  r['mariqt']['yaw
-00013a60: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00013a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a80: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00013a90: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00013aa0: 7069 7463 6827 5d3a 6d69 7174 762e 636f  pitch']:miqtv.co
-00013ab0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00013ac0: 275d 5b27 7069 7463 6827 5d2c 0a20 2020  ']['pitch'],.   
-00013ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ae0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-00013af0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013b00: 6172 6971 7427 5d5b 2772 6f6c 6c27 5d3a  ariqt']['roll']:
-00013b10: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00013b20: 5b27 6d61 7269 7174 275d 5b27 726f 6c6c  ['mariqt']['roll
-00013b30: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b50: 7d0a 0a20 2020 2020 2020 2069 6e74 5f70  }..        int_p
-00013b60: 6f73 655f 6669 6c65 203d 2073 656c 662e  ose_file = self.
-00013b70: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
-00013b80: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
-00013b90: 652d 6361 6d65 7261 2d70 6f73 652e 7478  e-camera-pose.tx
-00013ba0: 7427 0a20 2020 2020 2020 206f 7574 7075  t'.        outpu
-00013bb0: 745f 6865 6164 6572 5f70 6f73 6520 3d20  t_header_pose = 
-00013bc0: 7b20 206d 6971 7476 2e63 6f6c 5f68 6561  {  miqtv.col_hea
-00013bd0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00013be0: 6d67 275d 3a6d 6971 7476 2e63 6f6c 5f68  mg']:miqtv.col_h
-00013bf0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00013c00: 2769 6d67 275d 2c0a 2020 2020 2020 2020  'img'],.        
-00013c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c20: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
-00013c30: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00013c40: 275d 5b27 7574 6327 5d3a 6d69 7174 762e  ']['utc']:miqtv.
-00013c50: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00013c60: 7174 275d 5b27 7574 6327 5d2c 0a20 2020  qt']['utc'],.   
-00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c80: 2020 2020 2020 2020 2020 2020 206d 6971               miq
-00013c90: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013ca0: 6172 6971 7427 5d5b 2770 6f73 6527 5d3a  ariqt']['pose']:
-00013cb0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00013cc0: 5b27 6d61 7269 7174 275d 5b27 706f 7365  ['mariqt']['pose
-00013cd0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-00013ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013cf0: 7d0a 0a20 2020 2020 2020 2069 6620 6f73  }..        if os
-00013d00: 2e70 6174 682e 6578 6973 7473 2869 6e74  .path.exists(int
-00013d10: 5f61 7474 7574 7564 655f 6669 6c65 2920  _attutude_file) 
-00013d20: 616e 6420 6e6f 7420 6f76 6572 7772 6974  and not overwrit
-00013d30: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00013d40: 656c 662e 6164 645f 6974 656d 5f69 6e66  elf.add_item_inf
-00013d50: 6f5f 7461 625f 6669 6c65 2869 6e74 5f61  o_tab_file(int_a
-00013d60: 7474 7574 7564 655f 6669 6c65 2c22 5c74  ttutude_file,"\t
-00013d70: 222c 6f75 7470 7574 5f68 6561 6465 725f  ",output_header_
-00013d80: 6174 7429 0a20 2020 2020 2020 2020 2020  att).           
-00013d90: 2065 7874 7261 5f6d 7367 203d 2022 220a   extra_msg = "".
-00013da0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00013db0: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
-00013dc0: 745f 706f 7365 5f66 696c 6529 3a0a 2020  t_pose_file):.  
-00013dd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00013de0: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
-00013df0: 5f74 6162 5f66 696c 6528 696e 745f 706f  _tab_file(int_po
-00013e00: 7365 5f66 696c 652c 225c 7422 2c6f 7574  se_file,"\t",out
-00013e10: 7075 745f 6865 6164 6572 5f70 6f73 6529  put_header_pose)
-00013e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013e30: 2065 7874 7261 5f6d 7367 203d 2022 2c20   extra_msg = ", 
-00013e40: 2220 2b20 696e 745f 706f 7365 5f66 696c  " + int_pose_fil
-00013e50: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
-00013e60: 7475 726e 2054 7275 652c 2022 4f75 7470  turn True, "Outp
-00013e70: 7574 2066 696c 6520 6578 6973 7473 3a20  ut file exists: 
-00013e80: 222b 696e 745f 6174 7475 7475 6465 5f66  "+int_attutude_f
-00013e90: 696c 6520 2b20 6578 7472 615f 6d73 670a  ile + extra_msg.
-00013ea0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00013eb0: 6f73 2e70 6174 682e 6578 6973 7473 2861  os.path.exists(a
-00013ec0: 7474 5f70 6174 6829 3a0a 2020 2020 2020  tt_path):.      
-00013ed0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00013ee0: 7365 2c20 2241 7474 6974 7564 6520 6669  se, "Attitude fi
-00013ef0: 6c65 206e 6f74 2066 6f75 6e64 3a20 222b  le not found: "+
-00013f00: 6174 745f 7061 7468 0a0a 2020 2020 2020  att_path..      
-00013f10: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
-00013f20: 2e65 7869 7374 7328 7365 6c66 2e69 6d61  .exists(self.ima
-00013f30: 6765 7344 6972 293a 0a20 2020 2020 2020  gesDir):.       
-00013f40: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00013f50: 652c 2022 496d 6167 6520 666f 6c64 6572  e, "Image folder
-00013f60: 206e 6f74 2066 6f75 6e64 3a20 222b 2073   not found: "+ s
-00013f70: 656c 662e 696d 6167 6573 4469 720a 0a20  elf.imagesDir.. 
-00013f80: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
-00013f90: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
-00013fa0: 2822 4372 6561 7469 6e67 2069 7465 6d73  ("Creating items
-00013fb0: 2720 6174 7469 7475 6465 2064 6174 6122  ' attitude data"
-00013fc0: 290a 0a20 2020 2020 2020 2023 206c 6f61  )..        # loa
-00013fd0: 6420 6672 616d 6520 6174 7469 7475 6465  d frame attitude
-00013fe0: 2064 6174 6120 6672 6f6d 2066 696c 650a   data from file.
-00013ff0: 2020 2020 2020 2020 6174 745f 6461 7461          att_data
-00014000: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
-00014010: 746e 2e72 6561 6441 6c6c 4174 7469 7475  tn.readAllAttitu
-00014020: 6465 7346 726f 6d46 696c 6550 6174 6828  desFromFilePath(
-00014030: 6174 745f 7061 7468 2c20 6672 616d 655f  att_path, frame_
-00014040: 6174 745f 6865 6164 6572 2c20 6461 7465  att_header, date
-00014050: 5f66 6f72 6d61 742c 636f 6c5f 7365 7061  _format,col_sepa
-00014060: 7261 746f 723d 636f 6c5f 7365 7061 7261  rator=col_separa
-00014070: 746f 722c 636f 6e73 745f 7661 6c75 6573  tor,const_values
-00014080: 3d63 6f6e 7374 5f76 616c 7565 732c 616e  =const_values,an
-00014090: 676c 6573 496e 5261 643d 6174 745f 7061  glesInRad=att_pa
-000140a0: 7468 5f61 6e67 6c65 735f 696e 5f72 6164  th_angles_in_rad
-000140b0: 290a 2020 2020 2020 2020 6966 2070 6172  ).        if par
-000140c0: 7365 4d73 6720 213d 2022 223a 0a20 2020  seMsg != "":.   
-000140d0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-000140e0: 6f76 2e6c 6f67 2870 6172 7365 4d73 672c  ov.log(parseMsg,
-000140f0: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-00014100: 2020 2020 2020 2020 2020 2070 6172 7365             parse
-00014110: 4d73 6720 3d20 225c 6e22 202b 2070 6172  Msg = "\n" + par
-00014120: 7365 4d73 670a 0a20 2020 2020 2020 2023  seMsg..        #
-00014130: 2066 696e 6420 666f 7220 6561 6368 2069   find for each i
-00014140: 6d61 6765 2074 6865 2072 6573 7065 6374  mage the respect
-00014150: 6976 6520 6e61 7669 6761 7469 6f6e 2064  ive navigation d
-00014160: 6174 610a 2020 2020 2020 2020 732e 7374  ata.        s.st
-00014170: 6f70 2829 0a20 2020 2020 2020 2073 7563  op().        suc
-00014180: 6365 7373 2c20 696d 6167 655f 6474 732c  cess, image_dts,
-00014190: 206d 7367 203d 2073 656c 662e 6669 6e64   msg = self.find
-000141a0: 4e61 7644 6174 6146 6f72 496d 6167 6528  NavDataForImage(
-000141b0: 6174 745f 6461 7461 2c76 6964 656f 5361  att_data,videoSa
-000141c0: 6d70 6c65 5365 636f 6e64 7329 0a20 2020  mpleSeconds).   
-000141d0: 2020 2020 2069 6620 6e6f 7420 7375 6363       if not succ
-000141e0: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
-000141f0: 2072 6574 7572 6e20 4661 6c73 652c 206d   return False, m
-00014200: 7367 202b 2070 6172 7365 4d73 670a 2020  sg + parseMsg.  
-00014210: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
-00014220: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
-00014230: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
-00014240: 2061 7474 6974 7564 6520 6461 7461 2229   attitude data")
-00014250: 0a0a 2020 2020 2020 2020 2320 696e 7665  ..        # inve
-00014260: 7274 2076 616c 7565 7320 2869 6620 6e65  rt values (if ne
-00014270: 6564 6564 2920 6265 666f 7265 206c 6576  eded) before lev
-00014280: 6572 6172 6d20 636f 6d70 656e 7361 7469  erarm compensati
-00014290: 6f6e 0a20 2020 2020 2020 2069 6620 7265  on.        if re
-000142a0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-000142b0: 2021 3d20 5b5d 3a0a 2020 2020 2020 2020   != []:.        
-000142c0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-000142d0: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-000142e0: 2020 2020 2020 2020 2020 2061 7474 6974             attit
-000142f0: 7564 6573 203d 2069 6d61 6765 5f64 7473  udes = image_dts
-00014300: 5b66 696c 655d 0a20 2020 2020 2020 2020  [file].         
-00014310: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00014320: 7261 6e67 6528 6c65 6e28 6174 7469 7475  range(len(attitu
-00014330: 6465 7329 293a 0a20 2020 2020 2020 2020  des)):.         
-00014340: 2020 2020 2020 2020 2020 2069 6620 2779             if 'y
-00014350: 6177 2720 696e 2020 7265 636f 7264 7332  aw' in  records2
-00014360: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014380: 2020 2020 6174 7469 7475 6465 735b 695d      attitudes[i]
-00014390: 2e79 6177 202a 3d20 2d31 0a20 2020 2020  .yaw *= -1.     
-000143a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000143b0: 6620 2770 6974 6368 2720 696e 2020 7265  f 'pitch' in  re
-000143c0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-000143d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000143e0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
-000143f0: 6465 735b 695d 2e70 6974 6368 202a 3d20  des[i].pitch *= 
-00014400: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-00014410: 2020 2020 2020 2069 6620 2772 6f6c 6c27         if 'roll'
-00014420: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
-00014430: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-00014440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014450: 2061 7474 6974 7564 6573 5b69 5d2e 726f   attitudes[i].ro
-00014460: 6c6c 202a 3d20 2d31 0a0a 0a20 2020 2020  ll *= -1...     
-00014470: 2020 2023 2061 6464 2063 616d 6572 6132     # add camera2
-00014480: 4672 616d 6520 616e 676c 6573 0a20 2020  Frame angles.   
-00014490: 2020 2020 2052 5f63 616d 3266 7261 6d65       R_cam2frame
-000144a0: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
-000144b0: 7463 6852 6f6c 6c28 6361 6d65 7261 3246  tchRoll(camera2F
-000144c0: 7261 6d65 5f79 6177 2c63 616d 6572 6132  rame_yaw,camera2
-000144d0: 4672 616d 655f 7069 7463 682c 6361 6d65  Frame_pitch,came
-000144e0: 7261 3246 7261 6d65 5f72 6f6c 6c29 0a20  ra2Frame_roll). 
-000144f0: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
-00014500: 5f6c 6973 7420 3d20 5b5d 0a20 2020 2020  _list = [].     
-00014510: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
-00014520: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
-00014530: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
-00014540: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
-00014550: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
-00014560: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
-00014570: 203d 2074 696d 6570 6f69 6e74 0a20 2020   = timepoint.   
-00014580: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00014590: 6174 7469 7475 6465 2e79 6177 2069 7320  attitude.yaw is 
-000145a0: 4e6f 6e65 206f 7220 6174 7469 7475 6465  None or attitude
-000145b0: 2e70 6974 6368 2069 7320 4e6f 6e65 206f  .pitch is None o
-000145c0: 7220 6174 7469 7475 6465 2e72 6f6c 6c20  r attitude.roll 
-000145d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000145e0: 2020 2020 2020 2020 2020 2020 2052 5f63               R_c
-000145f0: 616d 3275 746d 5f6c 6973 742e 6170 7065  am2utm_list.appe
-00014600: 6e64 2822 2229 0a20 2020 2020 2020 2020  nd("").         
-00014610: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00014620: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-00014630: 2020 2020 525f 6672 616d 6532 6e65 6420      R_frame2ned 
-00014640: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
-00014650: 6368 526f 6c6c 2861 7474 6974 7564 652e  chRoll(attitude.
-00014660: 7961 772c 6174 7469 7475 6465 2e70 6974  yaw,attitude.pit
-00014670: 6368 2c61 7474 6974 7564 652e 726f 6c6c  ch,attitude.roll
-00014680: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014690: 2020 525f 6361 6d32 6e65 6420 3d20 525f    R_cam2ned = R_
-000146a0: 6672 616d 6532 6e65 642e 646f 7428 525f  frame2ned.dot(R_
-000146b0: 6361 6d32 6672 616d 6529 0a20 2020 2020  cam2frame).     
-000146c0: 2020 2020 2020 2020 2020 2079 6177 2c70             yaw,p
-000146d0: 6974 6368 2c72 6f6c 6c20 3d20 6d69 7174  itch,roll = miqt
-000146e0: 672e 7961 7750 6974 6368 526f 6c6c 2852  g.yawPitchRoll(R
-000146f0: 5f63 616d 326e 6564 290a 2020 2020 2020  _cam2ned).      
-00014700: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
-00014710: 6465 2e79 6177 203d 2079 6177 0a20 2020  de.yaw = yaw.   
-00014720: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00014730: 6974 7564 652e 7069 7463 6820 3d20 7069  itude.pitch = pi
-00014740: 7463 680a 2020 2020 2020 2020 2020 2020  tch.            
-00014750: 2020 2020 6174 7469 7475 6465 2e72 6f6c      attitude.rol
-00014760: 6c20 3d20 726f 6c6c 0a0a 2020 2020 2020  l = roll..      
-00014770: 2020 2020 2020 2020 2020 525f 6361 6d53            R_camS
-00014780: 7464 3275 746d 203d 2073 656c 662e 6765  td2utm = self.ge
-00014790: 745f 525f 6361 6d53 7464 3275 746d 2852  t_R_camStd2utm(R
-000147a0: 5f63 616d 3266 7261 6d65 2c52 5f66 7261  _cam2frame,R_fra
-000147b0: 6d65 326e 6564 290a 2020 2020 2020 2020  me2ned).        
-000147c0: 2020 2020 2020 2020 525f 6361 6d32 7574          R_cam2ut
-000147d0: 6d5f 6c69 7374 2e61 7070 656e 6428 525f  m_list.append(R_
-000147e0: 6361 6d53 7464 3275 746d 2e66 6c61 7474  camStd2utm.flatt
-000147f0: 656e 2829 2e74 6f6c 6973 7428 2929 0a0a  en().tolist())..
-00014800: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-00014810: 762e 6c6f 6728 2261 7070 6c69 6564 2066  v.log("applied f
-00014820: 7261 6d65 2074 6f20 6361 6d65 7261 2072  rame to camera r
-00014830: 6f74 6174 696f 6e20 7961 772c 7069 7463  otation yaw,pitc
-00014840: 682c 726f 6c6c 203d 2022 202b 2073 7472  h,roll = " + str
-00014850: 2863 616d 6572 6132 4672 616d 655f 7961  (camera2Frame_ya
-00014860: 7729 202b 2022 2c22 202b 2073 7472 2863  w) + "," + str(c
-00014870: 616d 6572 6132 4672 616d 655f 7069 7463  amera2Frame_pitc
-00014880: 6829 202b 2022 2c22 202b 2073 7472 2863  h) + "," + str(c
-00014890: 616d 6572 6132 4672 616d 655f 726f 6c6c  amera2Frame_roll
-000148a0: 292c 646f 6e74 5368 6f77 3d54 7275 6529  ),dontShow=True)
-000148b0: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-000148c0: 2869 6d61 6765 5f64 7473 2920 3e20 303a  (image_dts) > 0:
-000148d0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-000148e0: 5772 6974 6520 746f 206e 6176 6967 6174  Write to navigat
-000148f0: 696f 6e20 7478 7420 6669 6c65 0a20 2020  ion txt file.   
-00014900: 2020 2020 2020 2020 2023 2068 6561 6465           # heade
-00014910: 720a 2020 2020 2020 2020 2020 2020 7265  r.            re
-00014920: 7320 3d20 6f70 656e 2869 6e74 5f61 7474  s = open(int_att
-00014930: 7574 7564 655f 6669 6c65 2c20 2277 2229  utude_file, "w")
-00014940: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014950: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
-00014960: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00014970: 5d5b 2769 6d67 275d 2b22 5c74 222b 6d69  ]['img']+"\t"+mi
-00014980: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00014990: 6d61 7269 7174 275d 5b27 7574 6327 5d29  mariqt']['utc'])
-000149a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000149b0: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
-000149c0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000149d0: 7269 7174 275d 5b27 7961 7727 5d29 0a20  riqt']['yaw']). 
-000149e0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-000149f0: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
-00014a00: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00014a10: 7174 275d 5b27 7069 7463 6827 5d29 0a20  qt']['pitch']). 
-00014a20: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00014a30: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
-00014a40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00014a50: 7174 275d 5b27 726f 6c6c 275d 290a 0a20  qt']['roll']).. 
-00014a60: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00014a70: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
-00014a80: 2020 2020 2020 2023 2064 6174 6120 6c69         # data li
-00014a90: 6e65 730a 2020 2020 2020 2020 2020 2020  nes.            
-00014aa0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00014ab0: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
-00014ac0: 2020 2020 2020 2066 6f72 2074 696d 6570         for timep
-00014ad0: 6f69 6e74 2069 6e20 696d 6167 655f 6474  oint in image_dt
-00014ae0: 735b 6669 6c65 5d3a 0a20 2020 2020 2020  s[file]:.       
-00014af0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00014b00: 2e77 7269 7465 2866 696c 652b 225c 7422  .write(file+"\t"
-00014b10: 2b74 696d 6570 6f69 6e74 2e64 6174 6554  +timepoint.dateT
-00014b20: 696d 6528 292e 7374 7266 7469 6d65 286d  ime().strftime(m
-00014b30: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00014b40: 735b 276d 6172 6971 7427 5d29 2920 0a20  s['mariqt'])) . 
-00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014b60: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
-00014b70: 6e74 2e79 6177 0a20 2020 2020 2020 2020  nt.yaw.         
-00014b80: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00014b90: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
-00014ba0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
-00014bb0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
-00014bc0: 6d65 706f 696e 742e 7069 7463 680a 2020  mepoint.pitch.  
-00014bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014be0: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
-00014bf0: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
-00014c00: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00014c10: 616c 203d 2074 696d 6570 6f69 6e74 2e72  al = timepoint.r
-00014c20: 6f6c 6c0a 2020 2020 2020 2020 2020 2020  oll.            
-00014c30: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00014c40: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
-00014c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014c60: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014c70: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00014c80: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
-00014c90: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00014ca0: 726f 762e 6164 6441 7267 756d 656e 7428  rov.addArgument(
-00014cb0: 2269 6e70 7574 4174 7469 7475 6465 4669  "inputAttitudeFi
-00014cc0: 6c65 222c 6174 745f 7061 7468 2c6f 7665  le",att_path,ove
-00014cd0: 7277 7269 7465 3d54 7275 6529 0a20 2020  rwrite=True).   
-00014ce0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00014cf0: 6f76 2e6c 6f67 2822 7061 7273 6564 2066  ov.log("parsed f
-00014d00: 726f 6d20 696e 7075 7441 7474 6974 7564  rom inputAttitud
-00014d10: 6546 696c 653a 2022 202b 2073 7472 2866  eFile: " + str(f
-00014d20: 7261 6d65 5f61 7474 5f68 6561 6465 7229  rame_att_header)
-00014d30: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-00014d40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014d50: 2e61 6464 5f69 7465 6d5f 696e 666f 5f74  .add_item_info_t
-00014d60: 6162 5f66 696c 6528 696e 745f 6174 7475  ab_file(int_attu
-00014d70: 7475 6465 5f66 696c 652c 225c 7422 2c6f  tude_file,"\t",o
-00014d80: 7574 7075 745f 6865 6164 6572 5f61 7474  utput_header_att
-00014d90: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00014da0: 2057 7269 7465 2074 6f20 706f 7365 2074   Write to pose t
-00014db0: 7874 2066 696c 650a 2020 2020 2020 2020  xt file.        
-00014dc0: 2020 2020 2320 6865 6164 6572 0a20 2020      # header.   
-00014dd0: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
-00014de0: 7065 6e28 696e 745f 706f 7365 5f66 696c  pen(int_pose_fil
-00014df0: 652c 2022 7722 290a 2020 2020 2020 2020  e, "w").        
-00014e00: 2020 2020 7265 732e 7772 6974 6528 6d69      res.write(mi
-00014e10: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00014e20: 6d61 7269 7174 275d 5b27 696d 6727 5d2b  mariqt']['img']+
-00014e30: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00014e40: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00014e50: 2775 7463 275d 290a 2020 2020 2020 2020  'utc']).        
-00014e60: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00014e70: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00014e80: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
-00014e90: 6f73 6527 5d29 0a20 2020 2020 2020 2020  ose']).         
-00014ea0: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
-00014eb0: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00014ec0: 2064 6174 6120 6c69 6e65 730a 2020 2020   data lines.    
-00014ed0: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
-00014ee0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-00014ef0: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
-00014f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014f10: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
-00014f20: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-00014f30: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00014f40: 2020 2020 2020 2069 6620 525f 6361 6d32         if R_cam2
-00014f50: 7574 6d5f 6c69 7374 5b69 5d20 3d3d 2022  utm_list[i] == "
-00014f60: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-00014f70: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
-00014f80: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00014f90: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00014fa0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00014fb0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014fc0: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
-00014fd0: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
-00014fe0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-00014ff0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-00015000: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
-00015010: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
-00015020: 7279 203d 2073 7472 287b 2770 6f73 652d  ry = str({'pose-
-00015030: 6162 736f 6c75 7465 2d6f 7269 656e 7461  absolute-orienta
-00015040: 7469 6f6e 2d75 746d 2d6d 6174 7269 7827  tion-utm-matrix'
-00015050: 3a52 5f63 616d 3275 746d 5f6c 6973 745b  :R_cam2utm_list[
-00015060: 695d 7d29 2e72 6570 6c61 6365 2827 5c6e  i]}).replace('\n
-00015070: 272c 2727 290a 2020 2020 2020 2020 2020  ','').          
-00015080: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00015090: 6974 6528 225c 7422 2b65 6e74 7279 290a  ite("\t"+entry).
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150b0: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
-000150c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000150d0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
-000150e0: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
-000150f0: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
-00015100: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
-00015110: 5f69 6e66 6f5f 7461 625f 6669 6c65 2869  _info_tab_file(i
-00015120: 6e74 5f70 6f73 655f 6669 6c65 2c22 5c74  nt_pose_file,"\t
-00015130: 222c 6f75 7470 7574 5f68 6561 6465 725f  ",output_header_
-00015140: 706f 7365 290a 2020 2020 2020 2020 2020  pose).          
-00015150: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
-00015160: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00015170: 7565 2c20 2241 7474 6974 7564 6520 6461  ue, "Attitude da
-00015180: 7461 2063 7265 6174 6564 2220 2b20 7061  ta created" + pa
-00015190: 7273 654d 7367 0a20 2020 2020 2020 2065  rseMsg.        e
-000151a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000151b0: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
-000151c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-000151d0: 7365 2c20 224e 6f20 696d 6167 6520 6174  se, "No image at
-000151e0: 7469 7475 6465 7320 666f 756e 6422 202b  titudes found" +
-000151f0: 2070 6172 7365 4d73 670a 2020 2020 2020   parseMsg.      
-00015200: 2020 0a20 2020 2020 2020 200a 2020 2020    .        .    
-00015210: 6465 6620 6372 6561 7465 496d 6167 6541  def createImageA
-00015220: 7474 6974 7564 6546 696c 6528 7365 6c66  ttitudeFile(self
-00015230: 2c20 6174 745f 7061 7468 3a73 7472 2c20  , att_path:str, 
-00015240: 6672 616d 655f 6174 745f 6865 6164 6572  frame_att_header
-00015250: 3a64 6963 742c 2063 616d 6572 6132 4672  :dict, camera2Fr
-00015260: 616d 655f 7961 773a 666c 6f61 742c 6361  ame_yaw:float,ca
-00015270: 6d65 7261 3246 7261 6d65 5f70 6974 6368  mera2Frame_pitch
-00015280: 3a66 6c6f 6174 2c63 616d 6572 6132 4672  :float,camera2Fr
-00015290: 616d 655f 726f 6c6c 3a66 6c6f 6174 2c0a  ame_roll:float,.
-000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152c0: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
-000152d0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-000152e0: 7061 6e67 6165 6127 5d2c 2063 6f6e 7374  pangaea'], const
-000152f0: 5f76 616c 7565 7320 3d20 7b7d 2c20 6f76  _values = {}, ov
-00015300: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
-00015310: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
-00015320: 5c74 222c 0a20 2020 2020 2020 2020 2020  \t",.           
-00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015340: 2020 2020 2061 7474 5f70 6174 685f 616e       att_path_an
-00015350: 676c 6573 5f69 6e5f 7261 6420 3d20 4661  gles_in_rad = Fa
-00015360: 6c73 652c 2076 6964 656f 5361 6d70 6c65  lse, videoSample
-00015370: 5365 636f 6e64 733d 312c 7265 636f 7264  Seconds=1,record
-00015380: 7332 6265 496e 7665 7274 6564 3d5b 5d29  s2beInverted=[])
-00015390: 3a0a 2020 2020 2020 2020 2222 2220 4465  :.        """ De
-000153a0: 7072 6563 6174 6465 202d 2075 7365 2063  precatde - use c
-000153b0: 7265 6174 655f 696d 6167 655f 6174 7469  reate_image_atti
-000153c0: 7475 6465 5f66 696c 6520 2222 220a 2020  tude_file """.  
-000153d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000153e0: 662e 6372 6561 7465 5f69 6d61 6765 5f61  f.create_image_a
-000153f0: 7474 6974 7564 655f 6669 6c65 2861 7474  ttitude_file(att
-00015400: 5f70 6174 682c 2066 7261 6d65 5f61 7474  _path, frame_att
-00015410: 5f68 6561 6465 722c 2063 616d 6572 6132  _header, camera2
-00015420: 4672 616d 655f 7961 772c 2063 616d 6572  Frame_yaw, camer
-00015430: 6132 4672 616d 655f 7069 7463 682c 2063  a2Frame_pitch, c
-00015440: 616d 6572 6132 4672 616d 655f 726f 6c6c  amera2Frame_roll
-00015450: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
-00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015480: 2020 6461 7465 5f66 6f72 6d61 742c 2063    date_format, c
-00015490: 6f6e 7374 5f76 616c 7565 732c 206f 7665  onst_values, ove
-000154a0: 7277 7269 7465 2c20 636f 6c5f 7365 7061  rwrite, col_sepa
-000154b0: 7261 746f 722c 2061 7474 5f70 6174 685f  rator, att_path_
-000154c0: 616e 676c 6573 5f69 6e5f 7261 642c 2076  angles_in_rad, v
-000154d0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
-000154e0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015510: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
-00015520: 7274 6564 290a 2020 2020 2020 2020 0a0a  rted).        ..
-00015530: 2020 2020 6465 6620 6765 745f 525f 6361      def get_R_ca
-00015540: 6d53 7464 3275 746d 2873 656c 662c 525f  mStd2utm(self,R_
-00015550: 6361 6d32 6672 616d 653a 6e70 2e61 7272  cam2frame:np.arr
-00015560: 6179 2c52 5f66 7261 6d65 326e 6564 3a6e  ay,R_frame2ned:n
-00015570: 702e 6172 7261 7929 3a0a 2020 2020 2020  p.array):.      
-00015580: 2020 2222 2220 7265 7472 756e 2072 6f74    """ retrun rot
-00015590: 6174 696f 6e20 6d61 7472 6978 2052 2074  ation matrix R t
-000155a0: 7261 6e66 6f72 6d69 6e67 2066 726f 6d20  ranforming from 
-000155b0: 6361 6d53 7464 3a20 2878 2c79 2c7a 203d  camStd: (x,y,z =
-000155c0: 2072 6967 6874 2c62 7574 746f 6d2c 6c69   right,buttom,li
-000155d0: 6e65 206f 6620 7369 6768 7429 2074 6f20  ne of sight) to 
-000155e0: 7574 6d20 2878 2c79 2c7a 203d 2065 6173  utm (x,y,z = eas
-000155f0: 7469 6e67 2c6e 6f72 7468 696e 672c 7570  ting,northing,up
-00015600: 2920 2222 220a 2020 2020 2020 2020 525f  ) """.        R_
-00015610: 6361 6d69 4644 4f32 6361 6d53 7464 203d  camiFDO2camStd =
-00015620: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
-00015630: 6852 6f6c 6c28 3930 2c30 2c30 2920 2320  hRoll(90,0,0) # 
-00015640: 696e 2069 4644 4f20 6361 6d3a 2028 782c  in iFDO cam: (x,
-00015650: 792c 7a20 3d20 746f 702c 7269 6768 742c  y,z = top,right,
-00015660: 6c69 6e65 206f 6620 7369 6768 7429 2062  line of sight) b
-00015670: 7574 2066 6f72 2070 6f73 6520 7468 6520  ut for pose the 
-00015680: 2773 7461 6e64 6172 6427 2063 616d 5374  'standard' camSt
-00015690: 643a 2028 782c 792c 7a20 3d20 7269 6768  d: (x,y,z = righ
-000156a0: 742c 6275 7474 6f6d 2c6c 696e 6520 6f66  t,buttom,line of
-000156b0: 2073 6967 6874 2920 6973 2065 7870 6563   sight) is expec
-000156c0: 7465 640a 2020 2020 2020 2020 525f 6361  ted.        R_ca
-000156d0: 6d53 7464 3266 7261 6d65 203d 2052 5f63  mStd2frame = R_c
-000156e0: 616d 3266 7261 6d65 2e64 6f74 2852 5f63  am2frame.dot(R_c
-000156f0: 616d 6946 444f 3263 616d 5374 6429 0a20  amiFDO2camStd). 
-00015700: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
-00015710: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
-00015720: 642e 646f 7428 525f 6361 6d53 7464 3266  d.dot(R_camStd2f
-00015730: 7261 6d65 290a 2020 2020 2020 2020 525f  rame).        R_
-00015740: 6e65 6432 7574 6d20 3d20 6d69 7174 672e  ned2utm = miqtg.
-00015750: 525f 5859 5a28 3138 302c 302c 3930 2920  R_XYZ(180,0,90) 
-00015760: 2320 7769 7468 2075 746d 2078 2c79 2c7a  # with utm x,y,z
-00015770: 203d 2065 6173 7469 6e67 2c6e 6f72 7468   = easting,north
-00015780: 696e 672c 7570 0a20 2020 2020 2020 2052  ing,up.        R
-00015790: 5f63 616d 5374 6432 7574 6d20 3d20 525f  _camStd2utm = R_
-000157a0: 6e65 6432 7574 6d2e 646f 7428 525f 6361  ned2utm.dot(R_ca
-000157b0: 6d53 7464 326e 6564 292e 726f 756e 6428  mStd2ned).round(
-000157c0: 3529 0a20 2020 2020 2020 2072 6574 7572  5).        retur
-000157d0: 6e20 525f 6361 6d53 7464 3275 746d 0a0a  n R_camStd2utm..
-000157e0: 0a20 2020 2064 6566 2066 696e 644e 6176  .    def findNav
-000157f0: 4461 7461 466f 7249 6d61 6765 2873 656c  DataForImage(sel
-00015800: 662c 6461 7461 3a6d 6971 7467 2e4e 756d  f,data:miqtg.Num
-00015810: 4461 7461 5469 6d65 5374 616d 7065 642c  DataTimeStamped,
-00015820: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-00015830: 6473 3d31 293a 0a20 2020 2020 2020 2022  ds=1):.        "
-00015840: 2222 2063 7265 6174 6573 2061 2064 6963  "" creates a dic
-00015850: 7420 2869 6d61 6765 5f64 7473 2920 7769  t (image_dts) wi
-00015860: 7468 2066 696c 6520 6e61 6d65 2061 7320  th file name as 
-00015870: 6b65 7920 616e 6420 6120 6c69 7374 206f  key and a list o
-00015880: 6620 6461 7461 2065 6c65 6d65 6e74 7320  f data elements 
-00015890: 6173 2076 616c 7565 2e20 0a20 2020 2020  as value. .     
-000158a0: 2020 2020 2020 2049 6e20 6361 7365 206f         In case o
-000158b0: 6620 7068 6f74 6f73 2074 6865 206c 6973  f photos the lis
-000158c0: 7420 6861 7320 6f6e 6c79 2061 2073 696e  t has only a sin
-000158d0: 676c 6520 656e 7472 792c 2066 6f72 2076  gle entry, for v
-000158e0: 6964 656f 7320 6974 2068 6173 2076 6964  ideos it has vid
-000158f0: 656f 2064 7572 6174 696f 6e20 5b73 6563  eo duration [sec
-00015900: 5d20 2f20 7669 6465 6f53 616d 706c 6553  ] / videoSampleS
-00015910: 6563 6f6e 6473 2065 6e74 7269 6573 2e0a  econds entries..
-00015920: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
-00015930: 726e 7320 7375 6363 6573 732c 2069 6d61  rns success, ima
-00015940: 6765 5f64 7473 2c20 6d73 6720 2222 220a  ge_dts, msg """.
-00015950: 0a20 2020 2020 2020 2069 6620 7669 6465  .        if vide
-00015960: 6f53 616d 706c 6553 6563 6f6e 6473 203c  oSampleSeconds <
-00015970: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00015980: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
-00015990: 2822 6669 6e64 4e61 7644 6174 6146 6f72  ("findNavDataFor
-000159a0: 496d 6167 653a 2076 6964 656f 5361 6d70  Image: videoSamp
-000159b0: 6c65 5365 636f 6e64 7320 6d75 7374 2062  leSeconds must b
-000159c0: 6520 6772 6561 7465 7220 3022 290a 0a20  e greater 0").. 
-000159d0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
-000159e0: 736f 7274 6564 2074 696d 6520 706f 696e  sorted time poin
-000159f0: 7473 0a20 2020 2020 2020 2074 696d 655f  ts.        time_
-00015a00: 706f 696e 7473 203d 206c 6973 7428 6461  points = list(da
-00015a10: 7461 2e6b 6579 7328 2929 0a20 2020 2020  ta.keys()).     
-00015a20: 2020 2074 696d 655f 706f 696e 7473 2e73     time_points.s
-00015a30: 6f72 7428 290a 2020 2020 2020 2020 756e  ort().        un
-00015a40: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-00015a50: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
-00015a60: 6d61 6765 5f64 7473 203d 207b 7d0a 2020  mage_dts = {}.  
-00015a70: 2020 2020 2020 7374 6172 7453 6561 7263        startSearc
-00015a80: 6849 6e64 6578 203d 2030 0a20 2020 2020  hIndex = 0.     
-00015a90: 2020 2069 6d61 6765 7349 6e52 6177 203d     imagesInRaw =
-00015aa0: 2020 7365 6c66 2e69 6d61 6765 7349 6e49    self.imagesInI
-00015ab0: 6d61 6765 7344 6972 2829 0a20 2020 2020  magesDir().     
-00015ac0: 2020 2069 6d61 6765 7349 6e52 6177 536f     imagesInRawSo
-00015ad0: 7274 6564 4c69 7374 203d 2073 656c 662e  rtedList = self.
-00015ae0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00015af0: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
-00015b00: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
-00015b10: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
-00015b20: 6772 6573 734d 7367 2822 496e 7465 7270  gressMsg("Interp
-00015b30: 6f6c 6174 696e 6720 6e61 7669 6761 7469  olating navigati
-00015b40: 6f6e 2066 6f72 2069 6d61 6765 222c 206c  on for image", l
-00015b50: 656e 2869 6d61 6765 7349 6e52 6177 292c  en(imagesInRaw),
-00015b60: 6d6f 6475 6c6f 3d31 290a 2020 2020 2020  modulo=1).      
-00015b70: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-00015b80: 6167 6573 496e 5261 7753 6f72 7465 644c  agesInRawSortedL
-00015b90: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00015ba0: 2070 726f 672e 7072 6f67 7265 7373 2829   prog.progress()
-00015bb0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-00015bc0: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00015bd0: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
-00015be0: 0a20 2020 2020 2020 2020 2020 2064 745f  .            dt_
-00015bf0: 696d 6167 6520 3d20 6d69 7174 632e 7061  image = miqtc.pa
-00015c00: 7273 6546 696c 6544 6174 6554 696d 6541  rseFileDateTimeA
-00015c10: 7355 5443 2866 696c 655f 6e61 6d65 290a  sUTC(file_name).
-00015c20: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
-00015c30: 6d61 6765 5f74 7320 3d20 696e 7428 6474  mage_ts = int(dt
-00015c40: 5f69 6d61 6765 2e74 696d 6573 7461 6d70  _image.timestamp
-00015c50: 2829 202a 2031 3030 3029 0a0a 2020 2020  () * 1000)..    
-00015c60: 2020 2020 2020 2020 7275 6e54 696d 6520          runTime 
-00015c70: 3d20 696d 6167 6573 496e 5261 775b 6669  = imagesInRaw[fi
-00015c80: 6c65 5d5b 315d 2023 202d 3120 666f 7220  le][1] # -1 for 
-00015c90: 7068 6f74 6f73 0a20 2020 2020 2020 2020  photos.         
-00015ca0: 2020 2023 2076 6964 656f 0a20 2020 2020     # video.     
-00015cb0: 2020 2020 2020 2069 6620 696d 6167 6573         if images
-00015cc0: 496e 5261 775b 6669 6c65 5d5b 325d 2069  InRaw[file][2] i
-00015cd0: 6e20 6d69 7174 762e 7669 6465 6f5f 7479  n miqtv.video_ty
-00015ce0: 7065 7320 616e 6420 7275 6e54 696d 6520  pes and runTime 
-00015cf0: 3c3d 2030 3a20 2320 6578 740a 2020 2020  <= 0: # ext.    
-00015d00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00015d10: 7428 2243 6175 7469 6f6e 2120 436f 756c  t("Caution! Coul
-00015d20: 6420 6e6f 7420 7265 6164 2076 6964 656f  d not read video
-00015d30: 2072 756e 2074 696d 6520 6672 6f6d 2066   run time from f
-00015d40: 696c 6522 2c66 696c 6529 2023 2054 4f44  ile",file) # TOD
-00015d50: 4f20 646f 6573 2074 6869 7320 6861 7070  O does this happ
-00015d60: 656e 3f20 4861 6e64 6c65 2062 6574 7465  en? Handle bette
-00015d70: 723f 0a0a 2020 2020 2020 2020 2020 2020  r?..            
-00015d80: 7361 6d70 6c65 5469 6d65 5365 6373 203d  sampleTimeSecs =
-00015d90: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
-00015da0: 6f73 5f6c 6973 7420 3d20 5b5d 0a20 2020  os_list = [].   
-00015db0: 2020 2020 2020 2020 2067 6f20 3d20 5472           go = Tr
-00015dc0: 7565 0a20 2020 2020 2020 2020 2020 2077  ue.            w
-00015dd0: 6869 6c65 2067 6f3a 0a20 2020 2020 2020  hile go:.       
-00015de0: 2020 2020 2020 2020 2074 7279 3a20 2020           try:   
-00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
-00015e10: 2020 2020 2020 706f 732c 2073 7461 7274        pos, start
-00015e20: 5365 6172 6368 496e 6465 7820 3d20 6461  SearchIndex = da
-00015e30: 7461 2e69 6e74 6572 706f 6c61 7465 4174  ta.interpolateAt
-00015e40: 5469 6d65 2864 745f 696d 6167 655f 7473  Time(dt_image_ts
-00015e50: 202b 2073 616d 706c 6554 696d 6553 6563   + sampleTimeSec
-00015e60: 7320 2a20 3130 3030 2c74 696d 655f 706f  s * 1000,time_po
-00015e70: 696e 7473 2c73 7461 7274 5365 6172 6368  ints,startSearch
-00015e80: 496e 6465 7829 0a20 2020 2020 2020 2020  Index).         
-00015e90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
-00015ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015eb0: 2320 696e 7465 7270 6f6c 6174 6541 7454  # interpolateAtT
-00015ec0: 696d 6520 7265 7475 726e 7320 4e6f 6e65  ime returns None
-00015ed0: 2076 616c 7565 7320 6966 2074 696d 6520   values if time 
-00015ee0: 6f75 7420 6f66 2072 616e 6765 0a20 2020  out of range.   
-00015ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f00: 2069 6620 706f 732e 636f 7461 696e 734e   if pos.cotainsN
-00015f10: 6f6e 6556 616c 7565 7349 6e52 6571 7569  oneValuesInRequi
-00015f20: 7265 6446 6965 6c64 7328 293a 0a20 2020  redFields():.   
-00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f40: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
-00015f50: 6d65 506f 696e 7473 2e61 7070 656e 6428  mePoints.append(
-00015f60: 2864 745f 696d 6167 655f 7473 202b 2073  (dt_image_ts + s
-00015f70: 616d 706c 6554 696d 6553 6563 7320 2a20  ampleTimeSecs * 
-00015f80: 3130 3030 292f 3130 3030 290a 2020 2020  1000)/1000).    
-00015f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fa0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00015fb0: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00015fc0: 735f 6c69 7374 2e61 7070 656e 6428 706f  s_list.append(po
-00015fd0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00015fe0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00015ff0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00016000: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00016010: 7475 726e 2046 616c 7365 2c20 696d 6167  turn False, imag
-00016020: 655f 6474 732c 2022 436f 756c 6420 6e6f  e_dts, "Could no
-00016030: 7420 6669 6e64 2069 6d61 6765 2074 696d  t find image tim
-00016040: 6520 222b 2064 6174 6574 696d 652e 6461  e "+ datetime.da
-00016050: 7465 7469 6d65 2e75 7463 6672 6f6d 7469  tetime.utcfromti
-00016060: 6d65 7374 616d 7028 2864 745f 696d 6167  mestamp((dt_imag
-00016070: 655f 7473 202b 2073 616d 706c 6554 696d  e_ts + sampleTim
-00016080: 6553 6563 7320 2a20 3130 3030 292f 3130  eSecs * 1000)/10
-00016090: 3030 292e 7374 7266 7469 6d65 286d 6971  00).strftime(miq
-000160a0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-000160b0: 276d 6172 6971 7427 5d29 202b 2220 696e  'mariqt']) +" in
-000160c0: 2022 2b73 7472 2864 6174 612e 6c65 6e28   "+str(data.len(
-000160d0: 2929 2b22 2064 6174 6120 706f 7369 7469  ))+" data positi
-000160e0: 6f6e 7322 202b 2073 7472 2865 2e61 7267  ons" + str(e.arg
-000160f0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-00016100: 2020 2073 616d 706c 6554 696d 6553 6563     sampleTimeSec
-00016110: 7320 2b3d 2076 6964 656f 5361 6d70 6c65  s += videoSample
-00016120: 5365 636f 6e64 730a 2020 2020 2020 2020  Seconds.        
-00016130: 2020 2020 2020 2020 6966 2073 616d 706c          if sampl
-00016140: 6554 696d 6553 6563 7320 3e20 7275 6e54  eTimeSecs > runT
-00016150: 696d 653a 0a20 2020 2020 2020 2020 2020  ime:.           
-00016160: 2020 2020 2020 2020 2067 6f20 3d20 4661           go = Fa
-00016170: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00016180: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-00016190: 6765 5f64 7473 5b66 696c 655f 6e61 6d65  ge_dts[file_name
-000161a0: 5d20 3d20 706f 735f 6c69 7374 0a20 2020  ] = pos_list.   
-000161b0: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
-000161c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000161d0: 4d73 6720 3d20 2222 0a20 2020 2020 2020  Msg = "".       
-000161e0: 2069 6620 6c65 6e28 756e 6d61 7463 6865   if len(unmatche
-000161f0: 6454 696d 6550 6f69 6e74 7329 2021 3d20  dTimePoints) != 
-00016200: 303a 0a20 2020 2020 2020 2020 2020 2075  0:.            u
-00016210: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
-00016220: 7473 2e73 6f72 7428 290a 2020 2020 2020  ts.sort().      
-00016230: 2020 2020 2020 756e 6d61 7463 6865 6454        unmatchedT
-00016240: 696d 6550 6f69 6e74 7320 3d20 5b64 6174  imePoints = [dat
-00016250: 6574 696d 652e 6461 7465 7469 6d65 2e75  etime.datetime.u
-00016260: 7463 6672 6f6d 7469 6d65 7374 616d 7028  tcfromtimestamp(
-00016270: 7473 292e 7374 7266 7469 6d65 286d 6971  ts).strftime(miq
-00016280: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-00016290: 276d 6172 6971 7427 5d29 2066 6f72 2074  'mariqt']) for t
-000162a0: 7320 696e 2075 6e6d 6174 6368 6564 5469  s in unmatchedTi
-000162b0: 6d65 506f 696e 7473 5d0a 2020 2020 2020  mePoints].      
-000162c0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
-000162d0: 3d20 2243 6175 7469 6f6e 2120 4e61 7669  = "Caution! Navi
-000162e0: 6761 7469 6f6e 206e 6f74 2066 6f75 6e64  gation not found
-000162f0: 2066 6f72 2074 6865 2066 6f6c 6c6f 7769   for the followi
-00016300: 6e67 2069 6d61 6765 2074 696d 6520 706f  ng image time po
-00016310: 696e 7473 2e20 446f 7562 6c65 2063 6865  ints. Double che
-00016320: 636b 206f 7220 7072 6f76 6964 6520 6174  ck or provide at
-00016330: 206c 6561 7374 2073 7461 7469 6320 6465   least static de
-00016340: 6661 756c 7420 6e61 7669 6761 7469 6f6e  fault navigation
-00016350: 2069 6e20 6865 6164 6572 2066 6965 6c64   in header field
-00016360: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
-00016370: 7265 7475 726e 4d73 6720 2b3d 2022 5c6e  returnMsg += "\n
-00016380: 2220 2b20 225c 6e22 2e6a 6f69 6e28 756e  " + "\n".join(un
-00016390: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
-000163a0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-000163b0: 6e20 5472 7565 2c20 696d 6167 655f 6474  n True, image_dt
-000163c0: 732c 2072 6574 7572 6e4d 7367 0a0a 0a20  s, returnMsg... 
-000163d0: 2020 2064 6566 2063 7265 6174 655f 696d     def create_im
-000163e0: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
-000163f0: 696c 6528 7365 6c66 2c20 6e61 765f 7061  ile(self, nav_pa
-00016400: 7468 3a20 7374 722c 206e 6176 5f68 6561  th: str, nav_hea
-00016410: 6465 723d 6d69 7174 762e 706f 735f 6865  der=miqtv.pos_he
-00016420: 6164 6572 5b27 7061 6e67 6165 6127 5d2c  ader['pangaea'],
-00016430: 2064 6174 655f 666f 726d 6174 3d6d 6971   date_format=miq
-00016440: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-00016450: 2770 616e 6761 6561 275d 2c20 6f76 6572  'pangaea'], over
-00016460: 7772 6974 653d 4661 6c73 652c 2063 6f6c  write=False, col
-00016470: 5f73 6570 6172 6174 6f72 203d 2022 5c74  _separator = "\t
-00016480: 222c 2076 6964 656f 5361 6d70 6c65 5365  ", videoSampleSe
-00016490: 636f 6e64 733d 312c 0a20 2020 2020 2020  conds=1,.       
-000164a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000164b0: 2020 2020 2020 2020 2020 2020 206f 6666               off
-000164c0: 7365 745f 783d 302c 206f 6666 7365 745f  set_x=0, offset_
-000164d0: 793d 302c 206f 6666 7365 745f 7a3d 302c  y=0, offset_z=0,
-000164e0: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
-000164f0: 4661 6c73 652c 2072 6563 6f72 6473 3262  False, records2b
-00016500: 6549 6e76 6572 7465 643d 5b5d 293a 0a20  eInverted=[]):. 
-00016510: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-00016520: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
-00016530: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
-00016540: 7769 7468 2034 2e35 4420 6e61 7669 6761  with 4.5D naviga
-00016550: 7469 6f6e 2064 6174 6120 666f 7220 6561  tion data for ea
-00016560: 6368 2069 6d61 6765 2c20 692e 652e 2061  ch image, i.e. a
-00016570: 2073 696e 676c 6520 726f 7720 7065 7220   single row per 
-00016580: 7068 6f74 6f2c 2076 6964 656f 2064 7572  photo, video dur
-00016590: 6174 696f 6e20 5b73 6563 5d20 2f20 7669  ation [sec] / vi
-000165a0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-000165b0: 2072 6f77 7320 7065 7220 7669 6465 6f2e   rows per video.
-000165c0: 0a20 2020 2020 2020 2020 2020 206e 6176  .            nav
-000165d0: 5f68 6561 6465 7220 6d75 7374 2062 6520  _header must be 
-000165e0: 6469 6374 2063 6f6e 7461 696e 696e 6720  dict containing 
-000165f0: 7468 6520 6b65 7973 2027 7574 6327 2c27  the keys 'utc','
-00016600: 6c61 7427 2c27 6c6f 6e27 2c27 6465 7027  lat','lon','dep'
-00016610: 286f 7220 2761 6c74 2729 2c20 6f70 7469  (or 'alt'), opti
-00016620: 6f6e 616c 3a20 2768 6774 272c 2775 6e63  onal: 'hgt','unc
-00016630: 6572 7427 2077 6974 6820 7468 6520 7265  ert' with the re
-00016640: 7370 6563 7469 7665 2063 6f6c 756d 6e20  spective column 
-00016650: 6865 6164 6572 7320 6173 2076 616c 7565  headers as value
-00016660: 7320 0a20 2020 2020 2020 2020 2020 2069  s .            i
-00016670: 6620 6f6e 6520 6f66 2074 6865 2076 6568  f one of the veh
-00016680: 6963 6c65 2078 2c79 2c7a 206f 6666 7365  icle x,y,z offse
-00016690: 7473 205b 6d5d 2069 7320 6e6f 7420 3020  ts [m] is not 0 
-000166a0: 616e 6420 6e61 765f 6865 6164 6572 2061  and nav_header a
-000166b0: 6c73 6f20 636f 6e74 6169 6e73 2027 7961  lso contains 'ya
-000166c0: 7727 2c27 7069 7463 6827 2c27 726f 6c6c  w','pitch','roll
-000166d0: 2720 6c65 7665 7261 726d 206f 6666 7365  ' leverarm offse
-000166e0: 7473 2061 7265 2063 6f6d 7065 6e73 6174  ts are compensat
-000166f0: 6564 2066 6f72 2022 2222 0a0a 2020 2020  ed for """..    
-00016700: 2020 2020 6966 2073 656c 662e 696e 7465      if self.inte
-00016710: 726d 6564 6961 7465 4e61 7646 696c 6545  rmediateNavFileE
-00016720: 7869 7374 7328 2920 616e 6420 6e6f 7420  xists() and not 
-00016730: 6f76 6572 7772 6974 653a 0a20 2020 2020  overwrite:.     
-00016740: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00016750: 7565 2c20 224f 7574 7075 7420 6669 6c65  ue, "Output file
-00016760: 2065 7869 7374 733a 2022 2b73 656c 662e   exists: "+self.
-00016770: 6765 745f 696e 745f 6e61 765f 6669 6c65  get_int_nav_file
-00016780: 2829 0a0a 2020 2020 2020 2020 6966 206e  ()..        if n
-00016790: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
-000167a0: 7328 6e61 765f 7061 7468 293a 0a20 2020  s(nav_path):.   
-000167b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000167c0: 4661 6c73 652c 2022 4e61 7669 6761 7469  False, "Navigati
-000167d0: 6f6e 2066 696c 6520 6e6f 7420 666f 756e  on file not foun
-000167e0: 643a 2022 2b6e 6176 5f70 6174 680a 0a20  d: "+nav_path.. 
-000167f0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-00016800: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
-00016810: 662e 696d 6167 6573 4469 7229 3a0a 2020  f.imagesDir):.  
-00016820: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00016830: 2046 616c 7365 2c20 2249 6d61 6765 2066   False, "Image f
-00016840: 6f6c 6465 7220 6e6f 7420 666f 756e 643a  older not found:
-00016850: 2022 2b20 7365 6c66 2e69 6d61 6765 7344   "+ self.imagesD
-00016860: 6972 0a0a 2020 2020 2020 2020 7320 3d20  ir..        s = 
-00016870: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
-00016880: 6e67 4d73 6728 2243 7265 6174 696e 6720  ngMsg("Creating 
-00016890: 6974 656d 7327 206e 6176 6967 6174 696f  items' navigatio
-000168a0: 6e20 6461 7461 2229 0a20 2020 2020 2020  n data").       
-000168b0: 2072 6574 7572 6e4d 7367 203d 2022 220a   returnMsg = "".
-000168c0: 2020 2020 2020 2020 636f 6d70 656e 7361          compensa
-000168d0: 744f 6666 7365 7473 203d 2046 616c 7365  tOffsets = False
-000168e0: 0a20 2020 2020 2020 2069 6620 286f 6666  .        if (off
-000168f0: 7365 745f 7821 3d30 206f 7220 6f66 6673  set_x!=0 or offs
-00016900: 6574 5f79 213d 3020 6f72 206f 6666 7365  et_y!=0 or offse
-00016910: 745f 7a21 3d30 2920 616e 6420 2779 6177  t_z!=0) and 'yaw
-00016920: 2720 696e 206e 6176 5f68 6561 6465 7220  ' in nav_header 
-00016930: 616e 6420 2770 6974 6368 2720 696e 206e  and 'pitch' in n
-00016940: 6176 5f68 6561 6465 7220 616e 6420 2772  av_header and 'r
-00016950: 6f6c 6c27 2069 6e20 6e61 765f 6865 6164  oll' in nav_head
-00016960: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00016970: 636f 6d70 656e 7361 744f 6666 7365 7473  compensatOffsets
-00016980: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
-00016990: 2023 2063 6865 636b 2069 6620 666f 7220   # check if for 
-000169a0: 6d69 7373 696e 6720 6669 656c 6473 2074  missing fields t
-000169b0: 6865 7265 2061 7265 2063 6f6e 7374 2076  here are const v
-000169c0: 616c 7565 7320 696e 2068 6561 6465 720a  alues in header.
-000169d0: 2020 2020 2020 2020 636f 6e73 745f 7661          const_va
-000169e0: 6c75 6573 203d 207b 7d0a 2020 2020 2020  lues = {}.      
-000169f0: 2020 666f 7220 6e61 7646 6965 6c64 2069    for navField i
-00016a00: 6e20 6d69 7174 762e 706f 735f 6865 6164  n miqtv.pos_head
-00016a10: 6572 5b27 6d61 7269 7174 275d 3a0a 2020  er['mariqt']:.  
-00016a20: 2020 2020 2020 2020 2020 7265 7370 6563            respec
-00016a30: 7469 7665 4865 6164 6572 4669 656c 6420  tiveHeaderField 
-00016a40: 3d20 6d69 7174 762e 636f 6c5f 6865 6164  = miqtv.col_head
-00016a50: 6572 5b22 6d61 7269 7174 225d 5b6e 6176  er["mariqt"][nav
-00016a60: 4669 656c 645d 0a20 2020 2020 2020 2020  Field].         
-00016a70: 2020 2069 6620 6e61 7646 6965 6c64 206e     if navField n
-00016a80: 6f74 2069 6e20 6e61 765f 6865 6164 6572  ot in nav_header
-00016a90: 2061 6e64 2028 7265 7370 6563 7469 7665   and (respective
-00016aa0: 4865 6164 6572 4669 656c 6420 696e 2073  HeaderField in s
-00016ab0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00016ac0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-00016ad0: 4b65 795d 2061 6e64 2073 656c 662e 6669  Key] and self.fi
-00016ae0: 6e64 546d 7046 6965 6c64 3228 7265 7370  ndTmpField2(resp
-00016af0: 6563 7469 7665 4865 6164 6572 4669 656c  ectiveHeaderFiel
-00016b00: 6429 2021 3d20 2222 293a 200a 2020 2020  d) != ""): .    
-00016b10: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
-00016b20: 745f 7661 6c75 6573 5b6e 6176 4669 656c  t_values[navFiel
-00016b30: 645d 203d 2073 656c 662e 6669 6e64 546d  d] = self.findTm
-00016b40: 7046 6965 6c64 2872 6573 7065 6374 6976  pField(respectiv
-00016b50: 6548 6561 6465 7246 6965 6c64 290a 0a20  eHeaderField).. 
-00016b60: 2020 2020 2020 2020 2320 6861 6e64 6c65          # handle
-00016b70: 2061 6c74 2076 7320 6465 700a 2020 2020   alt vs dep.    
-00016b80: 2020 2020 6966 2027 616c 7427 2069 6e20      if 'alt' in 
-00016b90: 6e61 765f 6865 6164 6572 2061 6e64 2027  nav_header and '
-00016ba0: 6465 7027 2069 6e20 6e61 765f 6865 6164  dep' in nav_head
-00016bb0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
-00016bc0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00016bd0: 4578 6365 7074 696f 6e28 2227 616c 7427  Exception("'alt'
-00016be0: 2061 6e64 2027 6465 7027 2070 726f 7669   and 'dep' provi
-00016bf0: 6465 642e 2052 6564 756e 6461 6e74 2c20  ded. Redundant, 
-00016c00: 616c 7420 3d20 2d20 6465 702e 2050 726f  alt = - dep. Pro
-00016c10: 7669 6465 6420 6f6e 6c79 206f 6e65 206f  vided only one o
-00016c20: 6620 626f 7468 2e22 290a 2020 2020 2020  f both.").      
-00016c30: 2020 0a20 2020 2020 2020 2023 204c 6f61    .        # Loa
-00016c40: 6420 6e61 7669 6761 7469 6f6e 2064 6174  d navigation dat
-00016c50: 6120 2869 6620 2761 6c74 2720 696e 7374  a (if 'alt' inst
-00016c60: 6561 6420 6f66 2027 6465 7027 2c20 6974  ead of 'dep', it
-00016c70: 7320 6175 746f 6d61 7469 6361 6c6c 7920  s automatically 
-00016c80: 696e 7665 7274 6564 290a 2020 2020 2020  inverted).      
-00016c90: 2020 6e61 765f 6461 7461 2c20 7061 7273    nav_data, pars
-00016ca0: 654d 7367 203d 206d 6971 746e 2e72 6561  eMsg = miqtn.rea
-00016cb0: 6441 6c6c 506f 7369 7469 6f6e 7346 726f  dAllPositionsFro
-00016cc0: 6d46 696c 6550 6174 6828 6e61 765f 7061  mFilePath(nav_pa
-00016cd0: 7468 2c20 6e61 765f 6865 6164 6572 2c20  th, nav_header, 
-00016ce0: 6461 7465 5f66 6f72 6d61 742c 636f 6c5f  date_format,col_
-00016cf0: 7365 7061 7261 746f 723d 636f 6c5f 7365  separator=col_se
-00016d00: 7061 7261 746f 722c 636f 6e73 745f 7661  parator,const_va
-00016d10: 6c75 6573 3d63 6f6e 7374 5f76 616c 7565  lues=const_value
-00016d20: 7329 0a20 2020 2020 2020 2069 6620 7061  s).        if pa
-00016d30: 7273 654d 7367 2021 3d20 2222 3a0a 2020  rseMsg != "":.  
-00016d40: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-00016d50: 726f 762e 6c6f 6728 7061 7273 654d 7367  rov.log(parseMsg
-00016d60: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-00016d70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00016d80: 726e 4d73 6720 3d20 225c 6e22 202b 2070  rnMsg = "\n" + p
-00016d90: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
-00016da0: 2023 2066 696e 6420 666f 7220 6561 6368   # find for each
-00016db0: 2069 6d61 6765 2074 6865 2072 6573 7065   image the respe
-00016dc0: 6374 6976 6520 6e61 7669 6761 7469 6f6e  ctive navigation
-00016dd0: 2064 6174 610a 2020 2020 2020 2020 732e   data.        s.
-00016de0: 7374 6f70 2829 0a20 2020 2020 2020 2073  stop().        s
-00016df0: 7563 6365 7373 2c20 696d 6167 655f 6474  uccess, image_dt
-00016e00: 732c 206d 7367 203d 2073 656c 662e 6669  s, msg = self.fi
-00016e10: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
-00016e20: 6528 6e61 765f 6461 7461 2c76 6964 656f  e(nav_data,video
-00016e30: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
-00016e40: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-00016e50: 2e6c 6f67 286d 7367 2c64 6f6e 7453 686f  .log(msg,dontSho
-00016e60: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
-00016e70: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
-00016e80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00016e90: 4d73 6720 2b3d 2022 5c6e 2220 2b20 6d73  Msg += "\n" + ms
-00016ea0: 670a 2020 2020 2020 2020 6966 206e 6f74  g.        if not
-00016eb0: 2073 7563 6365 7373 3a0a 2020 2020 2020   success:.      
-00016ec0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00016ed0: 7365 2c20 7265 7475 726e 4d73 670a 2020  se, returnMsg.  
-00016ee0: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
-00016ef0: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
-00016f00: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
-00016f10: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
-00016f20: 2229 0a0a 2020 2020 2020 2020 2320 696e  ")..        # in
-00016f30: 7665 7274 2076 616c 7565 7320 2869 6620  vert values (if 
-00016f40: 6e65 6564 6564 2920 6265 666f 7265 206c  needed) before l
-00016f50: 6576 6572 6172 6d20 636f 6d70 656e 7361  everarm compensa
-00016f60: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
-00016f70: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00016f80: 6564 2021 3d20 5b5d 3a0a 2020 2020 2020  ed != []:.      
-00016f90: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-00016fa0: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
-00016fb0: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00016fc0: 6974 696f 6e73 203d 2069 6d61 6765 5f64  itions = image_d
-00016fd0: 7473 5b66 696c 655d 0a20 2020 2020 2020  ts[file].       
-00016fe0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00016ff0: 6e20 7261 6e67 6528 6c65 6e28 706f 7369  n range(len(posi
-00017000: 7469 6f6e 7329 293a 0a20 2020 2020 2020  tions)):.       
-00017010: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00017020: 276c 6174 2720 696e 2072 6563 6f72 6473  'lat' in records
-00017030: 3262 6549 6e76 6572 7465 643a 0a20 2020  2beInverted:.   
-00017040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017050: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
-00017060: 5d2e 6c61 7420 2a3d 202d 310a 2020 2020  ].lat *= -1.    
-00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017080: 6966 2027 6c6f 6e27 2069 6e20 7265 636f  if 'lon' in reco
-00017090: 7264 7332 6265 496e 7665 7274 6564 3a0a  rds2beInverted:.
-000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170b0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-000170c0: 735b 695d 2e6c 6f6e 202a 3d20 2d31 0a20  s[i].lon *= -1. 
-000170d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000170e0: 2020 2069 6620 2827 6465 7027 2069 6e20     if ('dep' in 
-000170f0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00017100: 6564 2061 6e64 2027 6465 7027 2069 6e20  ed and 'dep' in 
-00017110: 6e61 765f 6865 6164 6572 2920 6f72 2028  nav_header) or (
-00017120: 2761 6c74 2720 696e 2072 6563 6f72 6473  'alt' in records
-00017130: 3262 6549 6e76 6572 7465 6420 616e 6420  2beInverted and 
-00017140: 2761 6c74 2720 696e 206e 6176 5f68 6561  'alt' in nav_hea
-00017150: 6465 7229 3a0a 2020 2020 2020 2020 2020  der):.          
-00017160: 2020 2020 2020 2020 2020 2020 2020 706f                po
-00017170: 7369 7469 6f6e 735b 695d 2e64 6570 202a  sitions[i].dep *
-00017180: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
-00017190: 2020 2020 2020 2020 2069 6620 2768 6774           if 'hgt
-000171a0: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
-000171b0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-000171c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171d0: 2070 6f73 6974 696f 6e73 5b69 5d2e 6867   positions[i].hg
-000171e0: 7420 2a3d 202d 310a 0a0a 2020 2020 2020  t *= -1...      
-000171f0: 2020 2320 636f 6d70 656e 7361 7465 206c    # compensate l
-00017200: 6576 6572 6172 6d20 6f66 6673 6574 730a  everarm offsets.
-00017210: 2020 2020 2020 2020 6966 2063 6f6d 7065          if compe
-00017220: 6e73 6174 4f66 6673 6574 733a 0a0a 2020  nsatOffsets:..  
-00017230: 2020 2020 2020 2020 2020 2320 6c6f 6164            # load
-00017240: 2066 7261 6d65 2061 7474 6974 7564 6520   frame attitude 
-00017250: 6461 7461 2066 726f 6d20 6669 6c65 0a20  data from file. 
-00017260: 2020 2020 2020 2020 2020 2061 7474 5f64             att_d
-00017270: 6174 612c 2070 6172 7365 4d73 6720 3d20  ata, parseMsg = 
-00017280: 6d69 7174 6e2e 7265 6164 416c 6c41 7474  miqtn.readAllAtt
-00017290: 6974 7564 6573 4672 6f6d 4669 6c65 5061  itudesFromFilePa
-000172a0: 7468 286e 6176 5f70 6174 682c 206e 6176  th(nav_path, nav
-000172b0: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
-000172c0: 726d 6174 2c63 6f6c 5f73 6570 6172 6174  rmat,col_separat
-000172d0: 6f72 3d63 6f6c 5f73 6570 6172 6174 6f72  or=col_separator
-000172e0: 2c63 6f6e 7374 5f76 616c 7565 733d 636f  ,const_values=co
-000172f0: 6e73 745f 7661 6c75 6573 2c61 6e67 6c65  nst_values,angle
-00017300: 7349 6e52 6164 3d61 6e67 6c65 735f 696e  sInRad=angles_in
-00017310: 5f72 6164 290a 2020 2020 2020 2020 2020  _rad).          
-00017320: 2020 6966 2070 6172 7365 4d73 6720 213d    if parseMsg !=
-00017330: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00017340: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00017350: 6f67 2870 6172 7365 4d73 672c 646f 6e74  og(parseMsg,dont
-00017360: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
-00017370: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017380: 6e4d 7367 202b 3d20 225c 6e22 202b 2070  nMsg += "\n" + p
-00017390: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
-000173a0: 2020 2020 2069 6620 7265 636f 7264 7332       if records2
-000173b0: 6265 496e 7665 7274 6564 2021 3d20 5b5d  beInverted != []
-000173c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000173d0: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-000173e0: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
-000173f0: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00017400: 6974 7564 6573 203d 2069 6d61 6765 5f64  itudes = image_d
-00017410: 7473 5f61 7474 5b66 696c 655d 0a20 2020  ts_att[file].   
-00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017430: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00017440: 6c65 6e28 706f 7369 7469 6f6e 7329 293a  len(positions)):
-00017450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017460: 2020 2020 2020 2020 2069 6620 2779 6177           if 'yaw
-00017470: 2720 696e 2020 7265 636f 7264 7332 6265  ' in  records2be
-00017480: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174a0: 2020 2020 2020 6174 7469 7475 6465 735b        attitudes[
-000174b0: 695d 2e79 6177 202a 3d20 2d31 0a20 2020  i].yaw *= -1.   
-000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174d0: 2020 2020 2069 6620 2770 6974 6368 2720       if 'pitch' 
-000174e0: 696e 2020 7265 636f 7264 7332 6265 496e  in  records2beIn
-000174f0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
-00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017510: 2020 2020 6174 7469 7475 6465 735b 695d      attitudes[i]
-00017520: 2e70 6974 6368 202a 3d20 2d31 0a20 2020  .pitch *= -1.   
-00017530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017540: 2020 2020 2069 6620 2772 6f6c 6c27 2069       if 'roll' i
-00017550: 6e20 2072 6563 6f72 6473 3262 6549 6e76  n  records2beInv
-00017560: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
-00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017580: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
-00017590: 726f 6c6c 202a 3d20 2d31 0a0a 2020 2020  roll *= -1..    
-000175a0: 2020 2020 2020 2020 2320 6669 6e64 2066          # find f
-000175b0: 6f72 2065 6163 6820 696d 6167 6520 7468  or each image th
-000175c0: 6520 7265 7370 6563 7469 7665 206e 6176  e respective nav
-000175d0: 6967 6174 696f 6e20 6461 7461 0a20 2020  igation data.   
-000175e0: 2020 2020 2020 2020 2073 7563 6365 7373           success
-000175f0: 2c20 696d 6167 655f 6474 735f 6174 742c  , image_dts_att,
-00017600: 206d 7367 203d 2073 656c 662e 6669 6e64   msg = self.find
-00017610: 4e61 7644 6174 6146 6f72 496d 6167 6528  NavDataForImage(
-00017620: 6174 745f 6461 7461 2c76 6964 656f 5361  att_data,videoSa
-00017630: 6d70 6c65 5365 636f 6e64 7329 0a20 2020  mpleSeconds).   
-00017640: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-00017650: 6f76 2e6c 6f67 286d 7367 2c64 6f6e 7453  ov.log(msg,dontS
-00017660: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
-00017670: 2020 2020 2020 6966 206d 7367 2021 3d20        if msg != 
-00017680: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-00017690: 2020 2020 7265 7475 726e 4d73 6720 2b3d      returnMsg +=
-000176a0: 2022 5c6e 2220 2b20 6d73 670a 2020 2020   "\n" + msg.    
-000176b0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-000176c0: 7563 6365 7373 3a0a 2020 2020 2020 2020  uccess:.        
-000176d0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-000176e0: 616c 7365 2c20 7265 7475 726e 4d73 670a  alse, returnMsg.
-000176f0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-00017700: 6f6d 7065 6e73 6174 650a 2020 2020 2020  ompensate.      
-00017710: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-00017720: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
-00017730: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
-00017740: 6974 696f 6e73 203d 2069 6d61 6765 5f64  itions = image_d
-00017750: 7473 5b66 696c 655d 0a20 2020 2020 2020  ts[file].       
-00017760: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
-00017770: 6573 203d 2069 6d61 6765 5f64 7473 5f61  es = image_dts_a
-00017780: 7474 5b66 696c 655d 0a20 2020 2020 2020  tt[file].       
-00017790: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-000177a0: 6e20 7261 6e67 6528 6c65 6e28 706f 7369  n range(len(posi
-000177b0: 7469 6f6e 7329 293a 0a20 2020 2020 2020  tions)):.       
-000177c0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
-000177d0: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
-000177e0: 6c61 740a 2020 2020 2020 2020 2020 2020  lat.            
-000177f0: 2020 2020 2020 2020 6c6f 6e20 3d20 706f          lon = po
-00017800: 7369 7469 6f6e 735b 695d 2e6c 6f6e 0a20  sitions[i].lon. 
-00017810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017820: 2020 2064 6570 203d 2070 6f73 6974 696f     dep = positio
-00017830: 6e73 5b69 5d2e 6465 700a 2020 2020 2020  ns[i].dep.      
-00017840: 2020 2020 2020 2020 2020 2020 2020 7961                ya
-00017850: 7720 3d20 6174 7469 7475 6465 735b 695d  w = attitudes[i]
-00017860: 2e79 6177 0a20 2020 2020 2020 2020 2020  .yaw.           
-00017870: 2020 2020 2020 2020 2070 6974 6368 203d           pitch =
-00017880: 2061 7474 6974 7564 6573 5b69 5d2e 7069   attitudes[i].pi
-00017890: 7463 680a 2020 2020 2020 2020 2020 2020  tch.            
-000178a0: 2020 2020 2020 2020 726f 6c6c 203d 2061          roll = a
-000178b0: 7474 6974 7564 6573 5b69 5d2e 726f 6c6c  ttitudes[i].roll
-000178c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000178d0: 2020 2020 2069 6620 7961 7720 6973 204e       if yaw is N
-000178e0: 6f6e 6520 6f72 2070 6974 6368 2069 7320  one or pitch is 
-000178f0: 4e6f 6e65 206f 7220 726f 6c6c 2069 7320  None or roll is 
-00017900: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00017910: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00017920: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
-00017930: 2020 2020 2020 2020 2020 206e 6577 5f6c             new_l
-00017940: 6174 2c6e 6577 5f6c 6f6e 2c6e 6577 5f64  at,new_lon,new_d
-00017950: 6570 203d 206d 6971 7467 2e61 6464 4c65  ep = miqtg.addLe
-00017960: 7665 7261 726d 7332 4c61 746c 6f6e 286c  verarms2Latlon(l
-00017970: 6174 2c6c 6f6e 2c64 6570 2c6f 6666 7365  at,lon,dep,offse
-00017980: 745f 782c 6f66 6673 6574 5f79 2c6f 6666  t_x,offset_y,off
-00017990: 7365 745f 7a2c 7961 772c 7069 7463 682c  set_z,yaw,pitch,
-000179a0: 726f 6c6c 290a 2020 2020 2020 2020 2020  roll).          
-000179b0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-000179c0: 6f6e 735b 695d 2e6c 6174 203d 206e 6577  ons[i].lat = new
-000179d0: 5f6c 6174 0a20 2020 2020 2020 2020 2020  _lat.           
-000179e0: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
-000179f0: 6e73 5b69 5d2e 6c6f 6e20 3d20 6e65 775f  ns[i].lon = new_
-00017a00: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-00017a10: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
-00017a20: 735b 695d 2e64 6570 203d 206e 6577 5f64  s[i].dep = new_d
-00017a30: 6570 0a0a 2020 2020 2020 2020 2020 2020  ep..            
-00017a40: 7365 6c66 2e70 726f 762e 6c6f 6728 2261  self.prov.log("a
-00017a50: 7070 6c69 6564 206c 6576 6572 2061 726d  pplied lever arm
-00017a60: 2063 6f6d 7065 6e73 6174 696f 6e20 782c   compensation x,
-00017a70: 792c 7a20 3d20 2220 2b20 7374 7228 6f66  y,z = " + str(of
-00017a80: 6673 6574 5f78 2920 2b20 222c 2220 2b20  fset_x) + "," + 
-00017a90: 7374 7228 6f66 6673 6574 5f79 2920 2b20  str(offset_y) + 
-00017aa0: 222c 2220 2b20 7374 7228 6f66 6673 6574  "," + str(offset
-00017ab0: 5f7a 292c 646f 6e74 5368 6f77 3d54 7275  _z),dontShow=Tru
-00017ac0: 6529 0a0a 2020 2020 2020 2020 6966 206c  e)..        if l
-00017ad0: 656e 2869 6d61 6765 5f64 7473 2920 3e20  en(image_dts) > 
-00017ae0: 303a 0a20 2020 2020 2020 2020 2020 2023  0:.            #
-00017af0: 2043 6865 636b 2077 6865 7468 6572 2064   Check whether d
-00017b00: 6570 7468 2061 6e64 2068 6569 6768 7420  epth and height 
-00017b10: 6172 6520 7365 740a 2020 2020 2020 2020  are set.        
-00017b20: 2020 2020 6c61 745f 6964 656e 7469 6361      lat_identica
-00017b30: 6c2c 206c 6f6e 5f69 6465 6e74 6963 616c  l, lon_identical
-00017b40: 2c20 6465 705f 6964 656e 7469 6361 6c2c  , dep_identical,
-00017b50: 2068 6774 5f69 6465 6e74 6963 616c 2c20   hgt_identical, 
-00017b60: 6465 705f 6e6f 745f 7a65 726f 2c20 6867  dep_not_zero, hg
-00017b70: 745f 6e6f 745f 7a65 726f 2c75 6e63 6572  t_not_zero,uncer
-00017b80: 745f 6e6f 745f 7a65 726f 203d 206e 6176  t_not_zero = nav
-00017b90: 5f64 6174 612e 6368 6563 6b50 6f73 6974  _data.checkPosit
-00017ba0: 696f 6e73 436f 6e74 656e 7428 290a 0a20  ionsContent().. 
-00017bb0: 2020 2020 2020 2020 2020 2023 2057 7269             # Wri
-00017bc0: 7465 2074 6f20 6e61 7669 6761 7469 6f6e  te to navigation
-00017bd0: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
-00017be0: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
-00017bf0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00017c00: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
-00017c10: 6e74 5f6e 6176 5f66 696c 6528 292c 2022  nt_nav_file(), "
-00017c20: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
-00017c30: 7265 732e 7772 6974 6528 6d69 7174 762e  res.write(miqtv.
-00017c40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00017c50: 7174 275d 5b27 696d 6727 5d2b 225c 7422  qt']['img']+"\t"
-00017c60: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
-00017c70: 725b 276d 6172 6971 7427 5d5b 2775 7463  r['mariqt']['utc
-00017c80: 275d 290a 0a20 2020 2020 2020 2020 2020  '])..           
-00017c90: 2068 6173 5f61 6c74 203d 2054 7275 6520   has_alt = True 
-00017ca0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f20  if dep_not_zero 
-00017cb0: 616e 6420 2820 2764 6570 2720 696e 206e  and ( 'dep' in n
-00017cc0: 6176 5f68 6561 6465 7220 6f72 2027 616c  av_header or 'al
-00017cd0: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
-00017ce0: 2029 2065 6c73 6520 4661 6c73 650a 0a20   ) else False.. 
-00017cf0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-00017d00: 6174 2720 696e 206e 6176 5f68 6561 6465  at' in nav_heade
-00017d10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00017d20: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00017d30: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00017d40: 6572 5b27 6d61 7269 7174 275d 5b27 6c61  er['mariqt']['la
-00017d50: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-00017d60: 2069 6620 276c 6f6e 2720 696e 206e 6176   if 'lon' in nav
-00017d70: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-00017d80: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00017d90: 7465 2822 5c74 222b 6d69 7174 762e 636f  te("\t"+miqtv.co
-00017da0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00017db0: 275d 5b27 6c6f 6e27 5d29 0a20 2020 2020  ']['lon']).     
-00017dc0: 2020 2020 2020 2069 6620 6861 735f 616c         if has_al
-00017dd0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00017de0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00017df0: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
-00017e00: 6572 5b27 6d61 7269 7174 275d 5b27 616c  er['mariqt']['al
-00017e10: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-00017e20: 2069 6620 6867 745f 6e6f 745f 7a65 726f   if hgt_not_zero
-00017e30: 2061 6e64 2027 6867 7427 2069 6e20 6e61   and 'hgt' in na
-00017e40: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-00017e50: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00017e60: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
-00017e70: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00017e80: 7427 5d5b 2768 6774 275d 290a 2020 2020  t']['hgt']).    
-00017e90: 2020 2020 2020 2020 6966 2075 6e63 6572          if uncer
-00017ea0: 745f 6e6f 745f 7a65 726f 2061 6e64 2027  t_not_zero and '
-00017eb0: 756e 6365 7274 2720 696e 206e 6176 5f68  uncert' in nav_h
-00017ec0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
-00017ed0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00017ee0: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
-00017ef0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00017f00: 5b27 756e 6365 7274 275d 290a 2020 2020  ['uncert']).    
-00017f10: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00017f20: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
-00017f30: 2020 2020 2320 6461 7461 206c 696e 6573      # data lines
-00017f40: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00017f50: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
-00017f60: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00017f70: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
-00017f80: 7420 696e 2069 6d61 6765 5f64 7473 5b66  t in image_dts[f
-00017f90: 696c 655d 3a0a 2020 2020 2020 2020 2020  ile]:.          
-00017fa0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00017fb0: 6974 6528 6669 6c65 2b22 5c74 222b 7469  ite(file+"\t"+ti
-00017fc0: 6d65 706f 696e 742e 6461 7465 5469 6d65  mepoint.dateTime
-00017fd0: 2829 2e73 7472 6674 696d 6528 6d69 7174  ().strftime(miqt
-00017fe0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-00017ff0: 6d61 7269 7174 275d 2929 200a 2020 2020  mariqt'])) .    
-00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018010: 6966 2027 6c61 7427 2069 6e20 6e61 765f  if 'lat' in nav_
-00018020: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018040: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
-00018050: 6c61 740a 2020 2020 2020 2020 2020 2020  lat.            
-00018060: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00018070: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
-00018080: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
-00018090: 2020 2020 2020 2020 2069 6620 276c 6f6e           if 'lon
-000180a0: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
-000180b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000180c0: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
-000180d0: 696d 6570 6f69 6e74 2e6c 6f6e 0a20 2020  imepoint.lon.   
-000180e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180f0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00018100: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
-00018110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018120: 2020 6966 2068 6173 5f61 6c74 3a0a 2020    if has_alt:.  
-00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018140: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
-00018150: 706f 696e 742e 6465 700a 2020 2020 2020  point.dep.      
-00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018170: 2020 2320 6465 7020 746f 2061 6c74 0a20    # dep to alt. 
-00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018190: 2020 2020 2020 2076 616c 202a 3d20 2d31         val *= -1
-000181a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000181b0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-000181c0: 7465 2822 5c74 222b 7374 7228 7661 6c29  te("\t"+str(val)
-000181d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000181e0: 2020 2020 2020 6966 2068 6774 5f6e 6f74        if hgt_not
-000181f0: 5f7a 6572 6f20 616e 6420 2768 6774 2720  _zero and 'hgt' 
-00018200: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
+00012a70: 2022 2c22 2b6d 6971 7476 2e63 6f6c 5f68   ","+miqtv.col_h
+00012a80: 6561 6465 725b 2765 7869 6627 5d5b 2775  eader['exif']['u
+00012a90: 7569 6427 5d2b 225c 6e22 290a 2020 2020  uid']+"\n").    
+00012aa0: 2020 2020 2020 2020 2020 2020 6469 6666              diff
+00012ab0: 6572 656e 745f 7061 7468 7320 3d20 5b5d  erent_paths = []
+00012ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012ad0: 2066 6f72 2069 6d67 2069 6e20 6d69 7373   for img in miss
+00012ae0: 696e 675f 7575 6964 733a 0a20 2020 2020  ing_uuids:.     
+00012af0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00012b00: 6620 6f73 2e70 6174 682e 6261 7365 6e61  f os.path.basena
+00012b10: 6d65 2869 6d67 2920 6e6f 7420 696e 2064  me(img) not in d
+00012b20: 6966 6665 7265 6e74 5f70 6174 6873 3a0a  ifferent_paths:.
+00012b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b40: 2020 2020 2020 2020 6469 6666 6572 656e          differen
+00012b50: 745f 7061 7468 732e 6170 7065 6e64 286f  t_paths.append(o
+00012b60: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00012b70: 696d 6729 290a 2020 2020 2020 2020 2020  img)).          
+00012b80: 2020 2020 2020 2020 2020 6373 762e 7772            csv.wr
+00012b90: 6974 6528 696d 672b 222c 222b 7374 7228  ite(img+","+str(
+00012ba0: 6d69 7373 696e 675f 7575 6964 735b 696d  missing_uuids[im
+00012bb0: 675d 292b 225c 6e22 290a 2020 2020 2020  g])+"\n").      
+00012bc0: 2020 2020 2020 2020 2020 2372 6574 7572            #retur
+00012bd0: 6e20 4661 6c73 652c 2022 6578 6966 746f  n False, "exifto
+00012be0: 6f6c 202d 6373 763d 222b 6563 7376 5f70  ol -csv="+ecsv_p
+00012bf0: 6174 682b 2220 222b 2220 222e 6a6f 696e  ath+" "+" ".join
+00012c00: 2864 6966 6665 7265 6e74 5f70 6174 6873  (different_paths
+00012c10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012c20: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00012c30: 224e 6f74 2061 6c6c 2069 6d61 6765 7320  "Not all images 
+00012c40: 6861 7665 2076 616c 6964 2055 5549 4473  have valid UUIDs
+00012c50: 2e20 4d69 7373 696e 6720 666f 7220 666f  . Missing for fo
+00012c60: 6c6c 6f77 696e 6720 6669 6c65 733a 5c6e  llowing files:\n
+00012c70: 222b 225c c586 222e 6a6f 696e 2864 6966  "+"\..".join(dif
+00012c80: 6665 7265 6e74 5f70 6174 6873 290a 2020  ferent_paths).  
+00012c90: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+00012ca0: 2020 2020 2020 2073 656c 662e 5f5f 616c         self.__al
+00012cb0: 6c55 5549 4473 4368 6563 6b65 6420 3d20  lUUIDsChecked = 
+00012cc0: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
+00012cd0: 2072 6574 7572 6e20 5472 7565 2c20 2241   return True, "A
+00012ce0: 6c6c 2069 6d61 6765 7320 6861 7665 2061  ll images have a
+00012cf0: 2055 5549 4422 0a20 2020 2020 2020 2072   UUID".        r
+00012d00: 6574 7572 6e20 4661 6c73 652c 2022 5061  eturn False, "Pa
+00012d10: 7468 2022 2b73 656c 662e 696d 6167 6573  th "+self.images
+00012d20: 4469 7220 2b20 2220 6e6f 7420 666f 756e  Dir + " not foun
+00012d30: 642e 220a 0a20 2020 2064 6566 2063 7265  d."..    def cre
+00012d40: 6174 6555 5549 4446 696c 6528 7365 6c66  ateUUIDFile(self
+00012d50: 2c63 6c65 616e 3d54 7275 6529 3a0a 2020  ,clean=True):.  
+00012d60: 2020 2020 2020 2222 2220 4465 7072 6563        """ Deprec
+00012d70: 6174 6564 202d 2075 7365 2063 7265 6174  ated - use creat
+00012d80: 655f 7575 6964 5f66 696c 6520 2222 220a  e_uuid_file """.
+00012d90: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00012da0: 656c 662e 6372 6561 7465 5f75 7569 645f  elf.create_uuid_
+00012db0: 6669 6c65 2863 6c65 616e 290a 0a0a 2020  file(clean)...  
+00012dc0: 2020 6465 6620 7365 745f 696d 6167 655f    def set_image_
+00012dd0: 7365 745f 6174 7469 7475 6465 2873 656c  set_attitude(sel
+00012de0: 662c 7961 775f 6672 616d 653a 666c 6f61  f,yaw_frame:floa
+00012df0: 742c 7069 7463 685f 6672 616d 653a 666c  t,pitch_frame:fl
+00012e00: 6f61 742c 726f 6c6c 5f66 7261 6d65 3a66  oat,roll_frame:f
+00012e10: 6c6f 6174 2c79 6177 5f63 616d 3266 7261  loat,yaw_cam2fra
+00012e20: 6d65 3a66 6c6f 6174 2c70 6974 6368 5f63  me:float,pitch_c
+00012e30: 616d 3266 7261 6d65 3a66 6c6f 6174 2c72  am2frame:float,r
+00012e40: 6f6c 6c5f 6361 6d32 6672 616d 653a 666c  oll_cam2frame:fl
+00012e50: 6f61 7429 3a0a 2020 2020 2020 2020 2222  oat):.        ""
+00012e60: 2220 6361 6c63 756c 6174 6573 2074 6865  " calculates the
+00012e70: 2074 6865 2063 616d 6572 6173 2061 6273   the cameras abs
+00012e80: 6f6c 7574 6520 6174 7469 7475 6465 2061  olute attitude a
+00012e90: 6e64 2073 6574 7320 6974 2074 6f20 696d  nd sets it to im
+00012ea0: 6167 6520 7365 7420 6865 6164 6572 2e20  age set header. 
+00012eb0: 416c 6c20 616e 676c 6573 2061 7265 2065  All angles are e
+00012ec0: 7870 6563 7465 6420 696e 2064 6567 7265  xpected in degre
+00012ed0: 6573 2e20 0a20 2020 2020 2020 2063 616d  es. .        cam
+00012ee0: 6572 6132 6672 616d 6520 616e 676c 6573  era2frame angles
+00012ef0: 3a20 726f 7461 7469 6f6e 206f 6620 6361  : rotation of ca
+00012f00: 6d65 7261 2063 6f6f 7264 696e 6174 6573  mera coordinates
+00012f10: 2028 782c 792c 7a20 3d20 746f 702c 2072   (x,y,z = top, r
+00012f20: 6967 6874 2c20 6c69 6e65 206f 6620 7369  ight, line of si
+00012f30: 6768 7429 2077 6974 6820 7265 7370 6563  ght) with respec
+00012f40: 7420 746f 2076 6568 6963 6c65 2063 6f6f  t to vehicle coo
+00012f50: 7264 696e 6174 6573 2028 782c 792c 7a20  rdinates (x,y,z 
+00012f60: 3d20 666f 7277 6172 642c 7269 6768 742c  = forward,right,
+00012f70: 646f 776e 2920 0a20 2020 2020 2020 2069  down) .        i
+00012f80: 6e20 6163 636f 7264 616e 6365 2077 6974  n accordance wit
+00012f90: 6820 7468 6520 7961 772c 7069 7463 682c  h the yaw,pitch,
+00012fa0: 726f 6c6c 2072 6f74 6174 696f 6e20 6f72  roll rotation or
+00012fb0: 6465 7220 636f 6e76 656e 7469 6f6e 3a0a  der convention:.
+00012fc0: 0a20 2020 2020 2020 2031 2e20 7961 7720  .        1. yaw 
+00012fd0: 6172 6f75 6e64 207a 2c0a 2020 2020 2020  around z,.      
+00012fe0: 2020 322e 2070 6974 6368 2061 726f 756e    2. pitch aroun
+00012ff0: 6420 726f 7461 7465 6420 792c 0a20 2020  d rotated y,.   
+00013000: 2020 2020 2033 2e20 726f 6c6c 2061 726f       3. roll aro
+00013010: 756e 6420 726f 7461 7465 6420 780a 0a20  und rotated x.. 
+00013020: 2020 2020 2020 2052 6f74 6174 696f 6e20         Rotation 
+00013030: 6469 7265 6374 696f 6e73 2061 6363 6f72  directions accor
+00013040: 6469 6e67 2074 6f20 5c27 7269 6768 742d  ding to \'right-
+00013050: 6861 6e64 2072 756c 655c 272e 0a0a 2020  hand rule\'...  
+00013060: 2020 2020 2020 492e 652e 2063 616d 6572        I.e. camer
+00013070: 6132 4672 616d 6520 616e 676c 6573 203d  a2Frame angles =
+00013080: 2030 2c30 2c30 2063 616d 6572 6120 6973   0,0,0 camera is
+00013090: 2066 6163 696e 6720 646f 776e 7761 7264   facing downward
+000130a0: 2077 6974 6820 746f 7020 7369 6465 2074   with top side t
+000130b0: 6f77 6172 6473 2076 6568 6963 6c65 2773  owards vehicle's
+000130c0: 2066 6f72 7761 7264 2064 6972 6563 7469   forward directi
+000130d0: 6f6e 2720 2222 220a 0a20 2020 2020 2020  on' """..       
+000130e0: 2052 5f66 7261 6d65 326e 6564 203d 206d   R_frame2ned = m
+000130f0: 6971 7467 2e52 5f59 6177 5069 7463 6852  iqtg.R_YawPitchR
+00013100: 6f6c 6c28 7961 775f 6672 616d 652c 7069  oll(yaw_frame,pi
+00013110: 7463 685f 6672 616d 652c 726f 6c6c 5f66  tch_frame,roll_f
+00013120: 7261 6d65 290a 2020 2020 2020 2020 525f  rame).        R_
+00013130: 6361 6d32 6672 616d 6520 3d20 6d69 7174  cam2frame = miqt
+00013140: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
+00013150: 2879 6177 5f63 616d 3266 7261 6d65 2c70  (yaw_cam2frame,p
+00013160: 6974 6368 5f63 616d 3266 7261 6d65 2c72  itch_cam2frame,r
+00013170: 6f6c 6c5f 6361 6d32 6672 616d 6529 0a20  oll_cam2frame). 
+00013180: 2020 2020 2020 2052 5f63 616d 326e 6564         R_cam2ned
+00013190: 203d 2052 5f66 7261 6d65 326e 6564 2e64   = R_frame2ned.d
+000131a0: 6f74 2852 5f63 616d 3266 7261 6d65 290a  ot(R_cam2frame).
+000131b0: 2020 2020 2020 2020 7961 772c 7069 7463          yaw,pitc
+000131c0: 682c 726f 6c6c 203d 206d 6971 7467 2e79  h,roll = miqtg.y
+000131d0: 6177 5069 7463 6852 6f6c 6c28 525f 6361  awPitchRoll(R_ca
+000131e0: 6d32 6e65 6429 0a0a 2020 2020 2020 2020  m2ned)..        
+000131f0: 2320 706f 7365 206d 6174 7269 7820 6361  # pose matrix ca
+00013200: 6d32 7574 6d0a 2020 2020 2020 2020 525f  m2utm.        R_
+00013210: 6361 6d53 7464 3275 746d 203d 2073 656c  camStd2utm = sel
+00013220: 662e 6765 745f 525f 6361 6d53 7464 3275  f.get_R_camStd2u
+00013230: 746d 2852 5f63 616d 3266 7261 6d65 2c52  tm(R_cam2frame,R
+00013240: 5f66 7261 6d65 326e 6564 290a 0a20 2020  _frame2ned)..   
+00013250: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00013260: 2078 203d 206e 702e 6172 7261 7928 5b31   x = np.array([1
+00013270: 2c30 2c30 5d29 0a20 2020 2020 2020 2079  ,0,0]).        y
+00013280: 203d 206e 702e 6172 7261 7928 5b30 2c31   = np.array([0,1
+00013290: 2c30 5d29 0a20 2020 2020 2020 207a 203d  ,0]).        z =
+000132a0: 206e 702e 6172 7261 7928 5b30 2c30 2c31   np.array([0,0,1
+000132b0: 5d29 0a20 2020 2020 2020 2070 7269 6e74  ]).        print
+000132c0: 2827 7827 2c52 5f63 616d 5374 6432 7574  ('x',R_camStd2ut
+000132d0: 6d2e 646f 7428 7829 2e72 6f75 6e64 2835  m.dot(x).round(5
+000132e0: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
+000132f0: 2827 7927 2c52 5f63 616d 5374 6432 7574  ('y',R_camStd2ut
+00013300: 6d2e 646f 7428 7929 2e72 6f75 6e64 2835  m.dot(y).round(5
+00013310: 2929 0a20 2020 2020 2020 2070 7269 6e74  )).        print
+00013320: 2827 7a27 2c52 5f63 616d 5374 6432 7574  ('z',R_camStd2ut
+00013330: 6d2e 646f 7428 7a29 2e72 6f75 6e64 2835  m.dot(z).round(5
+00013340: 2929 0a20 2020 2020 2020 2022 2222 0a0a  )).        """..
+00013350: 2020 2020 2020 2020 6865 6164 6572 5570          headerUp
+00013360: 6461 7465 203d 207b 0a20 2020 2020 2020  date = {.       
+00013370: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+00013380: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013390: 2779 6177 275d 3a79 6177 2c0a 2020 2020  'yaw']:yaw,.    
+000133a0: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+000133b0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+000133c0: 275d 5b27 7069 7463 6827 5d3a 7069 7463  ']['pitch']:pitc
+000133d0: 682c 0a20 2020 2020 2020 2020 2020 206d  h,.            m
+000133e0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+000133f0: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
+00013400: 5d3a 726f 6c6c 2c0a 2020 2020 2020 2020  ]:roll,.        
+00013410: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
+00013420: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013430: 706f 7365 275d 3a7b 2770 6f73 652d 6162  pose']:{'pose-ab
+00013440: 736f 6c75 7465 2d6f 7269 656e 7461 7469  solute-orientati
+00013450: 6f6e 2d75 746d 2d6d 6174 7269 7827 3a52  on-utm-matrix':R
+00013460: 5f63 616d 5374 6432 7574 6d2e 666c 6174  _camStd2utm.flat
+00013470: 7465 6e28 292e 746f 6c69 7374 2829 7d0a  ten().tolist()}.
+00013480: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00013490: 2020 7365 6c66 2e75 7064 6174 655f 6966    self.update_if
+000134a0: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
+000134b0: 2868 6561 6465 7255 7064 6174 6529 0a0a  (headerUpdate)..
+000134c0: 2020 2020 6465 6620 7365 7449 6d61 6765      def setImage
+000134d0: 5365 7441 7474 6974 7564 6528 7365 6c66  SetAttitude(self
+000134e0: 2c79 6177 5f66 7261 6d65 3a66 6c6f 6174  ,yaw_frame:float
+000134f0: 2c70 6974 6368 5f66 7261 6d65 3a66 6c6f  ,pitch_frame:flo
+00013500: 6174 2c72 6f6c 6c5f 6672 616d 653a 666c  at,roll_frame:fl
+00013510: 6f61 742c 7961 775f 6361 6d32 6672 616d  oat,yaw_cam2fram
+00013520: 653a 666c 6f61 742c 7069 7463 685f 6361  e:float,pitch_ca
+00013530: 6d32 6672 616d 653a 666c 6f61 742c 726f  m2frame:float,ro
+00013540: 6c6c 5f63 616d 3266 7261 6d65 3a66 6c6f  ll_cam2frame:flo
+00013550: 6174 293a 0a20 2020 2020 2020 2022 2222  at):.        """
+00013560: 2044 6570 7265 6361 7465 6420 2d20 7573   Deprecated - us
+00013570: 6520 7365 745f 696d 6167 655f 7365 745f  e set_image_set_
+00013580: 6174 7469 7475 6465 2022 2222 0a20 2020  attitude """.   
+00013590: 2020 2020 2073 656c 662e 7365 745f 696d       self.set_im
+000135a0: 6167 655f 7365 745f 6174 7469 7475 6465  age_set_attitude
+000135b0: 2879 6177 5f66 7261 6d65 2c20 7069 7463  (yaw_frame, pitc
+000135c0: 685f 6672 616d 652c 2072 6f6c 6c5f 6672  h_frame, roll_fr
+000135d0: 616d 652c 2079 6177 5f63 616d 3266 7261  ame, yaw_cam2fra
+000135e0: 6d65 2c20 7069 7463 685f 6361 6d32 6672  me, pitch_cam2fr
+000135f0: 616d 652c 2072 6f6c 6c5f 6361 6d32 6672  ame, roll_cam2fr
+00013600: 616d 6529 0a0a 0a20 2020 2064 6566 2063  ame)...    def c
+00013610: 7265 6174 655f 696d 6167 655f 6174 7469  reate_image_atti
+00013620: 7475 6465 5f66 696c 6528 7365 6c66 2c20  tude_file(self, 
+00013630: 6174 745f 7061 7468 3a73 7472 2c20 6672  att_path:str, fr
+00013640: 616d 655f 6174 745f 6865 6164 6572 3a64  ame_att_header:d
+00013650: 6963 742c 2063 616d 6572 6132 4672 616d  ict, camera2Fram
+00013660: 655f 7961 773a 666c 6f61 742c 6361 6d65  e_yaw:float,came
+00013670: 7261 3246 7261 6d65 5f70 6974 6368 3a66  ra2Frame_pitch:f
+00013680: 6c6f 6174 2c63 616d 6572 6132 4672 616d  loat,camera2Fram
+00013690: 655f 726f 6c6c 3a66 6c6f 6174 2c0a 2020  e_roll:float,.  
+000136a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000136b0: 2020 2020 2020 2020 2020 2020 2020 6461                da
+000136c0: 7465 5f66 6f72 6d61 743d 6d69 7174 762e  te_format=miqtv.
+000136d0: 6461 7465 5f66 6f72 6d61 7473 5b27 7061  date_formats['pa
+000136e0: 6e67 6165 6127 5d2c 2063 6f6e 7374 5f76  ngaea'], const_v
+000136f0: 616c 7565 7320 3d20 7b7d 2c20 6f76 6572  alues = {}, over
+00013700: 7772 6974 653d 4661 6c73 652c 2063 6f6c  write=False, col
+00013710: 5f73 6570 6172 6174 6f72 203d 2022 5c74  _separator = "\t
+00013720: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00013730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013740: 2020 2061 7474 5f70 6174 685f 616e 676c     att_path_angl
+00013750: 6573 5f69 6e5f 7261 6420 3d20 4661 6c73  es_in_rad = Fals
+00013760: 652c 2076 6964 656f 5361 6d70 6c65 5365  e, videoSampleSe
+00013770: 636f 6e64 733d 312c 7265 636f 7264 7332  conds=1,records2
+00013780: 6265 496e 7665 7274 6564 3d5b 5d29 3a0a  beInverted=[]):.
+00013790: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
+000137a0: 7465 7320 696e 202f 696e 7465 726d 6564  tes in /intermed
+000137b0: 6961 7465 2061 2074 6578 7420 6669 6c65  iate a text file
+000137c0: 2077 6974 6820 6361 6d65 7261 2061 7474   with camera att
+000137d0: 6974 7564 6520 6461 7461 2066 6f72 2065  itude data for e
+000137e0: 6163 6820 696d 6167 652e 2041 6c6c 2061  ach image. All a
+000137f0: 6e67 6c65 7320 6172 6520 6578 7065 6374  ngles are expect
+00013800: 6564 2069 6e20 6465 6772 6565 732e 2055  ed in degrees. U
+00013810: 7365 2061 7474 5f70 6174 685f 616e 676c  se att_path_angl
+00013820: 6573 5f69 6e5f 7261 6420 6966 206e 6563  es_in_rad if nec
+00013830: 6573 7361 7279 2e20 0a20 2020 2020 2020  essary. .       
+00013840: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
+00013850: 676c 6573 3a20 726f 7461 7469 6f6e 206f  gles: rotation o
+00013860: 6620 6361 6d65 7261 2063 6f6f 7264 696e  f camera coordin
+00013870: 6174 6573 2028 782c 792c 7a20 3d20 746f  ates (x,y,z = to
+00013880: 702c 2072 6967 6874 2c20 6c69 6e65 206f  p, right, line o
+00013890: 6620 7369 6768 7429 2077 6974 6820 7265  f sight) with re
+000138a0: 7370 6563 7420 746f 2076 6568 6963 6c65  spect to vehicle
+000138b0: 2063 6f6f 7264 696e 6174 6573 2028 782c   coordinates (x,
+000138c0: 792c 7a20 3d20 666f 7277 6172 642c 7269  y,z = forward,ri
+000138d0: 6768 742c 646f 776e 2920 0a20 2020 2020  ght,down) .     
+000138e0: 2020 2069 6e20 6163 636f 7264 616e 6365     in accordance
+000138f0: 2077 6974 6820 7468 6520 7961 772c 7069   with the yaw,pi
+00013900: 7463 682c 726f 6c6c 2072 6f74 6174 696f  tch,roll rotatio
+00013910: 6e20 6f72 6465 7220 636f 6e76 656e 7469  n order conventi
+00013920: 6f6e 3a0a 2020 2020 2020 2020 312e 2079  on:.        1. y
+00013930: 6177 2061 726f 756e 6420 7a2c 0a20 2020  aw around z,.   
+00013940: 2020 2020 2032 2e20 7069 7463 6820 6172       2. pitch ar
+00013950: 6f75 6e64 2072 6f74 6174 6564 2079 2c0a  ound rotated y,.
+00013960: 2020 2020 2020 2020 332e 2072 6f6c 6c20          3. roll 
+00013970: 6172 6f75 6e64 2072 6f74 6174 6564 2078  around rotated x
+00013980: 0a0a 2020 2020 2020 2020 526f 7461 7469  ..        Rotati
+00013990: 6f6e 2064 6972 6563 7469 6f6e 7320 6163  on directions ac
+000139a0: 636f 7264 696e 6720 746f 205c 2772 6967  cording to \'rig
+000139b0: 6874 2d68 616e 6420 7275 6c65 5c27 2e0a  ht-hand rule\'..
+000139c0: 0a20 2020 2020 2020 2049 2e65 2e20 6361  .        I.e. ca
+000139d0: 6d65 7261 3246 7261 6d65 2061 6e67 6c65  mera2Frame angle
+000139e0: 7320 3d20 302c 302c 3020 6361 6d65 7261  s = 0,0,0 camera
+000139f0: 2069 7320 6661 6369 6e67 2064 6f77 6e77   is facing downw
+00013a00: 6172 6420 7769 7468 2074 6f70 2073 6964  ard with top sid
+00013a10: 6520 746f 7761 7264 7320 7665 6869 636c  e towards vehicl
+00013a20: 6527 7320 666f 7277 6172 6420 6469 7265  e's forward dire
+00013a30: 6374 696f 6e27 2022 2222 0a0a 2020 2020  ction' """..    
+00013a40: 2020 2020 696e 745f 6174 7475 7475 6465      int_attutude
+00013a50: 5f66 696c 6520 3d20 7365 6c66 2e5f 5f67  _file = self.__g
+00013a60: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
+00013a70: 6978 2829 202b 2027 5f69 6d61 6765 2d61  ix() + '_image-a
+00013a80: 7474 6974 7564 652e 7478 7427 0a20 2020  ttitude.txt'.   
+00013a90: 2020 2020 206f 7574 7075 745f 6865 6164       output_head
+00013aa0: 6572 5f61 7474 203d 207b 2020 206d 6971  er_att = {   miq
+00013ab0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013ac0: 6172 6971 7427 5d5b 2769 6d67 275d 3a20  ariqt']['img']: 
+00013ad0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+00013ae0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+00013af0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00013b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b10: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
+00013b20: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013b30: 7574 6327 5d3a 6d69 7174 762e 636f 6c5f  utc']:miqtv.col_
+00013b40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00013b50: 5b27 7574 6327 5d2c 0a20 2020 2020 2020  ['utc'],.       
+00013b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b70: 2020 2020 2020 2020 206d 6971 7476 2e63           miqtv.c
+00013b80: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00013b90: 7427 5d5b 2779 6177 275d 3a6d 6971 7476  t']['yaw']:miqtv
+00013ba0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00013bb0: 6971 7427 5d5b 2779 6177 275d 2c0a 2020  iqt']['yaw'],.  
+00013bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013bd0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00013be0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00013bf0: 6d61 7269 7174 275d 5b27 7069 7463 6827  mariqt']['pitch'
+00013c00: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
+00013c10: 6572 5b27 6d61 7269 7174 275d 5b27 7069  er['mariqt']['pi
+00013c20: 7463 6827 5d2c 0a20 2020 2020 2020 2020  tch'],.         
+00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c40: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00013c50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013c60: 5d5b 2772 6f6c 6c27 5d3a 6d69 7174 762e  ]['roll']:miqtv.
+00013c70: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013c80: 7174 275d 5b27 726f 6c6c 275d 2c0a 2020  qt']['roll'],.  
+00013c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ca0: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+00013cb0: 2020 2020 2069 6e74 5f70 6f73 655f 6669       int_pose_fi
+00013cc0: 6c65 203d 2073 656c 662e 5f5f 6765 745f  le = self.__get_
+00013cd0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+00013ce0: 2920 2b20 275f 696d 6167 652d 6361 6d65  ) + '_image-came
+00013cf0: 7261 2d70 6f73 652e 7478 7427 0a20 2020  ra-pose.txt'.   
+00013d00: 2020 2020 206f 7574 7075 745f 6865 6164       output_head
+00013d10: 6572 5f70 6f73 6520 3d20 7b20 206d 6971  er_pose = {  miq
+00013d20: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013d30: 6172 6971 7427 5d5b 2769 6d67 275d 3a6d  ariqt']['img']:m
+00013d40: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00013d50: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
+00013d60: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013d80: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+00013d90: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
+00013da0: 6327 5d3a 6d69 7174 762e 636f 6c5f 6865  c']:miqtv.col_he
+00013db0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013dc0: 7574 6327 5d2c 0a20 2020 2020 2020 2020  utc'],.         
+00013dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013de0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
+00013df0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013e00: 5d5b 2770 6f73 6527 5d3a 6d69 7174 762e  ]['pose']:miqtv.
+00013e10: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013e20: 7174 275d 5b27 706f 7365 275d 2c0a 2020  qt']['pose'],.  
+00013e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013e40: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
+00013e50: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00013e60: 6578 6973 7473 2869 6e74 5f61 7474 7574  exists(int_attut
+00013e70: 7564 655f 6669 6c65 2920 616e 6420 6e6f  ude_file) and no
+00013e80: 7420 6f76 6572 7772 6974 653a 0a20 2020  t overwrite:.   
+00013e90: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00013ea0: 645f 6974 656d 5f69 6e66 6f5f 7461 625f  d_item_info_tab_
+00013eb0: 6669 6c65 2869 6e74 5f61 7474 7574 7564  file(int_attutud
+00013ec0: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
+00013ed0: 7574 5f68 6561 6465 725f 6174 7429 0a20  ut_header_att). 
+00013ee0: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+00013ef0: 5f6d 7367 203d 2022 220a 2020 2020 2020  _msg = "".      
+00013f00: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+00013f10: 2e65 7869 7374 7328 696e 745f 706f 7365  .exists(int_pose
+00013f20: 5f66 696c 6529 3a0a 2020 2020 2020 2020  _file):.        
+00013f30: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00013f40: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
+00013f50: 696c 6528 696e 745f 706f 7365 5f66 696c  ile(int_pose_fil
+00013f60: 652c 225c 7422 2c6f 7574 7075 745f 6865  e,"\t",output_he
+00013f70: 6164 6572 5f70 6f73 6529 0a20 2020 2020  ader_pose).     
+00013f80: 2020 2020 2020 2020 2020 2065 7874 7261             extra
+00013f90: 5f6d 7367 203d 2022 2c20 2220 2b20 696e  _msg = ", " + in
+00013fa0: 745f 706f 7365 5f66 696c 650a 2020 2020  t_pose_file.    
+00013fb0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00013fc0: 7275 652c 2022 4f75 7470 7574 2066 696c  rue, "Output fil
+00013fd0: 6520 6578 6973 7473 3a20 222b 696e 745f  e exists: "+int_
+00013fe0: 6174 7475 7475 6465 5f66 696c 6520 2b20  attutude_file + 
+00013ff0: 6578 7472 615f 6d73 670a 0a20 2020 2020  extra_msg..     
+00014000: 2020 2069 6620 6e6f 7420 6f73 2e70 6174     if not os.pat
+00014010: 682e 6578 6973 7473 2861 7474 5f70 6174  h.exists(att_pat
+00014020: 6829 3a0a 2020 2020 2020 2020 2020 2020  h):.            
+00014030: 7265 7475 726e 2046 616c 7365 2c20 2241  return False, "A
+00014040: 7474 6974 7564 6520 6669 6c65 206e 6f74  ttitude file not
+00014050: 2066 6f75 6e64 3a20 222b 6174 745f 7061   found: "+att_pa
+00014060: 7468 0a0a 2020 2020 2020 2020 6966 206e  th..        if n
+00014070: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+00014080: 7328 7365 6c66 2e69 6d61 6765 7344 6972  s(self.imagesDir
+00014090: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000140a0: 6574 7572 6e20 4661 6c73 652c 2022 496d  eturn False, "Im
+000140b0: 6167 6520 666f 6c64 6572 206e 6f74 2066  age folder not f
+000140c0: 6f75 6e64 3a20 222b 2073 656c 662e 696d  ound: "+ self.im
+000140d0: 6167 6573 4469 720a 0a20 2020 2020 2020  agesDir..       
+000140e0: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
+000140f0: 4c6f 6164 696e 674d 7367 2822 4372 6561  LoadingMsg("Crea
+00014100: 7469 6e67 2069 7465 6d73 2720 6174 7469  ting items' atti
+00014110: 7475 6465 2064 6174 6122 290a 0a20 2020  tude data")..   
+00014120: 2020 2020 2023 206c 6f61 6420 6672 616d       # load fram
+00014130: 6520 6174 7469 7475 6465 2064 6174 6120  e attitude data 
+00014140: 6672 6f6d 2066 696c 650a 2020 2020 2020  from file.      
+00014150: 2020 6174 745f 6461 7461 2c20 7061 7273    att_data, pars
+00014160: 654d 7367 203d 206d 6971 746e 2e72 6561  eMsg = miqtn.rea
+00014170: 6441 6c6c 4174 7469 7475 6465 7346 726f  dAllAttitudesFro
+00014180: 6d46 696c 6550 6174 6828 6174 745f 7061  mFilePath(att_pa
+00014190: 7468 2c20 6672 616d 655f 6174 745f 6865  th, frame_att_he
+000141a0: 6164 6572 2c20 6461 7465 5f66 6f72 6d61  ader, date_forma
+000141b0: 742c 636f 6c5f 7365 7061 7261 746f 723d  t,col_separator=
+000141c0: 636f 6c5f 7365 7061 7261 746f 722c 636f  col_separator,co
+000141d0: 6e73 745f 7661 6c75 6573 3d63 6f6e 7374  nst_values=const
+000141e0: 5f76 616c 7565 732c 616e 676c 6573 496e  _values,anglesIn
+000141f0: 5261 643d 6174 745f 7061 7468 5f61 6e67  Rad=att_path_ang
+00014200: 6c65 735f 696e 5f72 6164 290a 2020 2020  les_in_rad).    
+00014210: 2020 2020 6966 2070 6172 7365 4d73 6720      if parseMsg 
+00014220: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
+00014230: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00014240: 2870 6172 7365 4d73 672c 646f 6e74 5368  (parseMsg,dontSh
+00014250: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+00014260: 2020 2020 2070 6172 7365 4d73 6720 3d20       parseMsg = 
+00014270: 225c 6e22 202b 2070 6172 7365 4d73 670a  "\n" + parseMsg.
+00014280: 0a20 2020 2020 2020 2023 2066 696e 6420  .        # find 
+00014290: 666f 7220 6561 6368 2069 6d61 6765 2074  for each image t
+000142a0: 6865 2072 6573 7065 6374 6976 6520 6e61  he respective na
+000142b0: 7669 6761 7469 6f6e 2064 6174 610a 2020  vigation data.  
+000142c0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
+000142d0: 2020 2020 2020 2073 7563 6365 7373 2c20         success, 
+000142e0: 696d 6167 655f 6474 732c 206d 7367 203d  image_dts, msg =
+000142f0: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
+00014300: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
+00014310: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
+00014320: 636f 6e64 7329 0a20 2020 2020 2020 2069  conds).        i
+00014330: 6620 6e6f 7420 7375 6363 6573 733a 0a20  f not success:. 
+00014340: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00014350: 6e20 4661 6c73 652c 206d 7367 202b 2070  n False, msg + p
+00014360: 6172 7365 4d73 670a 2020 2020 2020 2020  arseMsg.        
+00014370: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
+00014380: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
+00014390: 696e 6720 6974 656d 7327 2061 7474 6974  ing items' attit
+000143a0: 7564 6520 6461 7461 2229 0a0a 2020 2020  ude data")..    
+000143b0: 2020 2020 2320 696e 7665 7274 2076 616c      # invert val
+000143c0: 7565 7320 2869 6620 6e65 6564 6564 2920  ues (if needed) 
+000143d0: 6265 666f 7265 206c 6576 6572 6172 6d20  before leverarm 
+000143e0: 636f 6d70 656e 7361 7469 6f6e 0a20 2020  compensation.   
+000143f0: 2020 2020 2069 6620 7265 636f 7264 7332       if records2
+00014400: 6265 496e 7665 7274 6564 2021 3d20 5b5d  beInverted != []
+00014410: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00014420: 7220 6669 6c65 2069 6e20 696d 6167 655f  r file in image_
+00014430: 6474 733a 0a20 2020 2020 2020 2020 2020  dts:.           
+00014440: 2020 2020 2061 7474 6974 7564 6573 203d       attitudes =
+00014450: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+00014460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014470: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00014480: 6c65 6e28 6174 7469 7475 6465 7329 293a  len(attitudes)):
+00014490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000144a0: 2020 2020 2069 6620 2779 6177 2720 696e       if 'yaw' in
+000144b0: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
+000144c0: 7274 6564 3a0a 2020 2020 2020 2020 2020  rted:.          
+000144d0: 2020 2020 2020 2020 2020 2020 2020 6174                at
+000144e0: 7469 7475 6465 735b 695d 2e79 6177 202a  titudes[i].yaw *
+000144f0: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00014500: 2020 2020 2020 2020 2069 6620 2770 6974           if 'pit
+00014510: 6368 2720 696e 2020 7265 636f 7264 7332  ch' in  records2
+00014520: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2020 2020 6174 7469 7475 6465 735b 695d      attitudes[i]
+00014550: 2e70 6974 6368 202a 3d20 2d31 0a20 2020  .pitch *= -1.   
+00014560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014570: 2069 6620 2772 6f6c 6c27 2069 6e20 2072   if 'roll' in  r
+00014580: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00014590: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+000145a0: 2020 2020 2020 2020 2020 2061 7474 6974             attit
+000145b0: 7564 6573 5b69 5d2e 726f 6c6c 202a 3d20  udes[i].roll *= 
+000145c0: 2d31 0a0a 0a20 2020 2020 2020 2023 2061  -1...        # a
+000145d0: 6464 2063 616d 6572 6132 4672 616d 6520  dd camera2Frame 
+000145e0: 616e 676c 6573 0a20 2020 2020 2020 2052  angles.        R
+000145f0: 5f63 616d 3266 7261 6d65 203d 206d 6971  _cam2frame = miq
+00014600: 7467 2e52 5f59 6177 5069 7463 6852 6f6c  tg.R_YawPitchRol
+00014610: 6c28 6361 6d65 7261 3246 7261 6d65 5f79  l(camera2Frame_y
+00014620: 6177 2c63 616d 6572 6132 4672 616d 655f  aw,camera2Frame_
+00014630: 7069 7463 682c 6361 6d65 7261 3246 7261  pitch,camera2Fra
+00014640: 6d65 5f72 6f6c 6c29 0a20 2020 2020 2020  me_roll).       
+00014650: 2052 5f63 616d 3275 746d 5f6c 6973 7420   R_cam2utm_list 
+00014660: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00014670: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
+00014680: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00014690: 666f 7220 7469 6d65 706f 696e 7420 696e  for timepoint in
+000146a0: 2069 6d61 6765 5f64 7473 5b66 696c 655d   image_dts[file]
+000146b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000146c0: 2020 6174 7469 7475 6465 203d 2074 696d    attitude = tim
+000146d0: 6570 6f69 6e74 0a20 2020 2020 2020 2020  epoint.         
+000146e0: 2020 2020 2020 2069 6620 6174 7469 7475         if attitu
+000146f0: 6465 2e79 6177 2069 7320 4e6f 6e65 206f  de.yaw is None o
+00014700: 7220 6174 7469 7475 6465 2e70 6974 6368  r attitude.pitch
+00014710: 2069 7320 4e6f 6e65 206f 7220 6174 7469   is None or atti
+00014720: 7475 6465 2e72 6f6c 6c20 6973 204e 6f6e  tude.roll is Non
+00014730: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00014740: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
+00014750: 5f6c 6973 742e 6170 7065 6e64 2822 2229  _list.append("")
+00014760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014770: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00014780: 2020 2020 2020 2020 2020 2020 2020 525f                R_
+00014790: 6672 616d 6532 6e65 6420 3d20 6d69 7174  frame2ned = miqt
+000147a0: 672e 525f 5961 7750 6974 6368 526f 6c6c  g.R_YawPitchRoll
+000147b0: 2861 7474 6974 7564 652e 7961 772c 6174  (attitude.yaw,at
+000147c0: 7469 7475 6465 2e70 6974 6368 2c61 7474  titude.pitch,att
+000147d0: 6974 7564 652e 726f 6c6c 290a 2020 2020  itude.roll).    
+000147e0: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
+000147f0: 6d32 6e65 6420 3d20 525f 6672 616d 6532  m2ned = R_frame2
+00014800: 6e65 642e 646f 7428 525f 6361 6d32 6672  ned.dot(R_cam2fr
+00014810: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00014820: 2020 2020 2079 6177 2c70 6974 6368 2c72       yaw,pitch,r
+00014830: 6f6c 6c20 3d20 6d69 7174 672e 7961 7750  oll = miqtg.yawP
+00014840: 6974 6368 526f 6c6c 2852 5f63 616d 326e  itchRoll(R_cam2n
+00014850: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+00014860: 2020 2020 6174 7469 7475 6465 2e79 6177      attitude.yaw
+00014870: 203d 2079 6177 0a20 2020 2020 2020 2020   = yaw.         
+00014880: 2020 2020 2020 2061 7474 6974 7564 652e         attitude.
+00014890: 7069 7463 6820 3d20 7069 7463 680a 2020  pitch = pitch.  
+000148a0: 2020 2020 2020 2020 2020 2020 2020 6174                at
+000148b0: 7469 7475 6465 2e72 6f6c 6c20 3d20 726f  titude.roll = ro
+000148c0: 6c6c 0a0a 2020 2020 2020 2020 2020 2020  ll..            
+000148d0: 2020 2020 525f 6361 6d53 7464 3275 746d      R_camStd2utm
+000148e0: 203d 2073 656c 662e 6765 745f 525f 6361   = self.get_R_ca
+000148f0: 6d53 7464 3275 746d 2852 5f63 616d 3266  mStd2utm(R_cam2f
+00014900: 7261 6d65 2c52 5f66 7261 6d65 326e 6564  rame,R_frame2ned
+00014910: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014920: 2020 525f 6361 6d32 7574 6d5f 6c69 7374    R_cam2utm_list
+00014930: 2e61 7070 656e 6428 525f 6361 6d53 7464  .append(R_camStd
+00014940: 3275 746d 2e66 6c61 7474 656e 2829 2e74  2utm.flatten().t
+00014950: 6f6c 6973 7428 2929 0a0a 2020 2020 2020  olist())..      
+00014960: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+00014970: 2261 7070 6c69 6564 2066 7261 6d65 2074  "applied frame t
+00014980: 6f20 6361 6d65 7261 2072 6f74 6174 696f  o camera rotatio
+00014990: 6e20 7961 772c 7069 7463 682c 726f 6c6c  n yaw,pitch,roll
+000149a0: 203d 2022 202b 2073 7472 2863 616d 6572   = " + str(camer
+000149b0: 6132 4672 616d 655f 7961 7729 202b 2022  a2Frame_yaw) + "
+000149c0: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
+000149d0: 4672 616d 655f 7069 7463 6829 202b 2022  Frame_pitch) + "
+000149e0: 2c22 202b 2073 7472 2863 616d 6572 6132  ," + str(camera2
+000149f0: 4672 616d 655f 726f 6c6c 292c 646f 6e74  Frame_roll),dont
+00014a00: 5368 6f77 3d54 7275 6529 0a0a 2020 2020  Show=True)..    
+00014a10: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
+00014a20: 5f64 7473 2920 3e20 303a 0a0a 2020 2020  _dts) > 0:..    
+00014a30: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+00014a40: 746f 206e 6176 6967 6174 696f 6e20 7478  to navigation tx
+00014a50: 7420 6669 6c65 0a20 2020 2020 2020 2020  t file.         
+00014a60: 2020 2023 2068 6561 6465 720a 2020 2020     # header.    
+00014a70: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+00014a80: 656e 2869 6e74 5f61 7474 7574 7564 655f  en(int_attutude_
+00014a90: 6669 6c65 2c20 2277 2229 0a20 2020 2020  file, "w").     
+00014aa0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00014ab0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
+00014ac0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+00014ad0: 275d 2b22 5c74 222b 6d69 7174 762e 636f  ']+"\t"+miqtv.co
+00014ae0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00014af0: 275d 5b27 7574 6327 5d29 0a20 2020 2020  ']['utc']).     
+00014b00: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00014b10: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
+00014b20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00014b30: 5b27 7961 7727 5d29 0a20 2020 2020 2020  ['yaw']).       
+00014b40: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014b50: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00014b60: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00014b70: 7069 7463 6827 5d29 0a20 2020 2020 2020  pitch']).       
+00014b80: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014b90: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
+00014ba0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00014bb0: 726f 6c6c 275d 290a 0a20 2020 2020 2020  roll'])..       
+00014bc0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014bd0: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00014be0: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
+00014bf0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+00014c00: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
+00014c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c20: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
+00014c30: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+00014c40: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00014c50: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00014c60: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
+00014c70: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
+00014c80: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+00014c90: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+00014ca0: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
+00014cb0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00014cc0: 203d 2074 696d 6570 6f69 6e74 2e79 6177   = timepoint.yaw
+00014cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014ce0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014cf0: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
+00014d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d10: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
+00014d20: 742e 7069 7463 680a 2020 2020 2020 2020  t.pitch.        
+00014d30: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00014d40: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
+00014d50: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
+00014d60: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+00014d70: 696d 6570 6f69 6e74 2e72 6f6c 6c0a 2020  imepoint.roll.  
+00014d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d90: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00014da0: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
+00014db0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014dc0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
+00014dd0: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
+00014de0: 6c6f 7365 2829 0a0a 2020 2020 2020 2020  lose()..        
+00014df0: 2020 2020 7365 6c66 2e70 726f 762e 6164      self.prov.ad
+00014e00: 6441 7267 756d 656e 7428 2269 6e70 7574  dArgument("input
+00014e10: 4174 7469 7475 6465 4669 6c65 222c 6174  AttitudeFile",at
+00014e20: 745f 7061 7468 2c6f 7665 7277 7269 7465  t_path,overwrite
+00014e30: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+00014e40: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+00014e50: 2822 7061 7273 6564 2066 726f 6d20 696e  ("parsed from in
+00014e60: 7075 7441 7474 6974 7564 6546 696c 653a  putAttitudeFile:
+00014e70: 2022 202b 2073 7472 2866 7261 6d65 5f61   " + str(frame_a
+00014e80: 7474 5f68 6561 6465 7229 2c64 6f6e 7453  tt_header),dontS
+00014e90: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+00014ea0: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
+00014eb0: 7465 6d5f 696e 666f 5f74 6162 5f66 696c  tem_info_tab_fil
+00014ec0: 6528 696e 745f 6174 7475 7475 6465 5f66  e(int_attutude_f
+00014ed0: 696c 652c 225c 7422 2c6f 7574 7075 745f  ile,"\t",output_
+00014ee0: 6865 6164 6572 5f61 7474 290a 0a20 2020  header_att)..   
+00014ef0: 2020 2020 2020 2020 2023 2057 7269 7465           # Write
+00014f00: 2074 6f20 706f 7365 2074 7874 2066 696c   to pose txt fil
+00014f10: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+00014f20: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+00014f30: 2020 2072 6573 203d 206f 7065 6e28 696e     res = open(in
+00014f40: 745f 706f 7365 5f66 696c 652c 2022 7722  t_pose_file, "w"
+00014f50: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00014f60: 732e 7772 6974 6528 6d69 7174 762e 636f  s.write(miqtv.co
+00014f70: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00014f80: 275d 5b27 696d 6727 5d2b 225c 7422 2b6d  ']['img']+"\t"+m
+00014f90: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00014fa0: 276d 6172 6971 7427 5d5b 2775 7463 275d  'mariqt']['utc']
+00014fb0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00014fc0: 732e 7772 6974 6528 225c 7422 2b6d 6971  s.write("\t"+miq
+00014fd0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00014fe0: 6172 6971 7427 5d5b 2770 6f73 6527 5d29  ariqt']['pose'])
+00014ff0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00015000: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
+00015010: 2020 2020 2020 2020 2023 2064 6174 6120           # data 
+00015020: 6c69 6e65 730a 2020 2020 2020 2020 2020  lines.          
+00015030: 2020 6920 3d20 300a 2020 2020 2020 2020    i = 0.        
+00015040: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00015050: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
+00015060: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
+00015070: 696d 6570 6f69 6e74 2069 6e20 696d 6167  imepoint in imag
+00015080: 655f 6474 735b 6669 6c65 5d3a 0a20 2020  e_dts[file]:.   
+00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150a0: 2069 6620 525f 6361 6d32 7574 6d5f 6c69   if R_cam2utm_li
+000150b0: 7374 5b69 5d20 3d3d 2022 223a 0a20 2020  st[i] == "":.   
+000150c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150d0: 2020 2020 2069 202b 3d20 310a 2020 2020       i += 1.    
+000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150f0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015110: 2072 6573 2e77 7269 7465 2866 696c 652b   res.write(file+
+00015120: 225c 7422 2b74 696d 6570 6f69 6e74 2e64  "\t"+timepoint.d
+00015130: 6174 6554 696d 6528 292e 7374 7266 7469  ateTime().strfti
+00015140: 6d65 286d 6971 7476 2e64 6174 655f 666f  me(miqtv.date_fo
+00015150: 726d 6174 735b 276d 6172 6971 7427 5d29  rmats['mariqt'])
+00015160: 2920 0a20 2020 2020 2020 2020 2020 2020  ) .             
+00015170: 2020 2020 2020 2065 6e74 7279 203d 2073         entry = s
+00015180: 7472 287b 2770 6f73 652d 6162 736f 6c75  tr({'pose-absolu
+00015190: 7465 2d6f 7269 656e 7461 7469 6f6e 2d75  te-orientation-u
+000151a0: 746d 2d6d 6174 7269 7827 3a52 5f63 616d  tm-matrix':R_cam
+000151b0: 3275 746d 5f6c 6973 745b 695d 7d29 2e72  2utm_list[i]}).r
+000151c0: 6570 6c61 6365 2827 5c6e 272c 2727 290a  eplace('\n','').
+000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151e0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+000151f0: 7422 2b65 6e74 7279 290a 2020 2020 2020  t"+entry).      
+00015200: 2020 2020 2020 2020 2020 2020 2020 6920                i 
+00015210: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00015220: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00015230: 7465 2822 5c6e 2229 0a20 2020 2020 2020  te("\n").       
+00015240: 2020 2020 2072 6573 2e63 6c6f 7365 2829       res.close()
+00015250: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015260: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
+00015270: 7461 625f 6669 6c65 2869 6e74 5f70 6f73  tab_file(int_pos
+00015280: 655f 6669 6c65 2c22 5c74 222c 6f75 7470  e_file,"\t",outp
+00015290: 7574 5f68 6561 6465 725f 706f 7365 290a  ut_header_pose).
+000152a0: 2020 2020 2020 2020 2020 2020 732e 7374              s.st
+000152b0: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
+000152c0: 2072 6574 7572 6e20 5472 7565 2c20 2241   return True, "A
+000152d0: 7474 6974 7564 6520 6461 7461 2063 7265  ttitude data cre
+000152e0: 6174 6564 2220 2b20 7061 7273 654d 7367  ated" + parseMsg
+000152f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00015300: 2020 2020 2020 2020 2020 2073 2e73 746f             s.sto
+00015310: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00015320: 7265 7475 726e 2046 616c 7365 2c20 224e  return False, "N
+00015330: 6f20 696d 6167 6520 6174 7469 7475 6465  o image attitude
+00015340: 7320 666f 756e 6422 202b 2070 6172 7365  s found" + parse
+00015350: 4d73 670a 2020 2020 2020 2020 0a20 2020  Msg.        .   
+00015360: 2020 2020 200a 2020 2020 6465 6620 6372       .    def cr
+00015370: 6561 7465 496d 6167 6541 7474 6974 7564  eateImageAttitud
+00015380: 6546 696c 6528 7365 6c66 2c20 6174 745f  eFile(self, att_
+00015390: 7061 7468 3a73 7472 2c20 6672 616d 655f  path:str, frame_
+000153a0: 6174 745f 6865 6164 6572 3a64 6963 742c  att_header:dict,
+000153b0: 2063 616d 6572 6132 4672 616d 655f 7961   camera2Frame_ya
+000153c0: 773a 666c 6f61 742c 6361 6d65 7261 3246  w:float,camera2F
+000153d0: 7261 6d65 5f70 6974 6368 3a66 6c6f 6174  rame_pitch:float
+000153e0: 2c63 616d 6572 6132 4672 616d 655f 726f  ,camera2Frame_ro
+000153f0: 6c6c 3a66 6c6f 6174 2c0a 2020 2020 2020  ll:float,.      
+00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015410: 2020 2020 2020 2020 2020 6461 7465 5f66            date_f
+00015420: 6f72 6d61 743d 6d69 7174 762e 6461 7465  ormat=miqtv.date
+00015430: 5f66 6f72 6d61 7473 5b27 7061 6e67 6165  _formats['pangae
+00015440: 6127 5d2c 2063 6f6e 7374 5f76 616c 7565  a'], const_value
+00015450: 7320 3d20 7b7d 2c20 6f76 6572 7772 6974  s = {}, overwrit
+00015460: 653d 4661 6c73 652c 2063 6f6c 5f73 6570  e=False, col_sep
+00015470: 6172 6174 6f72 203d 2022 5c74 222c 0a20  arator = "\t",. 
+00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015490: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000154a0: 7474 5f70 6174 685f 616e 676c 6573 5f69  tt_path_angles_i
+000154b0: 6e5f 7261 6420 3d20 4661 6c73 652c 2076  n_rad = False, v
+000154c0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+000154d0: 733d 312c 7265 636f 7264 7332 6265 496e  s=1,records2beIn
+000154e0: 7665 7274 6564 3d5b 5d29 3a0a 2020 2020  verted=[]):.    
+000154f0: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
+00015500: 6465 202d 2075 7365 2063 7265 6174 655f  de - use create_
+00015510: 696d 6167 655f 6174 7469 7475 6465 5f66  image_attitude_f
+00015520: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+00015530: 7265 7475 726e 2073 656c 662e 6372 6561  return self.crea
+00015540: 7465 5f69 6d61 6765 5f61 7474 6974 7564  te_image_attitud
+00015550: 655f 6669 6c65 2861 7474 5f70 6174 682c  e_file(att_path,
+00015560: 2066 7261 6d65 5f61 7474 5f68 6561 6465   frame_att_heade
+00015570: 722c 2063 616d 6572 6132 4672 616d 655f  r, camera2Frame_
+00015580: 7961 772c 2063 616d 6572 6132 4672 616d  yaw, camera2Fram
+00015590: 655f 7069 7463 682c 2063 616d 6572 6132  e_pitch, camera2
+000155a0: 4672 616d 655f 726f 6c6c 2c20 0a20 2020  Frame_roll, .   
+000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155d0: 2020 2020 2020 2020 2020 2020 6461 7465              date
+000155e0: 5f66 6f72 6d61 742c 2063 6f6e 7374 5f76  _format, const_v
+000155f0: 616c 7565 732c 206f 7665 7277 7269 7465  alues, overwrite
+00015600: 2c20 636f 6c5f 7365 7061 7261 746f 722c  , col_separator,
+00015610: 2061 7474 5f70 6174 685f 616e 676c 6573   att_path_angles
+00015620: 5f69 6e5f 7261 642c 2076 6964 656f 5361  _in_rad, videoSa
+00015630: 6d70 6c65 5365 636f 6e64 732c 0a20 2020  mpleSeconds,.   
+00015640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015660: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00015670: 7264 7332 6265 496e 7665 7274 6564 290a  rds2beInverted).
+00015680: 2020 2020 2020 2020 0a0a 2020 2020 6465          ..    de
+00015690: 6620 6765 745f 525f 6361 6d53 7464 3275  f get_R_camStd2u
+000156a0: 746d 2873 656c 662c 525f 6361 6d32 6672  tm(self,R_cam2fr
+000156b0: 616d 653a 6e70 2e61 7272 6179 2c52 5f66  ame:np.array,R_f
+000156c0: 7261 6d65 326e 6564 3a6e 702e 6172 7261  rame2ned:np.arra
+000156d0: 7929 3a0a 2020 2020 2020 2020 2222 2220  y):.        """ 
+000156e0: 7265 7472 756e 2072 6f74 6174 696f 6e20  retrun rotation 
+000156f0: 6d61 7472 6978 2052 2074 7261 6e66 6f72  matrix R tranfor
+00015700: 6d69 6e67 2066 726f 6d20 6361 6d53 7464  ming from camStd
+00015710: 3a20 2878 2c79 2c7a 203d 2072 6967 6874  : (x,y,z = right
+00015720: 2c62 7574 746f 6d2c 6c69 6e65 206f 6620  ,buttom,line of 
+00015730: 7369 6768 7429 2074 6f20 7574 6d20 2878  sight) to utm (x
+00015740: 2c79 2c7a 203d 2065 6173 7469 6e67 2c6e  ,y,z = easting,n
+00015750: 6f72 7468 696e 672c 7570 2920 2222 220a  orthing,up) """.
+00015760: 2020 2020 2020 2020 525f 6361 6d69 4644          R_camiFD
+00015770: 4f32 6361 6d53 7464 203d 206d 6971 7467  O2camStd = miqtg
+00015780: 2e52 5f59 6177 5069 7463 6852 6f6c 6c28  .R_YawPitchRoll(
+00015790: 3930 2c30 2c30 2920 2320 696e 2069 4644  90,0,0) # in iFD
+000157a0: 4f20 6361 6d3a 2028 782c 792c 7a20 3d20  O cam: (x,y,z = 
+000157b0: 746f 702c 7269 6768 742c 6c69 6e65 206f  top,right,line o
+000157c0: 6620 7369 6768 7429 2062 7574 2066 6f72  f sight) but for
+000157d0: 2070 6f73 6520 7468 6520 2773 7461 6e64   pose the 'stand
+000157e0: 6172 6427 2063 616d 5374 643a 2028 782c  ard' camStd: (x,
+000157f0: 792c 7a20 3d20 7269 6768 742c 6275 7474  y,z = right,butt
+00015800: 6f6d 2c6c 696e 6520 6f66 2073 6967 6874  om,line of sight
+00015810: 2920 6973 2065 7870 6563 7465 640a 2020  ) is expected.  
+00015820: 2020 2020 2020 525f 6361 6d53 7464 3266        R_camStd2f
+00015830: 7261 6d65 203d 2052 5f63 616d 3266 7261  rame = R_cam2fra
+00015840: 6d65 2e64 6f74 2852 5f63 616d 6946 444f  me.dot(R_camiFDO
+00015850: 3263 616d 5374 6429 0a20 2020 2020 2020  2camStd).       
+00015860: 2052 5f63 616d 5374 6432 6e65 6420 3d20   R_camStd2ned = 
+00015870: 525f 6672 616d 6532 6e65 642e 646f 7428  R_frame2ned.dot(
+00015880: 525f 6361 6d53 7464 3266 7261 6d65 290a  R_camStd2frame).
+00015890: 2020 2020 2020 2020 525f 6e65 6432 7574          R_ned2ut
+000158a0: 6d20 3d20 6d69 7174 672e 525f 5859 5a28  m = miqtg.R_XYZ(
+000158b0: 3138 302c 302c 3930 2920 2320 7769 7468  180,0,90) # with
+000158c0: 2075 746d 2078 2c79 2c7a 203d 2065 6173   utm x,y,z = eas
+000158d0: 7469 6e67 2c6e 6f72 7468 696e 672c 7570  ting,northing,up
+000158e0: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
+000158f0: 6432 7574 6d20 3d20 525f 6e65 6432 7574  d2utm = R_ned2ut
+00015900: 6d2e 646f 7428 525f 6361 6d53 7464 326e  m.dot(R_camStd2n
+00015910: 6564 292e 726f 756e 6428 3529 0a20 2020  ed).round(5).   
+00015920: 2020 2020 2072 6574 7572 6e20 525f 6361       return R_ca
+00015930: 6d53 7464 3275 746d 0a0a 0a20 2020 2064  mStd2utm...    d
+00015940: 6566 2066 696e 644e 6176 4461 7461 466f  ef findNavDataFo
+00015950: 7249 6d61 6765 2873 656c 662c 6461 7461  rImage(self,data
+00015960: 3a6d 6971 7467 2e4e 756d 4461 7461 5469  :miqtg.NumDataTi
+00015970: 6d65 5374 616d 7065 642c 7669 6465 6f53  meStamped,videoS
+00015980: 616d 706c 6553 6563 6f6e 6473 3d31 293a  ampleSeconds=1):
+00015990: 0a20 2020 2020 2020 2022 2222 2063 7265  .        """ cre
+000159a0: 6174 6573 2061 2064 6963 7420 2869 6d61  ates a dict (ima
+000159b0: 6765 5f64 7473 2920 7769 7468 2066 696c  ge_dts) with fil
+000159c0: 6520 6e61 6d65 2061 7320 6b65 7920 616e  e name as key an
+000159d0: 6420 6120 6c69 7374 206f 6620 6461 7461  d a list of data
+000159e0: 2065 6c65 6d65 6e74 7320 6173 2076 616c   elements as val
+000159f0: 7565 2e20 0a20 2020 2020 2020 2020 2020  ue. .           
+00015a00: 2049 6e20 6361 7365 206f 6620 7068 6f74   In case of phot
+00015a10: 6f73 2074 6865 206c 6973 7420 6861 7320  os the list has 
+00015a20: 6f6e 6c79 2061 2073 696e 676c 6520 656e  only a single en
+00015a30: 7472 792c 2066 6f72 2076 6964 656f 7320  try, for videos 
+00015a40: 6974 2068 6173 2076 6964 656f 2064 7572  it has video dur
+00015a50: 6174 696f 6e20 5b73 6563 5d20 2f20 7669  ation [sec] / vi
+00015a60: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+00015a70: 2065 6e74 7269 6573 2e0a 2020 2020 2020   entries..      
+00015a80: 2020 2020 2020 5265 7475 726e 7320 7375        Returns su
+00015a90: 6363 6573 732c 2069 6d61 6765 5f64 7473  ccess, image_dts
+00015aa0: 2c20 6d73 6720 2222 220a 0a20 2020 2020  , msg """..     
+00015ab0: 2020 2069 6620 7669 6465 6f53 616d 706c     if videoSampl
+00015ac0: 6553 6563 6f6e 6473 203c 3d20 303a 0a20  eSeconds <= 0:. 
+00015ad0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00015ae0: 2045 7863 6570 7469 6f6e 2822 6669 6e64   Exception("find
+00015af0: 4e61 7644 6174 6146 6f72 496d 6167 653a  NavDataForImage:
+00015b00: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
+00015b10: 6e64 7320 6d75 7374 2062 6520 6772 6561  nds must be grea
+00015b20: 7465 7220 3022 290a 0a20 2020 2020 2020  ter 0")..       
+00015b30: 2023 2063 7265 6174 6520 736f 7274 6564   # create sorted
+00015b40: 2074 696d 6520 706f 696e 7473 0a20 2020   time points.   
+00015b50: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
+00015b60: 203d 206c 6973 7428 6461 7461 2e6b 6579   = list(data.key
+00015b70: 7328 2929 0a20 2020 2020 2020 2074 696d  s()).        tim
+00015b80: 655f 706f 696e 7473 2e73 6f72 7428 290a  e_points.sort().
+00015b90: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
+00015ba0: 6454 696d 6550 6f69 6e74 7320 3d20 5b5d  dTimePoints = []
+00015bb0: 0a20 2020 2020 2020 2069 6d61 6765 5f64  .        image_d
+00015bc0: 7473 203d 207b 7d0a 2020 2020 2020 2020  ts = {}.        
+00015bd0: 7374 6172 7453 6561 7263 6849 6e64 6578  startSearchIndex
+00015be0: 203d 2030 0a20 2020 2020 2020 2069 6d61   = 0.        ima
+00015bf0: 6765 7349 6e52 6177 203d 2020 7365 6c66  gesInRaw =  self
+00015c00: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
+00015c10: 6972 2829 0a20 2020 2020 2020 2069 6d61  ir().        ima
+00015c20: 6765 7349 6e52 6177 536f 7274 6564 4c69  gesInRawSortedLi
+00015c30: 7374 203d 2073 656c 662e 696d 6167 6573  st = self.images
+00015c40: 496e 496d 6167 6573 4469 7253 6f72 7465  InImagesDirSorte
+00015c50: 644c 6973 7428 290a 2020 2020 2020 2020  dList().        
+00015c60: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
+00015c70: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
+00015c80: 7367 2822 496e 7465 7270 6f6c 6174 696e  sg("Interpolatin
+00015c90: 6720 6e61 7669 6761 7469 6f6e 2066 6f72  g navigation for
+00015ca0: 2069 6d61 6765 222c 206c 656e 2869 6d61   image", len(ima
+00015cb0: 6765 7349 6e52 6177 292c 6d6f 6475 6c6f  gesInRaw),modulo
+00015cc0: 3d31 290a 2020 2020 2020 2020 666f 7220  =1).        for 
+00015cd0: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
+00015ce0: 5261 7753 6f72 7465 644c 6973 743a 0a20  RawSortedList:. 
+00015cf0: 2020 2020 2020 2020 2020 2070 726f 672e             prog.
+00015d00: 7072 6f67 7265 7373 2829 0a20 2020 2020  progress().     
+00015d10: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+00015d20: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00015d30: 616d 6528 6669 6c65 290a 0a20 2020 2020  ame(file)..     
+00015d40: 2020 2020 2020 2064 745f 696d 6167 6520         dt_image 
+00015d50: 3d20 6d69 7174 632e 7061 7273 6546 696c  = miqtc.parseFil
+00015d60: 6544 6174 6554 696d 6541 7355 5443 2866  eDateTimeAsUTC(f
+00015d70: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
+00015d80: 2020 2020 2020 6474 5f69 6d61 6765 5f74        dt_image_t
+00015d90: 7320 3d20 696e 7428 6474 5f69 6d61 6765  s = int(dt_image
+00015da0: 2e74 696d 6573 7461 6d70 2829 202a 2031  .timestamp() * 1
+00015db0: 3030 3029 0a0a 2020 2020 2020 2020 2020  000)..          
+00015dc0: 2020 7275 6e54 696d 6520 3d20 696d 6167    runTime = imag
+00015dd0: 6573 496e 5261 775b 6669 6c65 5d5b 315d  esInRaw[file][1]
+00015de0: 2023 202d 3120 666f 7220 7068 6f74 6f73   # -1 for photos
+00015df0: 0a20 2020 2020 2020 2020 2020 2023 2076  .            # v
+00015e00: 6964 656f 0a20 2020 2020 2020 2020 2020  ideo.           
+00015e10: 2069 6620 696d 6167 6573 496e 5261 775b   if imagesInRaw[
+00015e20: 6669 6c65 5d5b 325d 2069 6e20 6d69 7174  file][2] in miqt
+00015e30: 762e 7669 6465 6f5f 7479 7065 7320 616e  v.video_types an
+00015e40: 6420 7275 6e54 696d 6520 3c3d 2030 3a20  d runTime <= 0: 
+00015e50: 2320 6578 740a 2020 2020 2020 2020 2020  # ext.          
+00015e60: 2020 2020 2020 7072 696e 7428 2243 6175        print("Cau
+00015e70: 7469 6f6e 2120 436f 756c 6420 6e6f 7420  tion! Could not 
+00015e80: 7265 6164 2076 6964 656f 2072 756e 2074  read video run t
+00015e90: 696d 6520 6672 6f6d 2066 696c 6522 2c66  ime from file",f
+00015ea0: 696c 6529 2023 2054 4f44 4f20 646f 6573  ile) # TODO does
+00015eb0: 2074 6869 7320 6861 7070 656e 3f20 4861   this happen? Ha
+00015ec0: 6e64 6c65 2062 6574 7465 723f 0a0a 2020  ndle better?..  
+00015ed0: 2020 2020 2020 2020 2020 7361 6d70 6c65            sample
+00015ee0: 5469 6d65 5365 6373 203d 2030 0a20 2020  TimeSecs = 0.   
+00015ef0: 2020 2020 2020 2020 2070 6f73 5f6c 6973           pos_lis
+00015f00: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
+00015f10: 2020 2067 6f20 3d20 5472 7565 0a20 2020     go = True.   
+00015f20: 2020 2020 2020 2020 2077 6869 6c65 2067           while g
+00015f30: 6f3a 0a20 2020 2020 2020 2020 2020 2020  o:.             
+00015f40: 2020 2074 7279 3a20 2020 2020 2020 2020     try:         
+00015f50: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f70: 706f 732c 2073 7461 7274 5365 6172 6368  pos, startSearch
+00015f80: 496e 6465 7820 3d20 6461 7461 2e69 6e74  Index = data.int
+00015f90: 6572 706f 6c61 7465 4174 5469 6d65 2864  erpolateAtTime(d
+00015fa0: 745f 696d 6167 655f 7473 202b 2073 616d  t_image_ts + sam
+00015fb0: 706c 6554 696d 6553 6563 7320 2a20 3130  pleTimeSecs * 10
+00015fc0: 3030 2c74 696d 655f 706f 696e 7473 2c73  00,time_points,s
+00015fd0: 7461 7274 5365 6172 6368 496e 6465 7829  tartSearchIndex)
+00015fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015ff0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+00016000: 2020 2020 2020 2020 2020 2320 696e 7465            # inte
+00016010: 7270 6f6c 6174 6541 7454 696d 6520 7265  rpolateAtTime re
+00016020: 7475 726e 7320 4e6f 6e65 2076 616c 7565  turns None value
+00016030: 7320 6966 2074 696d 6520 6f75 7420 6f66  s if time out of
+00016040: 2072 616e 6765 0a20 2020 2020 2020 2020   range.         
+00016050: 2020 2020 2020 2020 2020 2069 6620 706f             if po
+00016060: 732e 636f 7461 696e 734e 6f6e 6556 616c  s.cotainsNoneVal
+00016070: 7565 7349 6e52 6571 7569 7265 6446 6965  uesInRequiredFie
+00016080: 6c64 7328 293a 0a20 2020 2020 2020 2020  lds():.         
+00016090: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+000160a0: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
+000160b0: 7473 2e61 7070 656e 6428 2864 745f 696d  ts.append((dt_im
+000160c0: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
+000160d0: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
+000160e0: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
+000160f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016110: 2020 2020 2020 2020 706f 735f 6c69 7374          pos_list
+00016120: 2e61 7070 656e 6428 706f 7329 0a20 2020  .append(pos).   
+00016130: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00016140: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+00016150: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00016160: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00016170: 616c 7365 2c20 696d 6167 655f 6474 732c  alse, image_dts,
+00016180: 2022 436f 756c 6420 6e6f 7420 6669 6e64   "Could not find
+00016190: 2069 6d61 6765 2074 696d 6520 222b 2064   image time "+ d
+000161a0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+000161b0: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
+000161c0: 7028 2864 745f 696d 6167 655f 7473 202b  p((dt_image_ts +
+000161d0: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
+000161e0: 2a20 3130 3030 292f 3130 3030 292e 7374  * 1000)/1000).st
+000161f0: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
+00016200: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+00016210: 7427 5d29 202b 2220 696e 2022 2b73 7472  t']) +" in "+str
+00016220: 2864 6174 612e 6c65 6e28 2929 2b22 2064  (data.len())+" d
+00016230: 6174 6120 706f 7369 7469 6f6e 7322 202b  ata positions" +
+00016240: 2073 7472 2865 2e61 7267 7329 0a20 2020   str(e.args).   
+00016250: 2020 2020 2020 2020 2020 2020 2073 616d               sam
+00016260: 706c 6554 696d 6553 6563 7320 2b3d 2076  pleTimeSecs += v
+00016270: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+00016280: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00016290: 2020 6966 2073 616d 706c 6554 696d 6553    if sampleTimeS
+000162a0: 6563 7320 3e20 7275 6e54 696d 653a 0a20  ecs > runTime:. 
+000162b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162c0: 2020 2067 6f20 3d20 4661 6c73 650a 2020     go = False.  
+000162d0: 2020 2020 2020 2020 2020 0a20 2020 2020            .     
+000162e0: 2020 2020 2020 2069 6d61 6765 5f64 7473         image_dts
+000162f0: 5b66 696c 655f 6e61 6d65 5d20 3d20 706f  [file_name] = po
+00016300: 735f 6c69 7374 0a20 2020 2020 2020 2070  s_list.        p
+00016310: 726f 672e 636c 6561 7228 290a 2020 2020  rog.clear().    
+00016320: 2020 2020 7265 7475 726e 4d73 6720 3d20      returnMsg = 
+00016330: 2222 0a20 2020 2020 2020 2069 6620 6c65  "".        if le
+00016340: 6e28 756e 6d61 7463 6865 6454 696d 6550  n(unmatchedTimeP
+00016350: 6f69 6e74 7329 2021 3d20 303a 0a20 2020  oints) != 0:.   
+00016360: 2020 2020 2020 2020 2075 6e6d 6174 6368           unmatch
+00016370: 6564 5469 6d65 506f 696e 7473 2e73 6f72  edTimePoints.sor
+00016380: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+00016390: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
+000163a0: 6e74 7320 3d20 5b64 6174 6574 696d 652e  nts = [datetime.
+000163b0: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
+000163c0: 7469 6d65 7374 616d 7028 7473 292e 7374  timestamp(ts).st
+000163d0: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
+000163e0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+000163f0: 7427 5d29 2066 6f72 2074 7320 696e 2075  t']) for ts in u
+00016400: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
+00016410: 7473 5d0a 2020 2020 2020 2020 2020 2020  ts].            
+00016420: 7265 7475 726e 4d73 6720 3d20 2243 6175  returnMsg = "Cau
+00016430: 7469 6f6e 2120 4e61 7669 6761 7469 6f6e  tion! Navigation
+00016440: 206e 6f74 2066 6f75 6e64 2066 6f72 2074   not found for t
+00016450: 6865 2066 6f6c 6c6f 7769 6e67 2069 6d61  he following ima
+00016460: 6765 2074 696d 6520 706f 696e 7473 2e20  ge time points. 
+00016470: 446f 7562 6c65 2063 6865 636b 206f 7220  Double check or 
+00016480: 7072 6f76 6964 6520 6174 206c 6561 7374  provide at least
+00016490: 2073 7461 7469 6320 6465 6661 756c 7420   static default 
+000164a0: 6e61 7669 6761 7469 6f6e 2069 6e20 6865  navigation in he
+000164b0: 6164 6572 2066 6965 6c64 732e 220a 2020  ader fields.".  
+000164c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000164d0: 4d73 6720 2b3d 2022 5c6e 2220 2b20 225c  Msg += "\n" + "\
+000164e0: 6e22 2e6a 6f69 6e28 756e 6d61 7463 6865  n".join(unmatche
+000164f0: 6454 696d 6550 6f69 6e74 7329 0a20 2020  dTimePoints).   
+00016500: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00016510: 2c20 696d 6167 655f 6474 732c 2072 6574  , image_dts, ret
+00016520: 7572 6e4d 7367 0a0a 0a20 2020 2064 6566  urnMsg...    def
+00016530: 2063 7265 6174 655f 696d 6167 655f 6e61   create_image_na
+00016540: 7669 6761 7469 6f6e 5f66 696c 6528 7365  vigation_file(se
+00016550: 6c66 2c20 6e61 765f 7061 7468 3a20 7374  lf, nav_path: st
+00016560: 722c 206e 6176 5f68 6561 6465 723d 6d69  r, nav_header=mi
+00016570: 7174 762e 706f 735f 6865 6164 6572 5b27  qtv.pos_header['
+00016580: 7061 6e67 6165 6127 5d2c 2064 6174 655f  pangaea'], date_
+00016590: 666f 726d 6174 3d6d 6971 7476 2e64 6174  format=miqtv.dat
+000165a0: 655f 666f 726d 6174 735b 2770 616e 6761  e_formats['panga
+000165b0: 6561 275d 2c20 6f76 6572 7772 6974 653d  ea'], overwrite=
+000165c0: 4661 6c73 652c 2063 6f6c 5f73 6570 6172  False, col_separ
+000165d0: 6174 6f72 203d 2022 5c74 222c 2076 6964  ator = "\t", vid
+000165e0: 656f 5361 6d70 6c65 5365 636f 6e64 733d  eoSampleSeconds=
+000165f0: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+00016600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016610: 2020 2020 2020 206f 6666 7365 745f 783d         offset_x=
+00016620: 302c 206f 6666 7365 745f 793d 302c 206f  0, offset_y=0, o
+00016630: 6666 7365 745f 7a3d 302c 616e 676c 6573  ffset_z=0,angles
+00016640: 5f69 6e5f 7261 6420 3d20 4661 6c73 652c  _in_rad = False,
+00016650: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00016660: 7465 643d 5b5d 293a 0a20 2020 2020 2020  ted=[]):.       
+00016670: 2022 2222 2043 7265 6174 6573 2069 6e20   """ Creates in 
+00016680: 2f69 6e74 6572 6d65 6469 6174 6520 6120  /intermediate a 
+00016690: 7465 7874 2066 696c 6520 7769 7468 2034  text file with 4
+000166a0: 2e35 4420 6e61 7669 6761 7469 6f6e 2064  .5D navigation d
+000166b0: 6174 6120 666f 7220 6561 6368 2069 6d61  ata for each ima
+000166c0: 6765 2c20 692e 652e 2061 2073 696e 676c  ge, i.e. a singl
+000166d0: 6520 726f 7720 7065 7220 7068 6f74 6f2c  e row per photo,
+000166e0: 2076 6964 656f 2064 7572 6174 696f 6e20   video duration 
+000166f0: 5b73 6563 5d20 2f20 7669 6465 6f53 616d  [sec] / videoSam
+00016700: 706c 6553 6563 6f6e 6473 2072 6f77 7320  pleSeconds rows 
+00016710: 7065 7220 7669 6465 6f2e 0a20 2020 2020  per video..     
+00016720: 2020 2020 2020 206e 6176 5f68 6561 6465         nav_heade
+00016730: 7220 6d75 7374 2062 6520 6469 6374 2063  r must be dict c
+00016740: 6f6e 7461 696e 696e 6720 7468 6520 6b65  ontaining the ke
+00016750: 7973 2027 7574 6327 2c27 6c61 7427 2c27  ys 'utc','lat','
+00016760: 6c6f 6e27 2c27 6465 7027 286f 7220 2761  lon','dep'(or 'a
+00016770: 6c74 2729 2c20 6f70 7469 6f6e 616c 3a20  lt'), optional: 
+00016780: 2768 6774 272c 2775 6e63 6572 7427 2077  'hgt','uncert' w
+00016790: 6974 6820 7468 6520 7265 7370 6563 7469  ith the respecti
+000167a0: 7665 2063 6f6c 756d 6e20 6865 6164 6572  ve column header
+000167b0: 7320 6173 2076 616c 7565 7320 0a20 2020  s as values .   
+000167c0: 2020 2020 2020 2020 2069 6620 6f6e 6520           if one 
+000167d0: 6f66 2074 6865 2076 6568 6963 6c65 2078  of the vehicle x
+000167e0: 2c79 2c7a 206f 6666 7365 7473 205b 6d5d  ,y,z offsets [m]
+000167f0: 2069 7320 6e6f 7420 3020 616e 6420 6e61   is not 0 and na
+00016800: 765f 6865 6164 6572 2061 6c73 6f20 636f  v_header also co
+00016810: 6e74 6169 6e73 2027 7961 7727 2c27 7069  ntains 'yaw','pi
+00016820: 7463 6827 2c27 726f 6c6c 2720 6c65 7665  tch','roll' leve
+00016830: 7261 726d 206f 6666 7365 7473 2061 7265  rarm offsets are
+00016840: 2063 6f6d 7065 6e73 6174 6564 2066 6f72   compensated for
+00016850: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+00016860: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
+00016870: 7465 4e61 7646 696c 6545 7869 7374 7328  teNavFileExists(
+00016880: 2920 616e 6420 6e6f 7420 6f76 6572 7772  ) and not overwr
+00016890: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
+000168a0: 2072 6574 7572 6e20 5472 7565 2c20 224f   return True, "O
+000168b0: 7574 7075 7420 6669 6c65 2065 7869 7374  utput file exist
+000168c0: 733a 2022 2b73 656c 662e 6765 745f 696e  s: "+self.get_in
+000168d0: 745f 6e61 765f 6669 6c65 2829 0a0a 2020  t_nav_file()..  
+000168e0: 2020 2020 2020 6966 206e 6f74 206f 732e        if not os.
+000168f0: 7061 7468 2e65 7869 7374 7328 6e61 765f  path.exists(nav_
+00016900: 7061 7468 293a 0a20 2020 2020 2020 2020  path):.         
+00016910: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
+00016920: 2022 4e61 7669 6761 7469 6f6e 2066 696c   "Navigation fil
+00016930: 6520 6e6f 7420 666f 756e 643a 2022 2b6e  e not found: "+n
+00016940: 6176 5f70 6174 680a 0a20 2020 2020 2020  av_path..       
+00016950: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+00016960: 6578 6973 7473 2873 656c 662e 696d 6167  exists(self.imag
+00016970: 6573 4469 7229 3a0a 2020 2020 2020 2020  esDir):.        
+00016980: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00016990: 2c20 2249 6d61 6765 2066 6f6c 6465 7220  , "Image folder 
+000169a0: 6e6f 7420 666f 756e 643a 2022 2b20 7365  not found: "+ se
+000169b0: 6c66 2e69 6d61 6765 7344 6972 0a0a 2020  lf.imagesDir..  
+000169c0: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
+000169d0: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
+000169e0: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
+000169f0: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+00016a00: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
+00016a10: 6e4d 7367 203d 2022 220a 2020 2020 2020  nMsg = "".      
+00016a20: 2020 636f 6d70 656e 7361 744f 6666 7365    compensatOffse
+00016a30: 7473 203d 2046 616c 7365 0a20 2020 2020  ts = False.     
+00016a40: 2020 2069 6620 286f 6666 7365 745f 7821     if (offset_x!
+00016a50: 3d30 206f 7220 6f66 6673 6574 5f79 213d  =0 or offset_y!=
+00016a60: 3020 6f72 206f 6666 7365 745f 7a21 3d30  0 or offset_z!=0
+00016a70: 2920 616e 6420 2779 6177 2720 696e 206e  ) and 'yaw' in n
+00016a80: 6176 5f68 6561 6465 7220 616e 6420 2770  av_header and 'p
+00016a90: 6974 6368 2720 696e 206e 6176 5f68 6561  itch' in nav_hea
+00016aa0: 6465 7220 616e 6420 2772 6f6c 6c27 2069  der and 'roll' i
+00016ab0: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00016ac0: 2020 2020 2020 2020 2020 636f 6d70 656e            compen
+00016ad0: 7361 744f 6666 7365 7473 203d 2054 7275  satOffsets = Tru
+00016ae0: 650a 0a20 2020 2020 2020 2023 2063 6865  e..        # che
+00016af0: 636b 2069 6620 666f 7220 6d69 7373 696e  ck if for missin
+00016b00: 6720 6669 656c 6473 2074 6865 7265 2061  g fields there a
+00016b10: 7265 2063 6f6e 7374 2076 616c 7565 7320  re const values 
+00016b20: 696e 2068 6561 6465 720a 2020 2020 2020  in header.      
+00016b30: 2020 636f 6e73 745f 7661 6c75 6573 203d    const_values =
+00016b40: 207b 7d0a 2020 2020 2020 2020 666f 7220   {}.        for 
+00016b50: 6e61 7646 6965 6c64 2069 6e20 6d69 7174  navField in miqt
+00016b60: 762e 706f 735f 6865 6164 6572 5b27 6d61  v.pos_header['ma
+00016b70: 7269 7174 275d 3a0a 2020 2020 2020 2020  riqt']:.        
+00016b80: 2020 2020 7265 7370 6563 7469 7665 4865      respectiveHe
+00016b90: 6164 6572 4669 656c 6420 3d20 6d69 7174  aderField = miqt
+00016ba0: 762e 636f 6c5f 6865 6164 6572 5b22 6d61  v.col_header["ma
+00016bb0: 7269 7174 225d 5b6e 6176 4669 656c 645d  riqt"][navField]
+00016bc0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016bd0: 6e61 7646 6965 6c64 206e 6f74 2069 6e20  navField not in 
+00016be0: 6e61 765f 6865 6164 6572 2061 6e64 2028  nav_header and (
+00016bf0: 7265 7370 6563 7469 7665 4865 6164 6572  respectiveHeader
+00016c00: 4669 656c 6420 696e 2073 656c 662e 6966  Field in self.if
+00016c10: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00016c20: 6553 6574 4865 6164 6572 4b65 795d 2061  eSetHeaderKey] a
+00016c30: 6e64 2073 656c 662e 6669 6e64 546d 7046  nd self.findTmpF
+00016c40: 6965 6c64 3228 7265 7370 6563 7469 7665  ield2(respective
+00016c50: 4865 6164 6572 4669 656c 6429 2021 3d20  HeaderField) != 
+00016c60: 2222 293a 200a 2020 2020 2020 2020 2020  ""): .          
+00016c70: 2020 2020 2020 636f 6e73 745f 7661 6c75        const_valu
+00016c80: 6573 5b6e 6176 4669 656c 645d 203d 2073  es[navField] = s
+00016c90: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
+00016ca0: 2872 6573 7065 6374 6976 6548 6561 6465  (respectiveHeade
+00016cb0: 7246 6965 6c64 290a 0a20 2020 2020 2020  rField)..       
+00016cc0: 2020 2320 6861 6e64 6c65 2061 6c74 2076    # handle alt v
+00016cd0: 7320 6465 700a 2020 2020 2020 2020 6966  s dep.        if
+00016ce0: 2027 616c 7427 2069 6e20 6e61 765f 6865   'alt' in nav_he
+00016cf0: 6164 6572 2061 6e64 2027 6465 7027 2069  ader and 'dep' i
+00016d00: 6e20 6e61 765f 6865 6164 6572 3a0a 2020  n nav_header:.  
+00016d10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00016d20: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00016d30: 696f 6e28 2227 616c 7427 2061 6e64 2027  ion("'alt' and '
+00016d40: 6465 7027 2070 726f 7669 6465 642e 2052  dep' provided. R
+00016d50: 6564 756e 6461 6e74 2c20 616c 7420 3d20  edundant, alt = 
+00016d60: 2d20 6465 702e 2050 726f 7669 6465 6420  - dep. Provided 
+00016d70: 6f6e 6c79 206f 6e65 206f 6620 626f 7468  only one of both
+00016d80: 2e22 290a 2020 2020 2020 2020 0a20 2020  .").        .   
+00016d90: 2020 2020 2023 204c 6f61 6420 6e61 7669       # Load navi
+00016da0: 6761 7469 6f6e 2064 6174 6120 2869 6620  gation data (if 
+00016db0: 2761 6c74 2720 696e 7374 6561 6420 6f66  'alt' instead of
+00016dc0: 2027 6465 7027 2c20 6974 7320 6175 746f   'dep', its auto
+00016dd0: 6d61 7469 6361 6c6c 7920 696e 7665 7274  matically invert
+00016de0: 6564 290a 2020 2020 2020 2020 6e61 765f  ed).        nav_
+00016df0: 6461 7461 2c20 7061 7273 654d 7367 203d  data, parseMsg =
+00016e00: 206d 6971 746e 2e72 6561 6441 6c6c 506f   miqtn.readAllPo
+00016e10: 7369 7469 6f6e 7346 726f 6d46 696c 6550  sitionsFromFileP
+00016e20: 6174 6828 6e61 765f 7061 7468 2c20 6e61  ath(nav_path, na
+00016e30: 765f 6865 6164 6572 2c20 6461 7465 5f66  v_header, date_f
+00016e40: 6f72 6d61 742c 636f 6c5f 7365 7061 7261  ormat,col_separa
+00016e50: 746f 723d 636f 6c5f 7365 7061 7261 746f  tor=col_separato
+00016e60: 722c 636f 6e73 745f 7661 6c75 6573 3d63  r,const_values=c
+00016e70: 6f6e 7374 5f76 616c 7565 7329 0a20 2020  onst_values).   
+00016e80: 2020 2020 2069 6620 7061 7273 654d 7367       if parseMsg
+00016e90: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+00016ea0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+00016eb0: 6728 7061 7273 654d 7367 2c64 6f6e 7453  g(parseMsg,dontS
+00016ec0: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+00016ed0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
+00016ee0: 3d20 225c 6e22 202b 2070 6172 7365 4d73  = "\n" + parseMs
+00016ef0: 670a 0a20 2020 2020 2020 2023 2066 696e  g..        # fin
+00016f00: 6420 666f 7220 6561 6368 2069 6d61 6765  d for each image
+00016f10: 2074 6865 2072 6573 7065 6374 6976 6520   the respective 
+00016f20: 6e61 7669 6761 7469 6f6e 2064 6174 610a  navigation data.
+00016f30: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+00016f40: 0a20 2020 2020 2020 2073 7563 6365 7373  .        success
+00016f50: 2c20 696d 6167 655f 6474 732c 206d 7367  , image_dts, msg
+00016f60: 203d 2073 656c 662e 6669 6e64 4e61 7644   = self.findNavD
+00016f70: 6174 6146 6f72 496d 6167 6528 6e61 765f  ataForImage(nav_
+00016f80: 6461 7461 2c76 6964 656f 5361 6d70 6c65  data,videoSample
+00016f90: 5365 636f 6e64 7329 0a20 2020 2020 2020  Seconds).       
+00016fa0: 2073 656c 662e 7072 6f76 2e6c 6f67 286d   self.prov.log(m
+00016fb0: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
+00016fc0: 290a 2020 2020 2020 2020 6966 206d 7367  ).        if msg
+00016fd0: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
+00016fe0: 2020 2020 7265 7475 726e 4d73 6720 2b3d      returnMsg +=
+00016ff0: 2022 5c6e 2220 2b20 6d73 670a 2020 2020   "\n" + msg.    
+00017000: 2020 2020 6966 206e 6f74 2073 7563 6365      if not succe
+00017010: 7373 3a0a 2020 2020 2020 2020 2020 2020  ss:.            
+00017020: 7265 7475 726e 2046 616c 7365 2c20 7265  return False, re
+00017030: 7475 726e 4d73 670a 2020 2020 2020 2020  turnMsg.        
+00017040: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
+00017050: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
+00017060: 696e 6720 6974 656d 7327 206e 6176 6967  ing items' navig
+00017070: 6174 696f 6e20 6461 7461 2229 0a0a 2020  ation data")..  
+00017080: 2020 2020 2020 2320 696e 7665 7274 2076        # invert v
+00017090: 616c 7565 7320 2869 6620 6e65 6564 6564  alues (if needed
+000170a0: 2920 6265 666f 7265 206c 6576 6572 6172  ) before leverar
+000170b0: 6d20 636f 6d70 656e 7361 7469 6f6e 0a20  m compensation. 
+000170c0: 2020 2020 2020 2069 6620 7265 636f 7264         if record
+000170d0: 7332 6265 496e 7665 7274 6564 2021 3d20  s2beInverted != 
+000170e0: 5b5d 3a0a 2020 2020 2020 2020 2020 2020  []:.            
+000170f0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+00017100: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
+00017110: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00017120: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
+00017130: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+00017140: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00017150: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
+00017160: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00017170: 2020 2020 2020 2069 6620 276c 6174 2720         if 'lat' 
+00017180: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
+00017190: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
+000171a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000171b0: 6f73 6974 696f 6e73 5b69 5d2e 6c61 7420  ositions[i].lat 
+000171c0: 2a3d 202d 310a 2020 2020 2020 2020 2020  *= -1.          
+000171d0: 2020 2020 2020 2020 2020 6966 2027 6c6f            if 'lo
+000171e0: 6e27 2069 6e20 7265 636f 7264 7332 6265  n' in records2be
+000171f0: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
+00017200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017210: 2020 706f 7369 7469 6f6e 735b 695d 2e6c    positions[i].l
+00017220: 6f6e 202a 3d20 2d31 0a20 2020 2020 2020  on *= -1.       
+00017230: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017240: 2827 6465 7027 2069 6e20 7265 636f 7264  ('dep' in record
+00017250: 7332 6265 496e 7665 7274 6564 2061 6e64  s2beInverted and
+00017260: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
+00017270: 6164 6572 2920 6f72 2028 2761 6c74 2720  ader) or ('alt' 
+00017280: 696e 2072 6563 6f72 6473 3262 6549 6e76  in records2beInv
+00017290: 6572 7465 6420 616e 6420 2761 6c74 2720  erted and 'alt' 
+000172a0: 696e 206e 6176 5f68 6561 6465 7229 3a0a  in nav_header):.
+000172b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172c0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+000172d0: 735b 695d 2e64 6570 202a 3d20 2d31 0a20  s[i].dep *= -1. 
+000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172f0: 2020 2069 6620 2768 6774 2720 696e 2072     if 'hgt' in r
+00017300: 6563 6f72 6473 3262 6549 6e76 6572 7465  ecords2beInverte
+00017310: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+00017320: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
+00017330: 696f 6e73 5b69 5d2e 6867 7420 2a3d 202d  ions[i].hgt *= -
+00017340: 310a 0a0a 2020 2020 2020 2020 2320 636f  1...        # co
+00017350: 6d70 656e 7361 7465 206c 6576 6572 6172  mpensate leverar
+00017360: 6d20 6f66 6673 6574 730a 2020 2020 2020  m offsets.      
+00017370: 2020 6966 2063 6f6d 7065 6e73 6174 4f66    if compensatOf
+00017380: 6673 6574 733a 0a0a 2020 2020 2020 2020  fsets:..        
+00017390: 2020 2020 2320 6c6f 6164 2066 7261 6d65      # load frame
+000173a0: 2061 7474 6974 7564 6520 6461 7461 2066   attitude data f
+000173b0: 726f 6d20 6669 6c65 0a20 2020 2020 2020  rom file.       
+000173c0: 2020 2020 2061 7474 5f64 6174 612c 2070       att_data, p
+000173d0: 6172 7365 4d73 6720 3d20 6d69 7174 6e2e  arseMsg = miqtn.
+000173e0: 7265 6164 416c 6c41 7474 6974 7564 6573  readAllAttitudes
+000173f0: 4672 6f6d 4669 6c65 5061 7468 286e 6176  FromFilePath(nav
+00017400: 5f70 6174 682c 206e 6176 5f68 6561 6465  _path, nav_heade
+00017410: 722c 2064 6174 655f 666f 726d 6174 2c63  r, date_format,c
+00017420: 6f6c 5f73 6570 6172 6174 6f72 3d63 6f6c  ol_separator=col
+00017430: 5f73 6570 6172 6174 6f72 2c63 6f6e 7374  _separator,const
+00017440: 5f76 616c 7565 733d 636f 6e73 745f 7661  _values=const_va
+00017450: 6c75 6573 2c61 6e67 6c65 7349 6e52 6164  lues,anglesInRad
+00017460: 3d61 6e67 6c65 735f 696e 5f72 6164 290a  =angles_in_rad).
+00017470: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00017480: 6172 7365 4d73 6720 213d 2022 223a 0a20  arseMsg != "":. 
+00017490: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000174a0: 656c 662e 7072 6f76 2e6c 6f67 2870 6172  elf.prov.log(par
+000174b0: 7365 4d73 672c 646f 6e74 5368 6f77 3d54  seMsg,dontShow=T
+000174c0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+000174d0: 2020 2020 2072 6574 7572 6e4d 7367 202b       returnMsg +
+000174e0: 3d20 225c 6e22 202b 2070 6172 7365 4d73  = "\n" + parseMs
+000174f0: 670a 0a20 2020 2020 2020 2020 2020 2069  g..            i
+00017500: 6620 7265 636f 7264 7332 6265 496e 7665  f records2beInve
+00017510: 7274 6564 2021 3d20 5b5d 3a0a 2020 2020  rted != []:.    
+00017520: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00017530: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
+00017540: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00017550: 2020 2020 2020 2061 7474 6974 7564 6573         attitudes
+00017560: 203d 2069 6d61 6765 5f64 7473 5f61 7474   = image_dts_att
+00017570: 5b66 696c 655d 0a20 2020 2020 2020 2020  [file].         
+00017580: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00017590: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
+000175a0: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
+000175b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000175c0: 2020 2069 6620 2779 6177 2720 696e 2020     if 'yaw' in  
+000175d0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+000175e0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
+000175f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017600: 6174 7469 7475 6465 735b 695d 2e79 6177  attitudes[i].yaw
+00017610: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+00017620: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017630: 6620 2770 6974 6368 2720 696e 2020 7265  f 'pitch' in  re
+00017640: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+00017650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017660: 2020 2020 2020 2020 2020 2020 2020 6174                at
+00017670: 7469 7475 6465 735b 695d 2e70 6974 6368  titudes[i].pitch
+00017680: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
+00017690: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000176a0: 6620 2772 6f6c 6c27 2069 6e20 2072 6563  f 'roll' in  rec
+000176b0: 6f72 6473 3262 6549 6e76 6572 7465 643a  ords2beInverted:
+000176c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000176d0: 2020 2020 2020 2020 2020 2020 2061 7474               att
+000176e0: 6974 7564 6573 5b69 5d2e 726f 6c6c 202a  itudes[i].roll *
+000176f0: 3d20 2d31 0a0a 2020 2020 2020 2020 2020  = -1..          
+00017700: 2020 2320 6669 6e64 2066 6f72 2065 6163    # find for eac
+00017710: 6820 696d 6167 6520 7468 6520 7265 7370  h image the resp
+00017720: 6563 7469 7665 206e 6176 6967 6174 696f  ective navigatio
+00017730: 6e20 6461 7461 0a20 2020 2020 2020 2020  n data.         
+00017740: 2020 2073 7563 6365 7373 2c20 696d 6167     success, imag
+00017750: 655f 6474 735f 6174 742c 206d 7367 203d  e_dts_att, msg =
+00017760: 2073 656c 662e 6669 6e64 4e61 7644 6174   self.findNavDat
+00017770: 6146 6f72 496d 6167 6528 6174 745f 6461  aForImage(att_da
+00017780: 7461 2c76 6964 656f 5361 6d70 6c65 5365  ta,videoSampleSe
+00017790: 636f 6e64 7329 0a20 2020 2020 2020 2020  conds).         
+000177a0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+000177b0: 286d 7367 2c64 6f6e 7453 686f 773d 5472  (msg,dontShow=Tr
+000177c0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+000177d0: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
+000177e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000177f0: 7475 726e 4d73 6720 2b3d 2022 5c6e 2220  turnMsg += "\n" 
+00017800: 2b20 6d73 670a 2020 2020 2020 2020 2020  + msg.          
+00017810: 2020 6966 206e 6f74 2073 7563 6365 7373    if not success
+00017820: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017830: 2020 7265 7475 726e 2046 616c 7365 2c20    return False, 
+00017840: 7265 7475 726e 4d73 670a 0a20 2020 2020  returnMsg..     
+00017850: 2020 2020 2020 2023 2063 6f6d 7065 6e73         # compens
+00017860: 6174 650a 2020 2020 2020 2020 2020 2020  ate.            
+00017870: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+00017880: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
+00017890: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+000178a0: 203d 2069 6d61 6765 5f64 7473 5b66 696c   = image_dts[fil
+000178b0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+000178c0: 2020 2061 7474 6974 7564 6573 203d 2069     attitudes = i
+000178d0: 6d61 6765 5f64 7473 5f61 7474 5b66 696c  mage_dts_att[fil
+000178e0: 655d 0a20 2020 2020 2020 2020 2020 2020  e].             
+000178f0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00017900: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
+00017910: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00017920: 2020 2020 2020 206c 6174 203d 2070 6f73         lat = pos
+00017930: 6974 696f 6e73 5b69 5d2e 6c61 740a 2020  itions[i].lat.  
+00017940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017950: 2020 6c6f 6e20 3d20 706f 7369 7469 6f6e    lon = position
+00017960: 735b 695d 2e6c 6f6e 0a20 2020 2020 2020  s[i].lon.       
+00017970: 2020 2020 2020 2020 2020 2020 2064 6570               dep
+00017980: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
+00017990: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
+000179a0: 2020 2020 2020 2020 7961 7720 3d20 6174          yaw = at
+000179b0: 7469 7475 6465 735b 695d 2e79 6177 0a20  titudes[i].yaw. 
+000179c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000179d0: 2020 2070 6974 6368 203d 2061 7474 6974     pitch = attit
+000179e0: 7564 6573 5b69 5d2e 7069 7463 680a 2020  udes[i].pitch.  
+000179f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a00: 2020 726f 6c6c 203d 2061 7474 6974 7564    roll = attitud
+00017a10: 6573 5b69 5d2e 726f 6c6c 0a20 2020 2020  es[i].roll.     
+00017a20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017a30: 6620 7961 7720 6973 204e 6f6e 6520 6f72  f yaw is None or
+00017a40: 2070 6974 6368 2069 7320 4e6f 6e65 206f   pitch is None o
+00017a50: 7220 726f 6c6c 2069 7320 4e6f 6e65 3a0a  r roll is None:.
+00017a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017a70: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00017a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017a90: 2020 2020 206e 6577 5f6c 6174 2c6e 6577       new_lat,new
+00017aa0: 5f6c 6f6e 2c6e 6577 5f64 6570 203d 206d  _lon,new_dep = m
+00017ab0: 6971 7467 2e61 6464 4c65 7665 7261 726d  iqtg.addLeverarm
+00017ac0: 7332 4c61 746c 6f6e 286c 6174 2c6c 6f6e  s2Latlon(lat,lon
+00017ad0: 2c64 6570 2c6f 6666 7365 745f 782c 6f66  ,dep,offset_x,of
+00017ae0: 6673 6574 5f79 2c6f 6666 7365 745f 7a2c  fset_y,offset_z,
+00017af0: 7961 772c 7069 7463 682c 726f 6c6c 290a  yaw,pitch,roll).
+00017b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b10: 2020 2020 706f 7369 7469 6f6e 735b 695d      positions[i]
+00017b20: 2e6c 6174 203d 206e 6577 5f6c 6174 0a20  .lat = new_lat. 
+00017b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b40: 2020 2070 6f73 6974 696f 6e73 5b69 5d2e     positions[i].
+00017b50: 6c6f 6e20 3d20 6e65 775f 6c6f 6e0a 2020  lon = new_lon.  
+00017b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017b70: 2020 706f 7369 7469 6f6e 735b 695d 2e64    positions[i].d
+00017b80: 6570 203d 206e 6577 5f64 6570 0a0a 2020  ep = new_dep..  
+00017b90: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00017ba0: 726f 762e 6c6f 6728 2261 7070 6c69 6564  rov.log("applied
+00017bb0: 206c 6576 6572 2061 726d 2063 6f6d 7065   lever arm compe
+00017bc0: 6e73 6174 696f 6e20 782c 792c 7a20 3d20  nsation x,y,z = 
+00017bd0: 2220 2b20 7374 7228 6f66 6673 6574 5f78  " + str(offset_x
+00017be0: 2920 2b20 222c 2220 2b20 7374 7228 6f66  ) + "," + str(of
+00017bf0: 6673 6574 5f79 2920 2b20 222c 2220 2b20  fset_y) + "," + 
+00017c00: 7374 7228 6f66 6673 6574 5f7a 292c 646f  str(offset_z),do
+00017c10: 6e74 5368 6f77 3d54 7275 6529 0a0a 2020  ntShow=True)..  
+00017c20: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
+00017c30: 6765 5f64 7473 2920 3e20 303a 0a20 2020  ge_dts) > 0:.   
+00017c40: 2020 2020 2020 2020 2023 2043 6865 636b           # Check
+00017c50: 2077 6865 7468 6572 2064 6570 7468 2061   whether depth a
+00017c60: 6e64 2068 6569 6768 7420 6172 6520 7365  nd height are se
+00017c70: 740a 2020 2020 2020 2020 2020 2020 6c61  t.            la
+00017c80: 745f 6964 656e 7469 6361 6c2c 206c 6f6e  t_identical, lon
+00017c90: 5f69 6465 6e74 6963 616c 2c20 6465 705f  _identical, dep_
+00017ca0: 6964 656e 7469 6361 6c2c 2068 6774 5f69  identical, hgt_i
+00017cb0: 6465 6e74 6963 616c 2c20 6465 705f 6e6f  dentical, dep_no
+00017cc0: 745f 7a65 726f 2c20 6867 745f 6e6f 745f  t_zero, hgt_not_
+00017cd0: 7a65 726f 2c75 6e63 6572 745f 6e6f 745f  zero,uncert_not_
+00017ce0: 7a65 726f 203d 206e 6176 5f64 6174 612e  zero = nav_data.
+00017cf0: 6368 6563 6b50 6f73 6974 696f 6e73 436f  checkPositionsCo
+00017d00: 6e74 656e 7428 290a 0a20 2020 2020 2020  ntent()..       
+00017d10: 2020 2020 2023 2057 7269 7465 2074 6f20       # Write to 
+00017d20: 6e61 7669 6761 7469 6f6e 2074 7874 2066  navigation txt f
+00017d30: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
+00017d40: 2320 6865 6164 6572 0a20 2020 2020 2020  # header.       
+00017d50: 2020 2020 2072 6573 203d 206f 7065 6e28       res = open(
+00017d60: 7365 6c66 2e67 6574 5f69 6e74 5f6e 6176  self.get_int_nav
+00017d70: 5f66 696c 6528 292c 2022 7722 290a 2020  _file(), "w").  
+00017d80: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00017d90: 6974 6528 6d69 7174 762e 636f 6c5f 6865  ite(miqtv.col_he
+00017da0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00017db0: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
+00017dc0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00017dd0: 6971 7427 5d5b 2775 7463 275d 290a 0a20  iqt']['utc']).. 
+00017de0: 2020 2020 2020 2020 2020 2068 6173 5f61             has_a
+00017df0: 6c74 203d 2054 7275 6520 6966 2064 6570  lt = True if dep
+00017e00: 5f6e 6f74 5f7a 6572 6f20 616e 6420 2820  _not_zero and ( 
+00017e10: 2764 6570 2720 696e 206e 6176 5f68 6561  'dep' in nav_hea
+00017e20: 6465 7220 6f72 2027 616c 7427 2069 6e20  der or 'alt' in 
+00017e30: 6e61 765f 6865 6164 6572 2029 2065 6c73  nav_header ) els
+00017e40: 6520 4661 6c73 650a 0a20 2020 2020 2020  e False..       
+00017e50: 2020 2020 2069 6620 276c 6174 2720 696e       if 'lat' in
+00017e60: 206e 6176 5f68 6561 6465 723a 0a20 2020   nav_header:.   
+00017e70: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00017e80: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+00017e90: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00017ea0: 7269 7174 275d 5b27 6c61 7427 5d29 0a20  riqt']['lat']). 
+00017eb0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
+00017ec0: 6f6e 2720 696e 206e 6176 5f68 6561 6465  on' in nav_heade
+00017ed0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00017ee0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00017ef0: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00017f00: 6572 5b27 6d61 7269 7174 275d 5b27 6c6f  er['mariqt']['lo
+00017f10: 6e27 5d29 0a20 2020 2020 2020 2020 2020  n']).           
+00017f20: 2069 6620 6861 735f 616c 743a 0a20 2020   if has_alt:.   
+00017f30: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00017f40: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+00017f50: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00017f60: 7269 7174 275d 5b27 616c 7427 5d29 0a20  riqt']['alt']). 
+00017f70: 2020 2020 2020 2020 2020 2069 6620 6867             if hg
+00017f80: 745f 6e6f 745f 7a65 726f 2061 6e64 2027  t_not_zero and '
+00017f90: 6867 7427 2069 6e20 6e61 765f 6865 6164  hgt' in nav_head
+00017fa0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00017fb0: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00017fc0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+00017fd0: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
+00017fe0: 6774 275d 290a 2020 2020 2020 2020 2020  gt']).          
+00017ff0: 2020 6966 2075 6e63 6572 745f 6e6f 745f    if uncert_not_
+00018000: 7a65 726f 2061 6e64 2027 756e 6365 7274  zero and 'uncert
+00018010: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+00018020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018030: 2072 6573 2e77 7269 7465 2822 5c74 222b   res.write("\t"+
+00018040: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00018050: 5b27 6d61 7269 7174 275d 5b27 756e 6365  ['mariqt']['unce
+00018060: 7274 275d 290a 2020 2020 2020 2020 2020  rt']).          
+00018070: 2020 7265 732e 7772 6974 6528 225c 6e22    res.write("\n"
+00018080: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00018090: 6461 7461 206c 696e 6573 0a20 2020 2020  data lines.     
+000180a0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
+000180b0: 696e 2069 6d61 6765 5f64 7473 3a0a 2020  in image_dts:.  
+000180c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000180d0: 7220 7469 6d65 706f 696e 7420 696e 2069  r timepoint in i
+000180e0: 6d61 6765 5f64 7473 5b66 696c 655d 3a0a  mage_dts[file]:.
+000180f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018100: 2020 2020 7265 732e 7772 6974 6528 6669      res.write(fi
+00018110: 6c65 2b22 5c74 222b 7469 6d65 706f 696e  le+"\t"+timepoin
+00018120: 742e 6461 7465 5469 6d65 2829 2e73 7472  t.dateTime().str
+00018130: 6674 696d 6528 6d69 7174 762e 6461 7465  ftime(miqtv.date
+00018140: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
+00018150: 275d 2929 200a 2020 2020 2020 2020 2020  '])) .          
+00018160: 2020 2020 2020 2020 2020 6966 2027 6c61            if 'la
+00018170: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
+00018180: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018190: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
+000181a0: 7469 6d65 706f 696e 742e 6c61 740a 2020  timepoint.lat.  
+000181b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181c0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+000181d0: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
+000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000181f0: 2020 2069 6620 276c 6f6e 2720 696e 206e     if 'lon' in n
+00018200: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
 00018210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018220: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
-00018230: 6570 6f69 6e74 2e68 6774 0a20 2020 2020  epoint.hgt.     
-00018240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018250: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
-00018260: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
-00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018280: 6966 2075 6e63 6572 745f 6e6f 745f 7a65  if uncert_not_ze
-00018290: 726f 2061 6e64 2027 756e 6365 7274 2720  ro and 'uncert' 
-000182a0: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
-000182b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182c0: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
-000182d0: 6570 6f69 6e74 2e75 6e63 6572 740a 2020  epoint.uncert.  
+00018220: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
+00018230: 6e74 2e6c 6f6e 0a20 2020 2020 2020 2020  nt.lon.         
+00018240: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018250: 6573 2e77 7269 7465 2822 5c74 222b 7374  es.write("\t"+st
+00018260: 7228 7661 6c29 290a 2020 2020 2020 2020  r(val)).        
+00018270: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00018280: 6173 5f61 6c74 3a0a 2020 2020 2020 2020  as_alt:.        
+00018290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182a0: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
+000182b0: 6465 700a 2020 2020 2020 2020 2020 2020  dep.            
+000182c0: 2020 2020 2020 2020 2020 2020 2320 6465              # de
+000182d0: 7020 746f 2061 6c74 0a20 2020 2020 2020  p to alt.       
 000182e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000182f0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00018300: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
-00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018320: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
-00018330: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-00018340: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
-00018350: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
-00018360: 746f 2067 656f 6a73 6f6e 2066 696c 650a  to geojson file.
-00018370: 2020 2020 2020 2020 2020 2020 6765 6f6a              geoj
-00018380: 736f 6e20 3d20 7b27 7479 7065 273a 2027  son = {'type': '
-00018390: 4665 6174 7572 6543 6f6c 6c65 6374 696f  FeatureCollectio
-000183a0: 6e27 2c20 276e 616d 6527 3a20 7365 6c66  n', 'name': self
-000183b0: 2e64 6972 2e65 7665 6e74 2829 2b22 5f22  .dir.event()+"_"
-000183c0: 2b73 656c 662e 6469 722e 7365 6e73 6f72  +self.dir.sensor
-000183d0: 2829 2b22 5f69 6d61 6765 2d6e 6176 6967  ()+"_image-navig
-000183e0: 6174 696f 6e22 2c20 2766 6561 7475 7265  ation", 'feature
-000183f0: 7327 3a20 5b5d 7d0a 2020 2020 2020 2020  s': []}.        
-00018400: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00018410: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-00018420: 2020 2020 2020 2020 2020 2023 2070 686f             # pho
-00018430: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
-00018440: 2020 2069 6620 6c65 6e28 696d 6167 655f     if len(image_
-00018450: 6474 735b 6669 6c65 5d29 203d 3d20 313a  dts[file]) == 1:
-00018460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018470: 2020 2020 2069 6620 6465 705f 6e6f 745f       if dep_not_
-00018480: 7a65 726f 3a0a 2020 2020 2020 2020 2020  zero:.          
-00018490: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-000184a0: 6f6d 6574 7279 203d 2020 7b27 7479 7065  ometry =  {'type
-000184b0: 273a 2022 506f 696e 7422 2c20 2763 6f6f  ': "Point", 'coo
-000184c0: 7264 696e 6174 6573 273a 200a 2020 2020  rdinates': .    
-000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184f0: 2020 2020 5b66 6c6f 6174 2869 6d61 6765      [float(image
-00018500: 5f64 7473 5b66 696c 655d 5b30 5d2e 6c6f  _dts[file][0].lo
-00018510: 6e29 2c20 666c 6f61 7428 696d 6167 655f  n), float(image_
-00018520: 6474 735b 6669 6c65 5d5b 305d 2e6c 6174  dts[file][0].lat
-00018530: 292c 2066 6c6f 6174 2869 6d61 6765 5f64  ), float(image_d
-00018540: 7473 5b66 696c 655d 5b30 5d2e 6465 7029  ts[file][0].dep)
-00018550: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018570: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00018580: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00018590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000185a0: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
-000185b0: 7279 203d 2020 7b27 7479 7065 273a 2022  ry =  {'type': "
-000185c0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
-000185d0: 6174 6573 273a 200a 2020 2020 2020 2020  ates': .        
+000182f0: 2076 616c 202a 3d20 2d31 0a20 2020 2020   val *= -1.     
+00018300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018310: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00018320: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
+00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018340: 6966 2068 6774 5f6e 6f74 5f7a 6572 6f20  if hgt_not_zero 
+00018350: 616e 6420 2768 6774 2720 696e 206e 6176  and 'hgt' in nav
+00018360: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
+00018370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018380: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
+00018390: 2e68 6774 0a20 2020 2020 2020 2020 2020  .hgt.           
+000183a0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000183b0: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
+000183c0: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
+000183d0: 2020 2020 2020 2020 2020 6966 2075 6e63            if unc
+000183e0: 6572 745f 6e6f 745f 7a65 726f 2061 6e64  ert_not_zero and
+000183f0: 2027 756e 6365 7274 2720 696e 206e 6176   'uncert' in nav
+00018400: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
+00018410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018420: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
+00018430: 2e75 6e63 6572 740a 2020 2020 2020 2020  .uncert.        
+00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018450: 7265 732e 7772 6974 6528 225c 7422 2b73  res.write("\t"+s
+00018460: 7472 2876 616c 2929 0a20 2020 2020 2020  tr(val)).       
+00018470: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00018480: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
+00018490: 2020 2020 2020 2020 2072 6573 2e63 6c6f           res.clo
+000184a0: 7365 2829 0a0a 2020 2020 2020 2020 2020  se()..          
+000184b0: 2020 2320 5772 6974 6520 746f 2067 656f    # Write to geo
+000184c0: 6a73 6f6e 2066 696c 650a 2020 2020 2020  json file.      
+000184d0: 2020 2020 2020 6765 6f6a 736f 6e20 3d20        geojson = 
+000184e0: 7b27 7479 7065 273a 2027 4665 6174 7572  {'type': 'Featur
+000184f0: 6543 6f6c 6c65 6374 696f 6e27 2c20 276e  eCollection', 'n
+00018500: 616d 6527 3a20 7365 6c66 2e64 6972 2e65  ame': self.dir.e
+00018510: 7665 6e74 2829 2b22 5f22 2b73 656c 662e  vent()+"_"+self.
+00018520: 6469 722e 7365 6e73 6f72 2829 2b22 5f69  dir.sensor()+"_i
+00018530: 6d61 6765 2d6e 6176 6967 6174 696f 6e22  mage-navigation"
+00018540: 2c20 2766 6561 7475 7265 7327 3a20 5b5d  , 'features': []
+00018550: 7d0a 2020 2020 2020 2020 2020 2020 666f  }.            fo
+00018560: 7220 6669 6c65 2069 6e20 696d 6167 655f  r file in image_
+00018570: 6474 733a 0a20 2020 2020 2020 2020 2020  dts:.           
+00018580: 2020 2020 2023 2070 686f 746f 0a20 2020       # photo.   
+00018590: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000185a0: 6c65 6e28 696d 6167 655f 6474 735b 6669  len(image_dts[fi
+000185b0: 6c65 5d29 203d 3d20 313a 0a20 2020 2020  le]) == 1:.     
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000185d0: 6620 6465 705f 6e6f 745f 7a65 726f 3a0a  f dep_not_zero:.
 000185e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018600: 5b66 6c6f 6174 2869 6d61 6765 5f64 7473  [float(image_dts
-00018610: 5b66 696c 655d 5b30 5d2e 6c6f 6e29 2c20  [file][0].lon), 
-00018620: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
-00018630: 6669 6c65 5d5b 305d 2e6c 6174 295d 0a20  file][0].lat)]. 
-00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018660: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00018670: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-00018680: 2069 6e20 5b6d 6174 682e 6973 6e61 6e28   in [math.isnan(
-00018690: 7829 2066 6f72 2078 2069 6e20 6765 6f6d  x) for x in geom
-000186a0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
-000186b0: 7327 5d5d 3a0a 2020 2020 2020 2020 2020  s']]:.          
-000186c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000186d0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-000186e0: 2020 2020 2020 2020 2320 7669 6465 6f0a          # video.
+000185f0: 2020 2020 2020 2020 6765 6f6d 6574 7279          geometry
+00018600: 203d 2020 7b27 7479 7065 273a 2022 506f   =  {'type': "Po
+00018610: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
+00018620: 6573 273a 200a 2020 2020 2020 2020 2020  es': .          
+00018630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018640: 2020 2020 2020 2020 2020 2020 2020 5b66                [f
+00018650: 6c6f 6174 2869 6d61 6765 5f64 7473 5b66  loat(image_dts[f
+00018660: 696c 655d 5b30 5d2e 6c6f 6e29 2c20 666c  ile][0].lon), fl
+00018670: 6f61 7428 696d 6167 655f 6474 735b 6669  oat(image_dts[fi
+00018680: 6c65 5d5b 305d 2e6c 6174 292c 2066 6c6f  le][0].lat), flo
+00018690: 6174 2869 6d61 6765 5f64 7473 5b66 696c  at(image_dts[fil
+000186a0: 655d 5b30 5d2e 6465 7029 5d0a 2020 2020  e][0].dep)].    
+000186b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000186d0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+000186e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
 000186f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018700: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00018710: 2020 2020 2020 2020 2020 6966 2064 6570            if dep
-00018720: 5f6e 6f74 5f7a 6572 6f3a 0a20 2020 2020  _not_zero:.     
-00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018740: 2020 2067 656f 6d65 7472 7920 3d20 207b     geometry =  {
-00018750: 2774 7970 6527 3a20 224d 756c 7469 506f  'type': "MultiPo
-00018760: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
-00018770: 6573 273a 0a20 2020 2020 2020 2020 2020  es':.           
-00018780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018790: 2020 2020 2020 2020 2020 2020 205b 5b66               [[f
-000187a0: 6c6f 6174 2864 2e6c 6f6e 292c 2066 6c6f  loat(d.lon), flo
-000187b0: 6174 2864 2e6c 6174 292c 2066 6c6f 6174  at(d.lat), float
-000187c0: 2864 2e64 6570 295d 2066 6f72 2064 2069  (d.dep)] for d i
-000187d0: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
-000187e0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
-000187f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018800: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00018810: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00018820: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018830: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
-00018840: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
-00018850: 224d 756c 7469 506f 696e 7422 2c20 2763  "MultiPoint", 'c
-00018860: 6f6f 7264 696e 6174 6573 273a 0a20 2020  oordinates':.   
-00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018890: 2020 2020 205b 5b66 6c6f 6174 2864 2e6c       [[float(d.l
-000188a0: 6f6e 292c 2066 6c6f 6174 2864 2e6c 6174  on), float(d.lat
-000188b0: 295d 2066 6f72 2064 2069 6e20 696d 6167  )] for d in imag
-000188c0: 655f 6474 735b 6669 6c65 5d5d 0a20 2020  e_dts[file]].   
+00018700: 2020 2020 6765 6f6d 6574 7279 203d 2020      geometry =  
+00018710: 7b27 7479 7065 273a 2022 506f 696e 7422  {'type': "Point"
+00018720: 2c20 2763 6f6f 7264 696e 6174 6573 273a  , 'coordinates':
+00018730: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00018740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018750: 2020 2020 2020 2020 2020 5b66 6c6f 6174            [float
+00018760: 2869 6d61 6765 5f64 7473 5b66 696c 655d  (image_dts[file]
+00018770: 5b30 5d2e 6c6f 6e29 2c20 666c 6f61 7428  [0].lon), float(
+00018780: 696d 6167 655f 6474 735b 6669 6c65 5d5b  image_dts[file][
+00018790: 305d 2e6c 6174 295d 0a20 2020 2020 2020  0].lat)].       
+000187a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187b0: 2020 2020 2020 2020 2020 2020 207d 0a20               }. 
+000187c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000187d0: 2020 2069 6620 5472 7565 2069 6e20 5b6d     if True in [m
+000187e0: 6174 682e 6973 6e61 6e28 7829 2066 6f72  ath.isnan(x) for
+000187f0: 2078 2069 6e20 6765 6f6d 6574 7279 5b27   x in geometry['
+00018800: 636f 6f72 6469 6e61 7465 7327 5d5d 3a0a  coordinates']]:.
+00018810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018820: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00018830: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018840: 2020 2320 7669 6465 6f0a 2020 2020 2020    # video.      
+00018850: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00018860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018870: 2020 2020 6966 2064 6570 5f6e 6f74 5f7a      if dep_not_z
+00018880: 6572 6f3a 0a20 2020 2020 2020 2020 2020  ero:.           
+00018890: 2020 2020 2020 2020 2020 2020 2067 656f               geo
+000188a0: 6d65 7472 7920 3d20 207b 2774 7970 6527  metry =  {'type'
+000188b0: 3a20 224d 756c 7469 506f 696e 7422 2c20  : "MultiPoint", 
+000188c0: 2763 6f6f 7264 696e 6174 6573 273a 0a20  'coordinates':. 
 000188d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188f0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
-00018900: 2020 2020 2020 2069 6620 5472 7565 2069         if True i
-00018910: 6e20 5b6d 6174 682e 6973 6e61 6e28 7829  n [math.isnan(x)
-00018920: 2066 6f72 2078 2069 6e20 5b69 7465 6d20   for x in [item 
-00018930: 666f 7220 7375 626c 6973 7420 696e 2067  for sublist in g
-00018940: 656f 6d65 7472 795b 2763 6f6f 7264 696e  eometry['coordin
-00018950: 6174 6573 275d 2066 6f72 2069 7465 6d20  ates'] for item 
-00018960: 696e 2073 7562 6c69 7374 5d5d 3a0a 2020  in sublist]]:.  
-00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018980: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189a0: 6765 6f6a 736f 6e5b 2766 6561 7475 7265  geojson['feature
-000189b0: 7327 5d2e 6170 7065 6e64 287b 2774 7970  s'].append({'typ
-000189c0: 6527 3a20 2746 6561 7475 7265 272c 2027  e': 'Feature', '
-000189d0: 7072 6f70 6572 7469 6573 273a 207b 2769  properties': {'i
-000189e0: 6427 3a20 6669 6c65 7d2c 2027 6765 6f6d  d': file}, 'geom
-000189f0: 6574 7279 273a 2067 656f 6d65 7472 7920  etry': geometry 
-00018a00: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-00018a10: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00018a20: 6f20 3d20 6f70 656e 2873 656c 662e 6765  o = open(self.ge
-00018a30: 745f 696e 745f 6e61 765f 6669 6c65 2829  t_int_nav_file()
-00018a40: 2e72 6570 6c61 6365 2822 2e74 7874 222c  .replace(".txt",
-00018a50: 2022 2e67 656f 6a73 6f6e 2229 2c0a 2020   ".geojson"),.  
-00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a70: 2020 2022 7722 2c20 6572 726f 7273 3d22     "w", errors="
-00018a80: 6967 6e6f 7265 222c 2065 6e63 6f64 696e  ignore", encodin
-00018a90: 673d 2775 7466 2d38 2729 0a20 2020 2020  g='utf-8').     
-00018aa0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
-00018ab0: 2867 656f 6a73 6f6e 2c20 6f2c 2065 6e73  (geojson, o, ens
-00018ac0: 7572 655f 6173 6369 693d 4661 6c73 652c  ure_ascii=False,
-00018ad0: 2069 6e64 656e 743d 3429 0a20 2020 2020   indent=4).     
-00018ae0: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
-00018af0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00018b00: 6c66 2e70 726f 762e 6164 6441 7267 756d  lf.prov.addArgum
-00018b10: 656e 7428 2269 6e70 7574 4e61 7669 6761  ent("inputNaviga
-00018b20: 7469 6f6e 4669 6c65 222c 6e61 765f 7061  tionFile",nav_pa
-00018b30: 7468 2c6f 7665 7277 7269 7465 3d54 7275  th,overwrite=Tru
-00018b40: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
-00018b50: 656c 662e 7072 6f76 2e6c 6f67 2822 7061  elf.prov.log("pa
-00018b60: 7273 6564 2066 726f 6d20 696e 7075 744e  rsed from inputN
-00018b70: 6176 6967 6174 696f 6e46 696c 653a 2022  avigationFile: "
-00018b80: 202b 2073 7472 286e 6176 5f68 6561 6465   + str(nav_heade
-00018b90: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
-00018ba0: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
-00018bb0: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
-00018bc0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00018bd0: 224e 6176 6967 6174 696f 6e20 6461 7461  "Navigation data
-00018be0: 2063 7265 6174 6564 2220 2b20 7265 7475   created" + retu
-00018bf0: 726e 4d73 670a 2020 2020 2020 2020 656c  rnMsg.        el
-00018c00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00018c10: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00018c20: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00018c30: 652c 2022 4e6f 2069 6d61 6765 2063 6f6f  e, "No image coo
-00018c40: 7264 696e 6174 6573 2066 6f75 6e64 2220  rdinates found" 
-00018c50: 2b20 7265 7475 726e 4d73 670a 0a20 2020  + returnMsg..   
-00018c60: 2064 6566 2063 7265 6174 6549 6d61 6765   def createImage
-00018c70: 4e61 7669 6761 7469 6f6e 4669 6c65 2873  NavigationFile(s
-00018c80: 656c 662c 206e 6176 5f70 6174 683a 2073  elf, nav_path: s
-00018c90: 7472 2c20 6e61 765f 6865 6164 6572 3d6d  tr, nav_header=m
-00018ca0: 6971 7476 2e70 6f73 5f68 6561 6465 725b  iqtv.pos_header[
-00018cb0: 2770 616e 6761 6561 275d 2c20 6461 7465  'pangaea'], date
-00018cc0: 5f66 6f72 6d61 743d 6d69 7174 762e 6461  _format=miqtv.da
-00018cd0: 7465 5f66 6f72 6d61 7473 5b27 7061 6e67  te_formats['pang
-00018ce0: 6165 6127 5d2c 206f 7665 7277 7269 7465  aea'], overwrite
-00018cf0: 3d46 616c 7365 2c20 636f 6c5f 7365 7061  =False, col_sepa
-00018d00: 7261 746f 7220 3d20 225c 7422 2c20 7669  rator = "\t", vi
-00018d10: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-00018d20: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
-00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d40: 2020 2020 2020 2020 6f66 6673 6574 5f78          offset_x
-00018d50: 3d30 2c20 6f66 6673 6574 5f79 3d30 2c20  =0, offset_y=0, 
-00018d60: 6f66 6673 6574 5f7a 3d30 2c61 6e67 6c65  offset_z=0,angle
-00018d70: 735f 696e 5f72 6164 203d 2046 616c 7365  s_in_rad = False
-00018d80: 2c20 7265 636f 7264 7332 6265 496e 7665  , records2beInve
-00018d90: 7274 6564 3d5b 5d29 3a0a 2020 2020 2020  rted=[]):.      
-00018da0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
-00018db0: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
-00018dc0: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
-00018dd0: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-00018de0: 7265 7475 726e 2073 656c 662e 6372 6561  return self.crea
-00018df0: 7465 5f69 6d61 6765 5f6e 6176 6967 6174  te_image_navigat
-00018e00: 696f 6e5f 6669 6c65 286e 6176 5f70 6174  ion_file(nav_pat
-00018e10: 682c 206e 6176 5f68 6561 6465 722c 2064  h, nav_header, d
-00018e20: 6174 655f 666f 726d 6174 2c20 6f76 6572  ate_format, over
-00018e30: 7772 6974 652c 2063 6f6c 5f73 6570 6172  write, col_separ
-00018e40: 6174 6f72 2c20 7669 6465 6f53 616d 706c  ator, videoSampl
-00018e50: 6553 6563 6f6e 6473 2c20 6f66 6673 6574  eSeconds, offset
-00018e60: 5f78 2c20 6f66 6673 6574 5f79 2c20 6f66  _x, offset_y, of
-00018e70: 6673 6574 5f7a 2c20 616e 676c 6573 5f69  fset_z, angles_i
-00018e80: 6e5f 7261 642c 2072 6563 6f72 6473 3262  n_rad, records2b
-00018e90: 6549 6e76 6572 7465 6429 0a0a 0a20 2020  eInverted)...   
-00018ea0: 2064 6566 2063 7265 6174 655f 696d 6167   def create_imag
-00018eb0: 655f 7368 6132 3536 5f66 696c 6528 7365  e_sha256_file(se
-00018ec0: 6c66 2c72 6552 6561 6441 6c6c 3d54 7275  lf,reReadAll=Tru
-00018ed0: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
-00018ee0: 4372 6561 7465 7320 696e 202f 696e 7465  Creates in /inte
-00018ef0: 726d 6564 6961 7465 2061 2074 6578 7420  rmediate a text 
-00018f00: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
-00018f10: 7065 7220 696d 6167 6520 6974 7320 5348  per image its SH
-00018f20: 4132 3536 2068 6173 682e 0a20 2020 2020  A256 hash..     
-00018f30: 2020 2020 2020 2049 6620 7265 5265 6164         If reRead
-00018f40: 416c 6c20 6973 2054 7275 6520 616c 6c20  All is True all 
-00018f50: 696d 6167 6573 2720 6861 7368 6573 2061  images' hashes a
-00018f60: 7265 2064 6574 6572 6d69 6e65 642e 204f  re determined. O
-00018f70: 7468 6572 7769 7365 206f 6e6c 7920 666f  therwise only fo
-00018f80: 7220 7468 6f73 6520 6669 6c65 730a 2020  r those files.  
-00018f90: 2020 2020 2020 2020 2020 7768 6963 6820            which 
-00018fa0: 6172 6520 6e6f 7420 7965 7420 696e 2074  are not yet in t
-00018fb0: 6865 2069 6e74 6572 6d65 6469 6174 6520  he intermediate 
-00018fc0: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
-00018fd0: 7468 6520 696d 6167 6520 6861 7368 6573  the image hashes
-00018fe0: 2020 2222 220a 2020 2020 2020 2020 6861    """.        ha
-00018ff0: 7368 6573 203d 207b 7d0a 2020 2020 2020  shes = {}.      
-00019000: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
-00019010: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
-00019020: 5f68 6173 685f 6669 6c65 2829 293a 0a20  _hash_file()):. 
-00019030: 2020 2020 2020 2020 2020 2068 6173 6865             hashe
-00019040: 7320 3d20 6d69 7174 662e 7461 6246 696c  s = miqtf.tabFil
-00019050: 6544 6174 6128 7365 6c66 2e67 6574 5f69  eData(self.get_i
-00019060: 6e74 5f68 6173 685f 6669 6c65 2829 2c20  nt_hash_file(), 
-00019070: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
-00019080: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-00019090: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
-000190a0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-000190b0: 6861 7368 275d 5d2c 206b 6579 5f63 6f6c  hash']], key_col
-000190c0: 3d6d 6971 7476 2e63 6f6c 5f68 6561 6465  =miqtv.col_heade
-000190d0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000190e0: 275d 290a 0a20 2020 2020 2020 2069 6d61  '])..        ima
-000190f0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
-00019100: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-00019110: 7228 290a 2020 2020 2020 2020 6966 206c  r().        if l
-00019120: 656e 2869 6d61 6765 7349 6e52 6177 2920  en(imagesInRaw) 
-00019130: 3e20 303a 0a0a 2020 2020 2020 2020 2020  > 0:..          
-00019140: 2020 6164 6465 645f 6861 7368 6573 203d    added_hashes =
-00019150: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
-00019160: 726f 6720 3d20 6d69 7174 632e 5072 696e  rog = miqtc.Prin
-00019170: 744b 6e6f 776e 5072 6f67 7265 7373 4d73  tKnownProgressMs
-00019180: 6728 2243 6865 636b 696e 6720 6861 7368  g("Checking hash
-00019190: 6573 222c 206c 656e 2869 6d61 6765 7349  es", len(imagesI
-000191a0: 6e52 6177 292c 6d6f 6475 6c6f 3d35 290a  nRaw),modulo=5).
-000191b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000191c0: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
-000191d0: 5261 773a 0a20 2020 2020 2020 2020 2020  Raw:.           
-000191e0: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
-000191f0: 7373 2829 0a0a 2020 2020 2020 2020 2020  ss()..          
-00019200: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00019210: 662e 5f5f 616c 6c55 5549 4473 4368 6563  f.__allUUIDsChec
-00019220: 6b65 6420 616e 6420 6e6f 7420 6d69 7174  ked and not miqt
-00019230: 692e 696d 6167 6543 6f6e 7461 696e 7356  i.imageContainsV
-00019240: 616c 6964 5555 4944 2866 696c 6529 5b30  alidUUID(file)[0
-00019250: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00019260: 2020 2020 2020 2023 2072 656d 6f76 6520         # remove 
-00019270: 6672 6f6d 2075 7569 6420 6669 6c65 0a20  from uuid file. 
-00019280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019290: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-000192a0: 6973 7473 2873 656c 662e 6765 745f 696e  ists(self.get_in
-000192b0: 745f 7575 6964 5f66 696c 6528 2929 3a0a  t_uuid_file()):.
-000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192d0: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
-000192e0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
-000192f0: 7575 6964 5f66 696c 6528 292c 2022 7222  uuid_file(), "r"
-00019300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019310: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
-00019320: 3d20 7265 732e 7265 6164 6c69 6e65 7328  = res.readlines(
-00019330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019340: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
-00019350: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
-00019360: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00019370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019380: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
-00019390: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
-000193a0: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
+000188f0: 2020 2020 2020 205b 5b66 6c6f 6174 2864         [[float(d
+00018900: 2e6c 6f6e 292c 2066 6c6f 6174 2864 2e6c  .lon), float(d.l
+00018910: 6174 292c 2066 6c6f 6174 2864 2e64 6570  at), float(d.dep
+00018920: 295d 2066 6f72 2064 2069 6e20 696d 6167  )] for d in imag
+00018930: 655f 6474 735b 6669 6c65 5d5d 0a20 2020  e_dts[file]].   
+00018940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018960: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00018970: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018990: 2020 2020 2067 656f 6d65 7472 7920 3d20       geometry = 
+000189a0: 207b 2774 7970 6527 3a20 224d 756c 7469   {'type': "Multi
+000189b0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
+000189c0: 6174 6573 273a 0a20 2020 2020 2020 2020  ates':.         
+000189d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189e0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+000189f0: 5b66 6c6f 6174 2864 2e6c 6f6e 292c 2066  [float(d.lon), f
+00018a00: 6c6f 6174 2864 2e6c 6174 295d 2066 6f72  loat(d.lat)] for
+00018a10: 2064 2069 6e20 696d 6167 655f 6474 735b   d in image_dts[
+00018a20: 6669 6c65 5d5d 0a20 2020 2020 2020 2020  file]].         
+00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a40: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+00018a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a60: 2069 6620 5472 7565 2069 6e20 5b6d 6174   if True in [mat
+00018a70: 682e 6973 6e61 6e28 7829 2066 6f72 2078  h.isnan(x) for x
+00018a80: 2069 6e20 5b69 7465 6d20 666f 7220 7375   in [item for su
+00018a90: 626c 6973 7420 696e 2067 656f 6d65 7472  blist in geometr
+00018aa0: 795b 2763 6f6f 7264 696e 6174 6573 275d  y['coordinates']
+00018ab0: 2066 6f72 2069 7465 6d20 696e 2073 7562   for item in sub
+00018ac0: 6c69 7374 5d5d 3a0a 2020 2020 2020 2020  list]]:.        
+00018ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ae0: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+00018af0: 2020 2020 2020 2020 2020 6765 6f6a 736f            geojso
+00018b00: 6e5b 2766 6561 7475 7265 7327 5d2e 6170  n['features'].ap
+00018b10: 7065 6e64 287b 2774 7970 6527 3a20 2746  pend({'type': 'F
+00018b20: 6561 7475 7265 272c 2027 7072 6f70 6572  eature', 'proper
+00018b30: 7469 6573 273a 207b 2769 6427 3a20 6669  ties': {'id': fi
+00018b40: 6c65 7d2c 2027 6765 6f6d 6574 7279 273a  le}, 'geometry':
+00018b50: 2067 656f 6d65 7472 7920 7d29 0a20 2020   geometry }).   
+00018b60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00018b70: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
+00018b80: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+00018b90: 6e61 765f 6669 6c65 2829 2e72 6570 6c61  nav_file().repla
+00018ba0: 6365 2822 2e74 7874 222c 2022 2e67 656f  ce(".txt", ".geo
+00018bb0: 6a73 6f6e 2229 2c0a 2020 2020 2020 2020  json"),.        
+00018bc0: 2020 2020 2020 2020 2020 2020 2022 7722               "w"
+00018bd0: 2c20 6572 726f 7273 3d22 6967 6e6f 7265  , errors="ignore
+00018be0: 222c 2065 6e63 6f64 696e 673d 2775 7466  ", encoding='utf
+00018bf0: 2d38 2729 0a20 2020 2020 2020 2020 2020  -8').           
+00018c00: 206a 736f 6e2e 6475 6d70 2867 656f 6a73   json.dump(geojs
+00018c10: 6f6e 2c20 6f2c 2065 6e73 7572 655f 6173  on, o, ensure_as
+00018c20: 6369 693d 4661 6c73 652c 2069 6e64 656e  cii=False, inden
+00018c30: 743d 3429 0a20 2020 2020 2020 2020 2020  t=4).           
+00018c40: 206f 2e63 6c6f 7365 2829 0a0a 2020 2020   o.close()..    
+00018c50: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00018c60: 762e 6164 6441 7267 756d 656e 7428 2269  v.addArgument("i
+00018c70: 6e70 7574 4e61 7669 6761 7469 6f6e 4669  nputNavigationFi
+00018c80: 6c65 222c 6e61 765f 7061 7468 2c6f 7665  le",nav_path,ove
+00018c90: 7277 7269 7465 3d54 7275 6529 0a20 2020  rwrite=True).   
+00018ca0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00018cb0: 6f76 2e6c 6f67 2822 7061 7273 6564 2066  ov.log("parsed f
+00018cc0: 726f 6d20 696e 7075 744e 6176 6967 6174  rom inputNavigat
+00018cd0: 696f 6e46 696c 653a 2022 202b 2073 7472  ionFile: " + str
+00018ce0: 286e 6176 5f68 6561 6465 7229 2c64 6f6e  (nav_header),don
+00018cf0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+00018d00: 2020 2020 2020 2020 732e 7374 6f70 2829          s.stop()
+00018d10: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00018d20: 7572 6e20 5472 7565 2c20 224e 6176 6967  urn True, "Navig
+00018d30: 6174 696f 6e20 6461 7461 2063 7265 6174  ation data creat
+00018d40: 6564 2220 2b20 7265 7475 726e 4d73 670a  ed" + returnMsg.
+00018d50: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018d60: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
+00018d70: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+00018d80: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
+00018d90: 2069 6d61 6765 2063 6f6f 7264 696e 6174   image coordinat
+00018da0: 6573 2066 6f75 6e64 2220 2b20 7265 7475  es found" + retu
+00018db0: 726e 4d73 670a 0a20 2020 2064 6566 2063  rnMsg..    def c
+00018dc0: 7265 6174 6549 6d61 6765 4e61 7669 6761  reateImageNaviga
+00018dd0: 7469 6f6e 4669 6c65 2873 656c 662c 206e  tionFile(self, n
+00018de0: 6176 5f70 6174 683a 2073 7472 2c20 6e61  av_path: str, na
+00018df0: 765f 6865 6164 6572 3d6d 6971 7476 2e70  v_header=miqtv.p
+00018e00: 6f73 5f68 6561 6465 725b 2770 616e 6761  os_header['panga
+00018e10: 6561 275d 2c20 6461 7465 5f66 6f72 6d61  ea'], date_forma
+00018e20: 743d 6d69 7174 762e 6461 7465 5f66 6f72  t=miqtv.date_for
+00018e30: 6d61 7473 5b27 7061 6e67 6165 6127 5d2c  mats['pangaea'],
+00018e40: 206f 7665 7277 7269 7465 3d46 616c 7365   overwrite=False
+00018e50: 2c20 636f 6c5f 7365 7061 7261 746f 7220  , col_separator 
+00018e60: 3d20 225c 7422 2c20 7669 6465 6f53 616d  = "\t", videoSam
+00018e70: 706c 6553 6563 6f6e 6473 3d31 2c0a 2020  pleSeconds=1,.  
+00018e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ea0: 2020 6f66 6673 6574 5f78 3d30 2c20 6f66    offset_x=0, of
+00018eb0: 6673 6574 5f79 3d30 2c20 6f66 6673 6574  fset_y=0, offset
+00018ec0: 5f7a 3d30 2c61 6e67 6c65 735f 696e 5f72  _z=0,angles_in_r
+00018ed0: 6164 203d 2046 616c 7365 2c20 7265 636f  ad = False, reco
+00018ee0: 7264 7332 6265 496e 7665 7274 6564 3d5b  rds2beInverted=[
+00018ef0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
+00018f00: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
+00018f10: 2063 7265 6174 655f 696d 6167 655f 6e61   create_image_na
+00018f20: 7669 6761 7469 6f6e 5f66 696c 6520 2222  vigation_file ""
+00018f30: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00018f40: 2073 656c 662e 6372 6561 7465 5f69 6d61   self.create_ima
+00018f50: 6765 5f6e 6176 6967 6174 696f 6e5f 6669  ge_navigation_fi
+00018f60: 6c65 286e 6176 5f70 6174 682c 206e 6176  le(nav_path, nav
+00018f70: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
+00018f80: 726d 6174 2c20 6f76 6572 7772 6974 652c  rmat, overwrite,
+00018f90: 2063 6f6c 5f73 6570 6172 6174 6f72 2c20   col_separator, 
+00018fa0: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+00018fb0: 6473 2c20 6f66 6673 6574 5f78 2c20 6f66  ds, offset_x, of
+00018fc0: 6673 6574 5f79 2c20 6f66 6673 6574 5f7a  fset_y, offset_z
+00018fd0: 2c20 616e 676c 6573 5f69 6e5f 7261 642c  , angles_in_rad,
+00018fe0: 2072 6563 6f72 6473 3262 6549 6e76 6572   records2beInver
+00018ff0: 7465 6429 0a0a 0a20 2020 2064 6566 2063  ted)...    def c
+00019000: 7265 6174 655f 696d 6167 655f 7368 6132  reate_image_sha2
+00019010: 3536 5f66 696c 6528 7365 6c66 2c72 6552  56_file(self,reR
+00019020: 6561 6441 6c6c 3d54 7275 6529 3a0a 2020  eadAll=True):.  
+00019030: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
+00019040: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
+00019050: 7465 2061 2074 6578 7420 6669 6c65 2063  te a text file c
+00019060: 6f6e 7461 696e 696e 6720 7065 7220 696d  ontaining per im
+00019070: 6167 6520 6974 7320 5348 4132 3536 2068  age its SHA256 h
+00019080: 6173 682e 0a20 2020 2020 2020 2020 2020  ash..           
+00019090: 2049 6620 7265 5265 6164 416c 6c20 6973   If reReadAll is
+000190a0: 2054 7275 6520 616c 6c20 696d 6167 6573   True all images
+000190b0: 2720 6861 7368 6573 2061 7265 2064 6574  ' hashes are det
+000190c0: 6572 6d69 6e65 642e 204f 7468 6572 7769  ermined. Otherwi
+000190d0: 7365 206f 6e6c 7920 666f 7220 7468 6f73  se only for thos
+000190e0: 6520 6669 6c65 730a 2020 2020 2020 2020  e files.        
+000190f0: 2020 2020 7768 6963 6820 6172 6520 6e6f      which are no
+00019100: 7420 7965 7420 696e 2074 6865 2069 6e74  t yet in the int
+00019110: 6572 6d65 6469 6174 6520 6669 6c65 2063  ermediate file c
+00019120: 6f6e 7461 696e 696e 6720 7468 6520 696d  ontaining the im
+00019130: 6167 6520 6861 7368 6573 2020 2222 220a  age hashes  """.
+00019140: 2020 2020 2020 2020 6861 7368 6573 203d          hashes =
+00019150: 207b 7d0a 2020 2020 2020 2020 6966 206f   {}.        if o
+00019160: 732e 7061 7468 2e65 7869 7374 7328 7365  s.path.exists(se
+00019170: 6c66 2e67 6574 5f69 6e74 5f68 6173 685f  lf.get_int_hash_
+00019180: 6669 6c65 2829 293a 0a20 2020 2020 2020  file()):.       
+00019190: 2020 2020 2068 6173 6865 7320 3d20 6d69       hashes = mi
+000191a0: 7174 662e 7461 6246 696c 6544 6174 6128  qtf.tabFileData(
+000191b0: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+000191c0: 685f 6669 6c65 2829 2c20 5b6d 6971 7476  h_file(), [miqtv
+000191d0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+000191e0: 6971 7427 5d5b 2769 6d67 275d 2c20 6d69  iqt']['img'], mi
+000191f0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00019200: 6d61 7269 7174 275d 5b27 6861 7368 275d  mariqt']['hash']
+00019210: 5d2c 206b 6579 5f63 6f6c 3d6d 6971 7476  ], key_col=miqtv
+00019220: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00019230: 6971 7427 5d5b 2769 6d67 275d 290a 0a20  iqt']['img']).. 
+00019240: 2020 2020 2020 2069 6d61 6765 7349 6e52         imagesInR
+00019250: 6177 203d 2073 656c 662e 696d 6167 6573  aw = self.images
+00019260: 496e 496d 6167 6573 4469 7228 290a 2020  InImagesDir().  
+00019270: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
+00019280: 6765 7349 6e52 6177 2920 3e20 303a 0a0a  gesInRaw) > 0:..
+00019290: 2020 2020 2020 2020 2020 2020 6164 6465              adde
+000192a0: 645f 6861 7368 6573 203d 2030 0a20 2020  d_hashes = 0.   
+000192b0: 2020 2020 2020 2020 2070 726f 6720 3d20           prog = 
+000192c0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
+000192d0: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
+000192e0: 636b 696e 6720 6861 7368 6573 222c 206c  cking hashes", l
+000192f0: 656e 2869 6d61 6765 7349 6e52 6177 292c  en(imagesInRaw),
+00019300: 6d6f 6475 6c6f 3d35 290a 2020 2020 2020  modulo=5).      
+00019310: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00019320: 6e20 696d 6167 6573 496e 5261 773a 0a20  n imagesInRaw:. 
+00019330: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019340: 726f 672e 7072 6f67 7265 7373 2829 0a0a  rog.progress()..
+00019350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019360: 6966 206e 6f74 2073 656c 662e 5f5f 616c  if not self.__al
+00019370: 6c55 5549 4473 4368 6563 6b65 6420 616e  lUUIDsChecked an
+00019380: 6420 6e6f 7420 6d69 7174 692e 696d 6167  d not miqti.imag
+00019390: 6543 6f6e 7461 696e 7356 616c 6964 5555  eContainsValidUU
+000193a0: 4944 2866 696c 6529 5b30 5d3a 0a20 2020  ID(file)[0]:.   
 000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193c0: 206c 696e 654e 7220 3d20 690a 2020 2020   lineNr = i.    
-000193d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193e0: 666f 7220 6c69 6e65 2069 6e20 6c69 6e65  for line in line
-000193f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00019400: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
-00019410: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
-00019420: 696c 6529 2069 6e20 6c69 6e65 3a0a 2020  ile) in line:.  
-00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019440: 2020 2020 2020 2020 2020 6c69 6e65 4e72            lineNr
-00019450: 203d 2069 0a20 2020 2020 2020 2020 2020   = i.           
+000193c0: 2023 2072 656d 6f76 6520 6672 6f6d 2075   # remove from u
+000193d0: 7569 6420 6669 6c65 0a20 2020 2020 2020  uid file.       
+000193e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000193f0: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
+00019400: 656c 662e 6765 745f 696e 745f 7575 6964  elf.get_int_uuid
+00019410: 5f66 696c 6528 2929 3a0a 2020 2020 2020  _file()):.      
+00019420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019430: 2020 7265 7320 3d20 6f70 656e 2873 656c    res = open(sel
+00019440: 662e 6765 745f 696e 745f 7575 6964 5f66  f.get_int_uuid_f
+00019450: 696c 6528 292c 2022 7222 290a 2020 2020  ile(), "r").    
 00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019470: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00019480: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00019490: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-000194a0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
-000194b0: 654e 7220 213d 2030 3a0a 2020 2020 2020  eNr != 0:.      
-000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194d0: 2020 6465 6c20 6c69 6e65 735b 6c69 6e65    del lines[line
-000194e0: 4e72 5d0a 2020 2020 2020 2020 2020 2020  Nr].            
-000194f0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
-00019500: 3d20 6f70 656e 2873 656c 662e 6765 745f  = open(self.get_
-00019510: 696e 745f 7575 6964 5f66 696c 6528 292c  int_uuid_file(),
-00019520: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
-00019530: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00019540: 732e 7772 6974 656c 696e 6573 286c 696e  s.writelines(lin
-00019550: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00019560: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00019570: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-00019580: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00019590: 6520 4578 6365 7074 696f 6e28 2022 4669  e Exception( "Fi
-000195a0: 6c65 2022 202b 2066 696c 6520 2b20 2220  le " + file + " 
-000195b0: 646f 6573 206e 6f74 2063 6f74 6169 6e20  does not cotain 
-000195c0: 6120 7661 6c69 6420 5555 4944 2e20 5275  a valid UUID. Ru
-000195d0: 6e20 6372 6561 7465 5f75 7569 645f 6669  n create_uuid_fi
-000195e0: 6c65 2829 2066 6972 7374 2122 290a 0a20  le() first!").. 
-000195f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00019600: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
-00019610: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
-00019620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019630: 2020 6966 206e 6f74 2072 6552 6561 6441    if not reReadA
-00019640: 6c6c 2061 6e64 2066 696c 655f 6e61 6d65  ll and file_name
-00019650: 2069 6e20 6861 7368 6573 3a0a 2020 2020   in hashes:.    
-00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019670: 6861 7368 6573 5b66 696c 655f 6e61 6d65  hashes[file_name
-00019680: 5d20 3d20 6861 7368 6573 5b66 696c 655f  ] = hashes[file_
-00019690: 6e61 6d65 5d5b 6d69 7174 762e 636f 6c5f  name][miqtv.col_
-000196a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-000196b0: 5b27 6861 7368 275d 5d0a 2020 2020 2020  ['hash']].      
-000196c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000196d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196e0: 2020 2020 6861 7368 6573 5b66 696c 655f      hashes[file_
-000196f0: 6e61 6d65 5d20 3d20 6d69 7174 632e 7368  name] = miqtc.sh
-00019700: 6132 3536 4861 7368 4669 6c65 2866 696c  a256HashFile(fil
-00019710: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00019720: 2020 2020 2020 2061 6464 6564 5f68 6173         added_has
-00019730: 6865 7320 2b3d 2031 0a20 2020 2020 2020  hes += 1.       
-00019740: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
-00019750: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00019760: 6620 7265 5265 6164 416c 6c20 6f72 2061  f reReadAll or a
-00019770: 6464 6564 5f68 6173 6865 7320 3e20 303a  dded_hashes > 0:
-00019780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019790: 2068 6173 685f 6669 6c65 203d 206f 7065   hash_file = ope
-000197a0: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f68  n(self.get_int_h
-000197b0: 6173 685f 6669 6c65 2829 2c20 2277 2229  ash_file(), "w")
-000197c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000197d0: 2068 6173 685f 6669 6c65 2e77 7269 7465   hash_file.write
-000197e0: 2820 6d69 7174 762e 636f 6c5f 6865 6164  ( miqtv.col_head
-000197f0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
-00019800: 6727 5d2b 225c 7422 2b6d 6971 7476 2e63  g']+"\t"+miqtv.c
-00019810: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00019820: 7427 5d5b 2768 6173 6827 5d2b 225c 6e22  t']['hash']+"\n"
-00019830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019840: 2020 666f 7220 6669 6c65 5f6e 616d 6520    for file_name 
-00019850: 696e 2068 6173 6865 733a 0a20 2020 2020  in hashes:.     
-00019860: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-00019870: 6173 685f 6669 6c65 2e77 7269 7465 2866  ash_file.write(f
-00019880: 696c 655f 6e61 6d65 2b22 5c74 222b 6861  ile_name+"\t"+ha
-00019890: 7368 6573 5b66 696c 655f 6e61 6d65 5d2b  shes[file_name]+
-000198a0: 225c 6e22 290a 0a20 2020 2020 2020 2020  "\n")..         
-000198b0: 2020 2020 2020 2068 6173 685f 6669 6c65         hash_file
-000198c0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-000198d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000198e0: 5472 7565 2c20 2241 6464 6564 2022 2b73  True, "Added "+s
-000198f0: 7472 2861 6464 6564 5f68 6173 6865 7329  tr(added_hashes)
-00019900: 2b22 2068 6173 6865 7320 746f 2068 6173  +" hashes to has
-00019910: 6820 6669 6c65 220a 2020 2020 2020 2020  h file".        
-00019920: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00019930: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00019940: 2054 7275 652c 2022 416c 6c20 6861 7368   True, "All hash
-00019950: 6573 2065 7869 7374 220a 0a20 2020 2020  es exist"..     
-00019960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00019970: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00019980: 652c 2022 4e6f 2069 6d61 6765 7320 666f  e, "No images fo
-00019990: 756e 6420 746f 2068 6173 6822 0a20 2020  und to hash".   
-000199a0: 2020 2020 200a 2020 2020 6465 6620 6372       .    def cr
-000199b0: 6561 7465 496d 6167 6553 4841 3235 3646  eateImageSHA256F
-000199c0: 696c 6528 7365 6c66 2c72 6552 6561 6441  ile(self,reReadA
-000199d0: 6c6c 3d54 7275 6529 3a0a 2020 2020 2020  ll=True):.      
-000199e0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
-000199f0: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
-00019a00: 6167 655f 7368 6132 3536 5f66 696c 6520  age_sha256_file 
-00019a10: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00019a20: 726e 2073 656c 662e 6372 6561 7465 5f69  rn self.create_i
-00019a30: 6d61 6765 5f73 6861 3235 365f 6669 6c65  mage_sha256_file
-00019a40: 2872 6552 6561 6441 6c6c 290a 0a0a 2020  (reReadAll)...  
-00019a50: 2020 6465 6620 6372 6561 7465 5f73 7461    def create_sta
-00019a60: 7274 5f74 696d 655f 6669 6c65 2873 656c  rt_time_file(sel
-00019a70: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-00019a80: 4372 6561 7465 7320 696e 202f 696e 7465  Creates in /inte
-00019a90: 726d 6564 6961 7465 2061 2074 6578 7420  rmediate a text 
-00019aa0: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
-00019ab0: 7065 7220 696d 6167 6520 6974 7320 7374  per image its st
-00019ac0: 6172 7420 7469 6d65 2070 6172 7365 6420  art time parsed 
-00019ad0: 6672 6f6d 2074 6865 2066 696c 6520 6e61  from the file na
-00019ae0: 6d65 2022 2222 0a0a 2020 2020 2020 2020  me """..        
-00019af0: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
-00019b00: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
-00019b10: 696e 6720 696e 7465 726d 6564 6961 7465  ing intermediate
-00019b20: 2073 7461 7274 7469 6d65 2066 696c 6520   starttime file 
-00019b30: 2229 0a20 2020 2020 2020 2069 6d61 6765  ").        image
-00019b40: 7349 6e52 6177 203d 2073 656c 662e 696d  sInRaw = self.im
-00019b50: 6167 6573 496e 496d 6167 6573 4469 7253  agesInImagesDirS
-00019b60: 6f72 7465 644c 6973 7428 290a 2020 2020  ortedList().    
-00019b70: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
-00019b80: 7349 6e52 6177 2920 3e20 303a 0a0a 2020  sInRaw) > 0:..  
-00019b90: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
-00019ba0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
-00019bb0: 7374 6172 7454 696d 6573 5f66 696c 6528  startTimes_file(
-00019bc0: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
-00019bd0: 2020 2020 6f2e 7772 6974 6528 6d69 7174      o.write(miqt
-00019be0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00019bf0: 7269 7174 275d 5b27 696d 6727 5d20 2b0a  riqt']['img'] +.
-00019c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c10: 2020 2020 225c 7422 2b6d 6971 7476 2e63      "\t"+miqtv.c
-00019c20: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00019c30: 7427 5d5b 2775 7463 275d 2b22 5c6e 2229  t']['utc']+"\n")
-00019c40: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00019c50: 7220 6669 6c65 2069 6e20 696d 6167 6573  r file in images
-00019c60: 496e 5261 773a 0a20 2020 2020 2020 2020  InRaw:.         
-00019c70: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
-00019c80: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
-00019c90: 616d 6528 6669 6c65 290a 0a20 2020 2020  ame(file)..     
-00019ca0: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
-00019cb0: 6d69 7174 632e 7061 7273 6546 696c 6544  miqtc.parseFileD
-00019cc0: 6174 6554 696d 6541 7355 5443 2866 696c  ateTimeAsUTC(fil
-00019cd0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00019ce0: 2020 2020 2020 2020 6f2e 7772 6974 6528          o.write(
-00019cf0: 6669 6c65 5f6e 616d 652b 225c 7422 202b  file_name+"\t" +
-00019d00: 2064 742e 7374 7266 7469 6d65 286d 6971   dt.strftime(miq
-00019d10: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-00019d20: 276d 6172 6971 7427 5d29 2b22 5c6e 2229  'mariqt'])+"\n")
-00019d30: 0a0a 2020 2020 2020 2020 2020 2020 6f2e  ..            o.
-00019d40: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-00019d50: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-00019d60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019d70: 5472 7565 2c20 2243 7265 6174 6564 2073  True, "Created s
-00019d80: 7461 7274 2074 696d 6520 6669 6c65 220a  tart time file".
-00019d90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00019da0: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
-00019db0: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
-00019dc0: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
-00019dd0: 2069 6d61 6765 7320 666f 756e 6420 746f   images found to
-00019de0: 2072 6561 6420 7374 6172 7420 7469 6d65   read start time
-00019df0: 7322 0a20 2020 2020 2020 200a 2020 2020  s".        .    
-00019e00: 6465 6620 6372 6561 7465 5374 6172 7454  def createStartT
-00019e10: 696d 6546 696c 6528 7365 6c66 293a 0a20  imeFile(self):. 
-00019e20: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
-00019e30: 6361 7465 6420 2d20 7573 6520 6372 6561  cated - use crea
-00019e40: 7465 5f73 7461 7274 5f74 696d 655f 6669  te_start_time_fi
-00019e50: 6c65 2022 2222 0a20 2020 2020 2020 2072  le """.        r
-00019e60: 6574 7572 6e20 7365 6c66 2e63 7265 6174  eturn self.creat
-00019e70: 655f 7374 6172 745f 7469 6d65 5f66 696c  e_start_time_fil
-00019e80: 6528 290a 0a0a 2020 2020 6465 6620 6372  e()...    def cr
-00019e90: 6561 7465 4163 7175 6973 6974 696f 6e53  eateAcquisitionS
-00019ea0: 6574 7469 6e67 7345 5849 4646 696c 6528  ettingsEXIFFile(
-00019eb0: 7365 6c66 2c6f 7665 7272 6964 653d 4661  self,override=Fa
-00019ec0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
-00019ed0: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
-00019ee0: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
-00019ef0: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
-00019f00: 6720 7065 7220 696d 6167 6520 6120 6469  g per image a di
-00019f10: 6374 206f 6620 6578 6966 2074 6167 7320  ct of exif tags 
-00019f20: 616e 6420 7468 6569 7220 7661 6c75 6573  and their values
-00019f30: 2070 6172 7365 6420 6672 6f6d 2074 6865   parsed from the
-00019f40: 2069 6d61 6765 2022 2222 0a0a 2020 2020   image """..    
-00019f50: 2020 2020 696e 745f 6163 7175 6973 6974      int_acquisit
-00019f60: 696f 6e53 6574 7469 6e67 5f66 696c 6520  ionSetting_file 
-00019f70: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
-00019f80: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
-00019f90: 2027 5f69 6d61 6765 2d61 6371 7569 7369   '_image-acquisi
-00019fa0: 7469 6f6e 2d73 6574 7469 6e67 732e 7478  tion-settings.tx
-00019fb0: 7427 0a20 2020 2020 2020 2068 6561 6465  t'.        heade
-00019fc0: 7220 3d20 7b20 206d 6971 7476 2e63 6f6c  r = {  miqtv.col
-00019fd0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00019fe0: 5d5b 2769 6d67 275d 3a20 206d 6971 7476  ]['img']:  miqtv
-00019ff0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0001a000: 6971 7427 5d5b 2769 6d67 275d 2c0a 2020  iqt']['img'],.  
-0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a020: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
-0001a030: 6572 5b27 6d61 7269 7174 275d 5b27 6163  er['mariqt']['ac
-0001a040: 7175 6927 5d3a 6d69 7174 762e 636f 6c5f  qui']:miqtv.col_
-0001a050: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001a060: 5b27 6163 7175 6927 5d7d 0a20 2020 2020  ['acqui']}.     
-0001a070: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
-0001a080: 6973 7473 2869 6e74 5f61 6371 7569 7369  ists(int_acquisi
-0001a090: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
-0001a0a0: 2920 616e 6420 6e6f 7420 6f76 6572 7269  ) and not overri
-0001a0b0: 6465 3a0a 2020 2020 2020 2020 2020 2020  de:.            
-0001a0c0: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
-0001a0d0: 666f 5f74 6162 5f66 696c 6528 696e 745f  fo_tab_file(int_
-0001a0e0: 6163 7175 6973 6974 696f 6e53 6574 7469  acquisitionSetti
-0001a0f0: 6e67 5f66 696c 652c 225c 7422 2c68 6561  ng_file,"\t",hea
-0001a100: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
-0001a110: 2072 6574 7572 6e20 5472 7565 2c20 2252   return True, "R
-0001a120: 6573 756c 7420 6669 6c65 2065 7869 7374  esult file exist
-0001a130: 7322 0a0a 2020 2020 2020 2020 696d 6167  s"..        imag
-0001a140: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
-0001a150: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-0001a160: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
-0001a170: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
-0001a180: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
-0001a190: 2020 2020 2020 2020 2020 206f 203d 206f             o = o
-0001a1a0: 7065 6e28 696e 745f 6163 7175 6973 6974  pen(int_acquisit
-0001a1b0: 696f 6e53 6574 7469 6e67 5f66 696c 652c  ionSetting_file,
-0001a1c0: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
-0001a1d0: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
-0001a1e0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-0001a1f0: 7174 275d 5b27 696d 6727 5d20 2b20 225c  qt']['img'] + "\
-0001a200: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-0001a210: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
-0001a220: 6371 7569 275d 2b22 5c6e 2229 0a20 0a20  cqui']+"\n"). . 
-0001a230: 2020 2020 2020 2020 2020 2069 6d61 6765             image
-0001a240: 7345 7869 6673 203d 206d 6971 7469 2e67  sExifs = miqti.g
-0001a250: 6574 496d 6167 6573 416c 6c45 7869 6656  etImagesAllExifV
-0001a260: 616c 7565 7328 696d 6167 6573 496e 5261  alues(imagesInRa
-0001a270: 772c 7365 6c66 2e70 726f 7629 0a20 2020  w,self.prov).   
-0001a280: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
-0001a290: 6520 696e 2069 6d61 6765 7345 7869 6673  e in imagesExifs
-0001a2a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001a2b0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
-0001a2c0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
-0001a2d0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-0001a2e0: 2020 2020 206f 2e77 7269 7465 2866 696c       o.write(fil
-0001a2f0: 655f 6e61 6d65 2b22 5c74 222b 7374 7228  e_name+"\t"+str(
-0001a300: 696d 6167 6573 4578 6966 735b 6669 6c65  imagesExifs[file
-0001a310: 5d29 2b22 5c6e 2229 0a0a 2020 2020 2020  ])+"\n")..      
-0001a320: 2020 2020 2020 6f2e 636c 6f73 6528 290a        o.close().
-0001a330: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0001a340: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
-0001a350: 7461 625f 6669 6c65 2869 6e74 5f61 6371  tab_file(int_acq
-0001a360: 7569 7369 7469 6f6e 5365 7474 696e 675f  uisitionSetting_
-0001a370: 6669 6c65 2c22 5c74 222c 6865 6164 6572  file,"\t",header
-0001a380: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001a390: 7475 726e 2054 7275 652c 2022 4372 6561  turn True, "Crea
-0001a3a0: 7465 6420 6163 7175 6973 6974 696f 6e20  ted acquisition 
-0001a3b0: 7365 7474 696e 6773 2066 696c 6522 0a20  settings file". 
-0001a3c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001a3d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001a3e0: 4661 6c73 652c 2022 4e6f 2069 6d61 6765  False, "No image
-0001a3f0: 7320 666f 756e 6422 0a0a 0a20 2020 2064  s found"...    d
-0001a400: 6566 2069 6d61 6765 7349 6e49 6d61 6765  ef imagesInImage
-0001a410: 7344 6972 2873 656c 6629 3a0a 2020 2020  sDir(self):.    
-0001a420: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
-0001a430: 6465 6570 636f 7079 2873 656c 662e 5f69  deepcopy(self._i
-0001a440: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-0001a450: 290a 0a20 2020 2064 6566 2069 6d61 6765  )..    def image
-0001a460: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
-0001a470: 6564 4c69 7374 2873 656c 6629 3a0a 2020  edList(self):.  
-0001a480: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
-0001a490: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0001a4a0: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
-0001a4b0: 6972 536f 7274 6564 4c69 7374 290a 0a0a  irSortedList)...
-0001a4c0: 2020 2020 6465 6620 7061 7273 6549 7465      def parseIte
-0001a4d0: 6d44 6174 6166 726f 6d54 6162 4669 6c65  mDatafromTabFile
-0001a4e0: 4461 7461 2873 656c 662c 2069 7465 6d73  Data(self, items
-0001a4f0: 3a20 6469 6374 2c20 6669 6c65 3a20 7374  : dict, file: st
-0001a500: 722c 2063 6f6c 733a 206c 6973 742c 206f  r, cols: list, o
-0001a510: 7074 696f 6e61 6c3a 206c 6973 7420 3d20  ptional: list = 
-0001a520: 5b5d 2c20 6461 7465 7469 6d65 5f66 6f72  [], datetime_for
-0001a530: 6d61 743a 7374 723d 6d69 7174 762e 6461  mat:str=miqtv.da
-0001a540: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
-0001a550: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
-0001a560: 2222 2070 6172 7365 7320 6461 7461 2066  "" parses data f
-0001a570: 726f 6d20 636f 6c75 6d6e 7320 696e 2063  rom columns in c
-0001a580: 6f6c 7320 616e 6420 7772 6974 6573 2069  ols and writes i
-0001a590: 6e66 6f20 746f 2069 7465 6d73 2e20 436f  nfo to items. Co
-0001a5a0: 6c75 6d6e 2027 696d 6167 652d 6669 6c65  lumn 'image-file
-0001a5b0: 6e61 6d65 2720 6d75 7374 2062 6520 696e  name' must be in
-0001a5c0: 2066 696c 6520 616e 6420 646f 6573 206e   file and does n
-0001a5d0: 6f74 206e 6565 6420 746f 2062 6520 7061  ot need to be pa
-0001a5e0: 7373 6564 2069 6e20 636f 6c73 2e20 0a20  ssed in cols. . 
-0001a5f0: 2020 2020 2020 2020 2020 2046 696c 6520             File 
-0001a600: 6d75 7374 2062 6520 7461 6220 7365 7061  must be tab sepa
-0001a610: 7261 7465 6420 616e 6420 636f 6c75 6d6e  rated and column
-0001a620: 7320 6e61 6d65 7320 6d75 7374 2065 7175  s names must equ
-0001a630: 616c 2069 7465 6d20 6669 656c 6420 6e61  al item field na
-0001a640: 6d65 7322 2222 0a20 2020 2020 2020 2074  mes""".        t
-0001a650: 6d70 5f64 6174 6120 3d20 6d69 7174 662e  mp_data = miqtf.
-0001a660: 7461 6246 696c 6544 6174 6128 6669 6c65  tabFileData(file
-0001a670: 2c20 636f 6c73 2b5b 2769 6d61 6765 2d66  , cols+['image-f
-0001a680: 696c 656e 616d 6527 5d2b 6f70 7469 6f6e  ilename']+option
-0001a690: 616c 2c20 6b65 795f 636f 6c3d 2769 6d61  al, key_col='ima
-0001a6a0: 6765 2d66 696c 656e 616d 6527 2c20 6f70  ge-filename', op
-0001a6b0: 7469 6f6e 616c 3d6f 7074 696f 6e61 6c2c  tional=optional,
-0001a6c0: 636f 6e76 6572 743d 5472 7565 290a 2020  convert=True).  
-0001a6d0: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
-0001a6e0: 5061 7273 6564 4461 7461 546f 4974 656d  ParsedDataToItem
-0001a6f0: 7328 746d 705f 6461 7461 2c69 7465 6d73  s(tmp_data,items
-0001a700: 2c73 656c 662e 6966 646f 5f74 6d70 5b6d  ,self.ifdo_tmp[m
-0001a710: 6971 7476 2e69 6d61 6765 5f73 6574 5f68  iqtv.image_set_h
-0001a720: 6561 6465 725f 6b65 795d 2c20 6461 7465  eader_key], date
-0001a730: 7469 6d65 5f66 6f72 6d61 743d 6461 7465  time_format=date
-0001a740: 7469 6d65 5f66 6f72 6d61 7429 0a0a 0a20  time_format)... 
-0001a750: 2020 2064 6566 2070 7261 7365 4974 656d     def praseItem
-0001a760: 4461 7461 4672 6f6d 4669 6c65 2873 656c  DataFromFile(sel
-0001a770: 662c 6974 656d 733a 6469 6374 2c66 696c  f,items:dict,fil
-0001a780: 653a 7374 722c 7365 7061 7261 746f 723a  e:str,separator:
-0001a790: 7374 722c 6865 6164 6572 3a64 6963 742c  str,header:dict,
-0001a7a0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
-0001a7b0: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
-0001a7c0: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
-0001a7d0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
-0001a7e0: 7061 7273 6573 2064 6174 6120 6672 6f6d  parses data from
-0001a7f0: 2066 726f 6d20 6669 6c65 2074 6f20 6974   from file to it
-0001a800: 656d 732e 2068 6561 6465 7220 6469 6374  ems. header dict
-0001a810: 206d 7573 7420 6265 206f 6620 7374 7275   must be of stru
-0001a820: 6374 7572 653a 207b 3c69 7465 6d2d 6669  cture: {<item-fi
-0001a830: 656c 642d 6e61 6d65 3e3a 3c63 6f6c 756d  eld-name>:<colum
-0001a840: 6e2d 6e61 6d65 3e7d 0a20 2020 2020 2020  n-name>}.       
-0001a850: 2020 2020 2061 6e64 206d 7573 7420 636f       and must co
-0001a860: 6e74 6169 6e20 656e 7472 7920 2769 6d61  ntain entry 'ima
-0001a870: 6765 2d66 696c 656e 616d 6527 2022 2222  ge-filename' """
-0001a880: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001a890: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-0001a8a0: 2069 6e20 6865 6164 6572 3a0a 2020 2020   in header:.    
-0001a8b0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
-0001a8c0: 6365 7074 696f 6e28 2268 6561 6465 7220  ception("header 
-0001a8d0: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
-0001a8e0: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
-0001a8f0: 2722 290a 2020 2020 2020 2020 0a20 2020  '").        .   
-0001a900: 2020 2020 2074 6d70 5f64 6174 6120 3d20       tmp_data = 
-0001a910: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
-0001a920: 6128 6669 6c65 2c20 6865 6164 6572 2c63  a(file, header,c
-0001a930: 6f6c 5f73 6570 6172 6174 6f72 3d73 6570  ol_separator=sep
-0001a940: 6172 6174 6f72 2c20 6b65 795f 636f 6c3d  arator, key_col=
-0001a950: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-0001a960: 2c63 6f6e 7665 7274 3d54 7275 6529 0a20  ,convert=True). 
-0001a970: 2020 2020 2020 2073 656c 662e 7772 6974         self.writ
-0001a980: 6550 6172 7365 6444 6174 6154 6f49 7465  eParsedDataToIte
-0001a990: 6d73 2874 6d70 5f64 6174 612c 6974 656d  ms(tmp_data,item
-0001a9a0: 732c 7365 6c66 2e69 6664 6f5f 746d 705b  s,self.ifdo_tmp[
-0001a9b0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
-0001a9c0: 6865 6164 6572 5f6b 6579 5d2c 2064 6174  header_key], dat
-0001a9d0: 6574 696d 655f 666f 726d 6174 3d64 6174  etime_format=dat
-0001a9e0: 6574 696d 655f 666f 726d 6174 290a 0a0a  etime_format)...
-0001a9f0: 2020 2020 6465 6620 7772 6974 6550 6172      def writePar
-0001aa00: 7365 6444 6174 6154 6f49 7465 6d73 2873  sedDataToItems(s
-0001aa10: 656c 662c 6461 7461 3a64 6963 742c 6974  elf,data:dict,it
-0001aa20: 656d 733a 6469 6374 2c68 6561 6465 723a  ems:dict,header:
-0001aa30: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
-0001aa40: 6f72 6d61 743a 7374 723d 6d69 7174 762e  ormat:str=miqtv.
-0001aa50: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0001aa60: 7269 7174 275d 293a 0a0a 2020 2020 2020  riqt']):..      
-0001aa70: 2020 2320 6576 616c 2073 7472 696e 6773    # eval strings
-0001aa80: 2061 7320 6469 6374 206f 7220 6c69 7374   as dict or list
-0001aa90: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
-0001aaa0: 6563 7572 7369 7665 4576 616c 2864 6174  ecursiveEval(dat
-0001aab0: 6129 0a0a 2020 2020 2020 2020 6461 7461  a)..        data
-0001aac0: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
-0001aad0: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
-0001aae0: 6965 6c64 7328 6461 7461 2c63 6f6e 7465  ields(data,conte
-0001aaf0: 6e74 3262 6552 656d 6f76 6564 3d4e 6f6e  nt2beRemoved=Non
-0001ab00: 6529 0a0a 2020 2020 2020 2020 2320 706f  e)..        # po
-0001ab10: 7465 6e74 6169 6c6c 7920 7265 6d6f 7665  tentailly remove
-0001ab20: 2063 6f6e 7374 2064 6174 6120 6672 6f6d   const data from
-0001ab30: 2069 7465 6d73 2061 6e64 2070 7574 2069   items and put i
-0001ab40: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
-0001ab50: 2073 656c 662e 6578 7472 6163 7443 6f6e   self.extractCon
-0001ab60: 7374 4461 7461 5661 6c75 6573 2864 6174  stDataValues(dat
-0001ab70: 612c 6865 6164 6572 290a 0a20 2020 2020  a,header)..     
-0001ab80: 2020 2023 2061 6464 2027 696d 6167 652d     # add 'image-
-0001ab90: 6669 6c65 6e61 6d65 2720 6669 656c 640a  filename' field.
-0001aba0: 2020 2020 2020 2020 666f 7220 696d 672c          for img,
-0001abb0: 2065 6e74 7279 2069 6e20 6461 7461 2e69   entry in data.i
-0001abc0: 7465 6d73 2829 3a0a 0a20 2020 2020 2020  tems():..       
-0001abd0: 2020 2020 2023 206c 6973 740a 2020 2020       # list.    
-0001abe0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0001abf0: 7461 6e63 6528 656e 7472 792c 6c69 7374  tance(entry,list
-0001ac00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001ac10: 2020 2066 6f72 206c 6973 7449 7465 6d20     for listItem 
-0001ac20: 696e 2065 6e74 7279 3a0a 2020 2020 2020  in entry:.      
-0001ac30: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0001ac40: 7374 4974 656d 5b27 696d 6167 652d 6669  stItem['image-fi
-0001ac50: 6c65 6e61 6d65 275d 203d 2069 6d67 0a20  lename'] = img. 
-0001ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac70: 2020 2023 2063 6f76 6572 7420 6461 7465     # covert date
-0001ac80: 7469 6d65 2073 7472 696e 670a 2020 2020  time string.    
-0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aca0: 6966 2027 696d 6167 652d 6461 7465 7469  if 'image-dateti
-0001acb0: 6d65 2720 696e 206c 6973 7449 7465 6d3a  me' in listItem:
-0001acc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001acd0: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
-0001ace0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-0001acf0: 7374 7270 7469 6d65 286c 6973 7449 7465  strptime(listIte
-0001ad00: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
-0001ad10: 6527 5d2c 2064 6174 6574 696d 655f 666f  e'], datetime_fo
-0001ad20: 726d 6174 290a 2020 2020 2020 2020 2020  rmat).          
-0001ad30: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-0001ad40: 7374 4974 656d 5b27 696d 6167 652d 6461  stItem['image-da
-0001ad50: 7465 7469 6d65 275d 203d 2064 742e 7374  tetime'] = dt.st
-0001ad60: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
-0001ad70: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-0001ad80: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
-0001ad90: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0001ada0: 2865 6e74 7279 2c64 6963 7429 3a0a 2020  (entry,dict):.  
-0001adb0: 2020 2020 2020 2020 2020 2020 2020 656e                en
-0001adc0: 7472 795b 2769 6d61 6765 2d66 696c 656e  try['image-filen
-0001add0: 616d 6527 5d20 3d20 696d 670a 2020 2020  ame'] = img.    
-0001ade0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-0001adf0: 7665 7274 2064 6174 6574 696d 6520 7374  vert datetime st
-0001ae00: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-0001ae10: 2020 2020 2069 6620 2769 6d61 6765 2d64       if 'image-d
-0001ae20: 6174 6574 696d 6527 2069 6e20 656e 7472  atetime' in entr
-0001ae30: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0001ae40: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
-0001ae50: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
-0001ae60: 7270 7469 6d65 2865 6e74 7279 5b27 696d  rptime(entry['im
-0001ae70: 6167 652d 6461 7465 7469 6d65 275d 2c20  age-datetime'], 
-0001ae80: 6461 7465 7469 6d65 5f66 6f72 6d61 7429  datetime_format)
-0001ae90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aea0: 2020 2020 2065 6e74 7279 5b27 696d 6167       entry['imag
-0001aeb0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
-0001aec0: 742e 7374 7266 7469 6d65 286d 6971 7476  t.strftime(miqtv
-0001aed0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-0001aee0: 6172 6971 7427 5d29 0a20 2020 2020 2020  ariqt']).       
-0001aef0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001af00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001af10: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
-0001af20: 7469 6f6e 2822 6461 7461 2065 6e74 7269  tion("data entri
-0001af30: 6573 206d 7573 7420 6265 2064 6963 7420  es must be dict 
-0001af40: 6f72 206c 6973 7420 6966 2064 6963 7473  or list if dicts
-0001af50: 2229 0a0a 2020 2020 2020 2020 6d69 7174  ")..        miqt
-0001af60: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
-0001af70: 6174 6544 6963 7473 2869 7465 6d73 2c64  ateDicts(items,d
-0001af80: 6174 6129 0a0a 0a20 2020 2040 7374 6174  ata)...    @stat
-0001af90: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-0001afa0: 2065 7874 7261 6374 436f 6e73 7444 6174   extractConstDat
-0001afb0: 6156 616c 7565 7328 6461 7461 3a64 6963  aValues(data:dic
-0001afc0: 742c 6865 6164 6572 3a64 6963 7429 3a0a  t,header:dict):.
-0001afd0: 2020 2020 2020 2020 2222 2220 5265 6d6f          """ Remo
-0001afe0: 7665 7320 6669 656c 6473 2074 6861 7420  ves fields that 
-0001aff0: 6172 6520 636f 6e73 7461 6e74 2066 6f72  are constant for
-0001b000: 2061 6c6c 2065 6e74 7269 6573 2066 726f   all entries fro
-0001b010: 6d20 6461 7461 2064 6963 7420 616e 6420  m data dict and 
-0001b020: 7075 7420 7468 656d 2069 6e20 6865 6164  put them in head
-0001b030: 6572 2064 6963 742e 200a 2020 2020 2020  er dict. .      
-0001b040: 2020 2020 2020 4561 6368 2065 6e74 7279        Each entry
-0001b050: 206f 6620 6461 7461 206d 7573 7420 6265   of data must be
-0001b060: 2061 2064 6963 7420 7769 7468 2074 6865   a dict with the
-0001b070: 2073 616d 6520 7365 7420 6f66 206b 6579   same set of key
-0001b080: 732e 2022 2222 0a20 2020 200a 2020 2020  s. """.    .    
-0001b090: 2020 2020 6669 656c 6473 546f 4967 6e6f      fieldsToIgno
-0001b0a0: 7265 203d 205b 2769 6d61 6765 2d64 6174  re = ['image-dat
-0001b0b0: 6574 696d 6527 5d0a 2020 2020 2020 2020  etime'].        
-0001b0c0: 636f 6e73 7444 6174 6120 3d20 7b7d 0a20  constData = {}. 
-0001b0d0: 2020 2020 2020 2066 6972 7374 496d 6167         firstImag
-0001b0e0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
-0001b0f0: 2066 6f72 2069 6d61 6765 2c69 6d61 6765   for image,image
-0001b100: 5f64 6174 6120 696e 2064 6174 612e 6974  _data in data.it
-0001b110: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0001b120: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0001b130: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0001b140: 6528 696d 6167 655f 6461 7461 2c6c 6973  e(image_data,lis
-0001b150: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0001b160: 2020 2020 696d 6167 655f 6461 7461 203d      image_data =
-0001b170: 205b 696d 6167 655f 6461 7461 5d0a 0a20   [image_data].. 
-0001b180: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001b190: 7420 6669 7273 7449 6d61 6765 2061 6e64  t firstImage and
-0001b1a0: 2063 6f6e 7374 4461 7461 203d 3d20 7b7d   constData == {}
-0001b1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b1c0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-0001b1d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
-0001b1e0: 2066 6972 7374 5469 6d65 506f 696e 7420   firstTimePoint 
-0001b1f0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
-0001b200: 2020 2066 6f72 2069 6d61 6765 5f74 705f     for image_tp_
-0001b210: 6461 7461 2069 6e20 696d 6167 655f 6461  data in image_da
-0001b220: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0001b230: 2020 2020 2320 7665 7279 2066 6972 7374      # very first
-0001b240: 2064 6174 6120 666f 7220 636f 6d70 6172   data for compar
-0001b250: 6973 6f6e 0a20 2020 2020 2020 2020 2020  ison.           
-0001b260: 2020 2020 2069 6620 6669 7273 7449 6d61       if firstIma
-0001b270: 6765 2061 6e64 2066 6972 7374 5469 6d65  ge and firstTime
-0001b280: 506f 696e 743a 0a20 2020 2020 2020 2020  Point:.         
-0001b290: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
-0001b2a0: 4461 7461 203d 2063 6f70 792e 6465 6570  Data = copy.deep
-0001b2b0: 636f 7079 2869 6d61 6765 5f74 705f 6461  copy(image_tp_da
-0001b2c0: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
-0001b2d0: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
-0001b2e0: 6420 696e 2066 6965 6c64 7354 6f49 676e  d in fieldsToIgn
-0001b2f0: 6f72 653a 0a20 2020 2020 2020 2020 2020  ore:.           
-0001b300: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b310: 6669 656c 6420 696e 2063 6f6e 7374 4461  field in constDa
-0001b320: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0001b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b340: 6465 6c20 636f 6e73 7444 6174 615b 6669  del constData[fi
-0001b350: 656c 645d 0a20 2020 2020 2020 2020 2020  eld].           
-0001b360: 2020 2020 2020 2020 2066 6972 7374 5469           firstTi
-0001b370: 6d65 506f 696e 7420 3d20 4661 6c73 650a  mePoint = False.
-0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b390: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-0001b3a0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001b3b0: 6e73 7444 6174 6120 3d20 6d69 7174 632e  nstData = miqtc.
-0001b3c0: 6669 6e64 436f 6d6d 6f6e 4469 6374 456c  findCommonDictEl
-0001b3d0: 656d 656e 7473 2869 6d61 6765 5f74 705f  ements(image_tp_
-0001b3e0: 6461 7461 2c63 6f6e 7374 4461 7461 290a  data,constData).
-0001b3f0: 0a20 2020 2020 2020 2020 2020 2066 6972  .            fir
-0001b400: 7374 496d 6167 6520 3d20 4661 6c73 650a  stImage = False.
-0001b410: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
-0001b420: 6368 6563 6b20 7769 7468 696e 2069 6d61  check within ima
-0001b430: 6765 2074 696d 6573 202d 3e20 746f 2069  ge times -> to i
-0001b440: 6d61 6765 2064 6566 6175 6c74 2e20 2874  mage default. (t
-0001b450: 7269 636b 7920 7369 6e63 6520 7765 2064  ricky since we d
-0001b460: 6f6e 2774 2068 6176 6520 7468 6520 6461  on't have the da
-0001b470: 6661 756c 7420 696e 6465 7820 6865 7265  fault index here
-0001b480: 2e20 4f6e 6c79 2061 2073 7562 7365 7420  . Only a subset 
-0001b490: 6d69 6768 7420 6265 2075 7064 6174 6520  might be update 
-0001b4a0: 6865 7265 290a 2020 2020 2020 2020 2320  here).        # 
-0001b4b0: 6368 6563 6b20 7769 7468 696e 2069 6d61  check within ima
-0001b4c0: 6765 2069 7465 6d73 202d 3e20 6865 6164  ge items -> head
-0001b4d0: 6572 0a20 2020 2020 2020 2068 6561 6465  er.        heade
-0001b4e0: 7255 7064 6174 6520 3d20 636f 7079 2e64  rUpdate = copy.d
-0001b4f0: 6565 7063 6f70 7928 636f 6e73 7444 6174  eepcopy(constDat
-0001b500: 6129 0a20 2020 2020 2020 2068 6561 6465  a).        heade
-0001b510: 7255 7064 6174 6564 5465 7374 203d 2063  rUpdatedTest = c
-0001b520: 6f70 792e 6465 6570 636f 7079 2868 6561  opy.deepcopy(hea
-0001b530: 6465 7229 0a20 2020 2020 2020 206d 6971  der).        miq
-0001b540: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
-0001b550: 6461 7465 4469 6374 7328 6865 6164 6572  dateDicts(header
-0001b560: 5570 6461 7465 6454 6573 742c 6865 6164  UpdatedTest,head
-0001b570: 6572 5570 6461 7465 290a 2020 2020 2020  erUpdate).      
-0001b580: 2020 7570 6461 7465 4469 6666 203d 2044    updateDiff = D
-0001b590: 6565 7044 6966 6628 6865 6164 6572 2c68  eepDiff(header,h
-0001b5a0: 6561 6465 7255 7064 6174 6564 5465 7374  eaderUpdatedTest
-0001b5b0: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
-0001b5c0: 6b20 6966 2068 6561 6465 7255 7064 6174  k if headerUpdat
-0001b5d0: 6520 776f 756c 6420 6f76 6572 7772 6974  e would overwrit
-0001b5e0: 6520 616e 7974 6869 6e67 2066 726f 6d20  e anything from 
-0001b5f0: 6375 7272 656e 7420 6865 6164 6572 2028  current header (
-0001b600: 7368 6f75 6c64 206e 6f74 2068 6170 7065  should not happe
-0001b610: 6e29 2c20 6966 2073 6f20 646f 6e74 2072  n), if so dont r
-0001b620: 656d 6f76 6520 6672 6f6d 2069 7465 6d73  emove from items
-0001b630: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0001b640: 2776 616c 7565 735f 6368 616e 6765 6427  'values_changed'
-0001b650: 2069 6e20 7570 6461 7465 4469 6666 2061   in updateDiff a
-0001b660: 6e64 206e 6f74 2027 7479 7065 5f63 6861  nd not 'type_cha
-0001b670: 6e67 6573 2720 696e 2075 7064 6174 6544  nges' in updateD
-0001b680: 6966 6620 616e 6420 6e6f 7420 2764 6963  iff and not 'dic
-0001b690: 7469 6f6e 6172 795f 6974 656d 5f72 656d  tionary_item_rem
-0001b6a0: 6f76 6564 2720 696e 2075 7064 6174 6544  oved' in updateD
-0001b6b0: 6966 663a 0a20 2020 2020 2020 2020 2020  iff:.           
-0001b6c0: 2068 6561 6465 722e 636c 6561 7228 290a   header.clear().
-0001b6d0: 2020 2020 2020 2020 2020 2020 6865 6164              head
-0001b6e0: 6572 2e75 7064 6174 6528 6865 6164 6572  er.update(header
-0001b6f0: 5570 6461 7465 6454 6573 7429 0a0a 2020  UpdatedTest)..  
-0001b700: 2020 2020 2020 2020 2020 2320 7265 6d6f            # remo
-0001b710: 7665 2063 6f6e 7374 2076 616c 7565 7320  ve const values 
-0001b720: 6672 6f6d 2064 6174 610a 2020 2020 2020  from data.      
-0001b730: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
-0001b740: 7273 6976 654d 616b 654e 6f6e 6544 6963  rsiveMakeNoneDic
-0001b750: 7446 6965 6c64 7345 6d70 7479 5374 7228  tFieldsEmptyStr(
-0001b760: 636f 6e73 7444 6174 6129 0a20 2020 2020  constData).     
-0001b770: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
-0001b780: 2c69 6d61 6765 5f64 6174 6120 696e 2064  ,image_data in d
-0001b790: 6174 612e 6974 656d 7328 293a 0a20 2020  ata.items():.   
-0001b7a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001b7b0: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
-0001b7c0: 6d61 6765 5f64 6174 612c 6c69 7374 293a  mage_data,list):
-0001b7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b7e0: 2020 2020 2069 6d61 6765 5f64 6174 6120       image_data 
-0001b7f0: 3d20 5b69 6d61 6765 5f64 6174 615d 0a20  = [image_data]. 
-0001b800: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001b810: 6f72 2069 6d61 6765 5f74 705f 6461 7461  or image_tp_data
-0001b820: 2069 6e20 696d 6167 655f 6461 7461 3a0a   in image_data:.
-0001b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b840: 2020 2020 6d69 7174 632e 7265 6375 7273      miqtc.recurs
-0001b850: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
-0001b860: 2869 6d61 6765 5f74 705f 6461 7461 2c63  (image_tp_data,c
-0001b870: 6f6e 7374 4461 7461 2920 2020 2020 2020  onstData)       
-0001b880: 2020 200a 0a20 2020 2020 2020 2065 6c73     ..        els
-0001b890: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
-0001b8a0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-0001b8b0: 2320 544f 444f 206c 6f67 3f0a 2020 2020  # TODO log?.    
-0001b8c0: 200a 0a20 2020 2064 6566 2069 6e74 6572   ..    def inter
-0001b8d0: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
-0001b8e0: 6973 7473 2873 656c 6629 3a0a 2020 2020  ists(self):.    
-0001b8f0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-0001b900: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
-0001b910: 6e74 5f6e 6176 5f66 696c 6528 2929 3a0a  nt_nav_file()):.
-0001b920: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001b930: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
-0001b940: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001b950: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0001b960: 0a20 2020 2064 6566 2068 6561 6465 7246  .    def headerF
-0001b970: 6965 6c64 4669 6c6c 6564 2873 656c 662c  ieldFilled(self,
-0001b980: 6669 656c 643a 7374 7229 3a0a 2020 2020  field:str):.    
-0001b990: 2020 2020 6966 2073 656c 662e 6669 6e64      if self.find
-0001b9a0: 546d 7046 6965 6c64 3228 6669 656c 6429  TmpField2(field)
-0001b9b0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-0001b9c0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001b9d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001b9e0: 5472 7565 0a0a 2020 2020 6465 6620 636f  True..    def co
-0001b9f0: 6e76 6572 7454 6f44 6566 6175 6c74 4461  nvertToDefaultDa
-0001ba00: 7465 5469 6d65 466f 726d 6174 2873 656c  teTimeFormat(sel
-0001ba10: 662c 6966 646f 293a 0a20 2020 2020 2020  f,ifdo):.       
-0001ba20: 2022 2222 2043 6865 636b 7320 6966 2061   """ Checks if a
-0001ba30: 6c6c 2069 7465 6d73 2720 2769 6d61 6765  ll items' 'image
-0001ba40: 2d64 6174 6574 696d 6527 2066 6965 6c64  -datetime' field
-0001ba50: 7320 6d61 7463 6820 6465 6661 756c 7420  s match default 
-0001ba60: 6461 7465 7469 6d65 2066 6f72 6d61 7420  datetime format 
-0001ba70: 6f72 2061 2063 7573 746f 6d20 6f6e 6520  or a custom one 
-0001ba80: 6465 6669 6e65 6420 696e 2027 696d 6167  defined in 'imag
-0001ba90: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
-0001baa0: 7427 0a20 2020 2020 2020 2020 2020 2061  t'.            a
-0001bab0: 6e64 2063 6f6e 7665 7274 7320 746f 2064  nd converts to d
-0001bac0: 6566 6175 6c74 2066 6f72 6d61 742e 2054  efault format. T
-0001bad0: 6872 6f77 7320 6578 6365 7074 696f 6e20  hrows exception 
-0001bae0: 6966 2064 6174 6574 696d 6520 6361 6e6e  if datetime cann
-0001baf0: 6f74 2062 6520 7061 7273 6564 2022 2222  ot be parsed """
-0001bb00: 0a20 2020 2020 2020 2063 7573 746f 6d44  .        customD
-0001bb10: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
-0001bb20: 6e64 203d 2046 616c 7365 0a20 2020 2020  nd = False.     
-0001bb30: 2020 2068 6561 6465 7243 7573 746f 6d44     headerCustomD
-0001bb40: 6174 6554 696d 6546 6f72 6d61 7420 3d20  ateTimeFormat = 
-0001bb50: 6669 6e64 4669 656c 6428 6966 646f 5b73  findField(ifdo[s
-0001bb60: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0001bb70: 6572 4b65 795d 2c27 696d 6167 652d 6461  erKey],'image-da
-0001bb80: 7465 7469 6d65 2d66 6f72 6d61 7427 290a  tetime-format').
-0001bb90: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
-0001bba0: 7243 7573 746f 6d44 6174 6554 696d 6546  rCustomDateTimeF
-0001bbb0: 6f72 6d61 7420 213d 2022 223a 0a20 2020  ormat != "":.   
-0001bbc0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
-0001bbd0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0001bbe0: 724b 6579 5d5b 2769 6d61 6765 2d64 6174  rKey]['image-dat
-0001bbf0: 6574 696d 652d 666f 726d 6174 275d 203d  etime-format'] =
-0001bc00: 2022 2220 2320 7265 6d6f 7665 2063 7573   "" # remove cus
-0001bc10: 746f 6d20 666f 726d 6174 0a20 2020 2020  tom format.     
-0001bc20: 2020 2020 2020 2063 7573 746f 6d44 6174         customDat
-0001bc30: 6554 696d 6546 6f72 6d61 7446 6f75 6e64  eTimeFormatFound
-0001bc40: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
-0001bc50: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
-0001bc60: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
-0001bc70: 7367 2822 4368 6563 6b69 6e67 2064 6174  sg("Checking dat
-0001bc80: 6574 696d 6520 666f 726d 6174 222c 206c  etime format", l
-0001bc90: 656e 2869 6664 6f5b 7365 6c66 2e69 6d61  en(ifdo[self.ima
-0001bca0: 6765 5365 7449 7465 6d73 4b65 795d 292c  geSetItemsKey]),
-0001bcb0: 6d6f 6475 6c6f 3d31 290a 2020 2020 2020  modulo=1).      
-0001bcc0: 2020 666f 7220 6669 6c65 2c69 7465 6d20    for file,item 
-0001bcd0: 696e 2069 6664 6f5b 7365 6c66 2e69 6d61  in ifdo[self.ima
-0001bce0: 6765 5365 7449 7465 6d73 4b65 795d 2e69  geSetItemsKey].i
-0001bcf0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001bd00: 2020 2020 7072 6f67 2e70 726f 6772 6573      prog.progres
-0001bd10: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-0001bd20: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0001bd30: 6528 6974 656d 2c6c 6973 7429 3a0a 2020  e(item,list):.  
-0001bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd50: 2020 6974 656d 203d 205b 6974 656d 5d0a    item = [item].
-0001bd60: 2020 2020 2020 2020 2020 2020 7375 6249              subI
-0001bd70: 7465 6d44 6566 6175 6c74 203d 2069 7465  temDefault = ite
-0001bd80: 6d5b 305d 0a20 2020 2020 2020 2020 2020  m[0].           
-0001bd90: 2069 7465 6d43 7573 746f 6d44 6174 6554   itemCustomDateT
-0001bda0: 696d 6546 6f72 6d61 7420 3d20 2222 0a20  imeFormat = "". 
-0001bdb0: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
-0001bdc0: 6d61 6765 2d64 6174 6574 696d 652d 666f  mage-datetime-fo
-0001bdd0: 726d 6174 2720 696e 2073 7562 4974 656d  rmat' in subItem
-0001bde0: 4465 6661 756c 743a 0a20 2020 2020 2020  Default:.       
-0001bdf0: 2020 2020 2020 2020 2069 7465 6d43 7573           itemCus
-0001be00: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
-0001be10: 7420 3d20 7375 6249 7465 6d44 6566 6175  t = subItemDefau
-0001be20: 6c74 5b27 696d 6167 652d 6461 7465 7469  lt['image-dateti
-0001be30: 6d65 2d66 6f72 6d61 7427 5d0a 2020 2020  me-format'].    
-0001be40: 2020 2020 2020 2020 2020 2020 7375 6249              subI
-0001be50: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
-0001be60: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
-0001be70: 7427 5d20 3d20 2222 2023 2072 656d 6f76  t'] = "" # remov
-0001be80: 6520 6375 7374 6f6d 2066 6f72 6d61 740a  e custom format.
-0001be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bea0: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
-0001beb0: 726d 6174 466f 756e 6420 3d20 5472 7565  rmatFound = True
-0001bec0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001bed0: 2073 7562 4974 656d 2069 6e20 6974 656d   subItem in item
-0001bee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001bef0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001bf00: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
-0001bf10: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
-0001bf20: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0001bf30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bf40: 2020 2020 2064 6174 6574 696d 652e 6461       datetime.da
-0001bf50: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
-0001bf60: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
-0001bf70: 6174 6574 696d 6527 5d2c 666f 726d 6174  atetime'],format
-0001bf80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001bf90: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
-0001bfa0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0001bfb0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0001bfc0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
-0001bfd0: 7420 3d20 6865 6164 6572 4375 7374 6f6d  t = headerCustom
-0001bfe0: 4461 7465 5469 6d65 466f 726d 6174 0a20  DateTimeFormat. 
-0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c000: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
-0001c010: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
-0001c020: 7270 7469 6d65 2873 7562 4974 656d 5b27  rptime(subItem['
-0001c030: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-0001c040: 2c66 6f72 6d61 7429 0a20 2020 2020 2020  ,format).       
-0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c060: 2073 7562 4974 656d 5b27 696d 6167 652d   subItem['image-
-0001c070: 6461 7465 7469 6d65 275d 203d 2064 6174  datetime'] = dat
-0001c080: 6574 696d 652e 6461 7465 7469 6d65 2e73  etime.datetime.s
-0001c090: 7472 6674 696d 6528 6474 2c6d 6971 7476  trftime(dt,miqtv
-0001c0a0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-0001c0b0: 6172 6971 7427 5d29 0a20 2020 2020 2020  ariqt']).       
-0001c0c0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0001c0d0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-0001c0e0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0001c0f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c100: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001c110: 726d 6174 203d 2069 7465 6d43 7573 746f  rmat = itemCusto
-0001c120: 6d44 6174 6554 696d 6546 6f72 6d61 740a  mDateTimeFormat.
-0001c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c140: 2020 2020 2020 2020 2020 2020 6474 203d              dt =
-0001c150: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
-0001c160: 6d65 2e73 7472 7074 696d 6528 7375 6249  me.strptime(subI
-0001c170: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
-0001c180: 696d 6527 5d2c 666f 726d 6174 290a 2020  ime'],format).  
-0001c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1a0: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
-0001c1b0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
-0001c1c0: 6527 5d20 3d20 6461 7465 7469 6d65 2e64  e'] = datetime.d
-0001c1d0: 6174 6574 696d 652e 7374 7266 7469 6d65  atetime.strftime
-0001c1e0: 2864 742c 6d69 7174 762e 6461 7465 5f66  (dt,miqtv.date_f
-0001c1f0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0001c200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c210: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0001c220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001c230: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001c240: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
-0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c260: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
-0001c270: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
-0001c280: 2827 496e 7661 6c69 6420 6461 7465 7469  ('Invalid dateti
-0001c290: 6d65 2076 616c 7565 272c 7375 6249 7465  me value',subIte
-0001c2a0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
-0001c2b0: 6527 5d2c 2022 646f 6573 206e 6f74 206d  e'], "does not m
-0001c2c0: 6174 6368 2066 6f72 6d61 7420 6465 6661  atch format defa
-0001c2d0: 756c 7420 6f72 2063 7573 746f 6d20 666f  ult or custom fo
-0001c2e0: 726d 6174 2229 0a20 2020 2020 2020 2069  rmat").        i
-0001c2f0: 6620 6375 7374 6f6d 4461 7465 5469 6d65  f customDateTime
-0001c300: 466f 726d 6174 466f 756e 643a 0a20 2020  FormatFound:.   
-0001c310: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
-0001c320: 6f76 2e6c 6f67 2822 4375 7374 6f6d 2064  ov.log("Custom d
-0001c330: 6174 6574 696d 6520 666f 726d 6174 7320  atetime formats 
-0001c340: 666f 756e 642e 2054 6865 7920 7769 6c6c  found. They will
-0001c350: 2062 6520 7265 706c 6163 6564 2062 7920   be replaced by 
-0001c360: 7468 6520 6465 6661 756c 7420 666f 726d  the default form
-0001c370: 6174 2e22 2920 2020 0a20 2020 2020 2020  at.")   .       
-0001c380: 2070 726f 672e 636c 6561 7228 2920 2020   prog.clear()   
-0001c390: 200a 0a0a 2020 2020 6465 6620 5f5f 696e   ...    def __in
-0001c3a0: 6974 496e 7465 726d 6564 6961 7465 4669  itIntermediateFi
-0001c3b0: 6c65 7328 7365 6c66 293a 0a20 2020 2020  les(self):.     
-0001c3c0: 2020 2073 656c 662e 696e 7465 726d 6564     self.intermed
-0001c3d0: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
-0001c3e0: 6520 3d20 7b0a 2020 2020 2020 2020 2020  e = {.          
-0001c3f0: 2020 2768 6173 6865 7327 3a20 7b0a 2020    'hashes': {.  
-0001c400: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0001c410: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
-0001c420: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
-0001c430: 365f 6669 6c65 2829 272c 0a20 2020 2020  6_file()',.     
-0001c440: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
-0001c450: 6978 273a 2027 5f69 6d61 6765 2d68 6173  ix': '_image-has
-0001c460: 6865 732e 7478 7427 2c0a 2020 2020 2020  hes.txt',.      
-0001c470: 2020 2020 2020 2020 2020 2763 6f6c 7327            'cols'
-0001c480: 3a20 5b6d 6971 7476 2e63 6f6c 5f68 6561  : [miqtv.col_hea
-0001c490: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
-0001c4a0: 6173 6827 5d5d 2c0a 2020 2020 2020 2020  ash']],.        
-0001c4b0: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
-0001c4c0: 6c27 3a20 5b5d 7d2c 0a20 2020 2020 2020  l': []},.       
-0001c4d0: 2020 2020 2027 7575 6964 7327 3a20 7b0a       'uuids': {.
-0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4f0: 2763 7265 6174 696f 6e46 6374 273a 2027  'creationFct': '
-0001c500: 6372 6561 7465 5f75 7569 645f 6669 6c65  create_uuid_file
-0001c510: 2829 272c 0a20 2020 2020 2020 2020 2020  ()',.           
-0001c520: 2020 2020 2027 7375 6666 6978 273a 2027       'suffix': '
-0001c530: 5f69 6d61 6765 2d75 7569 6473 2e74 7874  _image-uuids.txt
-0001c540: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0001c550: 2020 2027 636f 6c73 273a 205b 6d69 7174     'cols': [miqt
-0001c560: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001c570: 7269 7174 275d 5b27 7575 6964 275d 5d2c  riqt']['uuid']],
-0001c580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c590: 2027 6f70 7469 6f6e 616c 273a 205b 5d7d   'optional': []}
-0001c5a0: 2c0a 2020 2020 2020 2020 2020 2020 2764  ,.            'd
-0001c5b0: 6174 6574 696d 6527 3a20 7b0a 2020 2020  atetime': {.    
-0001c5c0: 2020 2020 2020 2020 2020 2020 2763 7265              'cre
-0001c5d0: 6174 696f 6e46 6374 273a 2027 6372 6561  ationFct': 'crea
-0001c5e0: 7465 5f73 7461 7274 5f74 696d 655f 6669  te_start_time_fi
-0001c5f0: 6c65 2829 272c 0a20 2020 2020 2020 2020  le()',.         
-0001c600: 2020 2020 2020 2027 7375 6666 6978 273a         'suffix':
-0001c610: 2027 5f69 6d61 6765 2d73 7461 7274 2d74   '_image-start-t
-0001c620: 696d 6573 2e74 7874 272c 0a20 2020 2020  imes.txt',.     
-0001c630: 2020 2020 2020 2020 2020 2027 636f 6c73             'cols
-0001c640: 273a 205b 6d69 7174 762e 636f 6c5f 6865  ': [miqtv.col_he
-0001c650: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-0001c660: 7574 6327 5d5d 2c0a 2020 2020 2020 2020  utc']],.        
-0001c670: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
-0001c680: 6c27 3a20 5b5d 7d2c 0a20 2020 2020 2020  l': []},.       
-0001c690: 2020 2020 2027 6e61 7669 6761 7469 6f6e       'navigation
-0001c6a0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-0001c6b0: 2020 2020 2027 6372 6561 7469 6f6e 4663       'creationFc
-0001c6c0: 7427 3a20 2763 7265 6174 655f 696d 6167  t': 'create_imag
-0001c6d0: 655f 6e61 7669 6761 7469 6f6e 5f66 696c  e_navigation_fil
-0001c6e0: 6528 2927 2c0a 2020 2020 2020 2020 2020  e()',.          
-0001c6f0: 2020 2020 2020 2773 7566 6669 7827 3a20        'suffix': 
-0001c700: 275f 696d 6167 652d 6e61 7669 6761 7469  '_image-navigati
-0001c710: 6f6e 2e74 7874 272c 0a20 2020 2020 2020  on.txt',.       
-0001c720: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
-0001c730: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
-0001c740: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
-0001c750: 6327 5d5d 2c0a 2020 2020 2020 2020 2020  c']],.          
-0001c760: 2020 2020 2020 276f 7074 696f 6e61 6c27        'optional'
-0001c770: 3a20 5b6d 6971 7476 2e63 6f6c 5f68 6561  : [miqtv.col_hea
-0001c780: 6465 725b 276d 6172 6971 7427 5d5b 276c  der['mariqt']['l
-0001c790: 6f6e 275d 2c20 6d69 7174 762e 636f 6c5f  on'], miqtv.col_
-0001c7a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001c7b0: 5b27 6c61 7427 5d2c 206d 6971 7476 2e63  ['lat'], miqtv.c
-0001c7c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-0001c7d0: 7427 5d5b 2761 6c74 275d 2c20 6d69 7174  t']['alt'], miqt
-0001c7e0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001c7f0: 7269 7174 275d 5b27 6867 7427 5d2c 206d  riqt']['hgt'], m
+00019470: 2020 2020 6c69 6e65 7320 3d20 7265 732e      lines = res.
+00019480: 7265 6164 6c69 6e65 7328 290a 2020 2020  readlines().    
+00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194a0: 2020 2020 7265 732e 636c 6f73 6528 290a      res.close().
+000194b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194c0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000194d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000194e0: 2020 6c69 6e65 7320 3d20 5b5d 0a20 2020    lines = [].   
+000194f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019500: 2069 203d 2030 0a20 2020 2020 2020 2020   i = 0.         
+00019510: 2020 2020 2020 2020 2020 206c 696e 654e             lineN
+00019520: 7220 3d20 690a 2020 2020 2020 2020 2020  r = i.          
+00019530: 2020 2020 2020 2020 2020 666f 7220 6c69            for li
+00019540: 6e65 2069 6e20 6c69 6e65 733a 0a20 2020  ne in lines:.   
+00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019560: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+00019570: 6261 7365 6e61 6d65 2866 696c 6529 2069  basename(file) i
+00019580: 6e20 6c69 6e65 3a0a 2020 2020 2020 2020  n line:.        
+00019590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195a0: 2020 2020 6c69 6e65 4e72 203d 2069 0a20      lineNr = i. 
+000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000195d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000195e0: 2020 2020 2020 2020 2069 202b 3d20 310a           i += 1.
+000195f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019600: 2020 2020 6966 206c 696e 654e 7220 213d      if lineNr !=
+00019610: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00019620: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
+00019630: 6c69 6e65 735b 6c69 6e65 4e72 5d0a 2020  lines[lineNr].  
+00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019650: 2020 2020 2020 7265 7320 3d20 6f70 656e        res = open
+00019660: 2873 656c 662e 6765 745f 696e 745f 7575  (self.get_int_uu
+00019670: 6964 5f66 696c 6528 292c 2022 7722 290a  id_file(), "w").
+00019680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019690: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+000196a0: 656c 696e 6573 286c 696e 6573 290a 2020  elines(lines).  
+000196b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196c0: 2020 2020 2020 7265 732e 636c 6f73 6528        res.close(
+000196d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000196e0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+000196f0: 7074 696f 6e28 2022 4669 6c65 2022 202b  ption( "File " +
+00019700: 2066 696c 6520 2b20 2220 646f 6573 206e   file + " does n
+00019710: 6f74 2063 6f74 6169 6e20 6120 7661 6c69  ot cotain a vali
+00019720: 6420 5555 4944 2e20 5275 6e20 6372 6561  d UUID. Run crea
+00019730: 7465 5f75 7569 645f 6669 6c65 2829 2066  te_uuid_file() f
+00019740: 6972 7374 2122 290a 0a20 2020 2020 2020  irst!")..       
+00019750: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
+00019760: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
+00019770: 656e 616d 6528 6669 6c65 290a 2020 2020  ename(file).    
+00019780: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00019790: 6f74 2072 6552 6561 6441 6c6c 2061 6e64  ot reReadAll and
+000197a0: 2066 696c 655f 6e61 6d65 2069 6e20 6861   file_name in ha
+000197b0: 7368 6573 3a0a 2020 2020 2020 2020 2020  shes:.          
+000197c0: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
+000197d0: 5b66 696c 655f 6e61 6d65 5d20 3d20 6861  [file_name] = ha
+000197e0: 7368 6573 5b66 696c 655f 6e61 6d65 5d5b  shes[file_name][
+000197f0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00019800: 5b27 6d61 7269 7174 275d 5b27 6861 7368  ['mariqt']['hash
+00019810: 275d 5d0a 2020 2020 2020 2020 2020 2020  ']].            
+00019820: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019830: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+00019840: 7368 6573 5b66 696c 655f 6e61 6d65 5d20  shes[file_name] 
+00019850: 3d20 6d69 7174 632e 7368 6132 3536 4861  = miqtc.sha256Ha
+00019860: 7368 4669 6c65 2866 696c 6529 0a20 2020  shFile(file).   
+00019870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019880: 2061 6464 6564 5f68 6173 6865 7320 2b3d   added_hashes +=
+00019890: 2031 0a20 2020 2020 2020 2020 2020 2070   1.            p
+000198a0: 726f 672e 636c 6561 7228 290a 0a20 2020  rog.clear()..   
+000198b0: 2020 2020 2020 2020 2069 6620 7265 5265           if reRe
+000198c0: 6164 416c 6c20 6f72 2061 6464 6564 5f68  adAll or added_h
+000198d0: 6173 6865 7320 3e20 303a 0a20 2020 2020  ashes > 0:.     
+000198e0: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+000198f0: 6669 6c65 203d 206f 7065 6e28 7365 6c66  file = open(self
+00019900: 2e67 6574 5f69 6e74 5f68 6173 685f 6669  .get_int_hash_fi
+00019910: 6c65 2829 2c20 2277 2229 0a20 2020 2020  le(), "w").     
+00019920: 2020 2020 2020 2020 2020 2068 6173 685f             hash_
+00019930: 6669 6c65 2e77 7269 7465 2820 6d69 7174  file.write( miqt
+00019940: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00019950: 7269 7174 275d 5b27 696d 6727 5d2b 225c  riqt']['img']+"\
+00019960: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+00019970: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
+00019980: 6173 6827 5d2b 225c 6e22 290a 2020 2020  ash']+"\n").    
+00019990: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000199a0: 6669 6c65 5f6e 616d 6520 696e 2068 6173  file_name in has
+000199b0: 6865 733a 0a20 2020 2020 2020 2020 2020  hes:.           
+000199c0: 2020 2020 2020 2020 2068 6173 685f 6669           hash_fi
+000199d0: 6c65 2e77 7269 7465 2866 696c 655f 6e61  le.write(file_na
+000199e0: 6d65 2b22 5c74 222b 6861 7368 6573 5b66  me+"\t"+hashes[f
+000199f0: 696c 655f 6e61 6d65 5d2b 225c 6e22 290a  ile_name]+"\n").
+00019a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019a10: 2068 6173 685f 6669 6c65 2e63 6c6f 7365   hash_file.close
+00019a20: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00019a30: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+00019a40: 2241 6464 6564 2022 2b73 7472 2861 6464  "Added "+str(add
+00019a50: 6564 5f68 6173 6865 7329 2b22 2068 6173  ed_hashes)+" has
+00019a60: 6865 7320 746f 2068 6173 6820 6669 6c65  hes to hash file
+00019a70: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
+00019a80: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019a90: 2020 2020 7265 7475 726e 2054 7275 652c      return True,
+00019aa0: 2022 416c 6c20 6861 7368 6573 2065 7869   "All hashes exi
+00019ab0: 7374 220a 0a20 2020 2020 2020 2065 6c73  st"..        els
+00019ac0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00019ad0: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
+00019ae0: 2069 6d61 6765 7320 666f 756e 6420 746f   images found to
+00019af0: 2068 6173 6822 0a20 2020 2020 2020 200a   hash".        .
+00019b00: 2020 2020 6465 6620 6372 6561 7465 496d      def createIm
+00019b10: 6167 6553 4841 3235 3646 696c 6528 7365  ageSHA256File(se
+00019b20: 6c66 2c72 6552 6561 6441 6c6c 3d54 7275  lf,reReadAll=Tru
+00019b30: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
+00019b40: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
+00019b50: 2063 7265 6174 655f 696d 6167 655f 7368   create_image_sh
+00019b60: 6132 3536 5f66 696c 6520 2222 220a 2020  a256_file """.  
+00019b70: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00019b80: 662e 6372 6561 7465 5f69 6d61 6765 5f73  f.create_image_s
+00019b90: 6861 3235 365f 6669 6c65 2872 6552 6561  ha256_file(reRea
+00019ba0: 6441 6c6c 290a 0a0a 2020 2020 6465 6620  dAll)...    def 
+00019bb0: 6372 6561 7465 5f73 7461 7274 5f74 696d  create_start_tim
+00019bc0: 655f 6669 6c65 2873 656c 6629 3a0a 2020  e_file(self):.  
+00019bd0: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
+00019be0: 7320 696e 202f 696e 7465 726d 6564 6961  s in /intermedia
+00019bf0: 7465 2061 2074 6578 7420 6669 6c65 2063  te a text file c
+00019c00: 6f6e 7461 696e 696e 6720 7065 7220 696d  ontaining per im
+00019c10: 6167 6520 6974 7320 7374 6172 7420 7469  age its start ti
+00019c20: 6d65 2070 6172 7365 6420 6672 6f6d 2074  me parsed from t
+00019c30: 6865 2066 696c 6520 6e61 6d65 2022 2222  he file name """
+00019c40: 0a0a 2020 2020 2020 2020 7320 3d20 6d69  ..        s = mi
+00019c50: 7174 632e 5072 696e 744c 6f61 6469 6e67  qtc.PrintLoading
+00019c60: 4d73 6728 2243 7265 6174 696e 6720 696e  Msg("Creating in
+00019c70: 7465 726d 6564 6961 7465 2073 7461 7274  termediate start
+00019c80: 7469 6d65 2066 696c 6520 2229 0a20 2020  time file ").   
+00019c90: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
+00019ca0: 203d 2073 656c 662e 696d 6167 6573 496e   = self.imagesIn
+00019cb0: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
+00019cc0: 6973 7428 290a 2020 2020 2020 2020 6966  ist().        if
+00019cd0: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
+00019ce0: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
+00019cf0: 2020 2020 6f20 3d20 6f70 656e 2873 656c      o = open(sel
+00019d00: 662e 6765 745f 696e 745f 7374 6172 7454  f.get_int_startT
+00019d10: 696d 6573 5f66 696c 6528 292c 2022 7722  imes_file(), "w"
+00019d20: 290a 2020 2020 2020 2020 2020 2020 6f2e  ).            o.
+00019d30: 7772 6974 6528 6d69 7174 762e 636f 6c5f  write(miqtv.col_
+00019d40: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00019d50: 5b27 696d 6727 5d20 2b0a 2020 2020 2020  ['img'] +.      
+00019d60: 2020 2020 2020 2020 2020 2020 2020 225c                "\
+00019d70: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+00019d80: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
+00019d90: 7463 275d 2b22 5c6e 2229 0a0a 2020 2020  tc']+"\n")..    
+00019da0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
+00019db0: 2069 6e20 696d 6167 6573 496e 5261 773a   in imagesInRaw:
+00019dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019dd0: 2066 696c 655f 6e61 6d65 203d 206f 732e   file_name = os.
+00019de0: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
+00019df0: 6c65 290a 0a20 2020 2020 2020 2020 2020  le)..           
+00019e00: 2020 2020 2064 7420 3d20 6d69 7174 632e       dt = miqtc.
+00019e10: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
+00019e20: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
+00019e30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019e40: 2020 6f2e 7772 6974 6528 6669 6c65 5f6e    o.write(file_n
+00019e50: 616d 652b 225c 7422 202b 2064 742e 7374  ame+"\t" + dt.st
+00019e60: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
+00019e70: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+00019e80: 7427 5d29 2b22 5c6e 2229 0a0a 2020 2020  t'])+"\n")..    
+00019e90: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
+00019ea0: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
+00019eb0: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
+00019ec0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+00019ed0: 2243 7265 6174 6564 2073 7461 7274 2074  "Created start t
+00019ee0: 696d 6520 6669 6c65 220a 2020 2020 2020  ime file".      
+00019ef0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00019f00: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+00019f10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00019f20: 4661 6c73 652c 2022 4e6f 2069 6d61 6765  False, "No image
+00019f30: 7320 666f 756e 6420 746f 2072 6561 6420  s found to read 
+00019f40: 7374 6172 7420 7469 6d65 7322 0a20 2020  start times".   
+00019f50: 2020 2020 200a 2020 2020 6465 6620 6372       .    def cr
+00019f60: 6561 7465 5374 6172 7454 696d 6546 696c  eateStartTimeFil
+00019f70: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+00019f80: 2022 2222 2044 6570 7265 6361 7465 6420   """ Deprecated 
+00019f90: 2d20 7573 6520 6372 6561 7465 5f73 7461  - use create_sta
+00019fa0: 7274 5f74 696d 655f 6669 6c65 2022 2222  rt_time_file """
+00019fb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019fc0: 7365 6c66 2e63 7265 6174 655f 7374 6172  self.create_star
+00019fd0: 745f 7469 6d65 5f66 696c 6528 290a 0a0a  t_time_file()...
+00019fe0: 2020 2020 6465 6620 6372 6561 7465 4163      def createAc
+00019ff0: 7175 6973 6974 696f 6e53 6574 7469 6e67  quisitionSetting
+0001a000: 7345 5849 4646 696c 6528 7365 6c66 2c6f  sEXIFFile(self,o
+0001a010: 7665 7272 6964 653d 4661 6c73 6529 3a0a  verride=False):.
+0001a020: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
+0001a030: 6563 6174 6564 2e20 5573 6520 6372 6561  ecated. Use crea
+0001a040: 7465 5f61 6371 7569 7369 7469 6f6e 5f73  te_acquisition_s
+0001a050: 6574 7469 6e67 735f 6578 6966 5f66 696c  ettings_exif_fil
+0001a060: 6528 2920 696e 7374 6561 642e 2022 2222  e() instead. """
+0001a070: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001a080: 7365 6c66 2e63 7265 6174 655f 6163 7175  self.create_acqu
+0001a090: 6973 6974 696f 6e5f 7365 7474 696e 6773  isition_settings
+0001a0a0: 5f65 7869 665f 6669 6c65 286f 7665 7272  _exif_file(overr
+0001a0b0: 6964 653d 6f76 6572 7269 6465 290a 0a20  ide=override).. 
+0001a0c0: 2020 2064 6566 2063 7265 6174 655f 6163     def create_ac
+0001a0d0: 7175 6973 6974 696f 6e5f 7365 7474 696e  quisition_settin
+0001a0e0: 6773 5f65 7869 665f 6669 6c65 2873 656c  gs_exif_file(sel
+0001a0f0: 662c 6f76 6572 7269 6465 3d46 616c 7365  f,override=False
+0001a100: 293a 0a20 2020 2020 2020 2022 2222 2043  ):.        """ C
+0001a110: 7265 6174 6573 2069 6e20 2f69 6e74 6572  reates in /inter
+0001a120: 6d65 6469 6174 6520 6120 7465 7874 2066  mediate a text f
+0001a130: 696c 6520 636f 6e74 6169 6e69 6e67 2070  ile containing p
+0001a140: 6572 2069 6d61 6765 2061 2064 6963 7420  er image a dict 
+0001a150: 6f66 2065 7869 6620 7461 6773 2061 6e64  of exif tags and
+0001a160: 2074 6865 6972 2076 616c 7565 7320 7061   their values pa
+0001a170: 7273 6564 2066 726f 6d20 7468 6520 696d  rsed from the im
+0001a180: 6167 6520 2222 220a 0a20 2020 2020 2020  age """..       
+0001a190: 2069 6e74 5f61 6371 7569 7369 7469 6f6e   int_acquisition
+0001a1a0: 5365 7474 696e 675f 6669 6c65 203d 2073  Setting_file = s
+0001a1b0: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
+0001a1c0: 6c65 5f70 7265 6669 7828 2920 2b20 275f  le_prefix() + '_
+0001a1d0: 696d 6167 652d 6163 7175 6973 6974 696f  image-acquisitio
+0001a1e0: 6e2d 7365 7474 696e 6773 2e74 7874 270a  n-settings.txt'.
+0001a1f0: 2020 2020 2020 2020 6865 6164 6572 203d          header =
+0001a200: 207b 2020 6d69 7174 762e 636f 6c5f 6865   {  miqtv.col_he
+0001a210: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+0001a220: 696d 6727 5d3a 2020 6d69 7174 762e 636f  img']:  miqtv.co
+0001a230: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+0001a240: 275d 5b27 696d 6727 5d2c 0a20 2020 2020  ']['img'],.     
+0001a250: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001a260: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+0001a270: 276d 6172 6971 7427 5d5b 2761 6371 7569  'mariqt']['acqui
+0001a280: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
+0001a290: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
+0001a2a0: 6371 7569 275d 7d0a 2020 2020 2020 2020  cqui']}.        
+0001a2b0: 6966 206f 732e 7061 7468 2e65 7869 7374  if os.path.exist
+0001a2c0: 7328 696e 745f 6163 7175 6973 6974 696f  s(int_acquisitio
+0001a2d0: 6e53 6574 7469 6e67 5f66 696c 6529 2061  nSetting_file) a
+0001a2e0: 6e64 206e 6f74 206f 7665 7272 6964 653a  nd not override:
+0001a2f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001a300: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
+0001a310: 7461 625f 6669 6c65 2869 6e74 5f61 6371  tab_file(int_acq
+0001a320: 7569 7369 7469 6f6e 5365 7474 696e 675f  uisitionSetting_
+0001a330: 6669 6c65 2c22 5c74 222c 6865 6164 6572  file,"\t",header
+0001a340: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0001a350: 7475 726e 2054 7275 652c 2022 5265 7375  turn True, "Resu
+0001a360: 6c74 2066 696c 6520 6578 6973 7473 220a  lt file exists".
+0001a370: 0a20 2020 2020 2020 2069 6d61 6765 7349  .        imagesI
+0001a380: 6e52 6177 203d 2073 656c 662e 696d 6167  nRaw = self.imag
+0001a390: 6573 496e 496d 6167 6573 4469 7253 6f72  esInImagesDirSor
+0001a3a0: 7465 644c 6973 7428 290a 2020 2020 2020  tedList().      
+0001a3b0: 2020 6966 206c 656e 2869 6d61 6765 7349    if len(imagesI
+0001a3c0: 6e52 6177 2920 3e20 303a 0a0a 2020 2020  nRaw) > 0:..    
+0001a3d0: 2020 2020 2020 2020 6f20 3d20 6f70 656e          o = open
+0001a3e0: 2869 6e74 5f61 6371 7569 7369 7469 6f6e  (int_acquisition
+0001a3f0: 5365 7474 696e 675f 6669 6c65 2c20 2277  Setting_file, "w
+0001a400: 2229 0a20 2020 2020 2020 2020 2020 206f  ").            o
+0001a410: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
+0001a420: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001a430: 5d5b 2769 6d67 275d 202b 2022 5c74 222b  ]['img'] + "\t"+
+0001a440: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+0001a450: 5b27 6d61 7269 7174 275d 5b27 6163 7175  ['mariqt']['acqu
+0001a460: 6927 5d2b 225c 6e22 290a 200a 2020 2020  i']+"\n"). .    
+0001a470: 2020 2020 2020 2020 696d 6167 6573 4578          imagesEx
+0001a480: 6966 7320 3d20 6d69 7174 692e 6765 7449  ifs = miqti.getI
+0001a490: 6d61 6765 7341 6c6c 4578 6966 5661 6c75  magesAllExifValu
+0001a4a0: 6573 2869 6d61 6765 7349 6e52 6177 2c73  es(imagesInRaw,s
+0001a4b0: 656c 662e 7072 6f76 290a 2020 2020 2020  elf.prov).      
+0001a4c0: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+0001a4d0: 6e20 696d 6167 6573 4578 6966 733a 0a20  n imagesExifs:. 
+0001a4e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001a4f0: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
+0001a500: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
+0001a510: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a520: 2020 6f2e 7772 6974 6528 6669 6c65 5f6e    o.write(file_n
+0001a530: 616d 652b 225c 7422 2b73 7472 2869 6d61  ame+"\t"+str(ima
+0001a540: 6765 7345 7869 6673 5b66 696c 655d 292b  gesExifs[file])+
+0001a550: 225c 6e22 290a 0a20 2020 2020 2020 2020  "\n")..         
+0001a560: 2020 206f 2e63 6c6f 7365 2829 0a0a 2020     o.close()..  
+0001a570: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
+0001a580: 6464 5f69 7465 6d5f 696e 666f 5f74 6162  dd_item_info_tab
+0001a590: 5f66 696c 6528 696e 745f 6163 7175 6973  _file(int_acquis
+0001a5a0: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
+0001a5b0: 652c 225c 7422 2c68 6561 6465 7229 0a20  e,"\t",header). 
+0001a5c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a5d0: 6e20 5472 7565 2c20 2243 7265 6174 6564  n True, "Created
+0001a5e0: 2061 6371 7569 7369 7469 6f6e 2073 6574   acquisition set
+0001a5f0: 7469 6e67 7320 6669 6c65 220a 2020 2020  tings file".    
+0001a600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001a610: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001a620: 7365 2c20 224e 6f20 696d 6167 6573 2066  se, "No images f
+0001a630: 6f75 6e64 220a 0a0a 2020 2020 6465 6620  ound"...    def 
+0001a640: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+0001a650: 7228 7365 6c66 293a 0a20 2020 2020 2020  r(self):.       
+0001a660: 2072 6574 7572 6e20 636f 7079 2e64 6565   return copy.dee
+0001a670: 7063 6f70 7928 7365 6c66 2e5f 696d 6167  pcopy(self._imag
+0001a680: 6573 496e 496d 6167 6573 4469 7229 0a0a  esInImagesDir)..
+0001a690: 2020 2020 6465 6620 696d 6167 6573 496e      def imagesIn
+0001a6a0: 496d 6167 6573 4469 7253 6f72 7465 644c  ImagesDirSortedL
+0001a6b0: 6973 7428 7365 6c66 293a 0a20 2020 2020  ist(self):.     
+0001a6c0: 2020 2072 6574 7572 6e20 636f 7079 2e64     return copy.d
+0001a6d0: 6565 7063 6f70 7928 7365 6c66 2e5f 696d  eepcopy(self._im
+0001a6e0: 6167 6573 496e 496d 6167 6573 4469 7253  agesInImagesDirS
+0001a6f0: 6f72 7465 644c 6973 7429 0a0a 0a20 2020  ortedList)...   
+0001a700: 2064 6566 2070 6172 7365 4974 656d 4461   def parseItemDa
+0001a710: 7461 6672 6f6d 5461 6246 696c 6544 6174  tafromTabFileDat
+0001a720: 6128 7365 6c66 2c20 6974 656d 733a 2064  a(self, items: d
+0001a730: 6963 742c 2066 696c 653a 2073 7472 2c20  ict, file: str, 
+0001a740: 636f 6c73 3a20 6c69 7374 2c20 6f70 7469  cols: list, opti
+0001a750: 6f6e 616c 3a20 6c69 7374 203d 205b 5d2c  onal: list = [],
+0001a760: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
+0001a770: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
+0001a780: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+0001a790: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
+0001a7a0: 7061 7273 6573 2064 6174 6120 6672 6f6d  parses data from
+0001a7b0: 2063 6f6c 756d 6e73 2069 6e20 636f 6c73   columns in cols
+0001a7c0: 2061 6e64 2077 7269 7465 7320 696e 666f   and writes info
+0001a7d0: 2074 6f20 6974 656d 732e 2043 6f6c 756d   to items. Colum
+0001a7e0: 6e20 2769 6d61 6765 2d66 696c 656e 616d  n 'image-filenam
+0001a7f0: 6527 206d 7573 7420 6265 2069 6e20 6669  e' must be in fi
+0001a800: 6c65 2061 6e64 2064 6f65 7320 6e6f 7420  le and does not 
+0001a810: 6e65 6564 2074 6f20 6265 2070 6173 7365  need to be passe
+0001a820: 6420 696e 2063 6f6c 732e 200a 2020 2020  d in cols. .    
+0001a830: 2020 2020 2020 2020 4669 6c65 206d 7573          File mus
+0001a840: 7420 6265 2074 6162 2073 6570 6172 6174  t be tab separat
+0001a850: 6564 2061 6e64 2063 6f6c 756d 6e73 206e  ed and columns n
+0001a860: 616d 6573 206d 7573 7420 6571 7561 6c20  ames must equal 
+0001a870: 6974 656d 2066 6965 6c64 206e 616d 6573  item field names
+0001a880: 2222 220a 2020 2020 2020 2020 746d 705f  """.        tmp_
+0001a890: 6461 7461 203d 206d 6971 7466 2e74 6162  data = miqtf.tab
+0001a8a0: 4669 6c65 4461 7461 2866 696c 652c 2063  FileData(file, c
+0001a8b0: 6f6c 732b 5b27 696d 6167 652d 6669 6c65  ols+['image-file
+0001a8c0: 6e61 6d65 275d 2b6f 7074 696f 6e61 6c2c  name']+optional,
+0001a8d0: 206b 6579 5f63 6f6c 3d27 696d 6167 652d   key_col='image-
+0001a8e0: 6669 6c65 6e61 6d65 272c 206f 7074 696f  filename', optio
+0001a8f0: 6e61 6c3d 6f70 7469 6f6e 616c 2c63 6f6e  nal=optional,con
+0001a900: 7665 7274 3d54 7275 6529 0a20 2020 2020  vert=True).     
+0001a910: 2020 2073 656c 662e 7772 6974 6550 6172     self.writePar
+0001a920: 7365 6444 6174 6154 6f49 7465 6d73 2874  sedDataToItems(t
+0001a930: 6d70 5f64 6174 612c 6974 656d 732c 7365  mp_data,items,se
+0001a940: 6c66 2e69 6664 6f5f 746d 705b 6d69 7174  lf.ifdo_tmp[miqt
+0001a950: 762e 696d 6167 655f 7365 745f 6865 6164  v.image_set_head
+0001a960: 6572 5f6b 6579 5d2c 2064 6174 6574 696d  er_key], datetim
+0001a970: 655f 666f 726d 6174 3d64 6174 6574 696d  e_format=datetim
+0001a980: 655f 666f 726d 6174 290a 0a0a 2020 2020  e_format)...    
+0001a990: 6465 6620 7072 6173 6549 7465 6d44 6174  def praseItemDat
+0001a9a0: 6146 726f 6d46 696c 6528 7365 6c66 2c69  aFromFile(self,i
+0001a9b0: 7465 6d73 3a64 6963 742c 6669 6c65 3a73  tems:dict,file:s
+0001a9c0: 7472 2c73 6570 6172 6174 6f72 3a73 7472  tr,separator:str
+0001a9d0: 2c68 6561 6465 723a 6469 6374 2c20 6461  ,header:dict, da
+0001a9e0: 7465 7469 6d65 5f66 6f72 6d61 743a 7374  tetime_format:st
+0001a9f0: 723d 6d69 7174 762e 6461 7465 5f66 6f72  r=miqtv.date_for
+0001aa00: 6d61 7473 5b27 6d61 7269 7174 275d 293a  mats['mariqt']):
+0001aa10: 0a20 2020 2020 2020 2022 2222 2070 6172  .        """ par
+0001aa20: 7365 7320 6461 7461 2066 726f 6d20 6672  ses data from fr
+0001aa30: 6f6d 2066 696c 6520 746f 2069 7465 6d73  om file to items
+0001aa40: 2e20 6865 6164 6572 2064 6963 7420 6d75  . header dict mu
+0001aa50: 7374 2062 6520 6f66 2073 7472 7563 7475  st be of structu
+0001aa60: 7265 3a20 7b3c 6974 656d 2d66 6965 6c64  re: {<item-field
+0001aa70: 2d6e 616d 653e 3a3c 636f 6c75 6d6e 2d6e  -name>:<column-n
+0001aa80: 616d 653e 7d0a 2020 2020 2020 2020 2020  ame>}.          
+0001aa90: 2020 616e 6420 6d75 7374 2063 6f6e 7461    and must conta
+0001aaa0: 696e 2065 6e74 7279 2027 696d 6167 652d  in entry 'image-
+0001aab0: 6669 6c65 6e61 6d65 2720 2222 220a 2020  filename' """.  
+0001aac0: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
+0001aad0: 6167 652d 6669 6c65 6e61 6d65 2720 696e  age-filename' in
+0001aae0: 2068 6561 6465 723a 0a20 2020 2020 2020   header:.       
+0001aaf0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
+0001ab00: 7469 6f6e 2822 6865 6164 6572 2064 6f65  tion("header doe
+0001ab10: 7320 6e6f 7420 636f 6e74 6169 6e20 2769  s not contain 'i
+0001ab20: 6d61 6765 2d66 696c 656e 616d 6527 2229  mage-filename'")
+0001ab30: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+0001ab40: 2020 746d 705f 6461 7461 203d 206d 6971    tmp_data = miq
+0001ab50: 7466 2e74 6162 4669 6c65 4461 7461 2866  tf.tabFileData(f
+0001ab60: 696c 652c 2068 6561 6465 722c 636f 6c5f  ile, header,col_
+0001ab70: 7365 7061 7261 746f 723d 7365 7061 7261  separator=separa
+0001ab80: 746f 722c 206b 6579 5f63 6f6c 3d27 696d  tor, key_col='im
+0001ab90: 6167 652d 6669 6c65 6e61 6d65 272c 636f  age-filename',co
+0001aba0: 6e76 6572 743d 5472 7565 290a 2020 2020  nvert=True).    
+0001abb0: 2020 2020 7365 6c66 2e77 7269 7465 5061      self.writePa
+0001abc0: 7273 6564 4461 7461 546f 4974 656d 7328  rsedDataToItems(
+0001abd0: 746d 705f 6461 7461 2c69 7465 6d73 2c73  tmp_data,items,s
+0001abe0: 656c 662e 6966 646f 5f74 6d70 5b6d 6971  elf.ifdo_tmp[miq
+0001abf0: 7476 2e69 6d61 6765 5f73 6574 5f68 6561  tv.image_set_hea
+0001ac00: 6465 725f 6b65 795d 2c20 6461 7465 7469  der_key], dateti
+0001ac10: 6d65 5f66 6f72 6d61 743d 6461 7465 7469  me_format=dateti
+0001ac20: 6d65 5f66 6f72 6d61 7429 0a0a 0a20 2020  me_format)...   
+0001ac30: 2064 6566 2077 7269 7465 5061 7273 6564   def writeParsed
+0001ac40: 4461 7461 546f 4974 656d 7328 7365 6c66  DataToItems(self
+0001ac50: 2c64 6174 613a 6469 6374 2c69 7465 6d73  ,data:dict,items
+0001ac60: 3a64 6963 742c 6865 6164 6572 3a64 6963  :dict,header:dic
+0001ac70: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
+0001ac80: 6174 3a73 7472 3d6d 6971 7476 2e64 6174  at:str=miqtv.dat
+0001ac90: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0001aca0: 7427 5d29 3a0a 0a20 2020 2020 2020 2023  t']):..        #
+0001acb0: 2065 7661 6c20 7374 7269 6e67 7320 6173   eval strings as
+0001acc0: 2064 6963 7420 6f72 206c 6973 740a 2020   dict or list.  
+0001acd0: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
+0001ace0: 7273 6976 6545 7661 6c28 6461 7461 290a  rsiveEval(data).
+0001acf0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
+0001ad00: 6d69 7174 632e 7265 6375 7273 6976 656c  miqtc.recursivel
+0001ad10: 7952 656d 6f76 6545 6d70 7479 4669 656c  yRemoveEmptyFiel
+0001ad20: 6473 2864 6174 612c 636f 6e74 656e 7432  ds(data,content2
+0001ad30: 6265 5265 6d6f 7665 643d 4e6f 6e65 290a  beRemoved=None).
+0001ad40: 0a20 2020 2020 2020 2023 2070 6f74 656e  .        # poten
+0001ad50: 7461 696c 6c79 2072 656d 6f76 6520 636f  tailly remove co
+0001ad60: 6e73 7420 6461 7461 2066 726f 6d20 6974  nst data from it
+0001ad70: 656d 7320 616e 6420 7075 7420 696e 2068  ems and put in h
+0001ad80: 6561 6465 720a 2020 2020 2020 2020 7365  eader.        se
+0001ad90: 6c66 2e65 7874 7261 6374 436f 6e73 7444  lf.extractConstD
+0001ada0: 6174 6156 616c 7565 7328 6461 7461 2c68  ataValues(data,h
+0001adb0: 6561 6465 7229 0a0a 2020 2020 2020 2020  eader)..        
+0001adc0: 2320 6164 6420 2769 6d61 6765 2d66 696c  # add 'image-fil
+0001add0: 656e 616d 6527 2066 6965 6c64 0a20 2020  ename' field.   
+0001ade0: 2020 2020 2066 6f72 2069 6d67 2c20 656e       for img, en
+0001adf0: 7472 7920 696e 2064 6174 612e 6974 656d  try in data.item
+0001ae00: 7328 293a 0a0a 2020 2020 2020 2020 2020  s():..          
+0001ae10: 2020 2320 6c69 7374 0a20 2020 2020 2020    # list.       
+0001ae20: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0001ae30: 6365 2865 6e74 7279 2c6c 6973 7429 3a0a  ce(entry,list):.
+0001ae40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae50: 666f 7220 6c69 7374 4974 656d 2069 6e20  for listItem in 
+0001ae60: 656e 7472 793a 0a20 2020 2020 2020 2020  entry:.         
+0001ae70: 2020 2020 2020 2020 2020 206c 6973 7449             listI
+0001ae80: 7465 6d5b 2769 6d61 6765 2d66 696c 656e  tem['image-filen
+0001ae90: 616d 6527 5d20 3d20 696d 670a 2020 2020  ame'] = img.    
+0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aeb0: 2320 636f 7665 7274 2064 6174 6574 696d  # covert datetim
+0001aec0: 6520 7374 7269 6e67 0a20 2020 2020 2020  e string.       
+0001aed0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001aee0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0001aef0: 2069 6e20 6c69 7374 4974 656d 3a0a 2020   in listItem:.  
+0001af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af10: 2020 2020 2020 6474 203d 2064 6174 6574        dt = datet
+0001af20: 696d 652e 6461 7465 7469 6d65 2e73 7472  ime.datetime.str
+0001af30: 7074 696d 6528 6c69 7374 4974 656d 5b27  ptime(listItem['
+0001af40: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0001af50: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
+0001af60: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+0001af70: 2020 2020 2020 2020 2020 206c 6973 7449             listI
+0001af80: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
+0001af90: 696d 6527 5d20 3d20 6474 2e73 7472 6674  ime'] = dt.strft
+0001afa0: 696d 6528 6d69 7174 762e 6461 7465 5f66  ime(miqtv.date_f
+0001afb0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+0001afc0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0001afd0: 6966 2069 7369 6e73 7461 6e63 6528 656e  if isinstance(en
+0001afe0: 7472 792c 6469 6374 293a 0a20 2020 2020  try,dict):.     
+0001aff0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+0001b000: 5b27 696d 6167 652d 6669 6c65 6e61 6d65  ['image-filename
+0001b010: 275d 203d 2069 6d67 0a20 2020 2020 2020  '] = img.       
+0001b020: 2020 2020 2020 2020 2023 2063 6f76 6572           # cover
+0001b030: 7420 6461 7465 7469 6d65 2073 7472 696e  t datetime strin
+0001b040: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
+0001b050: 2020 6966 2027 696d 6167 652d 6461 7465    if 'image-date
+0001b060: 7469 6d65 2720 696e 2065 6e74 7279 3a0a  time' in entry:.
+0001b070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b080: 2020 2020 6474 203d 2064 6174 6574 696d      dt = datetim
+0001b090: 652e 6461 7465 7469 6d65 2e73 7472 7074  e.datetime.strpt
+0001b0a0: 696d 6528 656e 7472 795b 2769 6d61 6765  ime(entry['image
+0001b0b0: 2d64 6174 6574 696d 6527 5d2c 2064 6174  -datetime'], dat
+0001b0c0: 6574 696d 655f 666f 726d 6174 290a 2020  etime_format).  
+0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0e0: 2020 656e 7472 795b 2769 6d61 6765 2d64    entry['image-d
+0001b0f0: 6174 6574 696d 6527 5d20 3d20 6474 2e73  atetime'] = dt.s
+0001b100: 7472 6674 696d 6528 6d69 7174 762e 6461  trftime(miqtv.da
+0001b110: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+0001b120: 7174 275d 290a 2020 2020 2020 2020 2020  qt']).          
+0001b130: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001b140: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
+0001b150: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
+0001b160: 6e28 2264 6174 6120 656e 7472 6965 7320  n("data entries 
+0001b170: 6d75 7374 2062 6520 6469 6374 206f 7220  must be dict or 
+0001b180: 6c69 7374 2069 6620 6469 6374 7322 290a  list if dicts").
+0001b190: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
+0001b1a0: 6563 7572 7369 7665 6c79 5570 6461 7465  ecursivelyUpdate
+0001b1b0: 4469 6374 7328 6974 656d 732c 6461 7461  Dicts(items,data
+0001b1c0: 290a 0a0a 2020 2020 4073 7461 7469 636d  )...    @staticm
+0001b1d0: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
+0001b1e0: 7472 6163 7443 6f6e 7374 4461 7461 5661  tractConstDataVa
+0001b1f0: 6c75 6573 2864 6174 613a 6469 6374 2c68  lues(data:dict,h
+0001b200: 6561 6465 723a 6469 6374 293a 0a20 2020  eader:dict):.   
+0001b210: 2020 2020 2022 2222 2052 656d 6f76 6573       """ Removes
+0001b220: 2066 6965 6c64 7320 7468 6174 2061 7265   fields that are
+0001b230: 2063 6f6e 7374 616e 7420 666f 7220 616c   constant for al
+0001b240: 6c20 656e 7472 6965 7320 6672 6f6d 2064  l entries from d
+0001b250: 6174 6120 6469 6374 2061 6e64 2070 7574  ata dict and put
+0001b260: 2074 6865 6d20 696e 2068 6561 6465 7220   them in header 
+0001b270: 6469 6374 2e20 0a20 2020 2020 2020 2020  dict. .         
+0001b280: 2020 2045 6163 6820 656e 7472 7920 6f66     Each entry of
+0001b290: 2064 6174 6120 6d75 7374 2062 6520 6120   data must be a 
+0001b2a0: 6469 6374 2077 6974 6820 7468 6520 7361  dict with the sa
+0001b2b0: 6d65 2073 6574 206f 6620 6b65 7973 2e20  me set of keys. 
+0001b2c0: 2222 220a 2020 2020 0a20 2020 2020 2020  """.    .       
+0001b2d0: 2023 2073 6b69 7020 6966 2074 6865 7265   # skip if there
+0001b2e0: 2069 7320 6f6e 6c79 206f 6e65 2069 7465   is only one ite
+0001b2f0: 6d0a 2020 2020 2020 2020 6966 206c 656e  m.        if len
+0001b300: 286c 6973 7428 6461 7461 2e6b 6579 7328  (list(data.keys(
+0001b310: 2929 2920 3d3d 2031 3a0a 2020 2020 2020  ))) == 1:.      
+0001b320: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+0001b330: 2020 2020 2020 6669 656c 6473 546f 4967        fieldsToIg
+0001b340: 6e6f 7265 203d 205b 2769 6d61 6765 2d64  nore = ['image-d
+0001b350: 6174 6574 696d 6527 5d0a 2020 2020 2020  atetime'].      
+0001b360: 2020 636f 6e73 7444 6174 6120 3d20 7b7d    constData = {}
+0001b370: 0a20 2020 2020 2020 2066 6972 7374 496d  .        firstIm
+0001b380: 6167 6520 3d20 5472 7565 0a20 2020 2020  age = True.     
+0001b390: 2020 2066 6f72 2069 6d61 6765 2c69 6d61     for image,ima
+0001b3a0: 6765 5f64 6174 6120 696e 2064 6174 612e  ge_data in data.
+0001b3b0: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0001b3c0: 2020 2020 200a 2020 2020 2020 2020 2020       .          
+0001b3d0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0001b3e0: 6e63 6528 696d 6167 655f 6461 7461 2c6c  nce(image_data,l
+0001b3f0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
+0001b400: 2020 2020 2020 696d 6167 655f 6461 7461        image_data
+0001b410: 203d 205b 696d 6167 655f 6461 7461 5d0a   = [image_data].
+0001b420: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001b430: 6e6f 7420 6669 7273 7449 6d61 6765 2061  not firstImage a
+0001b440: 6e64 2063 6f6e 7374 4461 7461 203d 3d20  nd constData == 
+0001b450: 7b7d 3a0a 2020 2020 2020 2020 2020 2020  {}:.            
+0001b460: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
+0001b470: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
+0001b480: 2020 2066 6972 7374 5469 6d65 506f 696e     firstTimePoin
+0001b490: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
+0001b4a0: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
+0001b4b0: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
+0001b4c0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0001b4d0: 2020 2020 2020 2320 7665 7279 2066 6972        # very fir
+0001b4e0: 7374 2064 6174 6120 666f 7220 636f 6d70  st data for comp
+0001b4f0: 6172 6973 6f6e 0a20 2020 2020 2020 2020  arison.         
+0001b500: 2020 2020 2020 2069 6620 6669 7273 7449         if firstI
+0001b510: 6d61 6765 2061 6e64 2066 6972 7374 5469  mage and firstTi
+0001b520: 6d65 506f 696e 743a 0a20 2020 2020 2020  mePoint:.       
+0001b530: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+0001b540: 7374 4461 7461 203d 2063 6f70 792e 6465  stData = copy.de
+0001b550: 6570 636f 7079 2869 6d61 6765 5f74 705f  epcopy(image_tp_
+0001b560: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
+0001b570: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+0001b580: 656c 6420 696e 2066 6965 6c64 7354 6f49  eld in fieldsToI
+0001b590: 676e 6f72 653a 0a20 2020 2020 2020 2020  gnore:.         
+0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b5b0: 6620 6669 656c 6420 696e 2063 6f6e 7374  f field in const
+0001b5c0: 4461 7461 3a0a 2020 2020 2020 2020 2020  Data:.          
+0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b5e0: 2020 6465 6c20 636f 6e73 7444 6174 615b    del constData[
+0001b5f0: 6669 656c 645d 0a20 2020 2020 2020 2020  field].         
+0001b600: 2020 2020 2020 2020 2020 2066 6972 7374             first
+0001b610: 5469 6d65 506f 696e 7420 3d20 4661 6c73  TimePoint = Fals
+0001b620: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001b630: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+0001b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b650: 636f 6e73 7444 6174 6120 3d20 6d69 7174  constData = miqt
+0001b660: 632e 6669 6e64 436f 6d6d 6f6e 4469 6374  c.findCommonDict
+0001b670: 456c 656d 656e 7473 2869 6d61 6765 5f74  Elements(image_t
+0001b680: 705f 6461 7461 2c63 6f6e 7374 4461 7461  p_data,constData
+0001b690: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
+0001b6a0: 6972 7374 496d 6167 6520 3d20 4661 6c73  irstImage = Fals
+0001b6b0: 650a 0a20 2020 2020 2020 2023 2054 4f44  e..        # TOD
+0001b6c0: 4f20 6368 6563 6b20 7769 7468 696e 2069  O check within i
+0001b6d0: 6d61 6765 2074 696d 6573 202d 3e20 746f  mage times -> to
+0001b6e0: 2069 6d61 6765 2064 6566 6175 6c74 2e20   image default. 
+0001b6f0: 2874 7269 636b 7920 7369 6e63 6520 7765  (tricky since we
+0001b700: 2064 6f6e 2774 2068 6176 6520 7468 6520   don't have the 
+0001b710: 6461 6661 756c 7420 696e 6465 7820 6865  dafault index he
+0001b720: 7265 2e20 4f6e 6c79 2061 2073 7562 7365  re. Only a subse
+0001b730: 7420 6d69 6768 7420 6265 2075 7064 6174  t might be updat
+0001b740: 6520 6865 7265 290a 2020 2020 2020 2020  e here).        
+0001b750: 2320 6368 6563 6b20 7769 7468 696e 2069  # check within i
+0001b760: 6d61 6765 2069 7465 6d73 202d 3e20 6865  mage items -> he
+0001b770: 6164 6572 0a20 2020 2020 2020 2068 6561  ader.        hea
+0001b780: 6465 7255 7064 6174 6520 3d20 636f 7079  derUpdate = copy
+0001b790: 2e64 6565 7063 6f70 7928 636f 6e73 7444  .deepcopy(constD
+0001b7a0: 6174 6129 0a20 2020 2020 2020 2068 6561  ata).        hea
+0001b7b0: 6465 7255 7064 6174 6564 5465 7374 203d  derUpdatedTest =
+0001b7c0: 2063 6f70 792e 6465 6570 636f 7079 2868   copy.deepcopy(h
+0001b7d0: 6561 6465 7229 0a20 2020 2020 2020 206d  eader).        m
+0001b7e0: 6971 7463 2e72 6563 7572 7369 7665 6c79  iqtc.recursively
+0001b7f0: 5570 6461 7465 4469 6374 7328 6865 6164  UpdateDicts(head
+0001b800: 6572 5570 6461 7465 6454 6573 742c 6865  erUpdatedTest,he
+0001b810: 6164 6572 5570 6461 7465 290a 2020 2020  aderUpdate).    
+0001b820: 2020 2020 7570 6461 7465 4469 6666 203d      updateDiff =
+0001b830: 2044 6565 7044 6966 6628 6865 6164 6572   DeepDiff(header
+0001b840: 2c68 6561 6465 7255 7064 6174 6564 5465  ,headerUpdatedTe
+0001b850: 7374 290a 2020 2020 2020 2020 2320 6368  st).        # ch
+0001b860: 6563 6b20 6966 2068 6561 6465 7255 7064  eck if headerUpd
+0001b870: 6174 6520 776f 756c 6420 6f76 6572 7772  ate would overwr
+0001b880: 6974 6520 616e 7974 6869 6e67 2066 726f  ite anything fro
+0001b890: 6d20 6375 7272 656e 7420 6865 6164 6572  m current header
+0001b8a0: 2028 7368 6f75 6c64 206e 6f74 2068 6170   (should not hap
+0001b8b0: 7065 6e29 2c20 6966 2073 6f20 646f 6e74  pen), if so dont
+0001b8c0: 2072 656d 6f76 6520 6672 6f6d 2069 7465   remove from ite
+0001b8d0: 6d73 0a20 2020 2020 2020 2069 6620 6e6f  ms.        if no
+0001b8e0: 7420 2776 616c 7565 735f 6368 616e 6765  t 'values_change
+0001b8f0: 6427 2069 6e20 7570 6461 7465 4469 6666  d' in updateDiff
+0001b900: 2061 6e64 206e 6f74 2027 7479 7065 5f63   and not 'type_c
+0001b910: 6861 6e67 6573 2720 696e 2075 7064 6174  hanges' in updat
+0001b920: 6544 6966 6620 616e 6420 6e6f 7420 2764  eDiff and not 'd
+0001b930: 6963 7469 6f6e 6172 795f 6974 656d 5f72  ictionary_item_r
+0001b940: 656d 6f76 6564 2720 696e 2075 7064 6174  emoved' in updat
+0001b950: 6544 6966 663a 0a20 2020 2020 2020 2020  eDiff:.         
+0001b960: 2020 2068 6561 6465 722e 636c 6561 7228     header.clear(
+0001b970: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
+0001b980: 6164 6572 2e75 7064 6174 6528 6865 6164  ader.update(head
+0001b990: 6572 5570 6461 7465 6454 6573 7429 0a0a  erUpdatedTest)..
+0001b9a0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
+0001b9b0: 6d6f 7665 2063 6f6e 7374 2076 616c 7565  move const value
+0001b9c0: 7320 6672 6f6d 2064 6174 610a 2020 2020  s from data.    
+0001b9d0: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
+0001b9e0: 6375 7273 6976 654d 616b 654e 6f6e 6544  cursiveMakeNoneD
+0001b9f0: 6963 7446 6965 6c64 7345 6d70 7479 5374  ictFieldsEmptySt
+0001ba00: 7228 636f 6e73 7444 6174 6129 0a20 2020  r(constData).   
+0001ba10: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
+0001ba20: 6765 2c69 6d61 6765 5f64 6174 6120 696e  ge,image_data in
+0001ba30: 2064 6174 612e 6974 656d 7328 293a 0a20   data.items():. 
+0001ba40: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ba50: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+0001ba60: 2869 6d61 6765 5f64 6174 612c 6c69 7374  (image_data,list
+0001ba70: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001ba80: 2020 2020 2020 2069 6d61 6765 5f64 6174         image_dat
+0001ba90: 6120 3d20 5b69 6d61 6765 5f64 6174 615d  a = [image_data]
+0001baa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bab0: 2066 6f72 2069 6d61 6765 5f74 705f 6461   for image_tp_da
+0001bac0: 7461 2069 6e20 696d 6167 655f 6461 7461  ta in image_data
+0001bad0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001bae0: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
+0001baf0: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
+0001bb00: 7473 2869 6d61 6765 5f74 705f 6461 7461  ts(image_tp_data
+0001bb10: 2c63 6f6e 7374 4461 7461 2920 2020 2020  ,constData)     
+0001bb20: 2020 2020 200a 0a20 2020 2020 2020 2065       ..        e
+0001bb30: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001bb40: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
+0001bb50: 2020 2320 544f 444f 206c 6f67 3f0a 2020    # TODO log?.  
+0001bb60: 2020 200a 0a20 2020 2064 6566 2069 6e74     ..    def int
+0001bb70: 6572 6d65 6469 6174 654e 6176 4669 6c65  ermediateNavFile
+0001bb80: 4578 6973 7473 2873 656c 6629 3a0a 2020  Exists(self):.  
+0001bb90: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
+0001bba0: 2e65 7869 7374 7328 7365 6c66 2e67 6574  .exists(self.get
+0001bbb0: 5f69 6e74 5f6e 6176 5f66 696c 6528 2929  _int_nav_file())
+0001bbc0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001bbd0: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0001bbe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0001bbf0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001bc00: 0a0a 0a20 2020 2064 6566 2068 6561 6465  ...    def heade
+0001bc10: 7246 6965 6c64 4669 6c6c 6564 2873 656c  rFieldFilled(sel
+0001bc20: 662c 6669 656c 643a 7374 7229 3a0a 2020  f,field:str):.  
+0001bc30: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
+0001bc40: 6e64 546d 7046 6965 6c64 3228 6669 656c  ndTmpField2(fiel
+0001bc50: 6429 203d 3d20 2222 3a0a 2020 2020 2020  d) == "":.      
+0001bc60: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001bc70: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+0001bc80: 6e20 5472 7565 0a0a 2020 2020 6465 6620  n True..    def 
+0001bc90: 636f 6e76 6572 7454 6f44 6566 6175 6c74  convertToDefault
+0001bca0: 4461 7465 5469 6d65 466f 726d 6174 2873  DateTimeFormat(s
+0001bcb0: 656c 662c 6966 646f 293a 0a20 2020 2020  elf,ifdo):.     
+0001bcc0: 2020 2022 2222 2043 6865 636b 7320 6966     """ Checks if
+0001bcd0: 2061 6c6c 2069 7465 6d73 2720 2769 6d61   all items' 'ima
+0001bce0: 6765 2d64 6174 6574 696d 6527 2066 6965  ge-datetime' fie
+0001bcf0: 6c64 7320 6d61 7463 6820 6465 6661 756c  lds match defaul
+0001bd00: 7420 6461 7465 7469 6d65 2066 6f72 6d61  t datetime forma
+0001bd10: 7420 6f72 2061 2063 7573 746f 6d20 6f6e  t or a custom on
+0001bd20: 6520 6465 6669 6e65 6420 696e 2027 696d  e defined in 'im
+0001bd30: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
+0001bd40: 6d61 7427 0a20 2020 2020 2020 2020 2020  mat'.           
+0001bd50: 2061 6e64 2063 6f6e 7665 7274 7320 746f   and converts to
+0001bd60: 2064 6566 6175 6c74 2066 6f72 6d61 742e   default format.
+0001bd70: 2054 6872 6f77 7320 6578 6365 7074 696f   Throws exceptio
+0001bd80: 6e20 6966 2064 6174 6574 696d 6520 6361  n if datetime ca
+0001bd90: 6e6e 6f74 2062 6520 7061 7273 6564 2022  nnot be parsed "
+0001bda0: 2222 0a20 2020 2020 2020 2063 7573 746f  "".        custo
+0001bdb0: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
+0001bdc0: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
+0001bdd0: 2020 2020 2068 6561 6465 7243 7573 746f       headerCusto
+0001bde0: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
+0001bdf0: 3d20 6669 6e64 4669 656c 6428 6966 646f  = findField(ifdo
+0001be00: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0001be10: 6164 6572 4b65 795d 2c27 696d 6167 652d  aderKey],'image-
+0001be20: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
+0001be30: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
+0001be40: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
+0001be50: 6546 6f72 6d61 7420 213d 2022 223a 0a20  eFormat != "":. 
+0001be60: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
+0001be70: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0001be80: 6465 724b 6579 5d5b 2769 6d61 6765 2d64  derKey]['image-d
+0001be90: 6174 6574 696d 652d 666f 726d 6174 275d  atetime-format']
+0001bea0: 203d 2022 2220 2320 7265 6d6f 7665 2063   = "" # remove c
+0001beb0: 7573 746f 6d20 666f 726d 6174 0a20 2020  ustom format.   
+0001bec0: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
+0001bed0: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
+0001bee0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+0001bef0: 2020 7072 6f67 203d 206d 6971 7463 2e50    prog = miqtc.P
+0001bf00: 7269 6e74 4b6e 6f77 6e50 726f 6772 6573  rintKnownProgres
+0001bf10: 734d 7367 2822 4368 6563 6b69 6e67 2064  sMsg("Checking d
+0001bf20: 6174 6574 696d 6520 666f 726d 6174 222c  atetime format",
+0001bf30: 206c 656e 2869 6664 6f5b 7365 6c66 2e69   len(ifdo[self.i
+0001bf40: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+0001bf50: 292c 6d6f 6475 6c6f 3d31 3029 0a20 2020  ),modulo=10).   
+0001bf60: 2020 2020 2066 6f72 2066 696c 652c 6974       for file,it
+0001bf70: 656d 2069 6e20 6966 646f 5b73 656c 662e  em in ifdo[self.
+0001bf80: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+0001bf90: 5d2e 6974 656d 7328 293a 0a20 2020 2020  ].items():.     
+0001bfa0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
+0001bfb0: 7265 7373 2829 0a20 2020 2020 2020 2020  ress().         
+0001bfc0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+0001bfd0: 616e 6365 2869 7465 6d2c 6c69 7374 293a  ance(item,list):
+0001bfe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bff0: 2020 2020 2069 7465 6d20 3d20 5b69 7465       item = [ite
+0001c000: 6d5d 0a20 2020 2020 2020 2020 2020 2073  m].            s
+0001c010: 7562 4974 656d 4465 6661 756c 7420 3d20  ubItemDefault = 
+0001c020: 6974 656d 5b30 5d0a 2020 2020 2020 2020  item[0].        
+0001c030: 2020 2020 6974 656d 4375 7374 6f6d 4461      itemCustomDa
+0001c040: 7465 5469 6d65 466f 726d 6174 203d 2022  teTimeFormat = "
+0001c050: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
+0001c060: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+0001c070: 2d66 6f72 6d61 7427 2069 6e20 7375 6249  -format' in subI
+0001c080: 7465 6d44 6566 6175 6c74 3a0a 2020 2020  temDefault:.    
+0001c090: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0001c0a0: 4375 7374 6f6d 4461 7465 5469 6d65 466f  CustomDateTimeFo
+0001c0b0: 726d 6174 203d 2073 7562 4974 656d 4465  rmat = subItemDe
+0001c0c0: 6661 756c 745b 2769 6d61 6765 2d64 6174  fault['image-dat
+0001c0d0: 6574 696d 652d 666f 726d 6174 275d 0a20  etime-format']. 
+0001c0e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c0f0: 7562 4974 656d 4465 6661 756c 745b 2769  ubItemDefault['i
+0001c100: 6d61 6765 2d64 6174 6574 696d 652d 666f  mage-datetime-fo
+0001c110: 726d 6174 275d 203d 2022 2220 2320 7265  rmat'] = "" # re
+0001c120: 6d6f 7665 2063 7573 746f 6d20 666f 726d  move custom form
+0001c130: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+0001c140: 2020 2063 7573 746f 6d44 6174 6554 696d     customDateTim
+0001c150: 6546 6f72 6d61 7446 6f75 6e64 203d 2054  eFormatFound = T
+0001c160: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
+0001c170: 666f 7220 7375 6249 7465 6d20 696e 2069  for subItem in i
+0001c180: 7465 6d3a 0a20 2020 2020 2020 2020 2020  tem:.           
+0001c190: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001c1a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001c1b0: 726d 6174 203d 206d 6971 7476 2e64 6174  rmat = miqtv.dat
+0001c1c0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0001c1d0: 7427 5d0a 2020 2020 2020 2020 2020 2020  t'].            
+0001c1e0: 2020 2020 2020 2020 6461 7465 7469 6d65          datetime
+0001c1f0: 2e64 6174 6574 696d 652e 7374 7270 7469  .datetime.strpti
+0001c200: 6d65 2873 7562 4974 656d 5b27 696d 6167  me(subItem['imag
+0001c210: 652d 6461 7465 7469 6d65 275d 2c66 6f72  e-datetime'],for
+0001c220: 6d61 7429 0a20 2020 2020 2020 2020 2020  mat).           
+0001c230: 2020 2020 2065 7863 6570 743a 0a20 2020       except:.   
+0001c240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c250: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0001c260: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001c270: 726d 6174 203d 2068 6561 6465 7243 7573  rmat = headerCus
+0001c280: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
+0001c290: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001c2a0: 2020 2020 2020 2020 2020 6474 203d 2064            dt = d
+0001c2b0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+0001c2c0: 2e73 7472 7074 696d 6528 7375 6249 7465  .strptime(subIte
+0001c2d0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001c2e0: 6527 5d2c 666f 726d 6174 290a 2020 2020  e'],format).    
+0001c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c300: 2020 2020 7375 6249 7465 6d5b 2769 6d61      subItem['ima
+0001c310: 6765 2d64 6174 6574 696d 6527 5d20 3d20  ge-datetime'] = 
+0001c320: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+0001c330: 652e 7374 7266 7469 6d65 2864 742c 6d69  e.strftime(dt,mi
+0001c340: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
+0001c350: 5b27 6d61 7269 7174 275d 290a 2020 2020  ['mariqt']).    
+0001c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c370: 6578 6365 7074 3a0a 2020 2020 2020 2020  except:.        
+0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c390: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3b0: 2066 6f72 6d61 7420 3d20 6974 656d 4375   format = itemCu
+0001c3c0: 7374 6f6d 4461 7465 5469 6d65 466f 726d  stomDateTimeForm
+0001c3d0: 6174 0a20 2020 2020 2020 2020 2020 2020  at.             
+0001c3e0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001c3f0: 7420 3d20 6461 7465 7469 6d65 2e64 6174  t = datetime.dat
+0001c400: 6574 696d 652e 7374 7270 7469 6d65 2873  etime.strptime(s
+0001c410: 7562 4974 656d 5b27 696d 6167 652d 6461  ubItem['image-da
+0001c420: 7465 7469 6d65 275d 2c66 6f72 6d61 7429  tetime'],format)
+0001c430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c440: 2020 2020 2020 2020 2020 2020 2073 7562               sub
+0001c450: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+0001c460: 7469 6d65 275d 203d 2064 6174 6574 696d  time'] = datetim
+0001c470: 652e 6461 7465 7469 6d65 2e73 7472 6674  e.datetime.strft
+0001c480: 696d 6528 6474 2c6d 6971 7476 2e64 6174  ime(dt,miqtv.dat
+0001c490: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0001c4a0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+0001c4b0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0001c4c0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4e0: 2070 726f 672e 636c 6561 7228 290a 2020   prog.clear().  
+0001c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c500: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001c510: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+0001c520: 696f 6e28 2749 6e76 616c 6964 2064 6174  ion('Invalid dat
+0001c530: 6574 696d 6520 7661 6c75 6527 2c73 7562  etime value',sub
+0001c540: 4974 656d 5b27 696d 6167 652d 6461 7465  Item['image-date
+0001c550: 7469 6d65 275d 2c20 2264 6f65 7320 6e6f  time'], "does no
+0001c560: 7420 6d61 7463 6820 666f 726d 6174 2064  t match format d
+0001c570: 6566 6175 6c74 206f 7220 6375 7374 6f6d  efault or custom
+0001c580: 2066 6f72 6d61 7422 290a 2020 2020 2020   format").      
+0001c590: 2020 6966 2063 7573 746f 6d44 6174 6554    if customDateT
+0001c5a0: 696d 6546 6f72 6d61 7446 6f75 6e64 3a0a  imeFormatFound:.
+0001c5b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001c5c0: 2e70 726f 762e 6c6f 6728 2243 7573 746f  .prov.log("Custo
+0001c5d0: 6d20 6461 7465 7469 6d65 2066 6f72 6d61  m datetime forma
+0001c5e0: 7473 2066 6f75 6e64 2e20 5468 6579 2077  ts found. They w
+0001c5f0: 696c 6c20 6265 2072 6570 6c61 6365 6420  ill be replaced 
+0001c600: 6279 2074 6865 2064 6566 6175 6c74 2066  by the default f
+0001c610: 6f72 6d61 742e 2229 2020 200a 2020 2020  ormat.")   .    
+0001c620: 2020 2020 7072 6f67 2e63 6c65 6172 2829      prog.clear()
+0001c630: 2020 2020 0a0a 0a20 2020 2064 6566 205f      ...    def _
+0001c640: 5f69 6e69 7449 6e74 6572 6d65 6469 6174  _initIntermediat
+0001c650: 6546 696c 6573 2873 656c 6629 3a0a 2020  eFiles(self):.  
+0001c660: 2020 2020 2020 7365 6c66 2e69 6e74 6572        self.inter
+0001c670: 6d65 6469 6174 6546 696c 6573 4465 665f  mediateFilesDef_
+0001c680: 636f 7265 203d 207b 0a20 2020 2020 2020  core = {.       
+0001c690: 2020 2020 2027 6861 7368 6573 273a 207b       'hashes': {
+0001c6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c6b0: 2027 6372 6561 7469 6f6e 4663 7427 3a20   'creationFct': 
+0001c6c0: 2763 7265 6174 655f 696d 6167 655f 7368  'create_image_sh
+0001c6d0: 6132 3536 5f66 696c 6528 2927 2c0a 2020  a256_file()',.  
+0001c6e0: 2020 2020 2020 2020 2020 2020 2020 2773                's
+0001c6f0: 7566 6669 7827 3a20 275f 696d 6167 652d  uffix': '_image-
+0001c700: 6861 7368 6573 2e74 7874 272c 0a20 2020  hashes.txt',.   
+0001c710: 2020 2020 2020 2020 2020 2020 2027 636f               'co
+0001c720: 6c73 273a 205b 6d69 7174 762e 636f 6c5f  ls': [miqtv.col_
+0001c730: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+0001c740: 5b27 6861 7368 275d 5d2c 0a20 2020 2020  ['hash']],.     
+0001c750: 2020 2020 2020 2020 2020 2027 6f70 7469             'opti
+0001c760: 6f6e 616c 273a 205b 5d7d 2c0a 2020 2020  onal': []},.    
+0001c770: 2020 2020 2020 2020 2775 7569 6473 273a          'uuids':
+0001c780: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0001c790: 2020 2027 6372 6561 7469 6f6e 4663 7427     'creationFct'
+0001c7a0: 3a20 2763 7265 6174 655f 7575 6964 5f66  : 'create_uuid_f
+0001c7b0: 696c 6528 2927 2c0a 2020 2020 2020 2020  ile()',.        
+0001c7c0: 2020 2020 2020 2020 2773 7566 6669 7827          'suffix'
+0001c7d0: 3a20 275f 696d 6167 652d 7575 6964 732e  : '_image-uuids.
+0001c7e0: 7478 7427 2c0a 2020 2020 2020 2020 2020  txt',.          
+0001c7f0: 2020 2020 2020 2763 6f6c 7327 3a20 5b6d        'cols': [m
 0001c800: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-0001c810: 276d 6172 6971 7427 5d5b 2775 6e63 6572  'mariqt']['uncer
-0001c820: 7427 5d5d 7d2c 0a20 2020 2020 2020 207d  t']]},.        }
-0001c830: 0a0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
-0001c840: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
-0001c850: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
-0001c860: 696c 6573 203d 205b 5d0a 0a20 2020 2064  iles = []..    d
-0001c870: 6566 205f 5f67 6574 5f69 6e74 5f66 696c  ef __get_int_fil
-0001c880: 655f 7072 6566 6978 2873 656c 6629 3a0a  e_prefix(self):.
-0001c890: 2020 2020 2020 2020 2222 2220 6465 7065          """ depe
-0001c8a0: 6e64 7320 6f6e 2027 696d 6167 652d 6576  nds on 'image-ev
-0001c8b0: 656e 7427 2061 6e64 2027 696d 6167 652d  ent' and 'image-
-0001c8c0: 7365 6e73 6f72 2720 736f 2069 7420 6361  sensor' so it ca
-0001c8d0: 6e20 6368 616e 6765 2064 7572 696e 6720  n change during 
-0001c8e0: 7570 6174 6520 2222 220a 2020 2020 2020  upate """.      
-0001c8f0: 2020 7265 7475 726e 206f 732e 7061 7468    return os.path
-0001c900: 2e6a 6f69 6e28 7365 6c66 2e64 6972 2e74  .join(self.dir.t
-0001c910: 6f28 7365 6c66 2e64 6972 2e64 742e 696e  o(self.dir.dt.in
-0001c920: 7465 726d 6564 6961 7465 292c 2073 656c  termediate), sel
-0001c930: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
-0001c940: 696d 6167 652d 7365 742d 6e61 6d65 2729  image-set-name')
-0001c950: 290a 0a20 2020 2064 6566 2067 6574 5f69  )..    def get_i
-0001c960: 6e74 5f68 6173 685f 6669 6c65 2873 656c  nt_hash_file(sel
-0001c970: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
-0001c980: 726e 2073 656c 662e 5f5f 6765 745f 696e  rn self.__get_in
-0001c990: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
-0001c9a0: 2b20 7365 6c66 2e69 6e74 6572 6d65 6469  + self.intermedi
-0001c9b0: 6174 6546 696c 6573 4465 665f 636f 7265  ateFilesDef_core
-0001c9c0: 5b27 6861 7368 6573 275d 5b27 7375 6666  ['hashes']['suff
-0001c9d0: 6978 275d 0a0a 2020 2020 6465 6620 6765  ix']..    def ge
-0001c9e0: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
-0001c9f0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0001ca00: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
-0001ca10: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
-0001ca20: 2829 202b 2073 656c 662e 696e 7465 726d  () + self.interm
-0001ca30: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
-0001ca40: 6f72 655b 2775 7569 6473 275d 5b27 7375  ore['uuids']['su
-0001ca50: 6666 6978 275d 0a0a 2020 2020 6465 6620  ffix']..    def 
-0001ca60: 6765 745f 696e 745f 7374 6172 7454 696d  get_int_startTim
-0001ca70: 6573 5f66 696c 6528 7365 6c66 293a 0a20  es_file(self):. 
-0001ca80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001ca90: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
-0001caa0: 655f 7072 6566 6978 2829 202b 2073 656c  e_prefix() + sel
-0001cab0: 662e 696e 7465 726d 6564 6961 7465 4669  f.intermediateFi
-0001cac0: 6c65 7344 6566 5f63 6f72 655b 2764 6174  lesDef_core['dat
-0001cad0: 6574 696d 6527 5d5b 2773 7566 6669 7827  etime']['suffix'
-0001cae0: 5d0a 0a20 2020 2064 6566 2067 6574 5f69  ]..    def get_i
-0001caf0: 6e74 5f6e 6176 5f66 696c 6528 7365 6c66  nt_nav_file(self
-0001cb00: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0001cb10: 6e20 7365 6c66 2e5f 5f67 6574 5f69 6e74  n self.__get_int
-0001cb20: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
-0001cb30: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
-0001cb40: 7465 4669 6c65 7344 6566 5f63 6f72 655b  teFilesDef_core[
-0001cb50: 276e 6176 6967 6174 696f 6e27 5d5b 2773  'navigation']['s
-0001cb60: 7566 6669 7827 5d0a 0a                   uffix']..
+0001c810: 276d 6172 6971 7427 5d5b 2775 7569 6427  'mariqt']['uuid'
+0001c820: 5d5d 2c0a 2020 2020 2020 2020 2020 2020  ]],.            
+0001c830: 2020 2020 276f 7074 696f 6e61 6c27 3a20      'optional': 
+0001c840: 5b5d 7d2c 0a20 2020 2020 2020 2020 2020  []},.           
+0001c850: 2027 6461 7465 7469 6d65 273a 207b 0a20   'datetime': {. 
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001c870: 6372 6561 7469 6f6e 4663 7427 3a20 2763  creationFct': 'c
+0001c880: 7265 6174 655f 7374 6172 745f 7469 6d65  reate_start_time
+0001c890: 5f66 696c 6528 2927 2c0a 2020 2020 2020  _file()',.      
+0001c8a0: 2020 2020 2020 2020 2020 2773 7566 6669            'suffi
+0001c8b0: 7827 3a20 275f 696d 6167 652d 7374 6172  x': '_image-star
+0001c8c0: 742d 7469 6d65 732e 7478 7427 2c0a 2020  t-times.txt',.  
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001c8e0: 6f6c 7327 3a20 5b6d 6971 7476 2e63 6f6c  ols': [miqtv.col
+0001c8f0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+0001c900: 5d5b 2775 7463 275d 5d2c 0a20 2020 2020  ]['utc']],.     
+0001c910: 2020 2020 2020 2020 2020 2027 6f70 7469             'opti
+0001c920: 6f6e 616c 273a 205b 5d7d 2c0a 2020 2020  onal': []},.    
+0001c930: 2020 2020 2020 2020 276e 6176 6967 6174          'navigat
+0001c940: 696f 6e27 3a20 7b0a 2020 2020 2020 2020  ion': {.        
+0001c950: 2020 2020 2020 2020 2763 7265 6174 696f          'creatio
+0001c960: 6e46 6374 273a 2027 6372 6561 7465 5f69  nFct': 'create_i
+0001c970: 6d61 6765 5f6e 6176 6967 6174 696f 6e5f  mage_navigation_
+0001c980: 6669 6c65 2829 272c 0a20 2020 2020 2020  file()',.       
+0001c990: 2020 2020 2020 2020 2027 7375 6666 6978           'suffix
+0001c9a0: 273a 2027 5f69 6d61 6765 2d6e 6176 6967  ': '_image-navig
+0001c9b0: 6174 696f 6e2e 7478 7427 2c0a 2020 2020  ation.txt',.    
+0001c9c0: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
+0001c9d0: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
+0001c9e0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+0001c9f0: 2775 7463 275d 5d2c 0a20 2020 2020 2020  'utc']],.       
+0001ca00: 2020 2020 2020 2020 2027 6f70 7469 6f6e           'option
+0001ca10: 616c 273a 205b 6d69 7174 762e 636f 6c5f  al': [miqtv.col_
+0001ca20: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+0001ca30: 5b27 6c6f 6e27 5d2c 206d 6971 7476 2e63  ['lon'], miqtv.c
+0001ca40: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+0001ca50: 7427 5d5b 276c 6174 275d 2c20 6d69 7174  t']['lat'], miqt
+0001ca60: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001ca70: 7269 7174 275d 5b27 616c 7427 5d2c 206d  riqt']['alt'], m
+0001ca80: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+0001ca90: 276d 6172 6971 7427 5d5b 2768 6774 275d  'mariqt']['hgt']
+0001caa0: 2c20 6d69 7174 762e 636f 6c5f 6865 6164  , miqtv.col_head
+0001cab0: 6572 5b27 6d61 7269 7174 275d 5b27 756e  er['mariqt']['un
+0001cac0: 6365 7274 275d 5d7d 2c0a 2020 2020 2020  cert']]},.      
+0001cad0: 2020 7d0a 0a20 2020 2020 2020 2073 656c    }..        sel
+0001cae0: 662e 6e6f 6e43 6f72 6546 6965 6c64 496e  f.nonCoreFieldIn
+0001caf0: 7465 726d 6564 6961 7465 4974 656d 496e  termediateItemIn
+0001cb00: 666f 4669 6c65 7320 3d20 5b5d 0a0a 2020  foFiles = []..  
+0001cb10: 2020 6465 6620 5f5f 6765 745f 696e 745f    def __get_int_
+0001cb20: 6669 6c65 5f70 7265 6669 7828 7365 6c66  file_prefix(self
+0001cb30: 293a 0a20 2020 2020 2020 2022 2222 2064  ):.        """ d
+0001cb40: 6570 656e 6473 206f 6e20 2769 6d61 6765  epends on 'image
+0001cb50: 2d65 7665 6e74 2720 616e 6420 2769 6d61  -event' and 'ima
+0001cb60: 6765 2d73 656e 736f 7227 2073 6f20 6974  ge-sensor' so it
+0001cb70: 2063 616e 2063 6861 6e67 6520 6475 7269   can change duri
+0001cb80: 6e67 2075 7061 7465 2022 2222 0a20 2020  ng upate """.   
+0001cb90: 2020 2020 2072 6574 7572 6e20 6f73 2e70       return os.p
+0001cba0: 6174 682e 6a6f 696e 2873 656c 662e 6469  ath.join(self.di
+0001cbb0: 722e 746f 2873 656c 662e 6469 722e 6474  r.to(self.dir.dt
+0001cbc0: 2e69 6e74 6572 6d65 6469 6174 6529 2c20  .intermediate), 
+0001cbd0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0001cbe0: 6428 2769 6d61 6765 2d73 6574 2d6e 616d  d('image-set-nam
+0001cbf0: 6527 2929 0a0a 2020 2020 6465 6620 6765  e'))..    def ge
+0001cc00: 745f 696e 745f 6861 7368 5f66 696c 6528  t_int_hash_file(
+0001cc10: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0001cc20: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
+0001cc30: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
+0001cc40: 2829 202b 2073 656c 662e 696e 7465 726d  () + self.interm
+0001cc50: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
+0001cc60: 6f72 655b 2768 6173 6865 7327 5d5b 2773  ore['hashes']['s
+0001cc70: 7566 6669 7827 5d0a 0a20 2020 2064 6566  uffix']..    def
+0001cc80: 2067 6574 5f69 6e74 5f75 7569 645f 6669   get_int_uuid_fi
+0001cc90: 6c65 2873 656c 6629 3a0a 2020 2020 2020  le(self):.      
+0001cca0: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+0001ccb0: 6765 745f 696e 745f 6669 6c65 5f70 7265  get_int_file_pre
+0001ccc0: 6669 7828 2920 2b20 7365 6c66 2e69 6e74  fix() + self.int
+0001ccd0: 6572 6d65 6469 6174 6546 696c 6573 4465  ermediateFilesDe
+0001cce0: 665f 636f 7265 5b27 7575 6964 7327 5d5b  f_core['uuids'][
+0001ccf0: 2773 7566 6669 7827 5d0a 0a20 2020 2064  'suffix']..    d
+0001cd00: 6566 2067 6574 5f69 6e74 5f73 7461 7274  ef get_int_start
+0001cd10: 5469 6d65 735f 6669 6c65 2873 656c 6629  Times_file(self)
+0001cd20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001cd30: 2073 656c 662e 5f5f 6765 745f 696e 745f   self.__get_int_
+0001cd40: 6669 6c65 5f70 7265 6669 7828 2920 2b20  file_prefix() + 
+0001cd50: 7365 6c66 2e69 6e74 6572 6d65 6469 6174  self.intermediat
+0001cd60: 6546 696c 6573 4465 665f 636f 7265 5b27  eFilesDef_core['
+0001cd70: 6461 7465 7469 6d65 275d 5b27 7375 6666  datetime']['suff
+0001cd80: 6978 275d 0a0a 2020 2020 6465 6620 6765  ix']..    def ge
+0001cd90: 745f 696e 745f 6e61 765f 6669 6c65 2873  t_int_nav_file(s
+0001cda0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
+0001cdb0: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
+0001cdc0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+0001cdd0: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
+0001cde0: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
+0001cdf0: 7265 5b27 6e61 7669 6761 7469 6f6e 275d  re['navigation']
+0001ce00: 5b27 7375 6666 6978 275d 0a0a            ['suffix']..
```

## Comparing `mariqt-0.5.7.dist-info/LICENSE` & `mariqt-0.5.8.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.5.7.dist-info/METADATA` & `mariqt-0.5.8.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.5.7
+Version: 0.5.8
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.5.7.dist-info/RECORD` & `mariqt-0.5.8.dist-info/RECORD`

 * *Files 9% similar despite different names*

```diff
@@ -8,24 +8,24 @@
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
 mariqt/navigation.py,sha256=3NFKxFggEVeZKM8RMketkNDeJe8MpAbfoGkF6FgjDLM,40980
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=BWJy4ejhsSINzhR_88HGfYeXVnPKbdMwDE-u2qLl6C0,8323
 mariqt/variables.py,sha256=TtGb3UVwJnE5tmDEOxuZlCFofebgEWiKr7Soh_DFk5g,9613
-mariqt/version.py,sha256=jR3u8xyb9ug4uh2IHlgd9VqSEn4enmk3_KpGlQQjNtM,21
+mariqt/version.py,sha256=4z8MqtGBtOcbYu_3DvdmU5SaNZeJl5pfcqzI9wsbFcc,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json,sha256=qKNwXPjk7NSpYI3PYGEItxsoyPUDTzJUNaJlqloWIHA,42461
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=2vAlW0oh4iHwRCkBQnbCZ4yhXNzVi7aKPnqNrN5RwI0,4684
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=fyTlaQL1vs61AaJqRNkTeJr3C_mX1e5_tiUIFHMgBp4,117609
+mariqt/sources/ifdo.py,sha256=9Sj5o1Dp6LzFfboKyezjv_jrapiAtotX2akN_8ySB6A,118284
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.5.7.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.5.7.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.5.7.dist-info/METADATA,sha256=jvkUl_vE4-ymCbEV5-nTlChcFS4sZ0fa2ckmiXxXDhA,1133
-mariqt-0.5.7.dist-info/WHEEL,sha256=k3vXr0c0OitO0k9eCWBlI2yTYnpb_n_I2SGzrrfY7HY,110
-mariqt-0.5.7.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.5.7.dist-info/RECORD,,
+mariqt-0.5.8.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.5.8.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.5.8.dist-info/METADATA,sha256=ZT8zId2gvF4lCucZmC_laQw6hZzWG6zaI72VLqpQ1ho,1133
+mariqt-0.5.8.dist-info/WHEEL,sha256=k3vXr0c0OitO0k9eCWBlI2yTYnpb_n_I2SGzrrfY7HY,110
+mariqt-0.5.8.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.5.8.dist-info/RECORD,,
```

